import{b as Ne}from"./chunk-JLNOW4KR.js";import{a as $e}from"./chunk-Q2NFJPGV.js";import{a as Ze}from"./chunk-W6JKZXLB.js";import{a as Qe}from"./chunk-CXT4EHFX.js";import{a as le}from"./chunk-5E2Y3UHC.js";import{a as me}from"./chunk-OQZ6UOCK.js";import{c as ge,h as se,q as Xe,r as ce}from"./chunk-TEVAE4SY.js";import{a as je}from"./chunk-V2QGBG3D.js";import{a as Je}from"./chunk-7GRDW7ZD.js";import{a as eo}from"./chunk-VY37IS5A.js";import{a as _e}from"./chunk-CIEH2J25.js";import{l as Te}from"./chunk-NKIUEXOA.js";import{b as pe}from"./chunk-LKSOM4R2.js";import{v as Ke,w as Ye}from"./chunk-CDNJY7Z3.js";import{d as H}from"./chunk-7JSJY3SQ.js";import{c as qe}from"./chunk-NWY3GPDX.js";import{b as Ue}from"./chunk-A5XY2FFW.js";import{h as ze,i as He}from"./chunk-R7LZSAVU.js";import{a as ie}from"./chunk-5CHE7P4E.js";import{h as ae}from"./chunk-AZNX5TUC.js";import{e as Ve}from"./chunk-XZE3L7K7.js";import{a as we}from"./chunk-WGVA2GGS.js";import{o as Oo}from"./chunk-XP3TNE3R.js";import{$a as Me,T as De,ab as ye,bb as Re,cb as Ge,db as ve,jc as ne}from"./chunk-QRHYK2TW.js";import{j as te,p as We}from"./chunk-Q4YLD24R.js";import{c as Be,e as Po}from"./chunk-AS4Z3FNS.js";import{F as k}from"./chunk-4EIUGT5A.js";import{c as re}from"./chunk-62ZAND24.js";import{J as Fe,L as ee,Mb as Y,Nb as be,Pc as Le,Q as Ce,S as Pe,fc as Se,ia as Oe,mc as oe,od as he}from"./chunk-QHXUL3YM.js";import{H as de,n as ke,y as W}from"./chunk-MOTAOJVG.js";import{d as Ee}from"./chunk-XR4SQWL7.js";import{L as $,f as xe,ra as Ae}from"./chunk-CYTB2B6Q.js";import{b as v}from"./chunk-OL67KS7C.js";import{f as x,o as r,q as a}from"./chunk-SHG7TIBL.js";r();a();var Ie=x(v());r();a();var V=x(v());he();r();a();var oo=x(ne());r();a();Po();function ue(e){return async()=>await Be().handleTxBySigner(e)}he();function Eo({walletId:e,method:t,message:o,onConfirm:n}){let c=(0,oo.useDispatch)();return async()=>{let l=await c(ue({walletId:e,localType:oe,method:t,params:{message:o}})),{publicKey:m,signature:u}=l||{},p=ve(Ge(m),u);return n(p)}}var to=Eo;var no=e=>{let{walletId:t,method:o,params:n,source:c,onConfirm:i,onCancel:l}=e,m=c==="dapp",[u,p]=(0,V.useState)({}),h=typeof n?.message=="string"?n?.message:new TextDecoder().decode(n?.message),f=to({walletId:t,method:o,message:h,onConfirm:i}),d,C,g;m||(d=f,C=!0,g=l);let O=me(e),w=H(Le)||{},s=ie(w?.localType,t),_=(0,V.useMemo)(()=>({method:o,dappData:JSON.stringify({message:h}),dappInfo:m?O:{},from:s,message:h,chainIndex:w.chainId}),[s]),T=ae(t),I=Ze({unapproved:e,onConfirm:d,onConfirmReplace:C,onCancel:g,preExecInfo:u}),y=le({initialType:T.initialType}),z=(0,V.useMemo)(()=>[y()].filter(Boolean),[y]);return V.default.createElement(ce,{needPreExecFn:()=>!1,preExecParams:_,buttonGroup:I,txType:Xe.signMessage,handleCancel:g,walletAccount:T,onUpdatePreExecInfo:p,chainHeaderTips:z,localType:w?.localType,slot:{bottom:!!n?.isSilentSign&&V.default.createElement(se,null)}})};r();a();var X=x(v());r();a();var P=x(v()),lo=x(Oo());Ae();de();Se();r();a();de();var bo=({feeLoading:e,estimateFailed:t,isSufficientGas:o,isSufficientBalance:n,onCancel:c,onConfirm:i,chainConfirmDisabled:l=!1,coinWithBalance:m={},preExecInfo:u={}})=>{let{isBalanceLoading:p}=m,f=l||e||t||(!o||!n)||u?.canConfirm===!1,{loading:d,onClick:C}=_e(c),g={onClick:C,loading:d,actionType:Te.ACTION_TYPE.CANCEL,btnText:W("wallet_dapp_connection_btn_reject")},{loading:O,onClick:w}=_e(i),s={disabled:f,loading:O||p,onClick:w,actionType:Te.ACTION_TYPE.CONFIRM};return{buttonGroup:[g,s],handleCancel:c}},ro=bo;r();a();var B=x(v());de();r();a();var j={root:"_root_b2owh_1",text:"_text_b2owh_4",currentChainText:"_currentChainText_b2owh_7",switchNetwork:"_switchNetwork_b2owh_12"};function Lo({origin:e,providerType:t,chainName:o,onClick:n,onClose:c,onNetworkChange:i}){let[l,m]=(0,B.useState)(!1);return B.default.createElement(re.Box,{className:j.root},B.default.createElement(Ee,{closable:!1,desc:B.default.createElement("span",{className:j.text},B.default.createElement("span",{className:j.currentChainText},W("wallet_extension_approval_toast_current_switch",{network:o})),B.default.createElement("span",{className:j.switchNetwork,onClick:()=>{m(!0),n&&n()}},W("wallet_extension_approval_textbtn_current_switch")))}),B.default.createElement(Ne,{origin:e,visible:l,onClose:()=>{m(!1),c&&c()},onNetworkChange:i,providerType:t},B.default.createElement(Ne.Header,{title:W("wallet_extension_sonic_desc_switch_network")})))}var ao=Lo;r();a();var so=x(v());Ae();r();a();var A=x(v());Oe();function Do({coinId:e,transactions:t,address:o,replace:n,disabled:c,unitLimits:i,signInfo:l}){let[m,u]=(0,A.useState)(0),[p,h]=(0,A.useState)(null),[f,d]=(0,A.useState)([]),[C,g]=(0,A.useState)("0"),[O,w]=(0,A.useState)([]),[s,_]=(0,A.useState)(!1),T=p?.fee||"0",[I,y]=(0,A.useState)(t||[]),z=eo(),E=H(e),{disabledSignInfo:U=!1,disabledPreExecute:M=!1}=c||{},b=R=>{u(R?S=>S+1:S=>S-1)};return(0,A.useEffect)(()=>{i&&d(i)},[i]),(0,A.useEffect)(()=>{l&&h(l)},[l]),(0,A.useEffect)(()=>{(async function(){if(!(U||!e)){b(!0);try{let{data:S={}}=await De({coinId:e,address:o}),{info:G={}}=S;h(G),_(!1)}catch{_(!0)}finally{b(!1)}}})()},[o,e,U]),(0,A.useEffect)(()=>{(async function(){if(!(M||!e)&&!(!n||!E?.chainId)){b(!0);try{let S=await z({coinId:e,from:o,chainId:E.chainId,simulateTransactionParamList:(t||[]).map(({serializedMessage:G})=>({transaction:G,sigVerify:!1,replaceRecentBlockhash:!0}))});d(S.unitLimits),_(!1)}catch{_(!0)}finally{b(!1)}}})()},[t,n,o,E?.chainId,M,e]),(0,A.useEffect)(()=>{(async function(){if(!(n&&(!p||!f?.length))){b(!0);try{let S=t||[];n&&(S=await Promise.all(S.map(async(D,q)=>{let{serializedMessage:F,whetherModified:J,...Q}=D,Z=await Ye(F,p.computeUnitPrice,f[q],J);return{...Q,serializedMessage:Z,whetherModified:J}})));let{totalPriorityFee:G,priorityFees:L}=await Ke(S.map(({serializedMessage:D})=>D));g(G),y(S),w(L),_(!1)}catch{_(!0)}finally{b(!1)}}})()},[t,n,p,f]),{loading:m>0,baseFee:T,totalPriorityFee:C,priorityFees:O,totalFee:ee(Fe(T,(t||[]).length),C),signInfo:p,estimateFailed:s,replacedTransactions:I}}var io=Do;Oe();var Bo=({from:e,coinId:t,preExecInfo:o,walletId:n,transactions:c,addPriorityFee:i})=>{let l=o?.loading,m=(0,so.useMemo)(()=>o?.unitGasLimitList||[],[o]),u=m.find(E=>$(E)||Pe(E,"0")),{loading:p,totalFee:h,baseFee:f,priorityFees:d,estimateFailed:C,signInfo:g,replacedTransactions:O}=io({coinId:t,transactions:c||[],address:e,replace:i,unitLimits:m,disabled:{disabledPreExecute:!0}}),w=g?.solRent||"0",s=C||!l&&!!u,_=je(t,n)||{},{coinAmountInt:T}=_,I=$(T)||Ce(T,h)||l,y=$(T)||Ce(T,ee(h,w))||l;return{loading:p,networkFeeProps:{loading:p,networkFee:h,estimateFailed:s,coinId:t},isSufficientGas:I,baseFee:f,priorityFees:d,networkFee:h,estimateFailed:s,estimateFailedMsg:u?.msg,isSufficientBalance:y,selfRent:w,replacedTransactions:O,coinWithBalance:_}},co=Bo;function Mo({txId:e,coinId:t,walletId:o,transactions:n=[],dappInfo:c={},showDappInfo:i=!0,addPriorityFee:l=!0,showSwitchNetwork:m=!0,onConfirm:u,onCancel:p,onAddressCopy:h=xe,onNetworkChange:f,method:d,providerType:C=Y,slot:g={}}){let O=pe(C),w=t||O?.coinId,s=H(w)||{},_=s.localType,T=ae(o),I=ie(_,o),[y,z]=(0,P.useState)({}),E=(0,P.useMemo)(()=>n.map(K=>{try{if(K.serializedMessage)return K;let fe=Re(K);return{instanceType:fe,serializedMessage:Me(K,fe),needToReplaceRecentBlockhash:!K.recentBlockhash}}catch{return null}}).filter(Boolean),[n.length]),{networkFee:U,isSufficientGas:M,networkFeeProps:b,estimateFailed:R,estimateFailedMsg:S,loading:G,isSufficientBalance:L,selfRent:D,replacedTransactions:q,coinWithBalance:F}=co({from:I,coinId:w,walletId:o,transactions:E,addPriorityFee:l,preExecInfo:y}),J=(0,P.useCallback)(()=>!L&&M?{renderMessage:()=>W("wallet_extension_loading_text_reserve_rent_exempt",{num:ke.div(D,10**s?.decimals),token:s?.symbol,balance:we(F?.coinAmount,{precision:F?.decimals}).value}),level:761,type:ge.FEE_BALANCE_INSUFFICIENT,txId:e,coinId:s?.coinId,address:I,walletId:o}:null,[L,M,e,s?.coinId,s?.decimals,s?.symbol,I,o,D,F?.coinAmount]),Q=le({initialType:T.initialType}),Z=(0,P.useCallback)(()=>y?.needFillUp?{renderMessage:()=>W("wallet_extension_trade_text_insufficient_funds",{token:s?.symbol,balance:we(F?.coinAmount,{precision:F?.decimals}).value}),level:825,type:ge.FEE_BALANCE_INSUFFICIENT,txId:e,coinId:s?.coinId,address:I,walletId:o}:null,[s?.coinId,s?.symbol,I,y?.needFillUp,F?.coinAmount,e,o]),No=(0,P.useMemo)(()=>[J(),Q(),Z()].filter(Boolean),[J,Q,Z]),Io=(0,P.useMemo)(()=>({dappData:JSON.stringify(E.map(K=>({transaction:K.serializedMessage,sigVerify:!1,replaceRecentBlockhash:!0}))),from:I,dappInfo:i?c:{},chainIndex:s?.chainId,method:d,forceLoading:!0}),[s?.chainId]),xo=(0,lo.useMemoizedFn)(async()=>{await u({serviceCharge:U,replacedTransactions:q,serializedTransactions:E})}),{handleCancel:Ao,buttonGroup:ko}=ro({feeLoading:G,estimateFailed:R,isSufficientGas:M,isSufficientBalance:L,onCancel:p,onConfirm:xo,chainConfirmDisabled:Ve(T.initialType),coinWithBalance:F,preExecInfo:y}),Fo={txId:e,baseCoin:s,estimateFailed:R,isSufficientBalance:L,isSufficientGas:M,estimateFailedMsg:S,coinWithBalance:F};return P.default.createElement(ce,{slot:{...g,top:m&&P.default.createElement(ao,{providerType:C,chainName:s?.chainName,onNetworkChange:f})},chainHeaderTips:No,networkFeeProps:b,preExecParams:Io,onAddressCopy:h,walletAccount:T,handleCancel:Ao,buttonGroup:ko,localType:s?.localType,txState:Fo,onUpdatePreExecInfo:z})}var mo=Mo;Se();r();a();var po=x(v()),uo=x(ne());We();function Ro({walletId:e,localType:t,id:o,origin:n}){let c=(0,uo.useDispatch)(),i=Je(e);return(0,po.useCallback)(async()=>{i({trade:"contract_interaction",all_confirmation:"cancel",network:t,dapp_url:n}),await c(ze(o)),await te(c)},[i,o,t,n])}var fo=Ro;r();a();var Co=x(v()),So=x(ne());We();function Go({coinId:e,id:t,localType:o,origin:n}){let c=(0,So.useDispatch)();return(0,Co.useCallback)(async({replacedTransactions:i,serviceCharge:l})=>{await c(He(t,{coinId:e,replacedTransactions:i,serviceCharge:l})),await te(c)},[o,n])}var ho=Go;r();a();Se();function vo(e){let{coinId:t,showSwitchNetwork:o=!0}=e?.params?.extParams||{},{providerType:n=Y}=e?.params||{},i=pe(n)?.coinId;return{coinId:t||i,showSwitchNetwork:n===be?!1:o}}var yo=vo;r();a();var wo=x(ne());he();function Wo({coinId:e,walletId:t,method:o,okxArgs:n,onConfirm:c}){let i=(0,wo.useDispatch)();return async({replacedTransactions:l,serviceCharge:m,serializedTransactions:u})=>{let f=await i(ue({walletId:t,localType:oe,method:o,params:{message:u,okxArgs:n},extraParams:{coinId:e,replacedTransactions:l,serviceCharge:m}})),d;if(o===k.SIGN_ALL_TRANSACTIONS)d=(f.signedTransactionResults||[]).map(({serializedTransaction:C,type:g})=>ye(C,g));else if(o===k.SIGN_TRANSACTION){let{instanceType:C}=u[0]||{};d=ye(f.serializedTransaction,C)}else o===k.SIGN_AND_SEND_TRANSACTION&&(d=f);return c(d)}}var To=Wo;r();a();var go={root:"_root_1ou6i_1"};var _o=e=>{let{id:t,coinId:o,method:n,params:c,walletId:i,origin:l,source:m,dappInfo:u,showDappInfo:p=!0,addPriorityFee:h=!0,showSwitchNetwork:f,onConfirm:d,onCancel:C,onAddressCopy:g,okxArgs:O}=e,{providerType:w=Y,isSilentSign:s}=c,{coinId:_,showSwitchNetwork:T}=yo(e),I=me(e),y=o||_,z=qe({coinId:y}),U=(H(y)||{}).localType,M=c?.message||[],b=ho({coinId:y,id:t,walletId:i,localType:U,origin:l}),R=fo({walletId:i,localType:U,id:t,origin:l}),S=Qe({walletId:i}),G=To({coinId:y,walletId:i,method:n,okxArgs:O,onConfirm:d}),L,D,q;m==="dapp"?(L=b,D=R,q=S):(L=G,D=C,q=g);let{loading:F}=$e({unapproved:{origin:l,id:t},network:z?.chainName,providerType:w});return F?X.default.createElement(re.Box,{className:go.root},X.default.createElement(Ue,null)):X.default.createElement(mo,{method:n,coinId:y,showSwitchNetwork:typeof f=="boolean"?f:T,slot:{bottom:s&&X.default.createElement(se,null)},txId:t,walletId:i,transactions:M,dappInfo:u||I,showDappInfo:p,addPriorityFee:h,onConfirm:L,onCancel:D,onAddressCopy:q,providerType:w})};function zo(e){switch(e.method){case k.SIGN_TRANSACTION:case k.RPC_SIGN_TRANSACTION:case k.SIGN_AND_SEND_TRANSACTION:case k.RPC_SIGN_AND_SEND_TRANSACTION:case k.SIGN_ALL_TRANSACTIONS:case k.RPC_SIGN_ALL_TRANSACTIONS:return Ie.default.createElement(_o,{...e});case k.SIGN_MESSAGE:case k.RPC_SIGN_MESSAGE:return Ie.default.createElement(no,{...e});default:return""}}var rr=zo;export{rr as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-U5SYUPQF.js.map
