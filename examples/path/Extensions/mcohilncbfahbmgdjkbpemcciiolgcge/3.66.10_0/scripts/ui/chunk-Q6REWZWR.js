import{a as Fe}from"./chunk-5QHVWW7O.js";import{c as de,d as U}from"./chunk-5PDHABUQ.js";import{a as Le}from"./chunk-36PYO4PJ.js";import{e as xe}from"./chunk-636UWIUZ.js";import{b as N}from"./chunk-KDVER5QK.js";import{a as V}from"./chunk-PD44C7EF.js";import{a as he}from"./chunk-WGVA2GGS.js";import{o as J}from"./chunk-XP3TNE3R.js";import{G as Pe}from"./chunk-QRHYK2TW.js";import{c as ye}from"./chunk-NU4UJZBB.js";import{a as ge,b as K}from"./chunk-2FDQIA7D.js";import{_ as C}from"./chunk-4EIUGT5A.js";import{Ab as Ge,Jb as Xe,L as T,M as S,Ma as pe,N as me,Na as $e,O as B,Q as H,V as ue,X as le,Y as fe,aa as W,ia as $,ma as X,ra as ze}from"./chunk-QHXUL3YM.js";import{H as qe,n as w,y as ce}from"./chunk-MOTAOJVG.js";import{H as ae,L as ne,f as re,ra as oe}from"./chunk-CYTB2B6Q.js";import{b as A}from"./chunk-OL67KS7C.js";import{f as R,o as g,q as d}from"./chunk-SHG7TIBL.js";g();d();var h=R(A()),M=R(J());oe();qe();$e();Xe();$();g();d();var _=R(A()),_e=R(J());g();d();var Re=R(A()),D=R(J());$();g();d();ze();$();var Ce=async(e={})=>!(e?.baseFeePerGas===void 0||e?.baseFeePerGas===null),Z=e=>parseInt(e,16);function Je({baseFeePerGas:e,number:t}){return{number:t,baseFeePerGas:e,gasUsedRatio:null,priorityFeesByPercentile:null}}function Ke({baseFeePerGas:e,number:t,blockIndex:r,gasUsedRatios:s,priorityFeePercentileGroups:i,percentiles:a}){let o=s[r],n=i[r],u=a.reduce((c,m,l)=>{let f=n[l];return{...c,[m]:Z(f)}},{});return{number:t,baseFeePerGas:e,gasUsedRatio:o,priorityFeesByPercentile:u}}async function Ee({provider:e,numberOfBlocks:t,endBlockNumber:r,percentiles:s,includeNextBlock:i}){let a=X(K(t)),o=X(K(r)),n=await e.send("eth_feeHistory",[a,o,s]),u=Z(n.oldestBlock);if(n.baseFeePerGas!==void 0&&n.baseFeePerGas.length>0&&n.gasUsedRatio.length>0&&(n.reward===void 0||n.reward.length>0)){let c=i?n.baseFeePerGas:n.baseFeePerGas.slice(0,t),m=n.gasUsedRatio,l=n.reward??[],f=m.length;return c.map((L,G)=>{let P=Z(L),v=T(u,G);return G>=f?Je({baseFeePerGas:P,number:v}):Ke({baseFeePerGas:P,number:v,blockIndex:G,gasUsedRatios:m,priorityFeePercentileGroups:l,percentiles:s})})}return[]}var Q=1024;function Qe(e,t){B(e,t)&&(t=e);let r=[];for(let s=S(e,t);B(s,e);s=T(s,Q)){let i=S(e,s),a=i<Q?i:Q,o=T(s,a);r.push({numberOfBlocks:a,endBlockNumber:o})}return r}var Te=async({provider:e,numberOfBlocks:t,endBlock:r="latest",percentiles:s=[],includeNextBlock:i=!1})=>{let a=s.length>0?Array.from(new Set(s)).sort((c,m)=>c-m):[],n=Qe(r,t);return(await Promise.all(n.map(({numberOfBlocks:c,endBlockNumber:m},l)=>l===n.length-1?Ee({provider:e,numberOfBlocks:c,endBlockNumber:m,percentiles:a,includeNextBlock:i}):Ee({provider:e,numberOfBlocks:c,endBlockNumber:m,percentiles:a,includeNextBlock:!1})))).reduce((c,m)=>[...c,...m],[])};var Ze=e=>e?N(e):{},Ie=["0x144","0x2105"],je=e=>(0,Re.useCallback)(async()=>e?(await Ze(e)).getBlock("latest"):{},[e]),we=e=>(0,D.useMemoizedFn)(async({to:t,from:r,value:s,data:i=""},a)=>{let o=!a,n="";i?U(i)?n=Pe(i):n=de(i):o||(n=Le(t,s||0));let u=await N(e),c={from:r,to:o?t:a};return o?c.value=s:c.value="0x0",n?c.data=n:c.data="0x",(await u.estimateGas(c)).toString()},[e]),I=["low","medium","high"],ve={low:{percentile:10,base:1.1,priority:.94,minSuggestedMaxPriorityFeePerGas:1e9,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:3e4}},medium:{percentile:20,base:1.2,priority:.97,minSuggestedMaxPriorityFeePerGas:15e8,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:45e3}},high:{percentile:30,base:1.25,priority:.98,minSuggestedMaxPriorityFeePerGas:2e9,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:6e4}}};function et(e){let t=e.slice().sort((i,a)=>B(S(i,a),0)?-1:1),r=t.length,s=Math.floor((r-1)/2);return t[s]}var tt=(e,t,r)=>{let s=r[e],i=t[t.length-1].baseFeePerGas,a=t.map(u=>"priorityFeesByPercentile"in u?u?.priorityFeesByPercentile?.[s.percentile]:null).filter(Boolean),o=et(a),n=T(i,o);return{baseFeePerGas:W(i,0),maxFeePerGas:W(n,0),maxPriorityFeePerGas:W(o,0)}},it=(e,t)=>I.reduce((r,s)=>{let i=tt(s,e,t),{maxFeePerGas:a}=i;return[...r,{level:s,isSupportEip1559:!0,gasPrice:a,...i}]},[]),st=(e,t)=>(0,D.useMemoizedFn)(async r=>{let s=await N(e),i=await Te({provider:s,endBlock:r.number,numberOfBlocks:21,percentiles:[10,20,30]});return it(i,t)},[e]),rt={low:{coefficient:1.1,level:"low"},medium:{coefficient:1.35,level:"medium"},high:{coefficient:1.7,level:"high"}},at=(e,t)=>(0,D.useMemoizedFn)(async()=>{let i=(await(await N(e)).getFeeData()).gasPrice.toString();return I.reduce((a,o)=>{let{level:n}=t[o];return[...a,{level:n,gasPrice:i}]},[])},[e]);function nt(e){let{rpcNetworks:t}=xe(),r=t.find(s=>s?.rpcUrl===e);return I.reduce((s,i)=>{let a=r?.gasNormal?.[i]||rt[i]?.coefficient,o=r?.gas1559?.[i]||ve?.[i];return{evmNormalGasPrice:{...s.evmNormalGasPrice,[i]:{level:i,coefficient:a}},evm1559GasPrice:{...s.evm1559GasPrice,[i]:{...ve[i],...o}}}},{})}var Se=(e,t={})=>{let r=nt(e),s=je(e),i=at(e,r?.evmNormalGasPrice),a=st(e,r?.evm1559GasPrice),o=t?.method;return(0,D.useMemoizedFn)(async n=>{if(e){let u=await s(),c=!ye({chainId:n,method:o})&&!Ie.includes(n)&&await Ce(u),m,l=c?a:i;try{m=await l(u)}catch{m=await i(u)}return m}return[]},[e])};var ct=({txParams:e={}},t)=>{let{to:r,from:s,value:i,data:a,tokenAddress:o}=e,[n,u]=(0,_.useState)(""),[c,m]=(0,_.useState)(""),[l,f]=(0,_.useState)(!0),[L,G]=(0,_.useState)(!1),{extensionConfig:P}=V("rpc_info"),y=we((t||P)?.rpcUrl),{run:x}=(0,_e.useDebounceFn)(async()=>{try{f(!0);let E=await y({to:r,from:s,value:i,data:a},o);u(E),G(!1)}catch(E){m(E?.message||""),G(!0)}finally{f(!1)}},{wait:500});return(0,_.useEffect)(()=>{x()},[r,s,i,a,o,x]),{chainGasLimit:n,chainGasLimitError:c,chainGasLimitLoading:l,chainGasLimitLoadFailed:L}},be=ct;g();d();var F=R(A());oe();var mt=({txParams:e={}},t)=>{let[r,s]=(0,F.useState)([]),[i,a]=(0,F.useState)(""),[o,n]=(0,F.useState)(!0),[u,c]=(0,F.useState)(!1),{rpcUrl:m,chainId:l}=t,f=Se(m,e),L=7e3,G=(0,F.useRef)(),P=(0,F.useRef)(!0),v=()=>{P.current=null,clearTimeout(G.current)},y=async(x=!1)=>{try{x&&n(!0);let E=await f(l);(x||P.current)&&(s(E),c(!1))}catch(E){x&&(a(E?.message||""),c(!0))}finally{n(!1),P.current&&(G.current=setTimeout(()=>{y()},L))}};return(0,F.useEffect)(()=>t?.rpcUrl?(y(!0),()=>{v()}):re,[t?.rpcUrl]),{isSupportEip1559:r[0]?.isSupportEip1559,chainGasPrices:r,chainGasPriceError:i,chainGasPriceLoading:o,chainGasPriceLoadFailed:u}},ke=mt;var Ne=e=>U(e)?ge(e):e,De={gas1559:{low:{base:"1.1",priority:"1.1"},medium:{base:"1.2",priority:"1.2"},high:{base:"1.3",priority:"1.3"},minPriority:"0"},gasNormal:{low:"1.1",medium:"1.2",high:"1.3"},gasLimit:"1.5"},ut={low:C.SLOW,medium:C.STANDARD,high:C.FAST},lt={},ft=({chainGasLevels:e})=>e.find(({typeKey:t})=>t===C.STANDARD)||lt,pt=()=>(0,M.useMemoizedFn)(async e=>{try{let{data:t}=await Ge(pe.getTestNetGasRate,{chainId:Ne(e)});return t}catch{return De}}),Gt=e=>{let t=pt(),[r,s]=(0,h.useState)(!0),[i,a]=(0,h.useState)(De);return(0,M.useAsyncEffect)(async()=>{if(e){let o=await t(e);a(o),s(!1)}},[e]),{loading:r,chainGasRate:i}},Be=(e,t)=>{let{maxFeePerGas:r,gasPrice:s,gasLimit:i}=e,a=r||s;return{...e,unitPrice:`${w.ceilShort(le(a),2)} ${ce("extension_wallet_transaction_input_gwei")}`,totalPrice:he(fe(w.ceilMul(a,i,0)),{symbol:t?.symbol}).value}},Pt=({chainGasLevels:e=[],chainGasRate:t={}})=>e.map(s=>{let i=t?.gas1559?.[s.level]||{},{baseFeePerGas:a,maxFeePerGas:o,maxPriorityFeePerGas:n,gasPrice:u,...c}=s,m=w.ceilMul(a,i?.base,0),l=me([w.ceilMul(n,i?.priority,0),t?.gas1559?.minPriority?ue(t?.gas1559?.minPriority):0]),f=T(m,l),L=t?.gasNormal?.[s.level]||1;return{gasPrice:w.ceilMul(u,L,0),baseFeePerGas:m,maxPriorityFeePerGas:l,maxFeePerGas:f,...c}}),j=({key:e,validDappGas:t,standardLevel:r,dappInjectedGasInfo:s})=>t&&s[e]||r[e],ht=({gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:r,isSupportEip1559:s})=>{let i=!1;return ne(s)||(s?i=H(r,0)&&H(t,r):i=H(e,0)),i},gt=(e={},t={},r=void 0)=>{let{extensionConfig:s}=V("rpc_info"),i=r||s,a=Fe(i.chainId),{chainGasPrices:o,isSupportEip1559:n,chainGasPriceError:u,chainGasPriceLoading:c,chainGasPriceLoadFailed:m}=ke({dappInjectedGasInfo:t,txParams:e},i),{chainGasLimit:l,chainGasLimitLoading:f,chainGasLimitError:L,chainGasLimitLoadFailed:G}=be({txParams:e,dappInjectedGasInfo:t},i),{chainGasRate:P,loading:v}=Gt(i.chainId),[y,x]=(0,h.useState)(null),[E,q]=(0,h.useState)(C.STANDARD),{gasPrice:Me,maxFeePerGas:Oe,maxPriorityFeePerGas:Ae}=t,b=ht({gasPrice:Me,maxFeePerGas:Oe,maxPriorityFeePerGas:Ae,isSupportEip1559:n});(0,h.useEffect)(()=>{b&&q(C.CUSTOM)},[b]),(0,M.useAsyncEffect)(async()=>{if(i?.rpcUrl){let p=await a(i.chainId);ae(p)||(q(C.CUSTOM),x(p))}},[i?.rpcUrl]);let He=c||f||v,We=m||G,Ue=u||L,Ve=P.gasLimit,O=w.ceilMul(l,Ve,0),z=(0,h.useMemo)(()=>Pt({chainGasRate:P,chainGasLevels:o}).map(se=>Be({...se,gasLimit:O,typeKey:ut[se.level]},i)),[n,P,o,O,i]),k=ft({chainGasLevels:z}),ee=(0,h.useMemo)(()=>{let p={...k,gasPrice:j({key:"gasPrice",standardLevel:k,validDappGas:b,dappInjectedGasInfo:t}),maxFeePerGas:j({key:"maxFeePerGas",standardLevel:k,validDappGas:b,dappInjectedGasInfo:t}),maxPriorityFeePerGas:j({key:"maxPriorityFeePerGas",standardLevel:k,validDappGas:b,dappInjectedGasInfo:t})};return p.baseFeePerGas=S(p.maxFeePerGas,p.maxPriorityFeePerGas),p},[k,t,b]),te=(0,h.useMemo)(()=>{let p=O;return y?.gasLimit?p=y.gasLimit:t.gasLimit&&(p=Ne(t.gasLimit)),{...y||ee,gasLimit:p,typeKey:C.CUSTOM}},[O,y,ee,t.gasLimit]),ie=(0,h.useMemo)(()=>[...z,Be(te,i)],[z,te,i]),Ye=ie.find(({typeKey:p})=>p===E)||{};return{setGasType:q,chainGasLevels:ie,currentGasInfo:Ye,setCustomGasOption:x,chainGasLoading:He,chainGasError:Ue,chainGasLoadFailed:We,chainGasPriceLoading:c,chainGasLimitLoading:f,chainGasPriceLoadFailed:m,chainGasLimitLoadFailed:G}},ni=gt;export{we as a,Se as b,De as c,pt as d,Pt as e,ni as f};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-Q6REWZWR.js.map
