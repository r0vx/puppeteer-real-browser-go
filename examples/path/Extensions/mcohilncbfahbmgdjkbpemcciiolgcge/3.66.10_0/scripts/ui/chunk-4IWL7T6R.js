import{a as $l,b as Vl,c as Ql,d as nu,e as ru,f as cu}from"./chunk-MZGKA3VL.js";import{a as Gl}from"./chunk-Q4BJZ4WV.js";import{a as Fl}from"./chunk-BYIL3SNH.js";import{a as ou,b as iu}from"./chunk-BDTFNWL6.js";import{a as ri}from"./chunk-7XLDA2AD.js";import{a as au}from"./chunk-CKPFDXPJ.js";import{a as tu}from"./chunk-5SHXKUU3.js";import{a as su}from"./chunk-3P56MQRB.js";import{b as Ds,c as Or,d as Wl,e as Is,f as jl}from"./chunk-NLKYL456.js";import{a as Ml}from"./chunk-7KQVTMRC.js";import{c as xl}from"./chunk-4YDY4B6P.js";import{a as ti,b as Bl}from"./chunk-L2RHVUUV.js";import{a as Ll}from"./chunk-RH6WPBEZ.js";import{a as Zl,c as eu}from"./chunk-BRQ6KAFA.js";import{a as Hl,b as ql,c as Jl}from"./chunk-TZ7T5CIH.js";import{a as Yl}from"./chunk-32XJE5HT.js";import{a as kl}from"./chunk-DBWXHHZT.js";import{c as Pl}from"./chunk-7JSJY3SQ.js";import{c as Kl}from"./chunk-NWY3GPDX.js";import{a as Xl}from"./chunk-6SNKRANG.js";import{a as zl}from"./chunk-YEFTFSOJ.js";import{a as ei}from"./chunk-L6DDH2OK.js";import{a as ni}from"./chunk-WPAZ67JY.js";import{d as dh,e as fh,k as ph,l as hh}from"./chunk-BBNWKUZT.js";import{a as Ns,c as pl,d as Il}from"./chunk-AAKTZU4R.js";import{q as Ol}from"./chunk-623SCK25.js";import{c as Rl,d as Dl}from"./chunk-LU2QCUPE.js";import{g as wl}from"./chunk-F6UVHIJV.js";import{b as Sl}from"./chunk-LTLRDXME.js";import{b as el}from"./chunk-E7MGN3V4.js";import{P as Go,ea as ul,la as dl}from"./chunk-NQAVUB4Q.js";import{c as Ul}from"./chunk-QEBIHVR2.js";import{v as bl}from"./chunk-MWPAA6TC.js";import{g as On,h as br}from"./chunk-AZNX5TUC.js";import{a as Tl}from"./chunk-XZE3L7K7.js";import{a as Al}from"./chunk-UR7XESQE.js";import{b as jt}from"./chunk-TKE74ERX.js";import{d as Zo}from"./chunk-MONRGJFN.js";import{a as Nl}from"./chunk-RYT7JDQV.js";import{da as go,g as hl,ia as zo,ib as yl,j as gl,sa as ml,ta as _l,ub as vl}from"./chunk-QMENNGDH.js";import{a as Qo}from"./chunk-KANXVZ35.js";import{n as Rs,r as Wt}from"./chunk-WGVA2GGS.js";import{o as Yo}from"./chunk-XP3TNE3R.js";import{C as il,Eb as sl,Ib as al,Kb as cl,P as Ts,dc as ll,jc as bn}from"./chunk-QRHYK2TW.js";import{a as vr}from"./chunk-532YJKK4.js";import{f as fl,p as yh}from"./chunk-Q4YLD24R.js";import{c as Ss,e as _h}from"./chunk-AS4Z3FNS.js";import{k as ho}from"./chunk-YCFHPQAJ.js";import{a as mh}from"./chunk-JPTLCZ2Y.js";import{d as El}from"./chunk-AVC4ODUV.js";import{c as Se}from"./chunk-62ZAND24.js";import{a as Cl}from"./chunk-SIITVWZR.js";import{Ab as Zc,Cc as rl,Eb as Fo,Fd as ws,Ga as lh,Ha as Vc,Jb as Cs,Ma as _r,Na as Os,Pd as gh,Zd as Vo,e as Ho,f as ch,gc as tl,ic as $o,od as Es,oe as ol,qc as nl,xb as Qc}from"./chunk-QHXUL3YM.js";import{B as qo,H as dn,n as zt,x as $c,y as Ie}from"./chunk-MOTAOJVG.js";import{G as bs,H as zc,j as vs,n as Yc,o as yt,w as po}from"./chunk-XR4SQWL7.js";import{G as qc,L as Jc,la as Fc,ra as ys}from"./chunk-CYTB2B6Q.js";import{a as Jo}from"./chunk-CTOTVO2J.js";import{aa as Gc,ka as tt}from"./chunk-6M3PZK2X.js";import{b as He}from"./chunk-OL67KS7C.js";import{a as uh}from"./chunk-VYKQ62AB.js";import{a as yr}from"./chunk-KTFU3F6C.js";import{a as fo,b as De,c as H,d as Ge,f as re,g as Hc,o as g,q as m}from"./chunk-SHG7TIBL.js";var Er=H(me=>{"use strict";g();m();Object.defineProperty(me,"__esModule",{value:!0});me.ConnectorState=me.CONNECT_PROTOCOL_VER=me.CONNECT_JSONRPC_VER=me.OKXCONNECTOR_SESSION_LIVE_TTL=me.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL=me.OKXCONNECTOR_MESSAGE_TTL=me.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE=me.OKXCONNECTOR_WS_URL_LIST=me.OKXCONNECTOR_WS_URL_IDX_KEY=me.OKXCONNECTOR_WS_URL_3=me.OKXCONNECTOR_WS_URL_2=me.OKXCONNECTOR_WS_URL_1=me.EVENT_EMITTER_MAX_LISTENERS=me.OKXCONNECTOR_PROTOCOL_VERSION=void 0;me.OKXCONNECTOR_PROTOCOL_VERSION=2;me.EVENT_EMITTER_MAX_LISTENERS=10;me.OKXCONNECTOR_WS_URL_1="wss://wsdexpri.okx.com/ws/v1/wallet-connect-relay";me.OKXCONNECTOR_WS_URL_2="wss://wsdexpri.okx.ac/ws/v1/wallet-connect-relay";me.OKXCONNECTOR_WS_URL_3="wss://wsdexpri.coinall.ltd/ws/v1/wallet-connect-relay";me.OKXCONNECTOR_WS_URL_IDX_KEY="wuik";me.OKXCONNECTOR_WS_URL_LIST=[me.OKXCONNECTOR_WS_URL_1,me.OKXCONNECTOR_WS_URL_2,me.OKXCONNECTOR_WS_URL_3];me.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE={TIME_OUT:3990,CANCELED:3991,FINISHED:3992};me.OKXCONNECTOR_MESSAGE_TTL=3e5;me.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL=864e5;me.OKXCONNECTOR_SESSION_LIVE_TTL=864e5;me.CONNECT_JSONRPC_VER="2.0";me.CONNECT_PROTOCOL_VER=2;me.ConnectorState={InitState:0,Connecting:1,Connected:2,Disconnected:3,OnError:4}});var wr=H(ye=>{"use strict";g();m();Object.defineProperty(ye,"__esModule",{value:!0});ye.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE=ye.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE=ye.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE=ye.OKXCONNECTOR_STORAGE_CIPHER_METHOD=ye.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV=ye.OKXCONNECTOR_STORAGER_CRYPTO_SALT=ye.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD=ye.OKXCONNECTOR_TON_KEY=ye.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE=ye.OKXCONNECTOR_TOKEN_CACHE=ye.OKXCONNECTOR_JWT_KEY=ye.OKXCONNECTOR_SESSION_PREFIX_KEY=ye.OKXCONNECTOR_CRYPTO_KEY=ye.OKXCONNECTOR_CACHE_KEY_DAPP=ye.OKXCONNECTOR_CACHE_KEY=void 0;ye.OKXCONNECTOR_CACHE_KEY="ck";ye.OKXCONNECTOR_CACHE_KEY_DAPP="ck_dapp";ye.OKXCONNECTOR_CRYPTO_KEY="cck_k";ye.OKXCONNECTOR_SESSION_PREFIX_KEY="cspk_";ye.OKXCONNECTOR_JWT_KEY="cjk_k";ye.OKXCONNECTOR_TOKEN_CACHE="ct";ye.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE="csp";ye.OKXCONNECTOR_TON_KEY="OKXStorage_ctc";ye.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD="scp";ye.OKXCONNECTOR_STORAGER_CRYPTO_SALT="scs";ye.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV="scpc";ye.OKXCONNECTOR_STORAGE_CIPHER_METHOD="aes-256-cbc";ye.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE="okx_connect_split_cache_key";ye.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE="okx_connect_te_cache_key";ye.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE="okx_connect_twe_cache_key"});var Eu=H((wn,Cu)=>{g();m();var ai=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis,ci=function(){function n(){this.fetch=!1,this.DOMException=ai.DOMException}return n.prototype=ai,new n}();(function(n){var e=function(t){var r=typeof n<"u"&&n||typeof self<"u"&&self||typeof r<"u"&&r,o={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};function i(C){return C&&DataView.prototype.isPrototypeOf(C)}if(o.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(C){return C&&s.indexOf(Object.prototype.toString.call(C))>-1};function p(C){if(typeof C!="string"&&(C=String(C)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(C)||C==="")throw new TypeError('Invalid character in header field name: "'+C+'"');return C.toLowerCase()}function f(C){return typeof C!="string"&&(C=String(C)),C}function a(C){var R={next:function(){var j=C.shift();return{done:j===void 0,value:j}}};return o.iterable&&(R[Symbol.iterator]=function(){return R}),R}function c(C){this.map={},C instanceof c?C.forEach(function(R,j){this.append(j,R)},this):Array.isArray(C)?C.forEach(function(R){this.append(R[0],R[1])},this):C&&Object.getOwnPropertyNames(C).forEach(function(R){this.append(R,C[R])},this)}c.prototype.append=function(C,R){C=p(C),R=f(R);var j=this.map[C];this.map[C]=j?j+", "+R:R},c.prototype.delete=function(C){delete this.map[p(C)]},c.prototype.get=function(C){return C=p(C),this.has(C)?this.map[C]:null},c.prototype.has=function(C){return this.map.hasOwnProperty(p(C))},c.prototype.set=function(C,R){this.map[p(C)]=f(R)},c.prototype.forEach=function(C,R){for(var j in this.map)this.map.hasOwnProperty(j)&&C.call(R,this.map[j],j,this)},c.prototype.keys=function(){var C=[];return this.forEach(function(R,j){C.push(j)}),a(C)},c.prototype.values=function(){var C=[];return this.forEach(function(R){C.push(R)}),a(C)},c.prototype.entries=function(){var C=[];return this.forEach(function(R,j){C.push([j,R])}),a(C)},o.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);function u(C){if(C.bodyUsed)return Promise.reject(new TypeError("Already read"));C.bodyUsed=!0}function _(C){return new Promise(function(R,j){C.onload=function(){R(C.result)},C.onerror=function(){j(C.error)}})}function y(C){var R=new FileReader,j=_(R);return R.readAsArrayBuffer(C),j}function I(C){var R=new FileReader,j=_(R);return R.readAsText(C),j}function X(C){for(var R=new Uint8Array(C),j=new Array(R.length),Q=0;Q<R.length;Q++)j[Q]=String.fromCharCode(R[Q]);return j.join("")}function D(C){if(C.slice)return C.slice(0);var R=new Uint8Array(C.byteLength);return R.set(new Uint8Array(C)),R.buffer}function T(){return this.bodyUsed=!1,this._initBody=function(C){this.bodyUsed=this.bodyUsed,this._bodyInit=C,C?typeof C=="string"?this._bodyText=C:o.blob&&Blob.prototype.isPrototypeOf(C)?this._bodyBlob=C:o.formData&&FormData.prototype.isPrototypeOf(C)?this._bodyFormData=C:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(C)?this._bodyText=C.toString():o.arrayBuffer&&o.blob&&i(C)?(this._bodyArrayBuffer=D(C.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(C)||l(C))?this._bodyArrayBuffer=D(C):this._bodyText=C=Object.prototype.toString.call(C):this._bodyText="",this.headers.get("content-type")||(typeof C=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(C)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var C=u(this);if(C)return C;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var C=u(this);return C||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(y)}),this.text=function(){var C=u(this);if(C)return C;if(this._bodyBlob)return I(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(X(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}var U=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function J(C){var R=C.toUpperCase();return U.indexOf(R)>-1?R:C}function V(C,R){if(!(this instanceof V))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');R=R||{};var j=R.body;if(C instanceof V){if(C.bodyUsed)throw new TypeError("Already read");this.url=C.url,this.credentials=C.credentials,R.headers||(this.headers=new c(C.headers)),this.method=C.method,this.mode=C.mode,this.signal=C.signal,!j&&C._bodyInit!=null&&(j=C._bodyInit,C.bodyUsed=!0)}else this.url=String(C);if(this.credentials=R.credentials||this.credentials||"same-origin",(R.headers||!this.headers)&&(this.headers=new c(R.headers)),this.method=J(R.method||this.method||"GET"),this.mode=R.mode||this.mode||null,this.signal=R.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&j)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(j),(this.method==="GET"||this.method==="HEAD")&&(R.cache==="no-store"||R.cache==="no-cache")){var Q=/([?&])_=[^&]*/;if(Q.test(this.url))this.url=this.url.replace(Q,"$1_="+new Date().getTime());else{var le=/\?/;this.url+=(le.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}V.prototype.clone=function(){return new V(this,{body:this._bodyInit})};function S(C){var R=new FormData;return C.trim().split("&").forEach(function(j){if(j){var Q=j.split("="),le=Q.shift().replace(/\+/g," "),oe=Q.join("=").replace(/\+/g," ");R.append(decodeURIComponent(le),decodeURIComponent(oe))}}),R}function B(C){var R=new c,j=C.replace(/\r?\n[\t ]+/g," ");return j.split("\r").map(function(Q){return Q.indexOf(`
`)===0?Q.substr(1,Q.length):Q}).forEach(function(Q){var le=Q.split(":"),oe=le.shift().trim();if(oe){var Fe=le.join(":").trim();R.append(oe,Fe)}}),R}T.call(V.prototype);function L(C,R){if(!(this instanceof L))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');R||(R={}),this.type="default",this.status=R.status===void 0?200:R.status,this.ok=this.status>=200&&this.status<300,this.statusText=R.statusText===void 0?"":""+R.statusText,this.headers=new c(R.headers),this.url=R.url||"",this._initBody(C)}T.call(L.prototype),L.prototype.clone=function(){return new L(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},L.error=function(){var C=new L(null,{status:0,statusText:""});return C.type="error",C};var $=[301,302,303,307,308];L.redirect=function(C,R){if($.indexOf(R)===-1)throw new RangeError("Invalid status code");return new L(null,{status:R,headers:{location:C}})},t.DOMException=r.DOMException;try{new t.DOMException}catch{t.DOMException=function(R,j){this.message=R,this.name=j;var Q=Error(R);this.stack=Q.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function ne(C,R){return new Promise(function(j,Q){var le=new V(C,R);if(le.signal&&le.signal.aborted)return Q(new t.DOMException("Aborted","AbortError"));var oe=new XMLHttpRequest;function Fe(){oe.abort()}oe.onload=function(){var Re={status:oe.status,statusText:oe.statusText,headers:B(oe.getAllResponseHeaders()||"")};Re.url="responseURL"in oe?oe.responseURL:Re.headers.get("X-Request-URL");var lt="response"in oe?oe.response:oe.responseText;setTimeout(function(){j(new L(lt,Re))},0)},oe.onerror=function(){setTimeout(function(){Q(new TypeError("Network request failed"))},0)},oe.ontimeout=function(){setTimeout(function(){Q(new TypeError("Network request failed"))},0)},oe.onabort=function(){setTimeout(function(){Q(new t.DOMException("Aborted","AbortError"))},0)};function $e(Re){try{return Re===""&&r.location.href?r.location.href:Re}catch{return Re}}oe.open(le.method,$e(le.url),!0),le.credentials==="include"?oe.withCredentials=!0:le.credentials==="omit"&&(oe.withCredentials=!1),"responseType"in oe&&(o.blob?oe.responseType="blob":o.arrayBuffer&&le.headers.get("Content-Type")&&le.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(oe.responseType="arraybuffer")),R&&typeof R.headers=="object"&&!(R.headers instanceof c)?Object.getOwnPropertyNames(R.headers).forEach(function(Re){oe.setRequestHeader(Re,f(R.headers[Re]))}):le.headers.forEach(function(Re,lt){oe.setRequestHeader(lt,Re)}),le.signal&&(le.signal.addEventListener("abort",Fe),oe.onreadystatechange=function(){oe.readyState===4&&le.signal.removeEventListener("abort",Fe)}),oe.send(typeof le._bodyInit>"u"?null:le._bodyInit)})}return ne.polyfill=!0,r.fetch||(r.fetch=ne,r.Headers=c,r.Request=V,r.Response=L),t.Headers=c,t.Request=V,t.Response=L,t.fetch=ne,t}({})})(ci);ci.fetch.ponyfill=!0;delete ci.fetch.polyfill;var Tr=ai.fetch?ai:ci;wn=Tr.fetch;wn.default=Tr.fetch;wn.fetch=Tr.fetch;wn.Headers=Tr.Headers;wn.Request=Tr.Request;wn.Response=Tr.Response;Cu.exports=wn});var ks=H(_e=>{"use strict";g();m();Object.defineProperty(_e,"__esModule",{value:!0});_e.DEFAULT_ERROR=_e.STANDARD_ERROR_MAP=_e.SERVER_ERROR_CODE_RANGE=_e.RESERVED_ERROR_CODES=_e.SERVER_ERROR=_e.INTERNAL_ERROR=_e.INVALID_PARAMS=_e.METHOD_NOT_FOUND=_e.INVALID_REQUEST=_e.PARSE_ERROR=_e.OKX_CONNECT_ERROR_CODES=_e.OKXConnectError=void 0;var Fn=class extends Error{constructor(e,t){t==null&&(t=vh(e)),super(t),this.code=e,this.message=`${Fn.prefix} ${t?`
`+t:""}`,Object.setPrototypeOf(this,Fn.prototype)}toJSON(){return{message:this.message,code:this.code}}};_e.OKXConnectError=Fn;Fn.prefix="[OKX_CONNECT_SDK_ERROR]";function vh(n){return n==St.UNKNOWN_ERROR?"unknown error":n==St.BAD_REQUEST_ERROR?"bad request error":n==St.ALREADY_CONNECTED_ERROR?"already connected error":n==St.NOT_CONNECTED_ERROR?"not connected error":n==St.UNKNOWN_APP_ERROR?"unknown app error":n==St.USER_REJECTS_ERROR?"user rejects error":n==St.USER_REJECTS_ERROR_CAUSE_REGISTER?"wallet address are registering":n==St.METHOD_NOT_SUPPORTED?"method not supported":n==St.CONNECTION_ERROR?"connect error":n==St.CHAIN_NOT_SUPPORTED?"chain not supported":"unknown error"}var St;(function(n){n[n.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",n[n.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",n[n.ALREADY_CONNECTED_ERROR=11]="ALREADY_CONNECTED_ERROR",n[n.NOT_CONNECTED_ERROR=12]="NOT_CONNECTED_ERROR",n[n.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",n[n.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",n[n.USER_REJECTS_ERROR_CAUSE_REGISTER=301]="USER_REJECTS_ERROR_CAUSE_REGISTER",n[n.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED",n[n.CHAIN_NOT_SUPPORTED=500]="CHAIN_NOT_SUPPORTED",n[n.WALLET_NOT_SUPPORTED=600]="WALLET_NOT_SUPPORTED",n[n.CONNECTION_ERROR=700]="CONNECTION_ERROR"})(St||(_e.OKX_CONNECT_ERROR_CODES=St={}));_e.PARSE_ERROR="PARSE_ERROR";_e.INVALID_REQUEST="INVALID_REQUEST";_e.METHOD_NOT_FOUND="METHOD_NOT_FOUND";_e.INVALID_PARAMS="INVALID_PARAMS";_e.INTERNAL_ERROR="INTERNAL_ERROR";_e.SERVER_ERROR="SERVER_ERROR";_e.RESERVED_ERROR_CODES=[-32700,-32600,-32601,-32602,-32603];_e.SERVER_ERROR_CODE_RANGE=[-32e3,-32099];_e.STANDARD_ERROR_MAP={[_e.PARSE_ERROR]:{code:-32700,message:"Parse error"},[_e.INVALID_REQUEST]:{code:-32600,message:"Invalid Request"},[_e.METHOD_NOT_FOUND]:{code:-32601,message:"Method not found"},[_e.INVALID_PARAMS]:{code:-32602,message:"Invalid params"},[_e.INTERNAL_ERROR]:{code:-32603,message:"Internal error"},[_e.SERVER_ERROR]:{code:-32e3,message:"Server error"}};_e.DEFAULT_ERROR=_e.SERVER_ERROR});var Tu=H(Sr=>{"use strict";g();m();Object.defineProperty(Sr,"__esModule",{value:!0});Sr.OKX_CONNECT_ERROR_CODES=Sr.OKXConnectError=void 0;var wu=ks();Object.defineProperty(Sr,"OKXConnectError",{enumerable:!0,get:function(){return wu.OKXConnectError}});Object.defineProperty(Sr,"OKX_CONNECT_ERROR_CODES",{enumerable:!0,get:function(){return wu.OKX_CONNECT_ERROR_CODES}})});var Ks=H(Ae=>{"use strict";g();m();Object.defineProperty(Ae,"__esModule",{value:!0});Ae.NameSpaceKeyStarknet=Ae.NameSpaceKeyTron=Ae.NameSpaceKeyCosmos=Ae.NameSpaceKeyAptos=Ae.NameSpaceKeyBtc=Ae.NameSpaceKeySui=Ae.NameSpaceKeyTON=Ae.NameSpaceKeySOL=Ae.NameSpaceKeyEip155=Ae.OpenAppLinkType=void 0;var Su;(function(n){n.UniversalLink="universallink",n.DeepLink="deeplink"})(Su||(Ae.OpenAppLinkType=Su={}));Ae.NameSpaceKeyEip155="eip155";Ae.NameSpaceKeySOL="solana";Ae.NameSpaceKeyTON="ton";Ae.NameSpaceKeySui="sui";Ae.NameSpaceKeyBtc="btc";Ae.NameSpaceKeyAptos="aptos";Ae.NameSpaceKeyCosmos="cosmos";Ae.NameSpaceKeyTron="tron";Ae.NameSpaceKeyStarknet="starknet"});var li=H(we=>{"use strict";g();m();Object.defineProperty(we,"__esModule",{value:!0});we.OKX_MINI_WALLET_NAME=we.OKX_APP_WALLET_NAME=we.stackDeepLink=we.tgwalletAppName=we.tgwalletName=we.tonConnectSdkVersion=we.standardDeeplink=we.downloadUrl=we.shortUniversalLink=we.standardUniversalLink=we.okxDeeplink=void 0;we.getTestTwaUrl=bh;we.getTestTgTwaUrl=Oh;we.getBotNameAndAppName=Ch;we.okxDeeplink="okx://web3";we.standardUniversalLink=typeof window<"u"&&window.location.hostname.includes("okx.com")?"https://link.okx.com/download":"https://www.okx.com/download";we.shortUniversalLink=typeof window<"u"&&window.location.hostname.includes("okx.com")?"https://link.okx.com/ul/connect":"https://www.okx.com/ul/connect";we.downloadUrl="https://www.okx.com/download";we.standardDeeplink=`${we.okxDeeplink}/wallet/connect`;we.tonConnectSdkVersion="1";we.tgwalletName="OKX_WALLET_BOT";we.tgwalletAppName="start";we.stackDeepLink="okx://web3?stack=true";function bh(){return window.okxTesttwaUrl}function Oh(){return window.okxTestTgtwaUrl}function Ch(n){let t=new URL(n).pathname.split("/").filter(Boolean);if(t.length>=2){let r=t[0],o=t[1];return{botName:r,appName:o}}}we.OKX_APP_WALLET_NAME="OKX Wallet";we.OKX_MINI_WALLET_NAME="OKX Mini Wallet"});var Ku=H(We=>{"use strict";g();m();var Eh=We&&We.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(We,"__esModule",{value:!0});We.isJsonRpcPayload=xs;We.isJsonRpcRequest=wh;We.isJsonRpcResponse=Th;We.isJsonRpcResult=Nu;We.isJsonRpcError=Ru;We.payloadId=Du;We.getBigIntRpcId=Dh;We.formatJsonRpcRequest=Ih;We.formatJsonRpcResult=Ah;We.formatJsonRpcError=Ph;We.isReservedErrorCode=Iu;We.getError=Ls;We.getErrorByCode=Au;We.formatErrorMessage=Pu;We.isHttpUrl=Kh;We.isWsUrl=Lh;We.parseConnectionError=xh;function xs(n){return typeof n=="object"&&"id"in n&&"jsonrpc"in n&&n.jsonrpc==="2.0"}function wh(n){return xs(n)&&"method"in n}function Th(n){return xs(n)&&(Nu(n)||Ru(n))}function Nu(n){return"result"in n}function Ru(n){return"error"in n}var Qt=ks(),Sh=Eh(yr()),ui=class{constructor(e){this.i=1;let t=e===8?new Uint8Array(1):e===16?new Uint16Array(1):new Uint32Array(1);e?this.initialValue=Sh.default.randomBytes(e/8)[0]:this.initialValue=0}getNextValue(){return this.initialValue+this.i++}},Nh=new ui(8),Rh=new ui(16);function Du(){let n=Date.now()*1e3,e=Nh.getNextValue();return n+e}function Dh(){let n=BigInt(Date.now())*BigInt(1e6),e=BigInt(Rh.getNextValue());return n+e}function Ih(n,e,t){return{id:t||Du(),jsonrpc:"2.0",method:n,params:e}}function Ah(n,e){return{id:n,jsonrpc:"2.0",result:e}}function Ph(n,e,t){return{id:n,jsonrpc:"2.0",error:Pu(e,t)}}function Iu(n){return Qt.RESERVED_ERROR_CODES.includes(n)}function Ls(n){return Object.keys(Qt.STANDARD_ERROR_MAP).includes(n)?Qt.STANDARD_ERROR_MAP[n]:Qt.STANDARD_ERROR_MAP[Qt.DEFAULT_ERROR]}function Au(n){let e=Object.values(Qt.STANDARD_ERROR_MAP).find(t=>t.code===n);return e||Qt.STANDARD_ERROR_MAP[Qt.DEFAULT_ERROR]}function Pu(n,e){return typeof n>"u"?Ls(Qt.INTERNAL_ERROR):(typeof n=="string"&&(n=Object.assign(Object.assign({},Ls(Qt.SERVER_ERROR)),{message:n})),typeof e<"u"&&(n.data=e),Iu(n.code)&&(n=Au(n.code)),n)}function kh(n){let e=n.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function ku(n,e){let t=kh(n);return typeof t>"u"?!1:new RegExp(e).test(t)}function Kh(n){return ku(n,"^https?:")}function Lh(n){return ku(n,"^wss?:")}function xh(n,e,t){return n.message.includes("getaddrinfo ENOTFOUND")||n.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):n}});var xu=H(Nt=>{"use strict";g();m();var Mh=Nt&&Nt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.IEngine=Nt.ISignClient=Nt.ISignClientEvents=Nt.IEngineEvents=void 0;var Lu=Mh(Jo()),Ms=class extends Lu.default{constructor(){super()}};Nt.IEngineEvents=Ms;var Ws=class extends Lu.default{constructor(){super()}};Nt.ISignClientEvents=Ws;var js=class{constructor(e){this.data=e}};Nt.ISignClient=js;var Us=class{constructor(e){this.client=e}};Nt.IEngine=Us});var Wu=H(di=>{"use strict";g();m();Object.defineProperty(di,"__esModule",{value:!0});di.TONCHAIN=void 0;var Mu;(function(n){n.MAINNET="-239"})(Mu||(di.TONCHAIN=Mu={}))});var Uu=H(fi=>{"use strict";g();m();Object.defineProperty(fi,"__esModule",{value:!0});fi.CONNECT_ITEM_ERROR_CODES=void 0;var ju;(function(n){n[n.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",n[n.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"})(ju||(fi.CONNECT_ITEM_ERROR_CODES=ju={}))});var Bu=H(Nr=>{"use strict";g();m();Object.defineProperty(Nr,"__esModule",{value:!0});Nr.CONNECT_ITEM_ERROR_CODES=Nr.TONCHAIN=void 0;var Wh=Wu();Object.defineProperty(Nr,"TONCHAIN",{enumerable:!0,get:function(){return Wh.TONCHAIN}});var jh=Uu();Object.defineProperty(Nr,"CONNECT_ITEM_ERROR_CODES",{enumerable:!0,get:function(){return jh.CONNECT_ITEM_ERROR_CODES}})});var _o=H(ft=>{"use strict";g();m();Object.defineProperty(ft,"__esModule",{value:!0});ft.OKXInjectWalletName=ft.OKXMiniWalletName=ft.OKXWalletName=void 0;ft.creatOKXWalletInfo=Uh;ft.creatOKXMiniAppWalletInfo=Bh;ft.creatOKXInjectWalletInfo=Xh;ft.OKXWalletName="OKX Wallet";ft.OKXMiniWalletName="OKX Mini Wallet";ft.OKXInjectWalletName="OKX Inject Wallet";function Uh(){return{appName:"okxAppWallet",name:ft.OKXWalletName,imageUrl:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png"}}function Bh(){return{appName:"okxMiniApp",name:ft.OKXMiniWalletName,imageUrl:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png"}}function Xh(){return{appName:"okxInjectWallet",name:ft.OKXInjectWalletName,imageUrl:""}}});var Xu=H(ue=>{"use strict";g();m();var Hh=ue&&ue.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),qh=ue&&ue.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Hh(e,n,t)};Object.defineProperty(ue,"__esModule",{value:!0});ue.OKXWalletName=ue.creatOKXInjectWalletInfo=ue.creatOKXMiniAppWalletInfo=ue.creatOKXWalletInfo=ue.ISignClientEvents=ue.IEngine=ue.IEngineEvents=ue.ISignClient=ue.getBigIntRpcId=ue.formatJsonRpcRequest=ue.isJsonRpcError=ue.isJsonRpcResponse=ue.parseConnectionError=ue.isHttpUrl=ue.formatJsonRpcError=void 0;var $n=Ku();Object.defineProperty(ue,"formatJsonRpcError",{enumerable:!0,get:function(){return $n.formatJsonRpcError}});Object.defineProperty(ue,"isHttpUrl",{enumerable:!0,get:function(){return $n.isHttpUrl}});Object.defineProperty(ue,"parseConnectionError",{enumerable:!0,get:function(){return $n.parseConnectionError}});Object.defineProperty(ue,"isJsonRpcResponse",{enumerable:!0,get:function(){return $n.isJsonRpcResponse}});Object.defineProperty(ue,"isJsonRpcError",{enumerable:!0,get:function(){return $n.isJsonRpcError}});Object.defineProperty(ue,"formatJsonRpcRequest",{enumerable:!0,get:function(){return $n.formatJsonRpcRequest}});Object.defineProperty(ue,"getBigIntRpcId",{enumerable:!0,get:function(){return $n.getBigIntRpcId}});var pi=xu();Object.defineProperty(ue,"ISignClient",{enumerable:!0,get:function(){return pi.ISignClient}});Object.defineProperty(ue,"IEngineEvents",{enumerable:!0,get:function(){return pi.IEngineEvents}});Object.defineProperty(ue,"IEngine",{enumerable:!0,get:function(){return pi.IEngine}});Object.defineProperty(ue,"ISignClientEvents",{enumerable:!0,get:function(){return pi.ISignClientEvents}});qh(Bu(),ue);var hi=_o();Object.defineProperty(ue,"creatOKXWalletInfo",{enumerable:!0,get:function(){return hi.creatOKXWalletInfo}});Object.defineProperty(ue,"creatOKXMiniAppWalletInfo",{enumerable:!0,get:function(){return hi.creatOKXMiniAppWalletInfo}});Object.defineProperty(ue,"creatOKXInjectWalletInfo",{enumerable:!0,get:function(){return hi.creatOKXInjectWalletInfo}});Object.defineProperty(ue,"OKXWalletName",{enumerable:!0,get:function(){return hi.OKXWalletName}})});var Hu=H(Pe=>{"use strict";g();m();Object.defineProperty(Pe,"__esModule",{value:!0});Pe.NAMES_CHAINS=Pe.TON_CHAINS=Pe.COSMOS_CHAINS=Pe.APTOS_CHAINS=Pe.SUI_CHAINS=Pe.SOLANA_CHAINS=Pe.BTC_CHAINS=void 0;var Rr=Ks();Pe.BTC_CHAINS={MAINNET:"btc:mainnet",FRACTAL:"fractal:mainnet"};Pe.SOLANA_CHAINS={MAINNET:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",TESTNET:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",SONIC_TESTNET:"sonic:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"};Pe.SUI_CHAINS={MAINNET:"sui:mainnet"};Pe.APTOS_CHAINS={MAINNET:"aptos:mainnet",MOVEMENT_MAINNET:"movement:mainnet",MOVEMENT_TESTNET:"movement:testnet"};Pe.COSMOS_CHAINS={COSMOS_MAINNET:"cosmos:cosmoshub-4"};Pe.TON_CHAINS={MAINNET:"ton:-239"};Pe.NAMES_CHAINS={[Rr.NameSpaceKeyBtc]:Object.values(Pe.BTC_CHAINS),[Rr.NameSpaceKeySOL]:Object.values(Pe.SOLANA_CHAINS),[Rr.NameSpaceKeyTON]:Object.values(Pe.TON_CHAINS),[Rr.NameSpaceKeySui]:Object.values(Pe.SUI_CHAINS),[Rr.NameSpaceKeyAptos]:Object.values(Pe.APTOS_CHAINS),[Rr.NameSpaceKeyCosmos]:Object.values(Pe.COSMOS_CHAINS)}});var ze=H(G=>{"use strict";g();m();var Jh=G&&G.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),qu=G&&G.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Jh(e,n,t)};Object.defineProperty(G,"__esModule",{value:!0});G.NAMES_CHAINS=G.TON_CHAINS=G.COSMOS_CHAINS=G.APTOS_CHAINS=G.SUI_CHAINS=G.SOLANA_CHAINS=G.BTC_CHAINS=G.shortUniversalLink=G.downloadUrl=G.okxDeeplink=G.tonConnectSdkVersion=G.standardDeeplink=G.standardUniversalLink=G.OpenAppLinkType=G.NameSpaceKeyStarknet=G.NameSpaceKeyTron=G.NameSpaceKeyCosmos=G.NameSpaceKeyAptos=G.NameSpaceKeyBtc=G.NameSpaceKeySui=G.NameSpaceKeyTON=G.NameSpaceKeySOL=G.NameSpaceKeyEip155=void 0;qu(Tu(),G);var Zt=Ks();Object.defineProperty(G,"NameSpaceKeyEip155",{enumerable:!0,get:function(){return Zt.NameSpaceKeyEip155}});Object.defineProperty(G,"NameSpaceKeySOL",{enumerable:!0,get:function(){return Zt.NameSpaceKeySOL}});Object.defineProperty(G,"NameSpaceKeyTON",{enumerable:!0,get:function(){return Zt.NameSpaceKeyTON}});Object.defineProperty(G,"NameSpaceKeySui",{enumerable:!0,get:function(){return Zt.NameSpaceKeySui}});Object.defineProperty(G,"NameSpaceKeyBtc",{enumerable:!0,get:function(){return Zt.NameSpaceKeyBtc}});Object.defineProperty(G,"NameSpaceKeyAptos",{enumerable:!0,get:function(){return Zt.NameSpaceKeyAptos}});Object.defineProperty(G,"NameSpaceKeyCosmos",{enumerable:!0,get:function(){return Zt.NameSpaceKeyCosmos}});Object.defineProperty(G,"NameSpaceKeyTron",{enumerable:!0,get:function(){return Zt.NameSpaceKeyTron}});Object.defineProperty(G,"NameSpaceKeyStarknet",{enumerable:!0,get:function(){return Zt.NameSpaceKeyStarknet}});Object.defineProperty(G,"OpenAppLinkType",{enumerable:!0,get:function(){return Zt.OpenAppLinkType}});var Dr=li();Object.defineProperty(G,"standardUniversalLink",{enumerable:!0,get:function(){return Dr.standardUniversalLink}});Object.defineProperty(G,"standardDeeplink",{enumerable:!0,get:function(){return Dr.standardDeeplink}});Object.defineProperty(G,"tonConnectSdkVersion",{enumerable:!0,get:function(){return Dr.tonConnectSdkVersion}});Object.defineProperty(G,"okxDeeplink",{enumerable:!0,get:function(){return Dr.okxDeeplink}});Object.defineProperty(G,"downloadUrl",{enumerable:!0,get:function(){return Dr.downloadUrl}});Object.defineProperty(G,"shortUniversalLink",{enumerable:!0,get:function(){return Dr.shortUniversalLink}});qu(Xu(),G);var Vn=Hu();Object.defineProperty(G,"BTC_CHAINS",{enumerable:!0,get:function(){return Vn.BTC_CHAINS}});Object.defineProperty(G,"SOLANA_CHAINS",{enumerable:!0,get:function(){return Vn.SOLANA_CHAINS}});Object.defineProperty(G,"SUI_CHAINS",{enumerable:!0,get:function(){return Vn.SUI_CHAINS}});Object.defineProperty(G,"APTOS_CHAINS",{enumerable:!0,get:function(){return Vn.APTOS_CHAINS}});Object.defineProperty(G,"COSMOS_CHAINS",{enumerable:!0,get:function(){return Vn.COSMOS_CHAINS}});Object.defineProperty(G,"TON_CHAINS",{enumerable:!0,get:function(){return Vn.TON_CHAINS}});Object.defineProperty(G,"NAMES_CHAINS",{enumerable:!0,get:function(){return Vn.NAMES_CHAINS}})});var Ju=H((yo,gi)=>{g();m();(function(n,e){"use strict";var t="1.0.39",r="",o="?",i="function",s="undefined",l="object",p="string",f="major",a="model",c="name",u="type",_="vendor",y="version",I="architecture",X="console",D="mobile",T="tablet",U="smarttv",J="wearable",V="embedded",S=500,B="Amazon",L="Apple",$="ASUS",ne="BlackBerry",C="Browser",R="Chrome",j="Edge",Q="Firefox",le="Google",oe="Huawei",Fe="LG",$e="Microsoft",Re="Motorola",lt="Opera",ln="Samsung",ut="Sharp",un="Sony",Bn="Xiaomi",Xn="Zebra",gt="Facebook",dr="Chromium OS",Wo="Mac OS",jo=" Browser",us=function(se,fe){var Z={};for(var Ce in se)fe[Ce]&&fe[Ce].length%2===0?Z[Ce]=fe[Ce].concat(se[Ce]):Z[Ce]=se[Ce];return Z},fr=function(se){for(var fe={},Z=0;Z<se.length;Z++)fe[se[Z].toUpperCase()]=se[Z];return fe},Uo=function(se,fe){return typeof se===p?yn(fe).indexOf(yn(se))!==-1:!1},yn=function(se){return se.toLowerCase()},ds=function(se){return typeof se===p?se.replace(/[^\d\.]/g,r).split(".")[0]:e},ao=function(se,fe){if(typeof se===p)return se=se.replace(/^\s\s*/,r),typeof fe===s?se:se.substring(0,S)},dt=function(se,fe){for(var Z=0,Ce,wt,mt,ge,z,_t;Z<fe.length&&!z;){var gr=fe[Z],co=fe[Z+1];for(Ce=wt=0;Ce<gr.length&&!z&&gr[Ce];)if(z=gr[Ce++].exec(se),z)for(mt=0;mt<co.length;mt++)_t=z[++wt],ge=co[mt],typeof ge===l&&ge.length>0?ge.length===2?typeof ge[1]==i?this[ge[0]]=ge[1].call(this,_t):this[ge[0]]=ge[1]:ge.length===3?typeof ge[1]===i&&!(ge[1].exec&&ge[1].test)?this[ge[0]]=_t?ge[1].call(this,_t,ge[2]):e:this[ge[0]]=_t?_t.replace(ge[1],ge[2]):e:ge.length===4&&(this[ge[0]]=_t?ge[3].call(this,_t.replace(ge[1],ge[2])):e):this[ge]=_t||e;Z+=2}},pr=function(se,fe){for(var Z in fe)if(typeof fe[Z]===l&&fe[Z].length>0){for(var Ce=0;Ce<fe[Z].length;Ce++)if(Uo(fe[Z][Ce],se))return Z===o?e:Z}else if(Uo(fe[Z],se))return Z===o?e:Z;return fe.hasOwnProperty("*")?fe["*"]:se},Bo={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Hn={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},hr={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,y],[/opios[\/ ]+([\w\.]+)/i],[y,[c,lt+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[c,lt+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[c,lt]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[c,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[c,y],[/quark(?:pc)?\/([-\w\.]+)/i],[y,[c,"Quark"]],[/\bddg\/([\w\.]+)/i],[y,[c,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[c,"UC"+C]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[c,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[c,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[c,"Smart Lenovo "+C]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+C],y],[/\bfocus\/([\w\.]+)/i],[y,[c,Q+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[c,lt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[c,lt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[c,"MIUI "+C]],[/fxios\/([-\w\.]+)/i],[y,[c,Q]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360"+jo]],[/\b(qq)\/([\w\.]+)/i],[[c,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1"+jo],y],[/samsungbrowser\/([\w\.]+)/i],[y,[c,ln+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],y],[/metasr[\/ ]?([\d\.]+)/i],[y,[c,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[c,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[c,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,gt],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[c,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[c,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[c,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[c,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,R+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[c,"Android "+C]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[y,pr,Bo]],[/(webkit|khtml)\/([\w\.]+)/i],[c,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],y],[/(wolvic)\/([\w\.]+)/i],[c,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[c,Q+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[c,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[c,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,yn]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,r,yn]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,yn]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[_,ln],[u,T]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[a,[_,ln],[u,D]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[a,[_,L],[u,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[_,L],[u,T]],[/(macintosh);/i],[a,[_,L]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[_,ut],[u,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a,[_,oe],[u,T]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[_,oe],[u,D]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[a,/_/g," "],[_,Bn],[u,D]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a,/_/g," "],[_,Bn],[u,T]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[_,"OPPO"],[u,D]],[/\b(opd2\d{3}a?) bui/i],[a,[_,"OPPO"],[u,T]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[_,"Vivo"],[u,D]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[a,[_,"Realme"],[u,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[_,Re],[u,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[_,Re],[u,T]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[_,Fe],[u,T]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[_,Fe],[u,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a,[_,"Lenovo"],[u,T]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a,/_/g," "],[_,"Nokia"],[u,D]],[/(pixel c)\b/i],[a,[_,le],[u,T]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[_,le],[u,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[_,un],[u,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[_,un],[u,T]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[_,"OnePlus"],[u,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[_,B],[u,T]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[_,B],[u,D]],[/(playbook);[-\w\),; ]+(rim)/i],[a,_,[u,T]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[_,ne],[u,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[_,$],[u,T]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[_,$],[u,D]],[/(nexus 9)/i],[a,[_,"HTC"],[u,T]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[a,/_/g," "],[u,D]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[a,[_,"TCL"],[u,T]],[/(itel) ((\w+))/i],[[_,yn],a,[u,pr,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[_,"Acer"],[u,T]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[_,"Meizu"],[u,D]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[a,[_,"Ulefone"],[u,D]],[/droid.+; (a(?:015|06[35]|142p?))/i],[a,[_,"Nothing"],[u,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,a,[u,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,a,[u,T]],[/(surface duo)/i],[a,[_,$e],[u,T]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[_,"Fairphone"],[u,D]],[/(u304aa)/i],[a,[_,"AT&T"],[u,D]],[/\bsie-(\w*)/i],[a,[_,"Siemens"],[u,D]],[/\b(rct\w+) b/i],[a,[_,"RCA"],[u,T]],[/\b(venue[\d ]{2,7}) b/i],[a,[_,"Dell"],[u,T]],[/\b(q(?:mv|ta)\w+) b/i],[a,[_,"Verizon"],[u,T]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[_,"Barnes & Noble"],[u,T]],[/\b(tm\d{3}\w+) b/i],[a,[_,"NuVision"],[u,T]],[/\b(k88) b/i],[a,[_,"ZTE"],[u,T]],[/\b(nx\d{3}j) b/i],[a,[_,"ZTE"],[u,D]],[/\b(gen\d{3}) b.+49h/i],[a,[_,"Swiss"],[u,D]],[/\b(zur\d{3}) b/i],[a,[_,"Swiss"],[u,T]],[/\b((zeki)?tb.*\b) b/i],[a,[_,"Zeki"],[u,T]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],a,[u,T]],[/\b(ns-?\w{0,9}) b/i],[a,[_,"Insignia"],[u,T]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[_,"NextBook"],[u,T]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],a,[u,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],a,[u,D]],[/\b(ph-1) /i],[a,[_,"Essential"],[u,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[_,"Envizen"],[u,T]],[/\b(trio[-\w\. ]+) b/i],[a,[_,"MachSpeed"],[u,T]],[/\btu_(1491) b/i],[a,[_,"Rotor"],[u,T]],[/(shield[\w ]+) b/i],[a,[_,"Nvidia"],[u,T]],[/(sprint) (\w+)/i],[_,a,[u,D]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[_,$e],[u,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[_,Xn],[u,T]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[_,Xn],[u,D]],[/smart-tv.+(samsung)/i],[_,[u,U]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[_,ln],[u,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,Fe],[u,U]],[/(apple) ?tv/i],[_,[a,L+" TV"],[u,U]],[/crkey/i],[[a,R+"cast"],[_,le],[u,U]],[/droid.+aft(\w+)( bui|\))/i],[a,[_,B],[u,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[_,ut],[u,U]],[/(bravia[\w ]+)( bui|\))/i],[a,[_,un],[u,U]],[/(mitv-\w{5}) bui/i],[a,[_,Bn],[u,U]],[/Hbbtv.*(technisat) (.*);/i],[_,a,[u,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,ao],[a,ao],[u,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,a,[u,X]],[/droid.+; (shield) bui/i],[a,[_,"Nvidia"],[u,X]],[/(playstation [345portablevi]+)/i],[a,[_,un],[u,X]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[_,$e],[u,X]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[a,[_,ln],[u,J]],[/((pebble))app/i],[_,a,[u,J]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[_,L],[u,J]],[/droid.+; (glass) \d/i],[a,[_,le],[u,J]],[/droid.+; (wt63?0{2,3})\)/i],[a,[_,Xn],[u,J]],[/(quest( \d| pro)?)/i],[a,[_,gt],[u,J]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[u,V]],[/(aeobc)\b/i],[a,[_,B],[u,V]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[a,[u,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[u,T]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,T]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,D]],[/(android[-\w\. ]{0,9});.+buil/i],[a,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[c,j+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[c,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[c,[y,pr,Hn]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,pr,Hn],[c,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,Wo],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,y],[/\(bb(10);/i],[y,[c,ne]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[c,Q+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[c,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,dr],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,y],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[c,y]]},et=function(se,fe){if(typeof se===l&&(fe=se,se=e),!(this instanceof et))return new et(se,fe).getResult();var Z=typeof n!==s&&n.navigator?n.navigator:e,Ce=se||(Z&&Z.userAgent?Z.userAgent:r),wt=Z&&Z.userAgentData?Z.userAgentData:e,mt=fe?us(hr,fe):hr,ge=Z&&Z.userAgent==Ce;return this.getBrowser=function(){var z={};return z[c]=e,z[y]=e,dt.call(z,Ce,mt.browser),z[f]=ds(z[y]),ge&&Z&&Z.brave&&typeof Z.brave.isBrave==i&&(z[c]="Brave"),z},this.getCPU=function(){var z={};return z[I]=e,dt.call(z,Ce,mt.cpu),z},this.getDevice=function(){var z={};return z[_]=e,z[a]=e,z[u]=e,dt.call(z,Ce,mt.device),ge&&!z[u]&&wt&&wt.mobile&&(z[u]=D),ge&&z[a]=="Macintosh"&&Z&&typeof Z.standalone!==s&&Z.maxTouchPoints&&Z.maxTouchPoints>2&&(z[a]="iPad",z[u]=T),z},this.getEngine=function(){var z={};return z[c]=e,z[y]=e,dt.call(z,Ce,mt.engine),z},this.getOS=function(){var z={};return z[c]=e,z[y]=e,dt.call(z,Ce,mt.os),ge&&!z[c]&&wt&&wt.platform&&wt.platform!="Unknown"&&(z[c]=wt.platform.replace(/chrome os/i,dr).replace(/macos/i,Wo)),z},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ce},this.setUA=function(z){return Ce=typeof z===p&&z.length>S?ao(z,S):z,this},this.setUA(Ce),this};et.VERSION=t,et.BROWSER=fr([c,y,f]),et.CPU=fr([I]),et.DEVICE=fr([a,_,u,X,D,U,T,J,V]),et.ENGINE=et.OS=fr([c,y]),typeof yo!==s?(typeof gi!==s&&gi.exports&&(yo=gi.exports=et),yo.UAParser=et):typeof define===i&&define.amd?define(function(){return et}):typeof n!==s&&(n.UAParser=et);var Yt=typeof n!==s&&(n.jQuery||n.Zepto);if(Yt&&!Yt.ua){var qn=new et;Yt.ua=qn.getResult(),Yt.ua.get=function(){return qn.getUA()},Yt.ua.set=function(se){qn.setUA(se);var fe=qn.getResult();for(var Z in fe)Yt.ua[Z]=fe[Z]}}})(typeof window=="object"?window:yo)});var _i=H(Bt=>{"use strict";g();m();var Fh=Bt&&Bt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.openLink=mi;Bt.openLinkBlank=Yh;Bt.openDeeplinkWithFallback=zh;Bt.isMobileUserAgent=Qh;Bt.getUserAgent=Hs;Bt.isOS=Bs;Bt.isBrowser=Xs;var $h=Fh(Ju()),Vh=je(),Gh=vo();function mi(n,e="_self"){(0,Vh.logDebug)("openLink",n,e),window.open(n,e,"noopener noreferrer")}function Yh(n){mi(n,"_blank")}function zh(n,e){let t=()=>{Xs("safari")||Bs("android")&&Xs("firefox")||e()},r=setTimeout(()=>t(),500);window.addEventListener("blur",()=>clearTimeout(r),{once:!0}),Bs("android")&&(0,Gh.inTg)()?mi(n,"_blank"):mi(n,"_self")}function Qh(){let n=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.slice(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n}function Hs(){var n,e,t;let r=new $h.default().getResult(),o=(n=r.os.name)===null||n===void 0?void 0:n.toLowerCase(),i=(e=r.device.model)===null||e===void 0?void 0:e.toLowerCase(),s;switch(!0){case i==="ipad":s="ipad";break;case o==="ios":s="ios";break;case o==="android":s="android";break;case o==="mac os":s="macos";break;case o==="linux":s="linux";break;case o?.includes("windows"):s="windows";break}let l=(t=r.browser.name)===null||t===void 0?void 0:t.toLowerCase(),p;switch(!0){case l==="chrome":p="chrome";break;case l==="firefox":p="firefox";break;case l?.includes("safari"):p="safari";break;case l?.includes("opera"):p="opera";break}return{os:s,browser:p}}function Bs(...n){return n.includes(Hs().os)}function Xs(...n){return n.includes(Hs().browser)}});var vo=H(pn=>{"use strict";g();m();var qs,Js,Fs,$s,Vs,Gs,Ys;Object.defineProperty(pn,"__esModule",{value:!0});pn.isTmaPlatform=eg;pn.isInTMA=zs;pn.inTg=tg;pn.isInTelegramBrowser=Fu;pn.sendExpand=ng;pn.sendOpenTelegramLink=rg;pn.versionCompare=Gu;var Ar=Pr(),yi=je(),Tn=ze(),Zh=_i(),fn={};try{let n=location.hash.toString();fn=og(n)}catch{}var Ir="unknown";fn?.tgWebAppPlatform&&(Ir=(qs=fn.tgWebAppPlatform)!==null&&qs!==void 0?qs:"unknown");if(Ir==="unknown"){let n=(0,Ar.getWindow)();Ir=($s=(Fs=(Js=n?.Telegram)===null||Js===void 0?void 0:Js.WebApp)===null||Fs===void 0?void 0:Fs.platform)!==null&&$s!==void 0?$s:"unknown"}var vi="6.0";fn?.tgWebAppVersion&&(vi=fn.tgWebAppVersion);if(!vi){let n=(0,Ar.getWindow)();vi=(Ys=(Gs=(Vs=n?.Telegram)===null||Vs===void 0?void 0:Vs.WebApp)===null||Gs===void 0?void 0:Gs.version)!==null&&Ys!==void 0?Ys:"6.0"}function eg(...n){return n.includes(Ir)}function zs(){var n;return Ir!=="unknown"||!!(!((n=(0,Ar.getWindow)())===null||n===void 0)&&n.TelegramWebviewProxy)}function tg(){return Fu()||zs()}function Fu(){var n;let e=!!(!((n=(0,Ar.getWindow)())===null||n===void 0)&&n.TelegramWebview);return(zs()||e)&&Ir==="unknown"}function ng(){Vu("web_app_expand",{})}function rg(n,e){let t=new URL(n);if(t.protocol!=="http:"&&t.protocol!=="https:"){if(e)return e();throw new Tn.OKXConnectError(Tn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Url protocol is not supported: ${t}`)}if(t.hostname!=="t.me"){if(e)return e();throw new Tn.OKXConnectError(Tn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Url host is not supported: ${t}`)}let r=t.pathname+t.search;$u()||sg("6.1")?Vu("web_app_open_tg_link",{path_full:r}):(0,Zh.openLinkBlank)("https://t.me"+r)}function $u(){try{let n=(0,Ar.getWindow)();return n?n.parent!=null&&n!==n.parent:!1}catch{return!1}}function Vu(n,e){try{let t=(0,Ar.getWindow)();if(!t)throw new Tn.OKXConnectError(Tn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Can't post event to parent window: window is not defined");if(t.TelegramWebviewProxy!==void 0)(0,yi.logDebug)("postEvent",n,e),t.TelegramWebviewProxy.postEvent(n,JSON.stringify(e));else if(t.external&&"notify"in t.external)(0,yi.logDebug)("postEvent",n,e),t.external.notify(JSON.stringify({eventType:n,eventData:e}));else if($u()){let r="*",o=JSON.stringify({eventType:n,eventData:e});(0,yi.logDebug)("postEvent",n,e),t.parent.postMessage(o,r)}else throw new Tn.OKXConnectError(Tn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Can't post event to TMA")}catch(t){(0,yi.logError)(`Can't post event to parent window: ${t}`)}}function og(n){n=n.replace(/^#/,"");let e={};if(!n.length)return e;if(n.indexOf("=")<0&&n.indexOf("?")<0)return e._path=bi(n),e;let t=n.indexOf("?");if(t>=0){let o=n.substr(0,t);e._path=bi(o),n=n.substr(t+1)}let r=ig(n);for(let o in r)e[o]=r[o];return e}function bi(n){try{return n=n.replace(/\+/g,"%20"),decodeURIComponent(n)}catch{return n}}function ig(n){let e={};if(!n.length)return e;let t=n.split("&"),r,o,i,s;for(r=0;r<t.length;r++)o=t[r].split("="),i=bi(o[0]),s=o[1]==null?null:bi(o[1]),e[i]=s;return e}function Gu(n,e){typeof n!="string"&&(n=""),typeof e!="string"&&(e="");let t=n.replace(/^\s+|\s+$/g,"").split("."),r=e.replace(/^\s+|\s+$/g,"").split("."),o,i,s,l;for(o=Math.max(t.length,r.length),i=0;i<o;i++)if(s=parseInt(t[i])||0,l=parseInt(r[i])||0,s!==l)return s>l?1:-1;return 0}function sg(n){return Gu(vi,n)>=0}});var Pr=H(Ve=>{"use strict";g();m();var Qs,Zs,ea,ta;Object.defineProperty(Ve,"__esModule",{value:!0});Ve.removeUrlLastSlash=Yu;Ve.addPathToUrl=lg;Ve.getUniversalLink=zu;Ve.openOKXDeeplink=ug;Ve.openOKXDeeplinkWithFallback=Qu;Ve.getWindow=zn;Ve.isTelegramUrl=dg;Ve.encodeTelegramUrlParameters=fg;Ve.encodeConnectParams=Zu;Ve.encodeTWAConnectURLParams=ed;Ve.getAppWalletDeepLink=pg;Ve.getAppWalletShortDeepLink=td;Ve.getTelegramWalletTWAUrl=na;Ve.openOKXTMAWalletlinkWithFallback=hg;Ve.isInTMA=Gn;Ve.isInTelegramBrowser=_g;Ve.getOKXLink=yg;var hn=ze(),Yn=je(),Te=li(),en=Rt(),ag=vo(),cg=Er();function Yu(n){return n.slice(-1)==="/"?n.slice(0,-1):n}function lg(n,e){return Yu(n)+"/"+e}function zu(n,e=!1){console.log("getUniversalLink deeplinkUrl:",n,", useStandardUniversalLink:",e);let t=encodeURIComponent(n);return console.log("getUniversalLink standardUniversalLink:",hn.standardUniversalLink),console.log("getUniversalLink standardUniversalLink:",`${hn.standardUniversalLink}?deeplink=${t}`),`${hn.standardUniversalLink}?deeplink=${t}`}function ug(n,e,t){Qu(n,e,t,!1)}function Qu(n,e,t,r=!0){var o;let i=!!(!((o=zn())===null||o===void 0)&&o.TelegramWebviewProxy);console.log("openOKXDeeplinkWithFallback fullUrl:",e);let s=!1,l=3e3,p=hn.standardUniversalLink;console.log("openOKXDeeplinkWithFallback standardUniversalLink:",hn.standardUniversalLink);let f=null,a=()=>{console.log("fallbackToDownloadPage :empty")},c=!1;if(t===hn.OpenAppLinkType.UniversalLink?c=(0,en.isInIOSChrome)()||(0,en.isInIOSLine)()||(0,en.isInIOSLark)()||(0,en.isInIOSWeChat)():c=i===!1&&(0,en.isIos)(),r&&((0,en.isIos)()?c&&(a=()=>{console.log("windowOpen --> fallbackToDownloadPage --",s),s||(console.log("windowOpen --> fallbackToDownloadPage universal link"),window.open(e,"_self"))}):a=()=>{s||(f?f.open(e,"_self"):window.open(e,"_blank"))}),!(0,en.isIos)()||c){if(i?f=window.open(n,"_blank"):(console.log("windowOpen --> deeplinkUrl"),window.location.href=n),r){setTimeout(a,l);let u=0,_=setInterval(()=>{u++,console.log("windowOpen --> interval:",u,document.hidden,document.visibilityState),document.hidden&&(s=!0),(u>10||document.hidden)&&(clearInterval(_),console.log("windowOpen :cleat: ${count}"))},200);window.addEventListener("blur",()=>{console.log("windowOpen :blur"),s=!0},{once:!0}),document.addEventListener("visibilitychange",()=>{console.log("windowOpen :visibilitychange:",document.visibilityState),document.visibilityState==="hidden"&&(s=!0)})}}else i?window.open(e,"_blank"):(console.log("windowOpen[before]: ",Date.now()),window?.okxLogDebug?window.open(e,"_blank"):window.open(e,"_self"),console.log("windowOpen[after]: ",Date.now()))}function zn(){if(typeof window<"u")return window}function dg(n){if(!n)return!1;let e=new URL(n);return e.protocol==="tg:"||e.hostname==="t.me"}function fg(n){let e=n;return e=e.replace(/\./g,"%2E"),e=e.replace(/-/g,"%2D"),e=e.replace(/_/g,"%5F"),e=e.replace(/&/g,"-"),e=e.replace(/=/g,"__"),e=e.replace(/%/g,"--"),e}function Zu(n){let e=Object.assign(Object.assign({},n),{protocolVersion:cg.CONNECT_PROTOCOL_VER}),t=JSON.stringify(e);(0,Yn.logDebug)("url encodeConnectParams connectRequestStr ",t);let r=new TextEncoder().encode(t),o=btoa(String.fromCharCode(...r));return(0,Yn.logDebug)("url encodeConnectParams base64Encoded ",o),o}function ed(n){let e=JSON.stringify({topic:n.topic,clientId:n.clientId});(0,Yn.logDebug)("url encodeConnectParams connectRequestStr",e);let t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function pg(n){return`${hn.standardDeeplink}?param=${n}`}function td(n,e){return`${Te.shortUniversalLink}?topic=${n}${(0,en.getLastSixMd5Hash)(e)}`}function na(n,e){let t={okxconnect:"",redirect:"",extraparams:"",fromtg:!1};n&&(t.okxconnect=n),e&&(t.redirect=e),Gn()?t.fromtg=!0:t.fromtg=!1,(0,Yn.logDebug)("getTelegramWalletTWAUrl redirect:",t.redirect);let r=JSON.stringify(t),o=new TextEncoder().encode(r),i=btoa(String.fromCharCode(...o)),s=(0,en.toSafeBase64FromBase64)(i);if((0,Yn.logDebug)("[TWA] open link:",t,i),n||e){if(Gn())return(0,Te.getTestTgTwaUrl)()?`${(0,Te.getTestTgTwaUrl)()}?startapp=${s}`:`https://t.me/${Te.tgwalletName}/start?startapp=${s}`;if((0,Te.getTestTwaUrl)())return`${(0,Te.getTestTwaUrl)()}?tgWebAppStartParam=${s}`;if((0,Te.getTestTgTwaUrl)()){let l=(0,Te.getBotNameAndAppName)((0,Te.getTestTgTwaUrl)());if(l){let{botName:p,appName:f}=l;return`tg://resolve?domain=${p}&appname=${f}&startapp=${s}`}return`tg://resolve?domain=${Te.tgwalletName}&appname=${Te.tgwalletAppName}&startapp=${s}`}else return`tg://resolve?domain=${Te.tgwalletName}&appname=${Te.tgwalletAppName}&startapp=${s}`}if(Gn())return(0,Te.getTestTgTwaUrl)()?`${(0,Te.getTestTgTwaUrl)()}`:`https://t.me/${Te.tgwalletName}/start`;if((0,Te.getTestTwaUrl)())return`${(0,Te.getTestTwaUrl)()}`;if((0,Te.getTestTgTwaUrl)()){let l=(0,Te.getBotNameAndAppName)((0,Te.getTestTgTwaUrl)());if(l){let{botName:p,appName:f}=l;return`tg://resolve?domain=${p}&appname=${f}`}return`tg://resolve?domain=${Te.tgwalletName}&appname=${Te.tgwalletAppName}`}else return`tg://resolve?domain=${Te.tgwalletName}&appname=${Te.tgwalletAppName}`}function hg(n){var e,t,r,o,i;(0,Yn.logDebug)("[TWA] open link:",n,"isInTMA ==> ",Gn()),Gn()?!((t=(e=zn())===null||e===void 0?void 0:e.Telegram)===null||t===void 0)&&t.WebApp?(i=(o=(r=zn())===null||r===void 0?void 0:r.Telegram)===null||o===void 0?void 0:o.WebApp)===null||i===void 0||i.openTelegramLink(n):(0,ag.sendOpenTelegramLink)(n):(0,Te.getTestTwaUrl)()?window.open(n,"_blank"):window.open(n,"_self")}function Oi(n){try{return n=n.replace(/\+/g,"%20"),decodeURIComponent(n)}catch{return n}}function gg(n){let e={};if(!n.length)return e;let t=n.split("&"),r,o,i,s;for(r=0;r<t.length;r++)o=t[r].split("="),i=Oi(o[0]),s=o[1]==null?null:Oi(o[1]),e[i]=s;return e}function mg(n){n=n.replace(/^#/,"");let e={};if(!n.length)return e;if(n.indexOf("=")<0&&n.indexOf("?")<0)return e._path=Oi(n),e;let t=n.indexOf("?");if(t>=0){let o=n.substr(0,t);e._path=Oi(o),n=n.substr(t+1)}let r=gg(n);for(let o in r)e[o]=r[o];return e}var bo={};try{let n=location.hash.toString();bo=mg(n)}catch{}var Oo="unknown";bo?.tgWebAppPlatform&&(Oo=(Qs=bo.tgWebAppPlatform)!==null&&Qs!==void 0?Qs:"unknown");if(Oo==="unknown"){let n=zn();Oo=(ta=(ea=(Zs=n?.Telegram)===null||Zs===void 0?void 0:Zs.WebApp)===null||ea===void 0?void 0:ea.platform)!==null&&ta!==void 0?ta:"unknown"}function Gn(){var n;return Oo!=="unknown"||!!(!((n=zn())===null||n===void 0)&&n.TelegramWebviewProxy)}function _g(){var n;let e=!!(!((n=zn())===null||n===void 0)&&n.TelegramWebview);return(Gn()||e)&&Oo==="unknown"}function yg(n,e=!1,t){if((0,Yn.logDebug)(`url  getOKXLink() called connectRequest==> ${JSON.stringify(n)}  useMini=> ${e}  tmaReturnUrl==> ${t}`),e)return n?{universalLink:na(ed(n),t??"back")}:{universalLink:na(void 0,t??"back")};{let r=n?`${hn.standardDeeplink}?param=${Zu(n)}`:hn.standardDeeplink;return(0,en.useShortLink)()?{universalLink:n?td(n.topic,n.clientId):Te.shortUniversalLink,deepLink:r}:{universalLink:zu(r),deepLink:r}}}});var od=H(kr=>{"use strict";g();m();var nd=kr&&kr.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(kr,"__esModule",{value:!0});kr.callForSuccess=vg;kr.delay=rd;function vg(n,e){return nd(this,void 0,void 0,function*(){var t,r;let o=(t=e?.attempts)!==null&&t!==void 0?t:3,i=(r=e?.delayMs)!==null&&r!==void 0?r:800;if(typeof n!="function")throw new Error(`Expected a function, got ${typeof n}`);let s=0,l;for(;s<o;)try{return yield n()}catch(p){l=p,s++,s<o&&(yield rd(i))}throw l})}function rd(n,e){return nd(this,void 0,void 0,function*(){return new Promise((t,r)=>{var o,i;if(!((o=e?.signal)===null||o===void 0)&&o.aborted){r(new Error("Delay aborted"));return}let s=setTimeout(()=>t(),n);(i=e?.signal)===null||i===void 0||i.addEventListener("abort",()=>{clearTimeout(s),r(new Error("Delay aborted"))})})})}});var id=H(de=>{"use strict";g();m();Object.defineProperty(de,"__esModule",{value:!0});de.Report_WalletType_Key=de.Report_OKXConnectSDK_RequestError_Log=de.Report_OKXConnectSDK_RequestSuccess_Log=de.Report_OKXConnectSDK_RequestStart_Log=de.Report_OKXConnectSDKExtension_ConnectDapp_Button_Click=de.Report_OKXConnectSDKExtension_Module_Retry_Click=de.Report_ConnectDapp_ConnectAndSign_Click=de.Report_Proceed_QRCode_Click=de.Report_ChooseType_Download_Click=de.Report_ChooseType_ConnectWallet_Click=de.Report_Proceed_Retry_Click=de.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View=de.Report_OKXConnectSDKExtension_ConnectDapp_Page_View=de.Report_ChooseType_ConnectWallet_View=de.Report_Loading_ConnectWallet_View=de.Report_Proceed_QRCode_View=de.Report_Proceed_Proceed_View=void 0;de.Report_Proceed_Proceed_View="OKXConnectSDK_Proceed_Proceed_View";de.Report_Proceed_QRCode_View="OKXConnectSDK_Proceed_QRCode_View";de.Report_Loading_ConnectWallet_View="OKXConnectSDK_Loading_ConnectWallet_View";de.Report_ChooseType_ConnectWallet_View="OKXConnectSDK_ChooseType_ConnectWallet_View";de.Report_OKXConnectSDKExtension_ConnectDapp_Page_View="OKXConnectSDKExtension_ConnectDapp_Page_View";de.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View="OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View";de.Report_Proceed_Retry_Click="OKXConnectSDK_Proceed_Retry_Click";de.Report_ChooseType_ConnectWallet_Click="OKXConnectSDK_ChooseType_ConnectWallet_Click";de.Report_ChooseType_Download_Click="OKXConnectSDK_ChooseType_Download_Click";de.Report_Proceed_QRCode_Click="OKXConnectSDK_Proceed_QRCode_Click";de.Report_ConnectDapp_ConnectAndSign_Click="OKXConnectSDK_ConnectDapp_ConnectAndSign_Click";de.Report_OKXConnectSDKExtension_Module_Retry_Click="OKXConnectSDKExtension_Module_Retry_Click";de.Report_OKXConnectSDKExtension_ConnectDapp_Button_Click="OKXConnectSDKExtension_ConnectDapp_Button_Click";de.Report_OKXConnectSDK_RequestStart_Log="Report_OKXConnectSDK_RequestStart_View";de.Report_OKXConnectSDK_RequestSuccess_Log="Report_OKXConnectSDK_RequestSuccess_View";de.Report_OKXConnectSDK_RequestError_Log="Report_OKXConnectSDK_RequestError_View";de.Report_WalletType_Key="wallet_type"});var sd=H(ra=>{"use strict";g();m();Object.defineProperty(ra,"__esModule",{value:!0});ra.checkMetaData=bg;var Ci=ze();function bg(n){if(!n)throw new Ci.OKXConnectError(Ci.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"You have to specify a `dappMetaData`in the options.");if(!n.name)throw new Ci.OKXConnectError(Ci.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"dappName is required");return!0}});var Qe=H(P=>{"use strict";g();m();var Og=P&&P.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ad=P&&P.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Og(e,n,t)};Object.defineProperty(P,"__esModule",{value:!0});P.getNamespaceKeyByChain=P.chainName2IdMap=P.replaceChainIdToChainName=P.replaceChainNameToChainId=P.checkMetaData=P.versionCompare=P.isBrowser=P.isOS=P.isMobileUserAgent=P.openDeeplinkWithFallback=P.openLinkBlank=P.openLink=P.getChainId=P.useShortLink=P.toSafeBase64FromBase64=P.isValidObject=P.isIos=P.base64decode=P.base64encode=P.splitToUint8Arrays=P.concatUint8Arrays=P.toHexString=P.hexToByteArray=P.getOKXLink=P.getAppWalletShortDeepLink=P.encodeTWAConnectURLParams=P.encodeConnectParams=P.openOKXTMAWalletlinkWithFallback=P.getTelegramWalletTWAUrl=P.getAppWalletDeepLink=P.encodeTelegramUrlParameters=P.isTelegramUrl=P.openOKXDeeplinkWithFallback=P.openOKXDeeplink=P.getUniversalLink=P.safeJsonStringify=P.safeJsonParse=P.getDefaultReporter=P.reportEvent=P.reportLog=P.logWarning=P.logError=P.logDebug=P.callForSuccess=void 0;var Cg=od();Object.defineProperty(P,"callForSuccess",{enumerable:!0,get:function(){return Cg.callForSuccess}});var Kr=je();Object.defineProperty(P,"logDebug",{enumerable:!0,get:function(){return Kr.logDebug}});Object.defineProperty(P,"logError",{enumerable:!0,get:function(){return Kr.logError}});Object.defineProperty(P,"logWarning",{enumerable:!0,get:function(){return Kr.logWarning}});Object.defineProperty(P,"reportLog",{enumerable:!0,get:function(){return Kr.reportLog}});Object.defineProperty(P,"reportEvent",{enumerable:!0,get:function(){return Kr.reportEvent}});Object.defineProperty(P,"getDefaultReporter",{enumerable:!0,get:function(){return Kr.getDefaultReporter}});ad(id(),P);ad(Co(),P);var cd=Sn();Object.defineProperty(P,"safeJsonParse",{enumerable:!0,get:function(){return cd.safeJsonParse}});Object.defineProperty(P,"safeJsonStringify",{enumerable:!0,get:function(){return cd.safeJsonStringify}});var Dt=Pr();Object.defineProperty(P,"getUniversalLink",{enumerable:!0,get:function(){return Dt.getUniversalLink}});Object.defineProperty(P,"openOKXDeeplink",{enumerable:!0,get:function(){return Dt.openOKXDeeplink}});Object.defineProperty(P,"openOKXDeeplinkWithFallback",{enumerable:!0,get:function(){return Dt.openOKXDeeplinkWithFallback}});Object.defineProperty(P,"isTelegramUrl",{enumerable:!0,get:function(){return Dt.isTelegramUrl}});Object.defineProperty(P,"encodeTelegramUrlParameters",{enumerable:!0,get:function(){return Dt.encodeTelegramUrlParameters}});Object.defineProperty(P,"getAppWalletDeepLink",{enumerable:!0,get:function(){return Dt.getAppWalletDeepLink}});Object.defineProperty(P,"getTelegramWalletTWAUrl",{enumerable:!0,get:function(){return Dt.getTelegramWalletTWAUrl}});Object.defineProperty(P,"openOKXTMAWalletlinkWithFallback",{enumerable:!0,get:function(){return Dt.openOKXTMAWalletlinkWithFallback}});Object.defineProperty(P,"encodeConnectParams",{enumerable:!0,get:function(){return Dt.encodeConnectParams}});Object.defineProperty(P,"encodeTWAConnectURLParams",{enumerable:!0,get:function(){return Dt.encodeTWAConnectURLParams}});Object.defineProperty(P,"getAppWalletShortDeepLink",{enumerable:!0,get:function(){return Dt.getAppWalletShortDeepLink}});Object.defineProperty(P,"getOKXLink",{enumerable:!0,get:function(){return Dt.getOKXLink}});var Xt=Rt();Object.defineProperty(P,"hexToByteArray",{enumerable:!0,get:function(){return Xt.hexToByteArray}});Object.defineProperty(P,"toHexString",{enumerable:!0,get:function(){return Xt.toHexString}});Object.defineProperty(P,"concatUint8Arrays",{enumerable:!0,get:function(){return Xt.concatUint8Arrays}});Object.defineProperty(P,"splitToUint8Arrays",{enumerable:!0,get:function(){return Xt.splitToUint8Arrays}});Object.defineProperty(P,"base64encode",{enumerable:!0,get:function(){return Xt.base64encode}});Object.defineProperty(P,"base64decode",{enumerable:!0,get:function(){return Xt.base64decode}});Object.defineProperty(P,"isIos",{enumerable:!0,get:function(){return Xt.isIos}});Object.defineProperty(P,"isValidObject",{enumerable:!0,get:function(){return Xt.isValidObject}});Object.defineProperty(P,"toSafeBase64FromBase64",{enumerable:!0,get:function(){return Xt.toSafeBase64FromBase64}});Object.defineProperty(P,"useShortLink",{enumerable:!0,get:function(){return Xt.useShortLink}});Object.defineProperty(P,"getChainId",{enumerable:!0,get:function(){return Xt.getChainId}});var Lr=_i();Object.defineProperty(P,"openLink",{enumerable:!0,get:function(){return Lr.openLink}});Object.defineProperty(P,"openLinkBlank",{enumerable:!0,get:function(){return Lr.openLinkBlank}});Object.defineProperty(P,"openDeeplinkWithFallback",{enumerable:!0,get:function(){return Lr.openDeeplinkWithFallback}});Object.defineProperty(P,"isMobileUserAgent",{enumerable:!0,get:function(){return Lr.isMobileUserAgent}});Object.defineProperty(P,"isOS",{enumerable:!0,get:function(){return Lr.isOS}});Object.defineProperty(P,"isBrowser",{enumerable:!0,get:function(){return Lr.isBrowser}});var Eg=vo();Object.defineProperty(P,"versionCompare",{enumerable:!0,get:function(){return Eg.versionCompare}});var wg=sd();Object.defineProperty(P,"checkMetaData",{enumerable:!0,get:function(){return wg.checkMetaData}});var Ei=Rt();Object.defineProperty(P,"replaceChainNameToChainId",{enumerable:!0,get:function(){return Ei.replaceChainNameToChainId}});Object.defineProperty(P,"replaceChainIdToChainName",{enumerable:!0,get:function(){return Ei.replaceChainIdToChainName}});Object.defineProperty(P,"chainName2IdMap",{enumerable:!0,get:function(){return Ei.chainName2IdMap}});Object.defineProperty(P,"getNamespaceKeyByChain",{enumerable:!0,get:function(){return Ei.getNamespaceKeyByChain}})});var wi=H((ld,oa)=>{g();m();(function(n){if(typeof ld=="object"&&typeof oa<"u")oa.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var e;typeof window<"u"?e=window:typeof globalThis<"u"?e=globalThis:typeof self<"u"?e=self:e=this,e.localforage=n()}})(function(){var n,e,t;return function r(o,i,s){function l(a,c){if(!i[a]){if(!o[a]){var u=typeof fo=="function"&&fo;if(!c&&u)return u(a,!0);if(p)return p(a,!0);var _=new Error("Cannot find module '"+a+"'");throw _.code="MODULE_NOT_FOUND",_}var y=i[a]={exports:{}};o[a][0].call(y.exports,function(I){var X=o[a][1][I];return l(X||I)},y,y.exports,r,o,i,s)}return i[a].exports}for(var p=typeof fo=="function"&&fo,f=0;f<s.length;f++)l(s[f]);return l}({1:[function(r,o,i){(function(s){"use strict";var l=s.MutationObserver||s.WebKitMutationObserver,p;if(l){var f=0,a=new l(I),c=s.document.createTextNode("");a.observe(c,{characterData:!0}),p=function(){c.data=f=++f%2}}else if(!s.setImmediate&&typeof s.MessageChannel<"u"){var u=new s.MessageChannel;u.port1.onmessage=I,p=function(){u.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?p=function(){var D=s.document.createElement("script");D.onreadystatechange=function(){I(),D.onreadystatechange=null,D.parentNode.removeChild(D),D=null},s.document.documentElement.appendChild(D)}:p=function(){setTimeout(I,0)};var _,y=[];function I(){_=!0;for(var D,T,U=y.length;U;){for(T=y,y=[],D=-1;++D<U;)T[D]();U=y.length}_=!1}o.exports=X;function X(D){y.push(D)===1&&!_&&p()}}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(r,o,i){"use strict";var s=r(1);function l(){}var p={},f=["REJECTED"],a=["FULFILLED"],c=["PENDING"];o.exports=u;function u(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,S!==l&&X(this,S)}u.prototype.catch=function(S){return this.then(null,S)},u.prototype.then=function(S,B){if(typeof S!="function"&&this.state===a||typeof B!="function"&&this.state===f)return this;var L=new this.constructor(l);if(this.state!==c){var $=this.state===a?S:B;y(L,$,this.outcome)}else this.queue.push(new _(L,S,B));return L};function _(S,B,L){this.promise=S,typeof B=="function"&&(this.onFulfilled=B,this.callFulfilled=this.otherCallFulfilled),typeof L=="function"&&(this.onRejected=L,this.callRejected=this.otherCallRejected)}_.prototype.callFulfilled=function(S){p.resolve(this.promise,S)},_.prototype.otherCallFulfilled=function(S){y(this.promise,this.onFulfilled,S)},_.prototype.callRejected=function(S){p.reject(this.promise,S)},_.prototype.otherCallRejected=function(S){y(this.promise,this.onRejected,S)};function y(S,B,L){s(function(){var $;try{$=B(L)}catch(ne){return p.reject(S,ne)}$===S?p.reject(S,new TypeError("Cannot resolve promise with itself")):p.resolve(S,$)})}p.resolve=function(S,B){var L=D(I,B);if(L.status==="error")return p.reject(S,L.value);var $=L.value;if($)X(S,$);else{S.state=a,S.outcome=B;for(var ne=-1,C=S.queue.length;++ne<C;)S.queue[ne].callFulfilled(B)}return S},p.reject=function(S,B){S.state=f,S.outcome=B;for(var L=-1,$=S.queue.length;++L<$;)S.queue[L].callRejected(B);return S};function I(S){var B=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof B=="function")return function(){B.apply(S,arguments)}}function X(S,B){var L=!1;function $(j){L||(L=!0,p.reject(S,j))}function ne(j){L||(L=!0,p.resolve(S,j))}function C(){B(ne,$)}var R=D(C);R.status==="error"&&$(R.value)}function D(S,B){var L={};try{L.value=S(B),L.status="success"}catch($){L.status="error",L.value=$}return L}u.resolve=T;function T(S){return S instanceof this?S:p.resolve(new this(l),S)}u.reject=U;function U(S){var B=new this(l);return p.reject(B,S)}u.all=J;function J(S){var B=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=S.length,$=!1;if(!L)return this.resolve([]);for(var ne=new Array(L),C=0,R=-1,j=new this(l);++R<L;)Q(S[R],R);return j;function Q(le,oe){B.resolve(le).then(Fe,function($e){$||($=!0,p.reject(j,$e))});function Fe($e){ne[oe]=$e,++C===L&&!$&&($=!0,p.resolve(j,ne))}}}u.race=V;function V(S){var B=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=S.length,$=!1;if(!L)return this.resolve([]);for(var ne=-1,C=new this(l);++ne<L;)R(S[ne]);return C;function R(j){B.resolve(j).then(function(Q){$||($=!0,p.resolve(C,Q))},function(Q){$||($=!0,p.reject(C,Q))})}}},{1:1}],3:[function(r,o,i){(function(s){"use strict";typeof s.Promise!="function"&&(s.Promise=r(2))}).call(this,typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(r,o,i){"use strict";var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d};function l(d,v){if(!(d instanceof v))throw new TypeError("Cannot call a class as a function")}function p(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var f=p();function a(){try{if(!f||!f.open)return!1;var d=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),v=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!d||v)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function c(d,v){d=d||[],v=v||{};try{return new Blob(d,v)}catch(b){if(b.name!=="TypeError")throw b;for(var h=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,O=new h,E=0;E<d.length;E+=1)O.append(d[E]);return O.getBlob(v.type)}}typeof Promise>"u"&&r(3);var u=Promise;function _(d,v){v&&d.then(function(h){v(null,h)},function(h){v(h)})}function y(d,v,h){typeof v=="function"&&d.then(v),typeof h=="function"&&d.catch(h)}function I(d){return typeof d!="string"&&(console.warn(d+" used as a key, but it is not a string."),d=String(d)),d}function X(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var D="local-forage-detect-blob-support",T=void 0,U={},J=Object.prototype.toString,V="readonly",S="readwrite";function B(d){for(var v=d.length,h=new ArrayBuffer(v),O=new Uint8Array(h),E=0;E<v;E++)O[E]=d.charCodeAt(E);return h}function L(d){return new u(function(v){var h=d.transaction(D,S),O=c([""]);h.objectStore(D).put(O,"key"),h.onabort=function(E){E.preventDefault(),E.stopPropagation(),v(!1)},h.oncomplete=function(){var E=navigator.userAgent.match(/Chrome\/(\d+)/),b=navigator.userAgent.match(/Edge\//);v(b||!E||parseInt(E[1],10)>=43)}}).catch(function(){return!1})}function $(d){return typeof T=="boolean"?u.resolve(T):L(d).then(function(v){return T=v,T})}function ne(d){var v=U[d.name],h={};h.promise=new u(function(O,E){h.resolve=O,h.reject=E}),v.deferredOperations.push(h),v.dbReady?v.dbReady=v.dbReady.then(function(){return h.promise}):v.dbReady=h.promise}function C(d){var v=U[d.name],h=v.deferredOperations.pop();if(h)return h.resolve(),h.promise}function R(d,v){var h=U[d.name],O=h.deferredOperations.pop();if(O)return O.reject(v),O.promise}function j(d,v){return new u(function(h,O){if(U[d.name]=U[d.name]||un(),d.db)if(v)ne(d),d.db.close();else return h(d.db);var E=[d.name];v&&E.push(d.version);var b=f.open.apply(f,E);v&&(b.onupgradeneeded=function(N){var A=b.result;try{A.createObjectStore(d.storeName),N.oldVersion<=1&&A.createObjectStore(D)}catch(k){if(k.name==="ConstraintError")console.warn('The database "'+d.name+'" has been upgraded from version '+N.oldVersion+" to version "+N.newVersion+', but the storage "'+d.storeName+'" already exists.');else throw k}}),b.onerror=function(N){N.preventDefault(),O(b.error)},b.onsuccess=function(){var N=b.result;N.onversionchange=function(A){A.target.close()},h(N),C(d)}})}function Q(d){return j(d,!1)}function le(d){return j(d,!0)}function oe(d,v){if(!d.db)return!0;var h=!d.db.objectStoreNames.contains(d.storeName),O=d.version<d.db.version,E=d.version>d.db.version;if(O&&(d.version!==v&&console.warn('The database "'+d.name+`" can't be downgraded from version `+d.db.version+" to version "+d.version+"."),d.version=d.db.version),E||h){if(h){var b=d.db.version+1;b>d.version&&(d.version=b)}return!0}return!1}function Fe(d){return new u(function(v,h){var O=new FileReader;O.onerror=h,O.onloadend=function(E){var b=btoa(E.target.result||"");v({__local_forage_encoded_blob:!0,data:b,type:d.type})},O.readAsBinaryString(d)})}function $e(d){var v=B(atob(d.data));return c([v],{type:d.type})}function Re(d){return d&&d.__local_forage_encoded_blob}function lt(d){var v=this,h=v._initReady().then(function(){var O=U[v._dbInfo.name];if(O&&O.dbReady)return O.dbReady});return y(h,d,d),h}function ln(d){ne(d);for(var v=U[d.name],h=v.forages,O=0;O<h.length;O++){var E=h[O];E._dbInfo.db&&(E._dbInfo.db.close(),E._dbInfo.db=null)}return d.db=null,Q(d).then(function(b){return d.db=b,oe(d)?le(d):b}).then(function(b){d.db=v.db=b;for(var N=0;N<h.length;N++)h[N]._dbInfo.db=b}).catch(function(b){throw R(d,b),b})}function ut(d,v,h,O){O===void 0&&(O=1);try{var E=d.db.transaction(d.storeName,v);h(null,E)}catch(b){if(O>0&&(!d.db||b.name==="InvalidStateError"||b.name==="NotFoundError"))return u.resolve().then(function(){if(!d.db||b.name==="NotFoundError"&&!d.db.objectStoreNames.contains(d.storeName)&&d.version<=d.db.version)return d.db&&(d.version=d.db.version+1),le(d)}).then(function(){return ln(d).then(function(){ut(d,v,h,O-1)})}).catch(h);h(b)}}function un(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Bn(d){var v=this,h={db:null};if(d)for(var O in d)h[O]=d[O];var E=U[h.name];E||(E=un(),U[h.name]=E),E.forages.push(v),v._initReady||(v._initReady=v.ready,v.ready=lt);var b=[];function N(){return u.resolve()}for(var A=0;A<E.forages.length;A++){var k=E.forages[A];k!==v&&b.push(k._initReady().catch(N))}var K=E.forages.slice(0);return u.all(b).then(function(){return h.db=E.db,Q(h)}).then(function(M){return h.db=M,oe(h,v._defaultConfig.version)?le(h):M}).then(function(M){h.db=E.db=M,v._dbInfo=h;for(var F=0;F<K.length;F++){var ae=K[F];ae!==v&&(ae._dbInfo.db=h.db,ae._dbInfo.version=h.version)}})}function Xn(d,v){var h=this;d=I(d);var O=new u(function(E,b){h.ready().then(function(){ut(h._dbInfo,V,function(N,A){if(N)return b(N);try{var k=A.objectStore(h._dbInfo.storeName),K=k.get(d);K.onsuccess=function(){var M=K.result;M===void 0&&(M=null),Re(M)&&(M=$e(M)),E(M)},K.onerror=function(){b(K.error)}}catch(M){b(M)}})}).catch(b)});return _(O,v),O}function gt(d,v){var h=this,O=new u(function(E,b){h.ready().then(function(){ut(h._dbInfo,V,function(N,A){if(N)return b(N);try{var k=A.objectStore(h._dbInfo.storeName),K=k.openCursor(),M=1;K.onsuccess=function(){var F=K.result;if(F){var ae=F.value;Re(ae)&&(ae=$e(ae));var be=d(ae,F.key,M++);be!==void 0?E(be):F.continue()}else E()},K.onerror=function(){b(K.error)}}catch(F){b(F)}})}).catch(b)});return _(O,v),O}function dr(d,v,h){var O=this;d=I(d);var E=new u(function(b,N){var A;O.ready().then(function(){return A=O._dbInfo,J.call(v)==="[object Blob]"?$(A.db).then(function(k){return k?v:Fe(v)}):v}).then(function(k){ut(O._dbInfo,S,function(K,M){if(K)return N(K);try{var F=M.objectStore(O._dbInfo.storeName);k===null&&(k=void 0);var ae=F.put(k,d);M.oncomplete=function(){k===void 0&&(k=null),b(k)},M.onabort=M.onerror=function(){var be=ae.error?ae.error:ae.transaction.error;N(be)}}catch(be){N(be)}})}).catch(N)});return _(E,h),E}function Wo(d,v){var h=this;d=I(d);var O=new u(function(E,b){h.ready().then(function(){ut(h._dbInfo,S,function(N,A){if(N)return b(N);try{var k=A.objectStore(h._dbInfo.storeName),K=k.delete(d);A.oncomplete=function(){E()},A.onerror=function(){b(K.error)},A.onabort=function(){var M=K.error?K.error:K.transaction.error;b(M)}}catch(M){b(M)}})}).catch(b)});return _(O,v),O}function jo(d){var v=this,h=new u(function(O,E){v.ready().then(function(){ut(v._dbInfo,S,function(b,N){if(b)return E(b);try{var A=N.objectStore(v._dbInfo.storeName),k=A.clear();N.oncomplete=function(){O()},N.onabort=N.onerror=function(){var K=k.error?k.error:k.transaction.error;E(K)}}catch(K){E(K)}})}).catch(E)});return _(h,d),h}function us(d){var v=this,h=new u(function(O,E){v.ready().then(function(){ut(v._dbInfo,V,function(b,N){if(b)return E(b);try{var A=N.objectStore(v._dbInfo.storeName),k=A.count();k.onsuccess=function(){O(k.result)},k.onerror=function(){E(k.error)}}catch(K){E(K)}})}).catch(E)});return _(h,d),h}function fr(d,v){var h=this,O=new u(function(E,b){if(d<0){E(null);return}h.ready().then(function(){ut(h._dbInfo,V,function(N,A){if(N)return b(N);try{var k=A.objectStore(h._dbInfo.storeName),K=!1,M=k.openKeyCursor();M.onsuccess=function(){var F=M.result;if(!F){E(null);return}d===0||K?E(F.key):(K=!0,F.advance(d))},M.onerror=function(){b(M.error)}}catch(F){b(F)}})}).catch(b)});return _(O,v),O}function Uo(d){var v=this,h=new u(function(O,E){v.ready().then(function(){ut(v._dbInfo,V,function(b,N){if(b)return E(b);try{var A=N.objectStore(v._dbInfo.storeName),k=A.openKeyCursor(),K=[];k.onsuccess=function(){var M=k.result;if(!M){O(K);return}K.push(M.key),M.continue()},k.onerror=function(){E(k.error)}}catch(M){E(M)}})}).catch(E)});return _(h,d),h}function yn(d,v){v=X.apply(this,arguments);var h=this.config();d=typeof d!="function"&&d||{},d.name||(d.name=d.name||h.name,d.storeName=d.storeName||h.storeName);var O=this,E;if(!d.name)E=u.reject("Invalid arguments");else{var b=d.name===h.name&&O._dbInfo.db,N=b?u.resolve(O._dbInfo.db):Q(d).then(function(A){var k=U[d.name],K=k.forages;k.db=A;for(var M=0;M<K.length;M++)K[M]._dbInfo.db=A;return A});d.storeName?E=N.then(function(A){if(!!A.objectStoreNames.contains(d.storeName)){var k=A.version+1;ne(d);var K=U[d.name],M=K.forages;A.close();for(var F=0;F<M.length;F++){var ae=M[F];ae._dbInfo.db=null,ae._dbInfo.version=k}var be=new u(function(Ee,Xe){var Me=f.open(d.name,k);Me.onerror=function(Tt){var uo=Me.result;uo.close(),Xe(Tt)},Me.onupgradeneeded=function(){var Tt=Me.result;Tt.deleteObjectStore(d.storeName)},Me.onsuccess=function(){var Tt=Me.result;Tt.close(),Ee(Tt)}});return be.then(function(Ee){K.db=Ee;for(var Xe=0;Xe<M.length;Xe++){var Me=M[Xe];Me._dbInfo.db=Ee,C(Me._dbInfo)}}).catch(function(Ee){throw(R(d,Ee)||u.resolve()).catch(function(){}),Ee})}}):E=N.then(function(A){ne(d);var k=U[d.name],K=k.forages;A.close();for(var M=0;M<K.length;M++){var F=K[M];F._dbInfo.db=null}var ae=new u(function(be,Ee){var Xe=f.deleteDatabase(d.name);Xe.onerror=function(){var Me=Xe.result;Me&&Me.close(),Ee(Xe.error)},Xe.onblocked=function(){console.warn('dropInstance blocked for database "'+d.name+'" until all open connections are closed')},Xe.onsuccess=function(){var Me=Xe.result;Me&&Me.close(),be(Me)}});return ae.then(function(be){k.db=be;for(var Ee=0;Ee<K.length;Ee++){var Xe=K[Ee];C(Xe._dbInfo)}}).catch(function(be){throw(R(d,be)||u.resolve()).catch(function(){}),be})})}return _(E,v),E}var ds={_driver:"asyncStorage",_initStorage:Bn,_support:a(),iterate:gt,getItem:Xn,setItem:dr,removeItem:Wo,clear:jo,length:us,key:fr,keys:Uo,dropInstance:yn};function ao(){return typeof openDatabase=="function"}var dt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pr="~~local_forage_type~",Bo=/^~~local_forage_type~([^~]+)~/,Hn="__lfsc__:",hr=Hn.length,et="arbf",Yt="blob",qn="si08",se="ui08",fe="uic8",Z="si16",Ce="si32",wt="ur16",mt="ui32",ge="fl32",z="fl64",_t=hr+et.length,gr=Object.prototype.toString;function co(d){var v=d.length*.75,h=d.length,O,E=0,b,N,A,k;d[d.length-1]==="="&&(v--,d[d.length-2]==="="&&v--);var K=new ArrayBuffer(v),M=new Uint8Array(K);for(O=0;O<h;O+=4)b=dt.indexOf(d[O]),N=dt.indexOf(d[O+1]),A=dt.indexOf(d[O+2]),k=dt.indexOf(d[O+3]),M[E++]=b<<2|N>>4,M[E++]=(N&15)<<4|A>>2,M[E++]=(A&3)<<6|k&63;return K}function fs(d){var v=new Uint8Array(d),h="",O;for(O=0;O<v.length;O+=3)h+=dt[v[O]>>2],h+=dt[(v[O]&3)<<4|v[O+1]>>4],h+=dt[(v[O+1]&15)<<2|v[O+2]>>6],h+=dt[v[O+2]&63];return v.length%3===2?h=h.substring(0,h.length-1)+"=":v.length%3===1&&(h=h.substring(0,h.length-2)+"=="),h}function wp(d,v){var h="";if(d&&(h=gr.call(d)),d&&(h==="[object ArrayBuffer]"||d.buffer&&gr.call(d.buffer)==="[object ArrayBuffer]")){var O,E=Hn;d instanceof ArrayBuffer?(O=d,E+=et):(O=d.buffer,h==="[object Int8Array]"?E+=qn:h==="[object Uint8Array]"?E+=se:h==="[object Uint8ClampedArray]"?E+=fe:h==="[object Int16Array]"?E+=Z:h==="[object Uint16Array]"?E+=wt:h==="[object Int32Array]"?E+=Ce:h==="[object Uint32Array]"?E+=mt:h==="[object Float32Array]"?E+=ge:h==="[object Float64Array]"?E+=z:v(new Error("Failed to get type for BinaryArray"))),v(E+fs(O))}else if(h==="[object Blob]"){var b=new FileReader;b.onload=function(){var N=pr+d.type+"~"+fs(this.result);v(Hn+Yt+N)},b.readAsArrayBuffer(d)}else try{v(JSON.stringify(d))}catch(N){console.error("Couldn't convert value into a JSON string: ",d),v(null,N)}}function Tp(d){if(d.substring(0,hr)!==Hn)return JSON.parse(d);var v=d.substring(_t),h=d.substring(hr,_t),O;if(h===Yt&&Bo.test(v)){var E=v.match(Bo);O=E[1],v=v.substring(E[0].length)}var b=co(v);switch(h){case et:return b;case Yt:return c([b],{type:O});case qn:return new Int8Array(b);case se:return new Uint8Array(b);case fe:return new Uint8ClampedArray(b);case Z:return new Int16Array(b);case wt:return new Uint16Array(b);case Ce:return new Int32Array(b);case mt:return new Uint32Array(b);case ge:return new Float32Array(b);case z:return new Float64Array(b);default:throw new Error("Unkown type: "+h)}}var ps={serialize:wp,deserialize:Tp,stringToBuffer:co,bufferToString:fs};function Mc(d,v,h,O){d.executeSql("CREATE TABLE IF NOT EXISTS "+v.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],h,O)}function Sp(d){var v=this,h={db:null};if(d)for(var O in d)h[O]=typeof d[O]!="string"?d[O].toString():d[O];var E=new u(function(b,N){try{h.db=openDatabase(h.name,String(h.version),h.description,h.size)}catch(A){return N(A)}h.db.transaction(function(A){Mc(A,h,function(){v._dbInfo=h,b()},function(k,K){N(K)})},N)});return h.serializer=ps,E}function vn(d,v,h,O,E,b){d.executeSql(h,O,E,function(N,A){A.code===A.SYNTAX_ERR?N.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[v.storeName],function(k,K){K.rows.length?b(k,A):Mc(k,v,function(){k.executeSql(h,O,E,b)},b)},b):b(N,A)},b)}function Np(d,v){var h=this;d=I(d);var O=new u(function(E,b){h.ready().then(function(){var N=h._dbInfo;N.db.transaction(function(A){vn(A,N,"SELECT * FROM "+N.storeName+" WHERE key = ? LIMIT 1",[d],function(k,K){var M=K.rows.length?K.rows.item(0).value:null;M&&(M=N.serializer.deserialize(M)),E(M)},function(k,K){b(K)})})}).catch(b)});return _(O,v),O}function Rp(d,v){var h=this,O=new u(function(E,b){h.ready().then(function(){var N=h._dbInfo;N.db.transaction(function(A){vn(A,N,"SELECT * FROM "+N.storeName,[],function(k,K){for(var M=K.rows,F=M.length,ae=0;ae<F;ae++){var be=M.item(ae),Ee=be.value;if(Ee&&(Ee=N.serializer.deserialize(Ee)),Ee=d(Ee,be.key,ae+1),Ee!==void 0){E(Ee);return}}E()},function(k,K){b(K)})})}).catch(b)});return _(O,v),O}function Wc(d,v,h,O){var E=this;d=I(d);var b=new u(function(N,A){E.ready().then(function(){v===void 0&&(v=null);var k=v,K=E._dbInfo;K.serializer.serialize(v,function(M,F){F?A(F):K.db.transaction(function(ae){vn(ae,K,"INSERT OR REPLACE INTO "+K.storeName+" (key, value) VALUES (?, ?)",[d,M],function(){N(k)},function(be,Ee){A(Ee)})},function(ae){if(ae.code===ae.QUOTA_ERR){if(O>0){N(Wc.apply(E,[d,k,h,O-1]));return}A(ae)}})})}).catch(A)});return _(b,h),b}function Dp(d,v,h){return Wc.apply(this,[d,v,h,1])}function Ip(d,v){var h=this;d=I(d);var O=new u(function(E,b){h.ready().then(function(){var N=h._dbInfo;N.db.transaction(function(A){vn(A,N,"DELETE FROM "+N.storeName+" WHERE key = ?",[d],function(){E()},function(k,K){b(K)})})}).catch(b)});return _(O,v),O}function Ap(d){var v=this,h=new u(function(O,E){v.ready().then(function(){var b=v._dbInfo;b.db.transaction(function(N){vn(N,b,"DELETE FROM "+b.storeName,[],function(){O()},function(A,k){E(k)})})}).catch(E)});return _(h,d),h}function Pp(d){var v=this,h=new u(function(O,E){v.ready().then(function(){var b=v._dbInfo;b.db.transaction(function(N){vn(N,b,"SELECT COUNT(key) as c FROM "+b.storeName,[],function(A,k){var K=k.rows.item(0).c;O(K)},function(A,k){E(k)})})}).catch(E)});return _(h,d),h}function kp(d,v){var h=this,O=new u(function(E,b){h.ready().then(function(){var N=h._dbInfo;N.db.transaction(function(A){vn(A,N,"SELECT key FROM "+N.storeName+" WHERE id = ? LIMIT 1",[d+1],function(k,K){var M=K.rows.length?K.rows.item(0).key:null;E(M)},function(k,K){b(K)})})}).catch(b)});return _(O,v),O}function Kp(d){var v=this,h=new u(function(O,E){v.ready().then(function(){var b=v._dbInfo;b.db.transaction(function(N){vn(N,b,"SELECT key FROM "+b.storeName,[],function(A,k){for(var K=[],M=0;M<k.rows.length;M++)K.push(k.rows.item(M).key);O(K)},function(A,k){E(k)})})}).catch(E)});return _(h,d),h}function Lp(d){return new u(function(v,h){d.transaction(function(O){O.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(E,b){for(var N=[],A=0;A<b.rows.length;A++)N.push(b.rows.item(A).name);v({db:d,storeNames:N})},function(E,b){h(b)})},function(O){h(O)})})}function xp(d,v){v=X.apply(this,arguments);var h=this.config();d=typeof d!="function"&&d||{},d.name||(d.name=d.name||h.name,d.storeName=d.storeName||h.storeName);var O=this,E;return d.name?E=new u(function(b){var N;d.name===h.name?N=O._dbInfo.db:N=openDatabase(d.name,"","",0),d.storeName?b({db:N,storeNames:[d.storeName]}):b(Lp(N))}).then(function(b){return new u(function(N,A){b.db.transaction(function(k){function K(be){return new u(function(Ee,Xe){k.executeSql("DROP TABLE IF EXISTS "+be,[],function(){Ee()},function(Me,Tt){Xe(Tt)})})}for(var M=[],F=0,ae=b.storeNames.length;F<ae;F++)M.push(K(b.storeNames[F]));u.all(M).then(function(){N()}).catch(function(be){A(be)})},function(k){A(k)})})}):E=u.reject("Invalid arguments"),_(E,v),E}var Mp={_driver:"webSQLStorage",_initStorage:Sp,_support:ao(),iterate:Rp,getItem:Np,setItem:Dp,removeItem:Ip,clear:Ap,length:Pp,key:kp,keys:Kp,dropInstance:xp};function Wp(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function jc(d,v){var h=d.name+"/";return d.storeName!==v.storeName&&(h+=d.storeName+"/"),h}function jp(){var d="_localforage_support_test";try{return localStorage.setItem(d,!0),localStorage.removeItem(d),!1}catch{return!0}}function Up(){return!jp()||localStorage.length>0}function Bp(d){var v=this,h={};if(d)for(var O in d)h[O]=d[O];return h.keyPrefix=jc(d,v._defaultConfig),Up()?(v._dbInfo=h,h.serializer=ps,u.resolve()):u.reject()}function Xp(d){var v=this,h=v.ready().then(function(){for(var O=v._dbInfo.keyPrefix,E=localStorage.length-1;E>=0;E--){var b=localStorage.key(E);b.indexOf(O)===0&&localStorage.removeItem(b)}});return _(h,d),h}function Hp(d,v){var h=this;d=I(d);var O=h.ready().then(function(){var E=h._dbInfo,b=localStorage.getItem(E.keyPrefix+d);return b&&(b=E.serializer.deserialize(b)),b});return _(O,v),O}function qp(d,v){var h=this,O=h.ready().then(function(){for(var E=h._dbInfo,b=E.keyPrefix,N=b.length,A=localStorage.length,k=1,K=0;K<A;K++){var M=localStorage.key(K);if(M.indexOf(b)===0){var F=localStorage.getItem(M);if(F&&(F=E.serializer.deserialize(F)),F=d(F,M.substring(N),k++),F!==void 0)return F}}});return _(O,v),O}function Jp(d,v){var h=this,O=h.ready().then(function(){var E=h._dbInfo,b;try{b=localStorage.key(d)}catch{b=null}return b&&(b=b.substring(E.keyPrefix.length)),b});return _(O,v),O}function Fp(d){var v=this,h=v.ready().then(function(){for(var O=v._dbInfo,E=localStorage.length,b=[],N=0;N<E;N++){var A=localStorage.key(N);A.indexOf(O.keyPrefix)===0&&b.push(A.substring(O.keyPrefix.length))}return b});return _(h,d),h}function $p(d){var v=this,h=v.keys().then(function(O){return O.length});return _(h,d),h}function Vp(d,v){var h=this;d=I(d);var O=h.ready().then(function(){var E=h._dbInfo;localStorage.removeItem(E.keyPrefix+d)});return _(O,v),O}function Gp(d,v,h){var O=this;d=I(d);var E=O.ready().then(function(){v===void 0&&(v=null);var b=v;return new u(function(N,A){var k=O._dbInfo;k.serializer.serialize(v,function(K,M){if(M)A(M);else try{localStorage.setItem(k.keyPrefix+d,K),N(b)}catch(F){(F.name==="QuotaExceededError"||F.name==="NS_ERROR_DOM_QUOTA_REACHED")&&A(F),A(F)}})})});return _(E,h),E}function Yp(d,v){if(v=X.apply(this,arguments),d=typeof d!="function"&&d||{},!d.name){var h=this.config();d.name=d.name||h.name,d.storeName=d.storeName||h.storeName}var O=this,E;return d.name?E=new u(function(b){d.storeName?b(jc(d,O._defaultConfig)):b(d.name+"/")}).then(function(b){for(var N=localStorage.length-1;N>=0;N--){var A=localStorage.key(N);A.indexOf(b)===0&&localStorage.removeItem(A)}}):E=u.reject("Invalid arguments"),_(E,v),E}var zp={_driver:"localStorageWrapper",_initStorage:Bp,_support:Wp(),iterate:qp,getItem:Hp,setItem:Gp,removeItem:Vp,clear:Xp,length:$p,key:Jp,keys:Fp,dropInstance:Yp},Qp=function(v,h){return v===h||typeof v=="number"&&typeof h=="number"&&isNaN(v)&&isNaN(h)},Zp=function(v,h){for(var O=v.length,E=0;E<O;){if(Qp(v[E],h))return!0;E++}return!1},Uc=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"},lo={},Bc={},mr={INDEXEDDB:ds,WEBSQL:Mp,LOCALSTORAGE:zp},eh=[mr.INDEXEDDB._driver,mr.WEBSQL._driver,mr.LOCALSTORAGE._driver],Xo=["dropInstance"],hs=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Xo),th={description:"",driver:eh.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function nh(d,v){d[v]=function(){var h=arguments;return d.ready().then(function(){return d[v].apply(d,h)})}}function gs(){for(var d=1;d<arguments.length;d++){var v=arguments[d];if(v)for(var h in v)v.hasOwnProperty(h)&&(Uc(v[h])?arguments[0][h]=v[h].slice():arguments[0][h]=v[h])}return arguments[0]}var rh=function(){function d(v){l(this,d);for(var h in mr)if(mr.hasOwnProperty(h)){var O=mr[h],E=O._driver;this[h]=E,lo[E]||this.defineDriver(O)}this._defaultConfig=gs({},th),this._config=gs({},this._defaultConfig,v),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return d.prototype.config=function(h){if((typeof h>"u"?"undefined":s(h))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var O in h){if(O==="storeName"&&(h[O]=h[O].replace(/\W/g,"_")),O==="version"&&typeof h[O]!="number")return new Error("Database version must be a number.");this._config[O]=h[O]}return"driver"in h&&h.driver?this.setDriver(this._config.driver):!0}else return typeof h=="string"?this._config[h]:this._config},d.prototype.defineDriver=function(h,O,E){var b=new u(function(N,A){try{var k=h._driver,K=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!h._driver){A(K);return}for(var M=hs.concat("_initStorage"),F=0,ae=M.length;F<ae;F++){var be=M[F],Ee=!Zp(Xo,be);if((Ee||h[be])&&typeof h[be]!="function"){A(K);return}}var Xe=function(){for(var uo=function(sh){return function(){var ah=new Error("Method "+sh+" is not implemented by the current driver"),Xc=u.reject(ah);return _(Xc,arguments[arguments.length-1]),Xc}},ms=0,ih=Xo.length;ms<ih;ms++){var _s=Xo[ms];h[_s]||(h[_s]=uo(_s))}};Xe();var Me=function(uo){lo[k]&&console.info("Redefining LocalForage driver: "+k),lo[k]=h,Bc[k]=uo,N()};"_support"in h?h._support&&typeof h._support=="function"?h._support().then(Me,A):Me(!!h._support):Me(!0)}catch(Tt){A(Tt)}});return y(b,O,E),b},d.prototype.driver=function(){return this._driver||null},d.prototype.getDriver=function(h,O,E){var b=lo[h]?u.resolve(lo[h]):u.reject(new Error("Driver not found."));return y(b,O,E),b},d.prototype.getSerializer=function(h){var O=u.resolve(ps);return y(O,h),O},d.prototype.ready=function(h){var O=this,E=O._driverSet.then(function(){return O._ready===null&&(O._ready=O._initDriver()),O._ready});return y(E,h,h),E},d.prototype.setDriver=function(h,O,E){var b=this;Uc(h)||(h=[h]);var N=this._getSupportedDrivers(h);function A(){b._config.driver=b.driver()}function k(F){return b._extend(F),A(),b._ready=b._initStorage(b._config),b._ready}function K(F){return function(){var ae=0;function be(){for(;ae<F.length;){var Ee=F[ae];return ae++,b._dbInfo=null,b._ready=null,b.getDriver(Ee).then(k).catch(be)}A();var Xe=new Error("No available storage method found.");return b._driverSet=u.reject(Xe),b._driverSet}return be()}}var M=this._driverSet!==null?this._driverSet.catch(function(){return u.resolve()}):u.resolve();return this._driverSet=M.then(function(){var F=N[0];return b._dbInfo=null,b._ready=null,b.getDriver(F).then(function(ae){b._driver=ae._driver,A(),b._wrapLibraryMethodsWithReady(),b._initDriver=K(N)})}).catch(function(){A();var F=new Error("No available storage method found.");return b._driverSet=u.reject(F),b._driverSet}),y(this._driverSet,O,E),this._driverSet},d.prototype.supports=function(h){return!!Bc[h]},d.prototype._extend=function(h){gs(this,h)},d.prototype._getSupportedDrivers=function(h){for(var O=[],E=0,b=h.length;E<b;E++){var N=h[E];this.supports(N)&&O.push(N)}return O},d.prototype._wrapLibraryMethodsWithReady=function(){for(var h=0,O=hs.length;h<O;h++)nh(this,hs[h])},d.prototype.createInstance=function(h){return new d(h)},d}(),oh=new rh;o.exports=oh},{3:3}]},{},[4])(4)})});var Co=H(nt=>{"use strict";g();m();var Rn=nt&&nt.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})},aa=nt&&nt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(nt,"__esModule",{value:!0});nt.OKXReporter=nt.OKXReportSide=nt.OKXReportType=nt.versionStr=void 0;var Tg=aa(Eu()),Nn=je(),Eo=Pr(),ia=Qe(),Sg=aa(wi()),Ng=aa(yr());nt.versionStr="1.8.1";var Rg=["https://www.okx.com/dappstat/wallet-connect","https://www.okx.ac/dappstat/wallet-connect"],Dg="OKX_RP_CK",ud="OKX_RP_UUID_CK",dd=100,Ig={Accept:"*/*","Content-Type":"text/plain"},Ag="POST",Pg={headers:Ig,method:Ag};nt.OKXReportType={PAGE_IN:"page_in",PAGE_OUT:"page_out",CLICK:"click",LOG:"log"};nt.OKXReportSide={DAPP:"dapp",WALLET:"wallet"};var kg=(n,...e)=>Rn(void 0,[n,...e],void 0,function*(t,r={},o=5e3){for(let i of t)try{let s=new AbortController,l=s.signal,p=(0,Tg.default)(i,Object.assign(Object.assign({},r),{signal:l})),f=new Promise((c,u)=>setTimeout(()=>{s.abort(),u(new Error("Request timed out"))},o)),a=yield Promise.race([p,f]);if(a.ok)return a;if(a.status==502)return console.error("Fetch error status 502",i),a}catch(s){console.error(`Fetch error for ${i}:`,s)}throw console.error("'All fetch attempts failed.'"),new Error("All fetch attempts failed.")}),sa=class{constructor(){this.currentSide=nt.OKXReportSide.DAPP,this.currentVersion=nt.versionStr,this.storage=Sg.default.createInstance({name:"OKXReporter"}),this.recordList=new Array,this.currentUUID=(0,ia.toHexString)(Ng.default.randomBytes(16))}configVersionAndSide(e,t,r){this.currentVersion=e+Nn.logVersion,this.currentSide=t,this.appName=r}get recordCacheKey(){return Dg+"@"+this.appName}get reportPlatform(){return(0,ia.isMobileUserAgent)()?(0,ia.isIos)()?"iOS":"android":"pc"}beginReport(){return Rn(this,void 0,void 0,function*(){this.startErrorCatching();let e=yield this.storage.getItem(this.recordCacheKey),t=yield this.storage.getItem(ud);t?this.currentUUID=t:this.storage.setItem(ud,this.currentUUID),e&&(this.recordList=e,(0,Nn.logDebug)("resume records from cache length: ",this.recordList.length),yield this.sendCachedRecords())})}startErrorCatching(){(0,Eo.getWindow)()&&(0,Nn.logDebug)("begin capture console error")}cachedErrors(){return this.recordList}sendRecord(e){return Rn(this,void 0,void 0,function*(){return new Promise((t,r)=>Rn(this,void 0,void 0,function*(){try{let o=JSON.stringify(e);(0,Nn.logDebug)("[REPORT] record: ",o);let i=yield kg(Rg,Object.assign(Object.assign({},Pg),{body:o}));(0,Nn.logDebug)("[REPORT] get rsp:",i),i&&i.status&&i.status==200?(this.recordList=this.recordList.filter(s=>s.timestamp!=e.timestamp||s.content!=e.content),yield this.storage.setItem(this.recordCacheKey,this.recordList),t(!0)):r(!1)}catch(o){(0,Nn.logDebug)("send record error:",o),t(!0)}}))})}sendRecordContent(e,t,r){return Rn(this,arguments,void 0,function*(o,i,s,l=void 0,p=void 0,f=void 0,a=void 0,c=void 0,u=void 0){var _,y,I,X;let D=(_=(0,Eo.getWindow)())===null||_===void 0?void 0:_.location.pathname,T=(y=(0,Eo.getWindow)())===null||y===void 0?void 0:y.location.origin;D&&T&&(T=T+D);let U=(I=(0,Eo.getWindow)())===null||I===void 0?void 0:I.navigator.language,J=(X=(0,Eo.getWindow)())===null||X===void 0?void 0:X.navigator.userAgent,V=this.reportPlatform,S={uuid:this.currentUUID,version:this.currentVersion,content:o,action:s,side:this.currentSide,timestamp:new Date().getTime(),url:T,lang:U,type:i,platform:V,"user-agent":J,reverved1:l,reverved2:p,reverved3:f,reverved4:a,reverved5:c,reverved6:u};yield this.markRecordItem(S),yield this.sendRecord(S)})}sendCachedRecords(){return Rn(this,void 0,void 0,function*(){return new Promise((e,t)=>Rn(this,void 0,void 0,function*(){let r=this.recordList.map(o=>this.sendRecord(o));(0,Nn.logDebug)("[REPORT] submit & clean recorded caches begin @",new Date().toUTCString()),Promise.allSettled(r).then(o=>{(0,Nn.logDebug)("[REPORT] submit & clean recorded caches ends @",new Date().toUTCString());let i=[];o.forEach((s,l)=>{s.status=="rejected"&&i.push(l)}),this.recordList=this.recordList.filter((s,l)=>!i.includes(l)),this.storage.setItem(this.recordCacheKey,this.recordList).then(function(s){e()}).catch(function(s){t(s)})})}))})}markRecordItem(e){return Rn(this,void 0,void 0,function*(){if(this.recordList.push(e),this.recordList.length>dd){let t=this.recordList.length-dd;this.recordList.splice(0,t)}return new Promise((t,r)=>{this.storage.setItem(this.recordCacheKey,this.recordList).then(function(o){t(e)}).catch(function(o){r(o)})})})}};nt.OKXReporter=sa});var fd=H((PE,Kg)=>{Kg.exports={name:"@okxconnect/core",version:"1.8.1",description:"OKX Connect core",main:"./src/index.js",keywords:["OKXConnect","OKX Connect"],scripts:{build:"npx tsc",local:"yarn install && npx tsc",remove:"rm -rf ./src  && rm -rf ./node_modules"},author:"OKX Wallet",license:"MIT",dependencies:{"@stablelib/ed25519":"^1.0.2","@stablelib/random":"^1.0.1","@stablelib/sha256":"1.0.1",bs58:"^5.0.0","core-js":"2.6.12","cross-fetch":"^4.0.0","crypto-js":"^4.2.0",eventemitter3:"^5.0.1",isutf8:"^4.0.0",localforage:"^1.10.0",multiformats:"9.4.2",process:"^0.11.10",tweetnacl:"^1.0.3","tweetnacl-util":"^0.15.1","ua-parser-js":"^1.0.35",uint8arrays:"3.1.0"},devDependencies:{"@types/crypto-js":"^4.2.2","@types/ua-parser-js":"^0.7.36",assert:"^2.1.0",eslint:"^9.7.0",events:"^3.3.0",jest:"^29.7.0","ts-loader":"^9.5.1",typescript:"^5.5.2"},peerDependencies:{"@solana/web3.js":"^1.78.4"}}});var je=H(It=>{"use strict";g();m();var pd=It&&It.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(It,"__esModule",{value:!0});It.logVersion=void 0;It.getDefaultReporter=xg;It.logDebug=Wg;It.logError=jg;It.logWarning=Ug;It.reportEvent=Bg;It.reportLog=Xg;var Ti=!1,Lg=!1,hd=Co(),ca=new hd.OKXReporter;function xg(){return ca}var Mg=fd(),Si=Mg.version;function Wg(...n){if(typeof console<"u")try{(Ti||window?.okxLogDebug)&&console.log(`[OKX_CONNECT_SDK] ${Si} `,...n)}catch{}}function jg(...n){if(typeof console<"u")try{if((Ti||window?.okxLogDebug)&&console.error(`[OKX_CONNECT_SDK] ${Si} `,...n),Lg||!Ti){let e="";e+=[...n].reduce((t,r)=>{typeof r=="string"?t+=","+r:typeof r=="object"&&(t+=JSON.stringify(r))}),ca.sendRecordContent(e,hd.OKXReportType.LOG,"")}}catch{}}function Ug(...n){if(typeof console<"u")try{(Ti||window?.okxLogDebug)&&console.warn(`[OKX_CONNECT_SDK] ${Si} `,...n)}catch{}}function Bg(n,e,t){return pd(this,arguments,void 0,function*(r,o,i,s=void 0,l=void 0,p=void 0,f=void 0,a=void 0,c=void 0){try{yield ca.sendRecordContent(i,r,o,s,l,p,f,a,c)}catch{}})}function Xg(n){return pd(this,arguments,void 0,function*(e,t="default"){})}It.logVersion=Si});var Sn=H(Ni=>{"use strict";g();m();Object.defineProperty(Ni,"__esModule",{value:!0});Ni.safeJsonParse=Fg;Ni.safeJsonStringify=$g;var Hg=je(),qg=n=>JSON.stringify(n,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),Jg=n=>{let e=/:(\b\d{17,}|\b(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\}\]]|$)/g,t=n.replace(e,(r,o)=>`:"${o}n"`);try{return JSON.parse(t,(r,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)}catch{return JSON.parse(n)}};function Fg(n){if(typeof n!="string")throw(0,Hg.logDebug)(n),new Error(`Cannot safe json parse value of type ${typeof n}`);try{return Jg(n)}catch(e){return console.error("safeJsonParse error:",e),n}}function $g(n){return typeof n=="string"?n:qg(n)||""}});function Vg(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var o=0;o<n.length;o++){var i=n.charAt(o),s=i.charCodeAt(0);if(t[s]!==255)throw new TypeError(i+" is ambiguous");t[s]=o}var l=n.length,p=n.charAt(0),f=Math.log(l)/Math.log(256),a=Math.log(256)/Math.log(l);function c(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var I=0,X=0,D=0,T=y.length;D!==T&&y[D]===0;)D++,I++;for(var U=(T-D)*a+1>>>0,J=new Uint8Array(U);D!==T;){for(var V=y[D],S=0,B=U-1;(V!==0||S<X)&&B!==-1;B--,S++)V+=256*J[B]>>>0,J[B]=V%l>>>0,V=V/l>>>0;if(V!==0)throw new Error("Non-zero carry");X=S,D++}for(var L=U-X;L!==U&&J[L]===0;)L++;for(var $=p.repeat(I);L<U;++L)$+=n.charAt(J[L]);return $}function u(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var I=0;if(y[I]!==" "){for(var X=0,D=0;y[I]===p;)X++,I++;for(var T=(y.length-I)*f+1>>>0,U=new Uint8Array(T);y[I];){var J=t[y.charCodeAt(I)];if(J===255)return;for(var V=0,S=T-1;(J!==0||V<D)&&S!==-1;S--,V++)J+=l*U[S]>>>0,U[S]=J%256>>>0,J=J/256>>>0;if(J!==0)throw new Error("Non-zero carry");D=V,I++}if(y[I]!==" "){for(var B=T-D;B!==T&&U[B]===0;)B++;for(var L=new Uint8Array(X+(T-B)),$=X;B!==T;)L[$++]=U[B++];return L}}}function _(y){var I=u(y);if(I)return I;throw new Error(`Non-${e} character`)}return{encode:c,decodeUnsafe:u,decode:_}}var Gg,Yg,gd,md=De(()=>{g();m();Gg=Vg,Yg=Gg,gd=Yg});var Ri={};Ge(Ri,{coerce:()=>Ht,empty:()=>_d,equals:()=>la,fromHex:()=>Qg,fromString:()=>ua,isBinary:()=>Zg,toHex:()=>zg,toString:()=>da});var _d,zg,Qg,la,Ht,Zg,ua,da,Dn=De(()=>{g();m();_d=new Uint8Array(0),zg=n=>n.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),Qg=n=>{let e=n.match(/../g);return e?new Uint8Array(e.map(t=>parseInt(t,16))):_d},la=(n,e)=>{if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0},Ht=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},Zg=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),ua=n=>new TextEncoder().encode(n),da=n=>new TextDecoder().decode(n)});var fa,pa,wo,ha,Di,In,em,tm,ke,tn=De(()=>{g();m();md();Dn();fa=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},pa=class{constructor(e,t,r){this.name=e,this.prefix=t,this.baseDecode=r}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){let t={[this.prefix]:this,...e.decoders||{[e.prefix]:e}};return new wo(t)}},wo=class{constructor(e){this.decoders=e}or(e){let t=e.decoders||{[e.prefix]:e};return new wo({...this.decoders,...t})}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},ha=class{constructor(e,t,r,o){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=o,this.encoder=new fa(e,t,r),this.decoder=new pa(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Di=({name:n,prefix:e,encode:t,decode:r})=>new ha(n,e,t,r),In=({prefix:n,name:e,alphabet:t})=>{let{encode:r,decode:o}=gd(t,e);return Di({prefix:n,name:e,encode:r,decode:i=>Ht(o(i))})},em=(n,e,t,r)=>{let o={};for(let a=0;a<e.length;++a)o[e[a]]=a;let i=n.length;for(;n[i-1]==="=";)--i;let s=new Uint8Array(i*t/8|0),l=0,p=0,f=0;for(let a=0;a<i;++a){let c=o[n[a]];if(c===void 0)throw new SyntaxError(`Non-${r} character`);p=p<<t|c,l+=t,l>=8&&(l-=8,s[f++]=255&p>>l)}if(l>=t||255&p<<8-l)throw new SyntaxError("Unexpected end of data");return s},tm=(n,e,t)=>{let r=e[e.length-1]==="=",o=(1<<t)-1,i="",s=0,l=0;for(let p=0;p<n.length;++p)for(l=l<<8|n[p],s+=8;s>t;)s-=t,i+=e[o&l>>s];if(s&&(i+=e[o&l<<t-s]),r)for(;i.length*t&7;)i+="=";return i},ke=({name:n,prefix:e,bitsPerChar:t,alphabet:r})=>Di({prefix:e,name:n,encode(o){return tm(o,r,t)},decode(o){return em(o,r,t,n)}})});var ga={};Ge(ga,{identity:()=>nm});var nm,yd=De(()=>{g();m();tn();Dn();nm=Di({prefix:"\0",name:"identity",encode:n=>da(n),decode:n=>ua(n)})});var ma={};Ge(ma,{base2:()=>rm});var rm,vd=De(()=>{g();m();tn();rm=ke({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})});var _a={};Ge(_a,{base8:()=>om});var om,bd=De(()=>{g();m();tn();om=ke({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})});var ya={};Ge(ya,{base10:()=>im});var im,Od=De(()=>{g();m();tn();im=In({prefix:"9",name:"base10",alphabet:"0123456789"})});var va={};Ge(va,{base16:()=>sm,base16upper:()=>am});var sm,am,Cd=De(()=>{g();m();tn();sm=ke({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),am=ke({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})});var ba={};Ge(ba,{base32:()=>xr,base32hex:()=>dm,base32hexpad:()=>pm,base32hexpadupper:()=>hm,base32hexupper:()=>fm,base32pad:()=>lm,base32padupper:()=>um,base32upper:()=>cm,base32z:()=>gm});var xr,cm,lm,um,dm,fm,pm,hm,gm,Oa=De(()=>{g();m();tn();xr=ke({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),cm=ke({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),lm=ke({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),um=ke({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),dm=ke({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),fm=ke({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pm=ke({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hm=ke({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),gm=ke({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})});var Ca={};Ge(Ca,{base36:()=>mm,base36upper:()=>_m});var mm,_m,Ed=De(()=>{g();m();tn();mm=In({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_m=In({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})});var Ea={};Ge(Ea,{base58btc:()=>nn,base58flickr:()=>ym});var nn,ym,wa=De(()=>{g();m();tn();nn=In({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ym=In({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})});var Ta={};Ge(Ta,{base64:()=>vm,base64pad:()=>bm,base64url:()=>Om,base64urlpad:()=>Cm});var vm,bm,Om,Cm,wd=De(()=>{g();m();tn();vm=ke({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bm=ke({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Om=ke({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Cm=ke({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});function Nd(n,e,t){e=e||[],t=t||0;for(var r=t;n>=Sm;)e[t++]=n&255|Td,n/=128;for(;n&Tm;)e[t++]=n&255|Td,n>>>=7;return e[t]=n|0,Nd.bytes=t-r+1,e}function Sa(n,r){var t=0,r=r||0,o=0,i=r,s,l=n.length;do{if(i>=l)throw Sa.bytes=0,new RangeError("Could not decode varint");s=n[i++],t+=o<28?(s&Sd)<<o:(s&Sd)*Math.pow(2,o),o+=7}while(s>=Rm);return Sa.bytes=i-r,t}var Em,Td,wm,Tm,Sm,Nm,Rm,Sd,Dm,Im,Am,Pm,km,Km,Lm,xm,Mm,Wm,jm,Um,To,Rd=De(()=>{g();m();Em=Nd,Td=128,wm=127,Tm=~wm,Sm=Math.pow(2,31);Nm=Sa,Rm=128,Sd=127;Dm=Math.pow(2,7),Im=Math.pow(2,14),Am=Math.pow(2,21),Pm=Math.pow(2,28),km=Math.pow(2,35),Km=Math.pow(2,42),Lm=Math.pow(2,49),xm=Math.pow(2,56),Mm=Math.pow(2,63),Wm=function(n){return n<Dm?1:n<Im?2:n<Am?3:n<Pm?4:n<km?5:n<Km?6:n<Lm?7:n<xm?8:n<Mm?9:10},jm={encode:Em,decode:Nm,encodingLength:Wm},Um=jm,To=Um});var Wr={};Ge(Wr,{decode:()=>Mr,encodeTo:()=>Qn,encodingLength:()=>Zn});var Mr,Qn,Zn,Ii=De(()=>{g();m();Rd();Mr=n=>[To.decode(n),To.decode.bytes],Qn=(n,e,t=0)=>(To.encode(n,e,t),e),Zn=n=>To.encodingLength(n)});var jr={};Ge(jr,{Digest:()=>er,create:()=>So,decode:()=>Na,equals:()=>Ra});var So,Na,Ra,er,Ai=De(()=>{g();m();Dn();Ii();So=(n,e)=>{let t=e.byteLength,r=Zn(n),o=r+Zn(t),i=new Uint8Array(o+t);return Qn(n,i,0),Qn(t,i,r),i.set(e,o),new er(n,t,e,i)},Na=n=>{let e=Ht(n),[t,r]=Mr(e),[o,i]=Mr(e.subarray(r)),s=e.subarray(r+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new er(t,o,s,e)},Ra=(n,e)=>n===e?!0:n.code===e.code&&n.size===e.size&&la(n.bytes,e.bytes),er=class{constructor(e,t,r,o){this.code=e,this.size=t,this.digest=r,this.bytes=o}}});var ki={};Ge(ki,{Hasher:()=>Pi,from:()=>Ur});var Ur,Pi,Ki=De(()=>{g();m();Ai();Ur=({name:n,code:e,encode:t})=>new Pi(n,e,t),Pi=class{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}async digest(e){if(e instanceof Uint8Array){let t=await this.encode(e);return So(this.code,t)}else throw Error("Unknown type, must be binary type")}}});var Da={};Ge(Da,{sha256:()=>Bm,sha512:()=>Xm});var Dd,Bm,Xm,Id=De(()=>{g();m();Ki();Dd=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),Bm=Ur({name:"sha2-256",code:18,encode:Dd("SHA-256")}),Xm=Ur({name:"sha2-512",code:19,encode:Dd("SHA-512")})});var Ia={};Ge(Ia,{identity:()=>Hm});var Hm,Ad=De(()=>{g();m();Ki();Dn();Hm=Ur({name:"identity",code:0,encode:n=>Ht(n)})});var Aa={};Ge(Aa,{code:()=>Jm,decode:()=>$m,encode:()=>Fm,name:()=>qm});var Pd,qm,Jm,Fm,$m,kd=De(()=>{g();m();Dn();Pd=n=>Ht(n),{name:qm,code:Jm,encode:Fm,decode:$m}={name:"raw",code:85,decode:Pd,encode:Pd}});var Pa={};Ge(Pa,{code:()=>Gm,decode:()=>zm,encode:()=>Ym,name:()=>Vm});var Vm,Gm,Ym,zm,Kd=De(()=>{g();m();({name:Vm,code:Gm,encode:Ym,decode:zm}={name:"json",code:512,encode:n=>new TextEncoder().encode(JSON.stringify(n)),decode:n=>JSON.parse(new TextDecoder().decode(n))})});var qe,Qm,Zm,e_,No,t_,Ld,xd,Li,xi,n_,r_,o_,Md=De(()=>{g();m();Ii();Ai();wa();Oa();Dn();qe=class{constructor(e,t,r,o){this.code=t,this.version=e,this.multihash=r,this.bytes=o,this.byteOffset=o.byteOffset,this.byteLength=o.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:xi,byteLength:xi,code:Li,version:Li,multihash:Li,bytes:Li,_baseCache:xi,asCID:xi})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==No)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==t_)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return qe.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,r=So(e,t);return qe.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Ra(this.multihash,e.multihash)}toString(e){let{bytes:t,version:r,_baseCache:o}=this;switch(r){case 0:return Zm(t,o,e||nn.encoder);default:return e_(t,o,e||xr.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return r_(/^0\.0/,o_),!!(e&&(e[xd]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof qe)return e;if(e!=null&&e.asCID===e){let{version:t,code:r,multihash:o,bytes:i}=e;return new qe(t,r,o,i||Ld(t,r,o.bytes))}else if(e!=null&&e[xd]===!0){let{version:t,multihash:r,code:o}=e,i=Na(r);return qe.create(t,o,i)}else return null}static create(e,t,r){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==No)throw new Error(`Version 0 CID must use dag-pb (code: ${No}) block encoding`);return new qe(e,t,r,r.bytes)}case 1:{let o=Ld(e,t,r.bytes);return new qe(e,t,r,o)}default:throw new Error("Invalid version")}}static createV0(e){return qe.create(0,No,e)}static createV1(e,t){return qe.create(1,e,t)}static decode(e){let[t,r]=qe.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=qe.inspectBytes(e),r=t.size-t.multihashSize,o=Ht(e.subarray(r,r+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=o.subarray(t.multihashSize-t.digestSize),s=new er(t.multihashCode,t.digestSize,i,o);return[t.version===0?qe.createV0(s):qe.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,r=()=>{let[c,u]=Mr(e.subarray(t));return t+=u,c},o=r(),i=No;if(o===18?(o=0,t=0):o===1&&(i=r()),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=t,l=r(),p=r(),f=t+p,a=f-s;return{version:o,codec:i,multihashCode:l,digestSize:p,multihashSize:a,size:f}}static parse(e,t){let[r,o]=Qm(e,t),i=qe.decode(o);return i._baseCache.set(r,e),i}},Qm=(n,e)=>{switch(n[0]){case"Q":{let t=e||nn;return[nn.prefix,t.decode(`${nn.prefix}${n}`)]}case nn.prefix:{let t=e||nn;return[nn.prefix,t.decode(n)]}case xr.prefix:{let t=e||xr;return[xr.prefix,t.decode(n)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[n[0],e.decode(n)]}}},Zm=(n,e,t)=>{let{prefix:r}=t;if(r!==nn.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let o=e.get(r);if(o==null){let i=t.encode(n).slice(1);return e.set(r,i),i}else return o},e_=(n,e,t)=>{let{prefix:r}=t,o=e.get(r);if(o==null){let i=t.encode(n);return e.set(r,i),i}else return o},No=112,t_=18,Ld=(n,e,t)=>{let r=Zn(n),o=r+Zn(e),i=new Uint8Array(o+t.byteLength);return Qn(n,i,0),Qn(e,i,r),i.set(t,o),i},xd=Symbol.for("@ipld/js-cid/CID"),Li={writable:!1,configurable:!1,enumerable:!0},xi={writable:!1,enumerable:!1,configurable:!1},n_="0.0.0-dev",r_=(n,e)=>{if(n.test(n_))console.warn(e);else throw new Error(e)},o_=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`});var Wd=De(()=>{g();m();Md();Ii();Dn();Ki();Ai()});var jd={};Ge(jd,{CID:()=>qe,bases:()=>i_,bytes:()=>Ri,codecs:()=>a_,digest:()=>jr,hasher:()=>ki,hashes:()=>s_,varint:()=>Wr});var i_,s_,a_,Ud=De(()=>{g();m();yd();vd();bd();Od();Cd();Oa();Ed();wa();wd();Id();Ad();kd();Kd();Wd();i_={...ga,...ma,..._a,...ya,...va,...ba,...Ca,...Ea,...Ta},s_={...Da,...Ia},a_={raw:Aa,json:Pa}});var Ka=H(Br=>{"use strict";g();m();Object.defineProperty(Br,"__esModule",{value:!0});Br.okxfromString=c_;Br.okxtoString=l_;Br.alloc=u_;Br.allocUnsafe=qd;var Bd=(Ud(),Hc(jd)),Hd=je();function c_(n,e="utf8"){let t=Fd[e];if((0,Hd.logDebug)("okxfromstring ====> "),!t)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${n}`)}function l_(n,e="utf8"){let t=Fd[e];if((0,Hd.logDebug)("okxtoString ====> "),!t)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(n).substring(1)}function u_(n=0){return new Uint8Array(n)}function qd(n=0){return new Uint8Array(n)}function Jd(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}var Xd=Jd("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),ka=Jd("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++){let r=n[t];r&&String.fromCharCode(r)&&(e+=String.fromCharCode(r))}return e},n=>{n=n.substring(1);let e=qd(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Fd=Object.assign({utf8:Xd,"utf-8":Xd,hex:Bd.bases.base16,latin1:ka,ascii:ka,binary:ka},Bd.bases)});var Rt=H(Y=>{"use strict";g();m();var La=Y&&Y.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Y,"__esModule",{value:!0});Y.chainName2IdMap=Y.isValidObject=Y.RANDOM_LENGTH=Y.isBrowser=Y.resolveLocalStorage=Y.hasLocalStorage=Y.hasBuiltInWebSocket=Y.resolveWebSocketImplementation=void 0;Y.hexToByteArray=g_;Y.getChainId=m_;Y.toHexString=__;Y.concatUint8Arrays=y_;Y.splitToUint8Arrays=v_;Y.base64encode=C_;Y.base64decode=E_;Y.checkWSUrl=w_;Y.hashKey=Wa;Y.generateRandomBytes32=Gd;Y.generateTopic=I_;Y.generateGroupId=A_;Y.isInIOSLine=k_;Y.isInIOSLark=K_;Y.isInIOSChrome=L_;Y.isInIOSWeChat=x_;Y.isIos=Do;Y.getLastSixMd5Hash=M_;Y.toSafeBase64FromBase64=W_;Y.useShortLink=j_;Y.replaceChainNameToChainId=U_;Y.replaceChainIdToChainName=B_;Y.getNamespaceKeyByChain=X_;var $d=La(yr()),Ro=La(uh()),xa=(hh(),Hc(ph)),d_=fh(),Vd=Sn(),Mi=je(),f_=Ka(),p_=La(Qc()),h_=ze(),Ma="base16";function g_(n){if(n.length%2!==0)throw new Error(`Cannot convert ${n} to bytesArray`);let e=new Uint8Array(n.length/2);for(let t=0;t<n.length;t+=2)e[t/2]=parseInt(n.slice(t,t+2),16);return e}function m_(n){return n.includes(":")?n.split(":")[1]:n}function __(n){let e="";return n.forEach(t=>{e+=("0"+(t&255).toString(16)).slice(-2)}),e}function y_(n,e){let t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function v_(n,e){if(e>=n.length)throw new Error("Index is out of buffer");let t=n.slice(0,e),r=n.slice(e);return[t,r]}function b_(n,e){let t=Ro.default.encodeBase64(n);return e?encodeURIComponent(t):t}function O_(n,e){return e&&(n=decodeURIComponent(n)),Ro.default.decodeBase64(n)}function C_(n,e){let t;return n instanceof Uint8Array?t=n:(typeof n!="string"&&(n=(0,Vd.safeJsonStringify)(n)),t=Ro.default.decodeUTF8(n)),b_(t,e)}function E_(n,e){let t=O_(n,e);return{toString(){return Ro.default.encodeUTF8(t)},toObject(){try{return(0,Vd.safeJsonParse)(Ro.default.encodeUTF8(t))}catch{return null}},toUint8Array(){return t}}}function w_(n){let e=n.match(new RegExp(/^\w+:/,"gi"));if(!e||!e.length)return!1;let t=e[0];return t===void 0?!1:new RegExp("^wss?:").test(t)}var T_=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:WebSocket;Y.resolveWebSocketImplementation=T_;var S_=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u";Y.hasBuiltInWebSocket=S_;var N_=()=>typeof globalThis<"u"&&typeof globalThis.localStorage<"u"||typeof window<"u"&&typeof window.localStorage<"u";Y.hasLocalStorage=N_;var R_=()=>typeof globalThis<"u"&&typeof globalThis.localStorage<"u"?globalThis.localStorage:typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:localStorage;Y.resolveLocalStorage=R_;var D_=()=>typeof window<"u";Y.isBrowser=D_;Y.RANDOM_LENGTH=32;function Wa(n,e=Ma){(0,Mi.logDebug)(`hash key called ${n}`);let t=(0,d_.hash)((0,f_.okxfromString)(n,e));return(0,xa.toString)(t,e)}function Gd(){return $d.default.randomBytes(Y.RANDOM_LENGTH)}function I_(){let n=Gd();return(0,Mi.logDebug)(`generate topic called ${n}`),Wa((0,xa.toString)(n,Ma))}function A_(){let n=$d.default.randomBytes(16);return(0,Mi.logDebug)(`generate groupid called ${n}`),Wa((0,xa.toString)(n,Ma))}var P_=n=>Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length;Y.isValidObject=P_;function k_(){return navigator.userAgent.includes("Safari Line/")&&Do()}function K_(){return navigator.userAgent.includes("Lark/")&&Do()}function L_(){return navigator.userAgent.includes("CriOS/")&&Do()}function x_(){return navigator.userAgent.includes("MicroMessenger/")&&Do()}function Do(){let n=navigator.userAgent,e=navigator.maxTouchPoints||0,t=/iPad|iPhone|iPod/.test(n)&&!window.MSStream,r=n.includes("Mac")&&e>1;return(0,Mi.logDebug)(`utils isIos >>>isIOSDevice: ${t}    >> isIPadOS: ${r}`),t||r}function M_(n){return p_.default.MD5(n).toString().slice(-6)}function W_(n){return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function j_(){return!0}Y.chainName2IdMap=new Map;Y.chainName2IdMap.set("aptos:mainnet","aptos:637");Y.chainName2IdMap.set("movement:testnet","aptos:70000060");Y.chainName2IdMap.set("movement:mainnet","aptos:70000066");Y.chainName2IdMap.set("soon:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000069");Y.chainName2IdMap.set("soon:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","svm:70000067");Y.chainName2IdMap.set("eclipse:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000068");Y.chainName2IdMap.set("sonic:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","svm:70000073");function U_(n){return Y.chainName2IdMap.forEach((e,t)=>{n.includes(t)&&(n=n.replace(t,e))}),n}function B_(n){return Y.chainName2IdMap.forEach((e,t)=>{n.includes(e)&&(n=n.replace(e,t))}),n}function X_(n){for(let[e,t]of Object.entries(h_.NAMES_CHAINS))if(Object.values(t).includes(n))return e;return n}});var Io=H(Pt=>{"use strict";g();m();var H_=Pt&&Pt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),q_=Pt&&Pt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),J_=Pt&&Pt.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&H_(t,e,r[o]);return q_(t,e),t}}(),F_=Pt&&Pt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.Storage=void 0;var Xr=wr(),ja=F_(yr()),tr=Rt(),Ua=Qe(),Ze=J_(je()),Hr=Qe(),Wi=Qc(),At=class{constructor(e,t=void 0){let r=(0,tr.resolveLocalStorage)();this.storeKey="",this.cipherIV="",this.subKey=e,Ze.logDebug("--------get current local storage --------"),Ze.logDebug(r),this.synchronizedCache()}checkAndUpgradeCache(e,t){if(e&&e.length>0&&t&&t.length>0){Ze.logDebug("--------get current local storage --------"),Ze.logDebug(localStorage);let r=localStorage.getItem(At.cacheKey+e);if(typeof r>"u"||r===null){Ze.logDebug("no pre cache content");return}Ze.logDebug(r),r?.length>0&&(Ze.logDebug("write in cache content: ",e,"->",t),localStorage.setItem(At.cacheKey+t,r),Ze.logDebug("clean in cache content: ",e),localStorage.removeItem(At.cacheKey+e))}else Ze.logDebug("no pre cache key:",e)}saveContent(e,t,r="-"){let o={id:r,timestamp:Date.now().toString(),content:e};this.saveItem(o,t)}saveItem(e,t){let r=At.cacheKey+this.subKey,o=(0,tr.resolveLocalStorage)();Ze.logDebug(this.cache),Ze.logDebug(`get cache obj: ${this.cache}, ${t}, ${e}`),this.cache[t]=e;let i=(0,Ua.safeJsonStringify)(this.cache);Ze.logDebug(`STORAGE: ${t} @ ${this.cache}`),o.setItem(r,i)}getItem(e){return Ze.logDebug(`STORAGE >> getItem: ${e} @ ${this.cache}`),this.cache[e]}synchronizedCache(){let e=localStorage.getItem(At.cacheKey+this.subKey);if(typeof e>"u"||e===null){Ze.logDebug("with no cache"),this.cache={};return}if(Ze.logDebug(e),e?.length>0){var t=(0,Ua.safeJsonParse)(e);this.cache=t}Ze.logDebug(`get cache obj: ${this.cache}`),(typeof this.cache>"u"||this.cache==null)&&(this.cache={})}getCachedPBKDF2InfoKey(){var e,t,r,o;if(this.storeKey.length>0&&((e=this.cipherIV)===null||e===void 0?void 0:e.length)>0)return{pw:this.storeKey,iv:this.cipherIV};let l=(t=this.getItem(Xr.OKXCONNECTOR_STORAGER_CRYPTO_SALT))===null||t===void 0?void 0:t.content;l||(l=(0,tr.toHexString)(ja.default.randomBytes(24)),this.saveContent(l,Xr.OKXCONNECTOR_STORAGER_CRYPTO_SALT));let p=(r=this.getItem(Xr.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD))===null||r===void 0?void 0:r.content;p||(p=(0,tr.toHexString)(ja.default.randomBytes(32)),this.saveContent(p,Xr.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD));let f=(o=this.getItem(Xr.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV))===null||o===void 0?void 0:o.content;if(!f){let a=ja.default.randomBytes(16);f=(0,tr.toHexString)(a),this.saveContent(f,Xr.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV)}return this.cipherIV=f,this.storeKey=(0,Wi.PBKDF2)(p,l,{iterations:10}).toString(),{pw:this.storeKey,iv:this.cipherIV}}encryptStoreMsg(e,t){(0,Hr.logDebug)(`encryptStoreMsg  encryptStoreMsg start ${Date.now()}`);let r=this.getCachedPBKDF2InfoKey();(0,Hr.logDebug)(`encryptStoreMsg  encryptStoreMsg mid ${Date.now()}`);var o=Wi.AES.encrypt(e,r.pw).toString();this.saveContent(o,t),(0,Hr.logDebug)(`encryptStoreMsg  encryptStoreMsg end ${Date.now()}`)}getAndDecrypt(e){(0,Hr.logDebug)(`encryptStoreMsg  getAndDecrypt start ${Date.now()}`);let t=this.getItem(e);if(t&&t.content){let r=this.getCachedPBKDF2InfoKey();(0,Hr.logDebug)(`encryptStoreMsg  getAndDecrypt mid ${Date.now()}`);let o=Wi.AES.decrypt(t.content,r.pw).toString(Wi.enc.Utf8);return(0,Hr.logDebug)(`encryptStoreMsg  getAndDecrypt end ${Date.now()}`),o}return null}clearCache(e=void 0){if(e===void 0){let t=(0,tr.resolveLocalStorage)();this.cache={};let r=At.cacheKey+this.subKey;t.setItem(r,"")}else{let t=At.cacheKey+this.subKey,r=(0,tr.resolveLocalStorage)();Ze.logDebug(this.cache),this.cache[e]=null;let o=(0,Ua.safeJsonStringify)(this.cache);Ze.logDebug(`STORAGE: clean key ${e} @ ${this.cache}`),r.setItem(t,o)}}};Pt.Storage=At;At.cacheKey="OKXStorageKey"});var Ui=H(kt=>{"use strict";g();m();var $_=kt&&kt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),V_=kt&&kt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),G_=kt&&kt.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&$_(t,e,r[o]);return V_(t,e),t}}(),qt=kt&&kt.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(kt,"__esModule",{value:!0});kt.OKXWalletConnector=void 0;var Ue=Er(),Ba=wr(),Y_=Io(),qr=Qe(),ji=Rt(),z_=Jo(),ee=G_(je()),Yd=ze(),Q_=Co(),Z_=(0,ji.resolveWebSocketImplementation)(),Xa=class{constructor(e){if(this.events=new z_.EventEmitter,this.state=Ue.ConnectorState.InitState,this.selectedUrlIndex=0,this.retryCount=0,this.timeOutLimit=8e3,!(0,ji.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e,this.heartbeatTimer=null,this.connectionTimeoutTimer=null,this.connectURLStorage=new Y_.Storage(Ba.OKXCONNECTOR_CACHE_KEY+Ba.OKXCONNECTOR_CACHE_KEY)}get connecting(){return this.state==Ue.ConnectorState.Connecting}onPayload(e){if(!(typeof e.data>"u")){if(ee.logDebug("get received data"),ee.logDebug(e),typeof e.data=="string"&&e.data==="pong"){ee.logDebug(`CONNECT: receive pong ${Date.now().toString()}`);return}this.events.emit("payload",e.data)}}onClose(e){var t;ee.logDebug("socket get closed: ",(t=this.socket)===null||t===void 0?void 0:t.url,e.code),this.socket=void 0,this.events.emit("close",e)}onError(e,t){let r={id:e,msg:t.toString()};this.events.emit("payload",r)}onopen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.state=Ue.ConnectorState.Connected,this.events.emit("open")}emitError(e){this.events.emit("fail",e)}heartbeat(){return qt(this,void 0,void 0,function*(){if(this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.state!=Ue.ConnectorState.Connected&&this.state!=Ue.ConnectorState.OnError){ee.logDebug("heart beat close");return}if(!this.socket){if(ee.logDebug("socket not exist"),this.state==Ue.ConnectorState.Connected||this.state==Ue.ConnectorState.OnError){ee.logDebug("socket reconnect by heartbeat");try{yield this.tryRegistOpen()}catch{ee.logError("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}return}if(this.socket.readyState!==WebSocket.OPEN){if(ee.logDebug("socket not ready"),this.state==Ue.ConnectorState.Connected||this.state==Ue.ConnectorState.OnError){ee.logDebug("socket reconnect by heartbeat with state",this.state,this.socket.readyState);try{yield this.tryRegistOpen()}catch{ee.logError("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}return}ee.logDebug(`send ping heart beat: ${Date.now().toString()}, ${this.socket}`),this.socket.send("ping"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)})}registOpen(e=this.url,t=!1){if(!(0,ji.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e,t||ee.logDebug("Connection connect:",this.url,new Date().toUTCString()),this.state=Ue.ConnectorState.Connecting;let r=new URLSearchParams(e).get("origin");return new Promise((o,i)=>{let s=new Z_(e,[]);ee.logDebug("Connection connect Begin:",this.url,new Date().toUTCString()),this.startTimeOutTimer(s),(0,ji.hasBuiltInWebSocket)()?(ee.logDebug("Add socket error handler"),s.onerror=()=>{i(new Error("socket error")),s.close()}):(ee.logDebug("Add socket error handler"),s.on("error",()=>{i(new Error("socket error")),s.close()})),s.onopen=()=>{ee.logDebug("socket opened"),this.resetTimeOutTimer(Ue.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.FINISHED),this.onopen(s),this.heartbeat(),o(s)}})}checkMaxRetry(){return ee.logDebug("current retry count:",this.retryCount,"of",Ue.OKXCONNECTOR_WS_URL_LIST.length),this.retryCount>Ue.OKXCONNECTOR_WS_URL_LIST.length*3}connectionTryNext(){return qt(this,void 0,void 0,function*(){if(this.checkMaxRetry())ee.logDebug("Max Connection retry ",this.retryCount,new Date().toUTCString());else{this.retryCount+=1;let e=this.getNextSelectUrl();return ee.logDebug("Connection retry:",e,new Date().toUTCString()),this.registOpen(e,!0)}})}startTimeOutTimer(e){this.connectionTimeoutTimer&&this.resetTimeOutTimer(Ue.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.CANCELED),this.pendingSocket=e,this.connectionTimeoutTimer=setTimeout(()=>{this.pendingSocket&&this.resetTimeOutTimer(Ue.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.TIME_OUT)},this.timeOutLimit)}resetTimeOutTimer(e){var t;if(e==Ue.OKXCONNECTOR_WS_URL_PENDING_CLOSE_CODE.TIME_OUT)throw clearTimeout(this.connectionTimeoutTimer),(t=this.pendingSocket)===null||t===void 0||t.close(),this.pendingSocket=void 0,ee.reportEvent(Q_.OKXReportType.LOG,"timeout",this.retryCount.toString()),new Error("socket timeout");this.pendingSocket=void 0,clearTimeout(this.connectionTimeoutTimer)}cacheSuccessUrlSelect(){this.connectURLStorage.saveContent(this.selectedUrlIndex.toString(),Ba.OKXCONNECTOR_CACHE_KEY)}getNextSelectUrl(){return this.selectedUrlIndex+=1,this.selectedUrlIndex=this.selectedUrlIndex%Ue.OKXCONNECTOR_WS_URL_LIST.length,Ue.OKXCONNECTOR_WS_URL_LIST[this.selectedUrlIndex]}onVisibleChanged(){return qt(this,void 0,void 0,function*(){if(document.visibilityState==="visible"&&(ee.logDebug(`get changed ${this.state}, ${this.socket}`),this.state==Ue.ConnectorState.Connected&&typeof this.socket>"u")){ee.logDebug("CONNECTION need reopen");try{yield this.tryRegistOpen()}catch{ee.logError("regist open failed")}return}})}tryRegistOpen(){return qt(this,arguments,void 0,function*(e=this.url){if(this.connecting)return ee.logDebug("tryRegistOpen => connecting state"),new Promise((r,o)=>{this.events.once("fail",i=>(ee.logDebug("tryRegistOpen => connecting fail listener",i),o(i))),this.events.once("open",()=>typeof this.socket>"u"?o(new Error("Connect lost")):r(this.socket))});ee.logDebug("tryRegistOpen => try registOpen until retry limit is hit");let t=!1;for(;!this.checkMaxRetry()&&!this.socket;)try{ee.logDebug("tryRegistOpen => call registOpen, try count:",this.retryCount,t),yield this.registOpen(e,t)}catch(r){ee.logDebug("tryRegistOpen => registOpen failed",r),this.retryCount+=1,e=this.getNextSelectUrl(),t=!0}if(ee.logDebug("tryRegistOpen => exit while loop",this.retryCount,this.socket),!this.socket&&this.checkMaxRetry())throw ee.logDebug("tryRegistOpen => failed to open a socket",this.retryCount,this.socket),this.retryCount=0,this.state=Ue.ConnectorState.OnError,this.emitError(new Error("tryRegistOpen failed")),new Yd.OKXConnectError(Yd.OKX_CONNECT_ERROR_CODES.CONNECTION_ERROR,"Failed to connect")})}connect(){return qt(this,void 0,void 0,function*(){try{yield this.tryRegistOpen(),document.removeEventListener("visibilitychange",this.onVisibleChanged.bind(this)),document.addEventListener("visibilitychange",this.onVisibleChanged.bind(this))}catch(e){throw ee.logDebug("connect => failed to connect",e),e}})}disconnect(){return qt(this,void 0,void 0,function*(){return this.state=Ue.ConnectorState.Disconnected,new Promise((e,t)=>{if(typeof this.socket>"u"){e();return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close(),this.heartbeatTimer&&clearTimeout(this.heartbeatTimer)})})}currentStatus(){return{state:this.state,url:this.url}}addListener(e,t,r,o,i){this.listenPayloadHandler&&this.events.removeListener("payload",this.listenPayloadHandler),this.listenPayloadHandler=s=>qt(this,void 0,void 0,function*(){var l;ee.logDebug(`<<< get payload ${s}`);let p=(0,qr.safeJsonParse)(s);if(p.params&&p.params.data){let f=(l=p.params.data)===null||l===void 0?void 0:l.message,a=!1;if(f&&i){let c=yield i(p.params.data);a=c.isSplitPackage&&!c.finalMessage,c.isSplitPackage&&(c.finalMessage&&c.finalMessage.length>0?(ee.logDebug("CONNECT: update raw msg content"),f=c.finalMessage):(ee.logDebug("CONNECT: skip raw msg content"),a=!0))}if(!a)try{let c=t(f);c===void 0?(ee.logDebug("CONNECT: decrypt undefined"),o(e,"Decrypt undefined")):r(e,c)}catch(c){ee.logDebug(`CONNECT: decrypt failed: ${c}`),o(e,c.message)}}}),this.events.on("payload",this.listenPayloadHandler),this.failHandler&&this.events.removeListener("fail",this.failHandler),this.failHandler=s=>{s?(ee.logDebug(`CONNECT failed: ${s}`),o(e,s.message)):o(e,"Unkonow error")},this.events.on("fail",this.failHandler)}addPackageParse(e){this.payloadHandler&&this.events.removeListener("payload",this.payloadHandler),this.payloadHandler=t=>qt(this,void 0,void 0,function*(){ee.logDebug(`CONNECTION @[${new Date().toUTCString()}] <<<< received e:${t}`);let r=(0,qr.safeJsonParse)(t);yield e(r)}),this.events.on("payload",this.payloadHandler)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}send(e,t){return qt(this,void 0,void 0,function*(){try{typeof this.socket>"u"&&(ee.logDebug(`>>> send payload undefined ${t}`),yield e()),ee.logDebug(`CONNECTION @[${new Date().toUTCString()}]>>> send payload ${(0,qr.safeJsonStringify)(t)}`),this.socket&&this.socket.send((0,qr.safeJsonStringify)(t))}catch(r){this.onError(t.id,r)}})}getMsgPayloadFromHistory(e){return qt(this,void 0,void 0,function*(){if(typeof e>"u")return;let t={params:{data:e}},r=(0,qr.safeJsonStringify)(e);ee.logDebug("get received data from history"),ee.logDebug(r),r=(0,qr.safeJsonStringify)(t),this.events.emit("payload",r)})}onOpen(e){this.openHandler&&this.events.removeListener("open",this.openHandler),this.openHandler=()=>qt(this,void 0,void 0,function*(){ee.logDebug(`CONNECTION @[${new Date().toUTCString()}] >>> ws opened: `),yield e()}),this.events.on("open",this.openHandler),this.cacheSuccessUrlSelect()}};kt.OKXWalletConnector=Xa});var Ha=H(Ke=>{"use strict";g();m();Object.defineProperty(Ke,"__esModule",{value:!0});Ke.CONNECT_METHOD_RECV_DISCONNECT=Ke.CONNECT_METHOD_DISCONNECT=Ke.CONNECT_METHOD_BATCH_FETCHMSG=Ke.CONNECT_METHOD_FETCHMSG=Ke.CONNECT_METHOD_RECEIVE=Ke.CONNECT_METHOD_UNSUB=Ke.CONNECT_METHOD_SUB=Ke.CONNECT_METHOD_PUBLISH=Ke.CONNECT_METHOD_LOGIN=Ke.CONNECT_METHOD_PUSH=void 0;Ke.CONNECT_METHOD_PUSH="push";Ke.CONNECT_METHOD_LOGIN="login";Ke.CONNECT_METHOD_PUBLISH="publish";Ke.CONNECT_METHOD_SUB="subscribe";Ke.CONNECT_METHOD_UNSUB="unsubscribe";Ke.CONNECT_METHOD_RECEIVE="receive";Ke.CONNECT_METHOD_FETCHMSG="fetchMessages";Ke.CONNECT_METHOD_BATCH_FETCHMSG="batchFetchMessages";Ke.CONNECT_METHOD_DISCONNECT="disconnect";Ke.CONNECT_METHOD_RECV_DISCONNECT="receiveDisconnect"});var qa=H(An=>{"use strict";g();m();Object.defineProperty(An,"__esModule",{value:!0});An.OKXCONNECTOR_JWT_TTL=An.OKXCONNECTOR_JWT_WALLET_SIDE=An.OKXCONNECTOR_JWT_SIDE=void 0;An.OKXCONNECTOR_JWT_SIDE="wallet";An.OKXCONNECTOR_JWT_WALLET_SIDE="dapp";An.OKXCONNECTOR_JWT_TTL=864e5});var Fa=H(Fr=>{"use strict";g();m();var ey=Fr&&Fr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Fr,"__esModule",{value:!0});Fr.SessionCrypto=void 0;var Jr=ey(yr()),Le=Rt(),Ja=class{constructor(e=void 0){this.nonceLength=24,this.sessionKeyPair=e?this.createKeypairFromString(e):this.createKeypair()}createKeypair(){return Jr.default.box.keyPair()}createKeypairFromString(e){return{publicKey:(0,Le.hexToByteArray)(e.publicKey),secretKey:(0,Le.hexToByteArray)(e.secretKey)}}createNonce(){return Jr.default.randomBytes(this.nonceLength)}get keyPair(){return this.sessionKeyPair}encrypt(e,t){let r=new TextEncoder().encode(e),o=this.createNonce(),i=Jr.default.box(r,o,(0,Le.hexToByteArray)(t),this.keyPair.secretKey),s=(0,Le.concatUint8Arrays)(o,i);var l=(0,Le.toHexString)(s),p=new TextEncoder().encode(l);return(0,Le.base64encode)(p,!1)}encryptWallet(e,t){let r=new TextEncoder().encode(e),o=this.createNonce(),i=Jr.default.box(r,o,(0,Le.hexToByteArray)(t),this.keyPair.secretKey),s=(0,Le.concatUint8Arrays)(o,i);return(0,Le.base64encode)(s,!1)}decrypt(e,t){let o=(0,Le.base64decode)(e,!0).toUint8Array(),[i,s]=(0,Le.splitToUint8Arrays)(o,this.nonceLength),l=Jr.default.box.open(s,i,(0,Le.hexToByteArray)(t),this.keyPair.secretKey);if(!l)throw new Error(`Decryption error: 
 message: ${e.toString()} 
 sender pubkey: ${t.toString()} 
 keypair pubkey: ${(0,Le.toHexString)(this.keyPair.publicKey)} 
 keypair secretkey: ${(0,Le.toHexString)(this.keyPair.secretKey)}`);return new TextDecoder().decode(l)}decryptWallet(e,t){let r=(0,Le.base64decode)(e,!0),o=(0,Le.hexToByteArray)(r.toString()),[i,s]=(0,Le.splitToUint8Arrays)(o,this.nonceLength),l=Jr.default.box.open(s,i,(0,Le.hexToByteArray)(t),this.keyPair.secretKey);if(!l)throw new Error(`Decryption error: 
 message: ${e.toString()} 
 sender pubkey: ${t.toString()} 
 keypair pubkey: ${(0,Le.toHexString)(this.keyPair.publicKey)} 
 keypair secretkey: ${(0,Le.toHexString)(this.keyPair.secretKey)}`);return new TextDecoder().decode(l)}stringifyKeypair(){return{publicKey:(0,Le.toHexString)(this.keyPair.publicKey),secretKey:(0,Le.toHexString)(this.keyPair.secretKey)}}};Fr.SessionCrypto=Ja});var $a=H(W=>{"use strict";g();m();var ty=W&&W.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ny=W&&W.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),zd=W&&W.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&ty(t,e,r[o]);return ny(t,e),t}}(),Qd=W&&W.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})},ry=W&&W.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(W,"__esModule",{value:!0});W.MULTICODEC_ED25519_LENGTH=W.MULTICODEC_ED25519_HEADER=W.MULTICODEC_ED25519_BASE=W.MULTICODEC_ED25519_ENCODING=W.DID_METHOD=W.DID_PREFIX=W.DID_DELIMITER=W.KEY_PAIR_SEED_LENGTH=W.DATA_ENCODING=W.JSON_ENCODING=W.JWT_ENCODING=W.JWT_DELIMITER=W.JWT_IRIDIUM_TYP=W.JWT_IRIDIUM_ALG=W.JWTHeaderType=void 0;W.generateKeyPair=sy;W.decodeJSON=Ao;W.encodeJSON=Po;W.encodeIss=nf;W.decodeIss=rf;W.encodeSig=of;W.decodeSig=sf;W.encodeData=af;W.decodeData=ay;W.encodeJWT=cf;W.decodeJWT=lf;W.signJWT=cy;W.verifyJWT=ly;var oy=zd(dh()),Zd=Sn(),iy=Rt(),ef=ry(yr()),tf=zd(je()),Jt=Ka();W.JWTHeaderType="dapp";W.JWT_IRIDIUM_ALG="EdDSA";W.JWT_IRIDIUM_TYP="JWT";W.JWT_DELIMITER=".";W.JWT_ENCODING="base64url";W.JSON_ENCODING="utf8";W.DATA_ENCODING="utf8";W.KEY_PAIR_SEED_LENGTH=32;W.DID_DELIMITER=":";W.DID_PREFIX="did";W.DID_METHOD="key";W.MULTICODEC_ED25519_ENCODING="base58btc";W.MULTICODEC_ED25519_BASE="z";W.MULTICODEC_ED25519_HEADER="K36";W.MULTICODEC_ED25519_LENGTH=32;function sy(){return ef.default.sign.keyPair()}function Ao(n){return(0,Zd.safeJsonParse)((0,Jt.okxtoString)((0,Jt.okxfromString)(n,W.JWT_ENCODING),W.JSON_ENCODING))}function Po(n){return(0,Jt.okxtoString)((0,Jt.okxfromString)((0,Zd.safeJsonStringify)(n),W.JSON_ENCODING),W.JWT_ENCODING)}function nf(n){tf.logDebug(`publicKey: ${(0,iy.toHexString)(n)}`);var e=(0,Jt.okxtoString)(n,W.MULTICODEC_ED25519_ENCODING);return[W.DID_PREFIX,W.DID_METHOD,e].join(W.DID_DELIMITER)}function rf(n){let[e,t,r]=n.split(W.DID_DELIMITER);if(e!==W.DID_PREFIX||t!==W.DID_METHOD)throw new Error('Issuer must be a DID with method "key"');if(r===void 0)throw new Error("multicodec is undefined");let o=(0,Jt.okxfromString)(r,W.MULTICODEC_ED25519_ENCODING);if(o===void 0||o.length!==W.MULTICODEC_ED25519_LENGTH)throw new Error("Issuer must be a public key with length 32 bytes");return o}function of(n){return(0,Jt.okxtoString)(n,W.JWT_ENCODING)}function sf(n){return(0,Jt.okxfromString)(n,W.JWT_ENCODING)}function af(n){return(0,Jt.okxfromString)([Po(n.header),Po(n.payload)].join(W.JWT_DELIMITER),W.DATA_ENCODING)}function ay(n){var e,t;let r=(0,Jt.okxtoString)(n,W.DATA_ENCODING).split(W.JWT_DELIMITER),o=Ao((e=r[0])!==null&&e!==void 0?e:"{}"),i=Ao((t=r[1])!==null&&t!==void 0?t:"{}");return{header:o,payload:i}}function cf(n){return[Po(n.header),Po(n.payload),of(n.signature)].join(W.JWT_DELIMITER)}function lf(n){var e,t,r;let o=n.split(W.JWT_DELIMITER),i=Ao((e=o[0])!==null&&e!==void 0?e:"{}"),s=Ao((t=o[1])!==null&&t!==void 0?t:"{}"),l=sf((r=o[2])!==null&&r!==void 0?r:"{}"),p=(0,Jt.okxfromString)(o.slice(0,2).join(W.JWT_DELIMITER),W.DATA_ENCODING);return{header:i,payload:s,signature:l,data:p}}function cy(n,e,t,r){return Qd(this,arguments,void 0,function*(o,i,s,l,p=Math.floor(Date.now())){let f={alg:W.JWT_IRIDIUM_ALG,typ:W.JWT_IRIDIUM_TYP},a=nf(l.publicKey),c=p+s,_={iss:a,sub:o,aud:i,act:"authenticate user",iat:p,exp:c},y=af({header:f,payload:_});tf.logDebug(`get sec kp: ${l.secretKey} {${l.secretKey.length}}`);let I=ef.default.sign.detached(y,l.secretKey);return cf({header:f,payload:_,signature:I})})}function ly(n){return Qd(this,void 0,void 0,function*(){let{header:e,payload:t,data:r,signature:o}=lf(n);if(e.alg!==W.JWT_IRIDIUM_ALG||e.typ!==W.JWT_IRIDIUM_TYP)throw new Error("JWT must use EdDSA algorithm");let i=rf(t.iss);return oy.verify(i,r,o)})}});var Ga=H(pt=>{"use strict";g();m();var uy=pt&&pt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),dy=pt&&pt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),fy=pt&&pt.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&uy(t,e,r[o]);return dy(t,e),t}}(),nr=pt&&pt.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})},py=pt&&pt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(pt,"__esModule",{value:!0});pt.ConnectionSplitPackages=void 0;var hy=wr(),gy=py(wi()),my=Rt(),$r=Sn(),rr=fy(je()),rn=je(),uf=2,df=63e3,ff="ConnectionReceiveKey",pf="ConnectionSendKey",hf="ConnectionSenderVersionKey",Va=class{constructor(e){this.splitMessageSendArray=new Map,this.splitMessageReceivedArray=new Map,this.splitMessageSenderVersionMap=new Map,this.splitPackageCache=gy.default.createInstance({name:hy.OKXCONNECTOR_STORAGE_PROTOCOL_CACHE+e})}init(e){return nr(this,void 0,void 0,function*(){if(yield this.recoverFromCache(),this.splitMessageSendArray.size>0){for(let[t,r]of this.splitMessageSendArray.entries())for(let o=0;o<r.length;){let i=r[o];try{yield e((0,$r.safeJsonStringify)(i),t),rr.logDebug(`Successfully sent payload: ${(0,$r.safeJsonStringify)(i)} to topic: ${t}`),r.splice(o,1)}catch(s){rr.logError(`Failed to send payload: ${(0,$r.safeJsonStringify)(i)} to topic: ${t}`,s),i.retryCount=(i.retryCount||0)+1,i.retryCount>3?(rr.logError(`Payload failed after 3 retries: ${(0,$r.safeJsonStringify)(i)}`),r.splice(o,1)):o++}}yield this.syncCache()}})}tryParseMessageSplitPayload(e){var t;let r;try{if(e.trimStart().startsWith("{")){let o=(0,$r.safeJsonParse)(e);if(o&&o.protocol_version&&o.protocol_version>=2){let i=o;i.package_group_id&&((t=i.package_group_id)===null||t===void 0?void 0:t.length)>0&&(r=o)}}else(0,rn.logDebug)("not split packages")}catch{(0,rn.logDebug)("not split packages")}return r}updateTopicSenderVersion(e,t){return nr(this,void 0,void 0,function*(){this.splitMessageSenderVersionMap.set(e,t),yield this.syncCache(),(0,rn.logDebug)("get update topic sender version: ",e,t)})}sendSplitPackages(e,t,r,o){return nr(this,void 0,void 0,function*(){if(!e){rr.logError("sendSplitPackages invalid topic");return}let i=this.splitMessageSenderVersionMap.get(e),s=t.length;try{if(s<df)throw new Error(`no need to split (size:${s})`);if(!i||i&&i<uf)throw new Error(`version not support split (version: ${i})`);let l=[],p=df;for(let c=0;c<t.length;c+=p)c+p<t.length?l.push(t.slice(c,c+p)):l.push(t.slice(c));let f=(0,my.generateGroupId)(),a=l.map((c,u)=>({topicId:e,protocol_version:uf,total_count:l.length,package_index:u,package_group_id:f,content:c}));this.mergePackageArray(!0,a);for(let c=0;c<a.length;){let u=a[c],_=(0,$r.safeJsonStringify)(u);try{yield o(_,e),rr.logDebug(`Successfully sent payload: ${_} to topic: ${e}`),a.splice(c,1)}catch(y){rr.logError(`Failed to send payload: ${_} to topic: ${e}`,y),u.retryCount=(u.retryCount||0)+1,u.retryCount>3?(rr.logError(`Payload failed after 3 retries: ${_}`),a.splice(c,1)):c++}}this.splitMessageSendArray.set(e,[]),yield this.syncCache()}catch(l){(0,rn.logDebug)("send split packages no split"),(0,rn.logDebug)(l),yield r(e,t)}})}onReceivedPackageCheck(e){return nr(this,void 0,void 0,function*(){this.mergePackageArray(!1,[e]);let t=new Map,r=e.topicId;this.splitMessageReceivedArray.forEach((i,s)=>{s==e.topicId&&i.forEach(l=>{if(l.messageObject.package_group_id){let p=t.get(l.messageObject.package_group_id);p||(p=new Array),p.push(l),t.set(l.messageObject.package_group_id,p)}})}),(0,rn.logDebug)("on received message, check message cache");let o={isSplitPackage:!1};if(e.messageObject.package_group_id){o.isSplitPackage=!0;let i=t.get(e.messageObject.package_group_id);if(i?.length){let s=new Set;if(i.forEach(l=>{l.messageObject.package_index!==void 0&&s.add(l.messageObject.package_index)}),s.size==e.messageObject.total_count){i.sort((a,c)=>(a.messageObject.package_index||a.messageObject.package_index===0)&&(c.messageObject.package_index||c.messageObject.package_index===0)?a.messageObject.package_index-c.messageObject.package_index:0);let l=i.reduce((a,c)=>(a.push(c.messageObject.content),a),[]),p=i.reduce((a,c)=>(a.push(c.messageId),a),[]);o.isSplitPackage=!0,o.finalMessage=l.join(""),o.completeMessageIdList=p;let f=this.splitMessageReceivedArray.get(r);f&&(f=f.filter(a=>!p.includes(a.messageId)),this.splitMessageReceivedArray.set(r,f)),yield this.syncCache()}}}return o})}mergePackageArray(e,t){return nr(this,void 0,void 0,function*(){if((0,rn.logDebug)("append sending array"),e){let o=t.filter(i=>{let s=i.topicId,l=!0,p=this.splitMessageSendArray.get(s);return p?.forEach(f=>{f.package_group_id==i.package_group_id&&f.total_count==i.total_count&&f.package_index==i.package_index&&(l=!1)}),l});if(o.length>0){let i=o[0].topicId,s=this.splitMessageSendArray.get(i);s||(s=new Array),s=s.concat(o),this.splitMessageSendArray.set(i,s),(0,rn.logDebug)("append sending array (after filted): ",s)}}else{let o=t.filter(i=>{let s=i.topicId,l=!0,p=this.splitMessageReceivedArray.get(s);return p?.forEach(f=>{f.messageId==i.messageId&&(l=!1)}),l});if(o.length>0){let i=o[0].topicId,s=this.splitMessageReceivedArray.get(i);s||(s=new Array),s=s.concat(o),this.splitMessageReceivedArray.set(i,s),(0,rn.logDebug)("append received array (after filted): ",s)}}})}syncCache(){return nr(this,void 0,void 0,function*(){(0,rn.logDebug)("sync split message cache"),yield this.splitPackageCache.setItem(ff,this.splitMessageReceivedArray),yield this.splitPackageCache.setItem(pf,this.splitMessageSendArray),yield this.splitPackageCache.setItem(hf,this.splitMessageSenderVersionMap)})}recoverFromCache(){return nr(this,void 0,void 0,function*(){let e=yield this.splitPackageCache.getItem(ff);e?this.splitMessageReceivedArray=e:this.splitMessageReceivedArray=new Map;let t=yield this.splitPackageCache.getItem(pf);t?this.splitMessageSendArray=t:this.splitMessageSendArray=new Map;let r=yield this.splitPackageCache.getItem(hf);r?this.splitMessageSenderVersionMap=r:this.splitMessageSenderVersionMap=new Map})}};pt.ConnectionSplitPackages=Va});var Za=H(Kt=>{"use strict";g();m();var _y=Kt&&Kt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),yy=Kt&&Kt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),vy=Kt&&Kt.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&_y(t,e,r[o]);return yy(t,e),t}}(),pe=Kt&&Kt.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.ConnectionManager=void 0;var by=Ui(),on=Ha(),Ne=wr(),gf=qa(),rt=Er(),Oy=Jo(),mf=Io(),Vr=Rt(),Ya=Fa(),za=$a(),bt=Sn(),x=vy(je()),Be=je(),Bi=Co(),Cy=Pr(),Ey=Ga(),Qa=class{constructor(e=void 0){this.events=new Oy.EventEmitter,this.splitManager=new Ey.ConnectionSplitPackages("dapp"),this.connectorEnable=!1,this.connectStorage=new mf.Storage(Ne.OKXCONNECTOR_CACHE_KEY_DAPP+e,Ne.OKXCONNECTOR_CACHE_KEY_DAPP),this.tonsdkConnectStorage=new mf.Storage(Ne.OKXCONNECTOR_TON_KEY+e,Ne.OKXCONNECTOR_TON_KEY),this.crypto=new Ya.SessionCrypto;let t=(0,Cy.isInTMA)();if((0,Be.logDebug)("do init:",t),x.reportLog("connection manager do init"),t)try{let r=this.getCachedCryptoKeyPair();(0,Be.logDebug)("use same pk:",r),this.crypto=new Ya.SessionCrypto(r)}catch{this.connectStorage.clearCache(),x.reportEvent(Bi.OKXReportType.LOG,"cache_fail","cache failed")}this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new by.OKXWalletConnector(rt.OKXCONNECTOR_WS_URL_1),this.packageId=Date.now(),this.connectedWalletPK="",this.currentTopic="",x.logDebug(`this.connectedWalletPK  constructor   ${this.connectedWalletPK}`)}refreshPackageId(){let e=Date.now();e==this.packageId&&(this.packageId=e+1),this.packageId=e}saveCryptoKeyPair(e){let t=(0,bt.safeJsonStringify)(e);this.connectStorage.encryptStoreMsg(t,Ne.OKXCONNECTOR_CRYPTO_KEY)}getCachedCryptoKeyPair(){let t=this.connectStorage.getAndDecrypt(Ne.OKXCONNECTOR_CRYPTO_KEY);return typeof t=="string"?(x.logDebug("get cached crypto key:"),x.logDebug(t),(0,bt.safeJsonParse)(t)):(this.connectStorage.clearCache(),null)}saveJWTKeyPair(e){var t={publicKey:(0,Vr.toHexString)(e.publicKey),secretKey:(0,Vr.toHexString)(e.secretKey)};x.logDebug("save jwt kp");let r=(0,bt.safeJsonStringify)(t);x.logDebug(r),this.connectStorage.encryptStoreMsg(r,Ne.OKXCONNECTOR_JWT_KEY)}getCachedJWTKeyPair(){try{let r=this.connectStorage.getAndDecrypt(Ne.OKXCONNECTOR_JWT_KEY);if(typeof r=="string"){x.logDebug("get cached jwt kp:"),x.logDebug(r);let o=(0,bt.safeJsonParse)(r);x.logDebug("save jwt kp"),x.logDebug(o);var e={publicKey:(0,Vr.hexToByteArray)(o.publicKey),secretKey:(0,Vr.hexToByteArray)(o.secretKey)};return e}else return(0,za.generateKeyPair)()}catch{return x.reportEvent(Bi.OKXReportType.LOG,"cache_fail","cache failed"),(0,za.generateKeyPair)()}}isWalletPKReady(){return x.logDebug(`isWalletPKReady  ===> ${this.connectedWalletPK}`),this.connectedWalletPK.length>0}makeJWT(e){return pe(this,void 0,void 0,function*(){return yield(0,za.signJWT)(e,gf.OKXCONNECTOR_JWT_SIDE,gf.OKXCONNECTOR_JWT_TTL,this.jwtKeyPair)})}parsePackage(e){return pe(this,arguments,void 0,function*(t,r=!1){var o,i,s,l,p,f,a,c,u,_,y,I,X;if(this.events.emit(t.id,t),!r){yield this.sendACK(t.id,!0);let D=(o=this.connectStorage.getItem(Ne.OKXCONNECTOR_TOKEN_CACHE))===null||o===void 0?void 0:o.content;if(D){let T=t;if(!((s=(i=T.params)===null||i===void 0?void 0:i.data)===null||s===void 0)&&s.messageId){T.method&&T.method===on.CONNECT_METHOD_PUSH&&((0,Be.logDebug)("checkExpire: update expire when get push"),this.updateExpireLimit(D));let U=this.splitManager.tryParseMessageSplitPayload((p=(l=T.params)===null||l===void 0?void 0:l.data)===null||p===void 0?void 0:p.message);if(U){let J={topicId:(a=(f=T.params)===null||f===void 0?void 0:f.data)===null||a===void 0?void 0:a.topic,messageId:(u=(c=T.params)===null||c===void 0?void 0:c.data)===null||u===void 0?void 0:u.messageId,messageObject:U,publishedAt:(y=(_=T.params)===null||_===void 0?void 0:_.data)===null||y===void 0?void 0:y.publishedAt},V=yield this.splitManager.onReceivedPackageCheck(J);V.completeMessageIdList&&V.completeMessageIdList.forEach(S=>pe(this,void 0,void 0,function*(){this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),S,D)}))}else this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),(X=(I=T.params)===null||I===void 0?void 0:I.data)===null||X===void 0?void 0:X.messageId,D)}}}})}restoreConnect(e){return pe(this,void 0,void 0,function*(){if(x.reportLog("connection manager restore connection"),x.logDebug(`connectionManager  restoreConenct   ${e}`),typeof e!="string"||e.length===0)throw new Error("CONNECTION: invalid topic");x.logDebug("connectionManager  restoreConenct   disconnect"),yield this.disconnect(!0),this.connectStorage.saveContent(e,Ne.OKXCONNECTOR_TOKEN_CACHE),x.logDebug("connectionManager  restoreConenct   conect"),yield this.connect(!0)})}getConnectInfo(){var e=(0,Vr.generateTopic)();return x.logDebug(`generate topic token: ${e}`),x.reportLog("connection manager generate connection info"),this.currentTopic=e,{channelId:e,clientId:this.crypto.stringifyKeypair().publicKey}}connect(){return pe(this,arguments,void 0,function*(e=!1){this.timeLog=new Date().getTime(),(0,Be.logDebug)("ConnectTime---enter->",this.timeLog),x.reportLog("connection manager begin connect");let t=this.connectStorage.getItem(Ne.OKXCONNECTOR_TOKEN_CACHE);var r=this.currentTopic;if(x.logDebug(`generate topic token: ${r}`),e){typeof t<"u"&&t!==null&&(x.logDebug(`read last connect id: ${t}`),r=t.content);var o=this.connectStorage.getItem(Ne.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE);o&&(this.connectedWalletPK=o.content,(0,Be.logDebug)(`connectionManager connect() this.connectedWalletPK : ${this.connectedWalletPK}`)),x.reportLog("connection manager do restore connection")}if(e)try{let s=this.getCachedCryptoKeyPair();s&&(this.crypto=new Ya.SessionCrypto(s))}catch{throw x.logError("get crypto key pair from cache failed"),x.reportEvent(Bi.OKXReportType.LOG,"cache_fail","cache failed"),this.connectStorage.clearCache(),new Error("crypto cache failed")}x.logDebug(`use crypto client id: ${this.crypto.stringifyKeypair().publicKey}`),this.connectStorage.saveContent(r,Ne.OKXCONNECTOR_TOKEN_CACHE);var i=yield this.makeJWT(r);return x.logDebug(`generate jwt token: ${i}`),this.connectStorage.saveContent(i,"jwt"),new Promise((s,l)=>{this.connector.onOpen(()=>pe(this,void 0,void 0,function*(){x.logDebug("1. connector on open"),x.reportLog("1. connect ws open");let p=new Date().getTime();(0,Be.logDebug)("ConnectTime---open->",p-this.timeLog),this.events.once(this.packageId.toString(),f=>pe(this,void 0,void 0,function*(){if(f&&f.error){x.logError("failed when login"),x.reportLog("2. connect login failed"),yield this.connector.disconnect();var a=new Error;a.message=f.error.message,a.name=f.error.code.toString(),l(a)}this.refreshPackageId(),this.events.once(this.packageId.toString(),u=>pe(this,void 0,void 0,function*(){if(u&&u.error){x.logError("failed when subscribe"),x.reportLog("3. connect subscribe failed"),yield this.connector.disconnect();var _=new Error;_.message=u.error.message,_.name=u.error.code.toString(),l(_)}this.refreshPackageId(),x.logDebug(`4. subscribe callback then send fetch: ${this.packageId}`),x.reportLog("4. subscribe callback then send fetch");let y=new Date().getTime();(0,Be.logDebug)("ConnectTime--subscribe callback->",y-this.timeLog),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),r),x.logDebug(`5. splitmanager init: ${this.packageId}`),x.reportLog("5. splitmanager init"),yield this.splitManager.init(this.sendRaw.bind(this)),e&&(this.checkExpire(r)?((0,Be.logDebug)("disconnect From topic expire"),setTimeout(()=>{this.activateDisconnect()},1e3)):((0,Be.logDebug)("extends expire check"),this.updateExpireLimit(r))),s()})),x.logDebug(`3. login callback then send subscribe: ${this.packageId}`),x.reportLog("3. connect subscribe failed");let c=new Date().getTime();(0,Be.logDebug)("ConnectTime---login callback->",c-this.timeLog),yield this.connector.send(()=>pe(this,void 0,void 0,function*(){x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect().catch(u=>{(0,Be.logDebug)("ConnectionManager connect error",u),l(u)})}),{id:this.packageId.toString(),jsonrpc:rt.CONNECT_JSONRPC_VER,method:on.CONNECT_METHOD_SUB,params:{topic:r}})})),x.logDebug("2. login called"),x.reportLog("2. connection manager connect call login"),yield this.connector.send(()=>pe(this,void 0,void 0,function*(){x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect().catch(f=>{(0,Be.logDebug)("ConnectionManager connect error",f),l(f)})}),{id:this.packageId.toString(),jsonrpc:rt.CONNECT_JSONRPC_VER,method:on.CONNECT_METHOD_LOGIN,params:{token:i}}),this.connector.addPackageParse(f=>{var a;if(x.logDebug("connect: parse package"),x.logDebug(f),!("params"in f)||!("data"in f.params)){this.parsePackage(f,!0);return}let c=(a=f.params.data)===null||a===void 0?void 0:a.message;if(typeof c<"u"&&c.length>0){c=c.replace(/'/g,'"');let u=(0,bt.safeJsonParse)(c);typeof u!="string"&&"clientId"in u&&u.clientId&&u.clientId.length>0&&(this.connectedWalletPK=u.clientId,x.logDebug(`this.connectedWalletPK  addPackageParse   ${this.connectedWalletPK}`),this.connectStorage.saveContent(this.connectedWalletPK,Ne.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.saveCryptoKeyPair(this.crypto.stringifyKeypair()))}this.parsePackage(f,f.method===on.CONNECT_METHOD_RECEIVE)})})),this.connector.connect().catch(p=>{(0,Be.logDebug)("ConnectionManager connect error",p),l(p)}),this.connectorEnable=!0})})}sendDisconnect(e){return pe(this,void 0,void 0,function*(){return new Promise((t,r)=>pe(this,void 0,void 0,function*(){if(this.refreshPackageId(),!this.connectorEnable){x.logDebug("skip disconnect before connected relay"),t();return}this.events.once(this.packageId.toString(),i=>pe(this,void 0,void 0,function*(){x.logDebug("CONNECT: disconnect command send"),this.connectorEnable=!1,t()}));let o={id:this.packageId.toString(),jsonrpc:rt.CONNECT_JSONRPC_VER,method:on.CONNECT_METHOD_DISCONNECT,params:{message:{topic:e,ttl:rt.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL}}};yield this.connector.send(()=>pe(this,void 0,void 0,function*(){x.logDebug("CONNECT: skip reconnect send")}),o)}))})}sendRecvDisconnect(e){return pe(this,void 0,void 0,function*(){this.refreshPackageId();let t={id:this.packageId.toString(),jsonrpc:rt.CONNECT_JSONRPC_VER,method:on.CONNECT_METHOD_RECV_DISCONNECT,params:{topic:e}};yield this.connector.send(()=>pe(this,void 0,void 0,function*(){return x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),t)})}disconnect(){return pe(this,arguments,void 0,function*(e=!1){try{yield this.sendDisconnect(this.currentTopic)}catch(t){x.logError("send disconnect command failed",t)}yield this.connector.disconnect(),x.reportLog("connect disconnect"),this.connectStorage.clearCache(Ne.OKXCONNECTOR_TOKEN_CACHE),e||(this.connectStorage.clearCache(Ne.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.connectedWalletPK="",(0,Be.logDebug)(`connectionManager disconnect() this.connectedWalletPK : ${this.connectedWalletPK}`))})}updateProtocolVersion(e,t){this.splitManager.updateTopicSenderVersion(e,t)}addListener(e,t,r){this.connector.addListener((0,bt.safeJsonStringify)(e),o=>{if(o=o.replace(/'/g,'"'),x.logDebug(`addListener ===> ${o}`),typeof o<"u"&&o.length>0){var i=(0,bt.safeJsonParse)(o),s=i.message;let l;return s.trimStart().startsWith("{")?l=s:(i.clientId&&i.clientId.length>0&&(this.connectedWalletPK=i.clientId,this.connectStorage.saveContent(this.connectedWalletPK,Ne.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),x.logDebug(`this.connectedWalletPK  addListener   ${this.connectedWalletPK}`),x.logDebug(`this.cryptoKey  addListener   ${(0,Vr.toHexString)(this.crypto.keyPair.publicKey)}`),this.saveCryptoKeyPair(this.crypto.stringifyKeypair())),l=this.crypto.decrypt(s,this.connectedWalletPK)),x.logDebug(`addListener ===> ${l}`),l}},t,r,o=>new Promise((i,s)=>pe(this,void 0,void 0,function*(){let l=this.splitManager.tryParseMessageSplitPayload(o.message);if(l){let p={topicId:o.topic,messageId:o?.messageId,messageObject:l,publishedAt:o?.publishedAt},f=yield this.splitManager.onReceivedPackageCheck(p);i(f)}else i({isSplitPackage:!1})})))}sendRaw(e){return pe(this,void 0,void 0,function*(){x.logDebug(`message send =====> ${e}`),x.reportLog("connect send raw msg");let t=e;x.logDebug(`message send =====encrypt message.length>>>> ${t.length}`);let r=this.connectStorage.getItem(Ne.OKXCONNECTOR_TOKEN_CACHE);x.logDebug(`message send =====topic>>>> ${r?.content}`),this.refreshPackageId();let o={id:this.packageId.toString(),method:on.CONNECT_METHOD_PUBLISH,jsonrpc:rt.CONNECT_JSONRPC_VER,params:{message:{topic:r?.content,message:t,ttl:rt.OKXCONNECTOR_MESSAGE_TTL}}};return this.events.once(this.packageId.toString(),i=>pe(this,void 0,void 0,function*(){i&&i.error?x.logError(`@${new Date().toUTCString()} >>> failed when send msg`):i&&!i.error&&x.logDebug(`CONNECTION @[${new Date().toUTCString()}] >>> send msg with id ${this.packageId} successed`)})),yield this.connector.send(()=>pe(this,void 0,void 0,function*(){return x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o),this.packageId})}sendEncryptedMsg(e,t){return pe(this,arguments,void 0,function*(r,o,i=rt.OKXCONNECTOR_MESSAGE_TTL){this.refreshPackageId();let s={id:this.packageId.toString(),method:on.CONNECT_METHOD_PUBLISH,jsonrpc:rt.CONNECT_JSONRPC_VER,params:{message:{topic:r,message:o,ttl:i}}};this.events.once(this.packageId.toString(),l=>pe(this,void 0,void 0,function*(){l&&l.error?x.logError(`@${new Date().toUTCString()} >>> failed when send msg`):l&&!l.error&&x.logDebug(`CONNECTION @[${new Date().toUTCString()}] >>> send msg with id ${this.packageId} successed`)})),yield this.connector.send(()=>pe(this,void 0,void 0,function*(){return x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)})}send(e){return pe(this,arguments,void 0,function*(t,r=rt.OKXCONNECTOR_MESSAGE_TTL){if(x.logDebug(`message send =====> ${t}`),x.reportLog("connect send msg"),!this.isWalletPKReady())throw new Error("connection not finish");let o=this.crypto.encrypt(t,this.connectedWalletPK);x.logDebug(`message send =====encrypt message.length>>>> ${o.length}`),x.reportEvent(Bi.OKXReportType.LOG,"msg_size",o.length.toString());let i=this.connectStorage.getItem(Ne.OKXCONNECTOR_TOKEN_CACHE);return x.logDebug(`message send =====topic>>>> ${i?.content}`),yield this.splitManager.sendSplitPackages(i?.content,o,this.sendEncryptedMsg.bind(this),this.sendRaw.bind(this)),this.packageId})}sendACK(e,t){return pe(this,arguments,void 0,function*(r,o,i=void 0){if(o===!0){let s={id:r,jsonrpc:rt.CONNECT_JSONRPC_VER,result:!0};yield this.connector.send(()=>pe(this,void 0,void 0,function*(){return x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)}else if(i){let s={id:r,jsonrpc:rt.CONNECT_JSONRPC_VER,error:{code:i.code,message:i.message}};yield this.connector.send(()=>pe(this,void 0,void 0,function*(){return x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)}})}sendReceive(e,t,r){return pe(this,void 0,void 0,function*(){let o={id:e,jsonrpc:rt.CONNECT_JSONRPC_VER,method:on.CONNECT_METHOD_RECEIVE,params:{data:{messageId:t,topic:r}}};yield this.connector.send(()=>pe(this,void 0,void 0,function*(){return x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}sendFetchAndConsumeMessages(e,t){return pe(this,void 0,void 0,function*(){this.events.once(e,i=>pe(this,void 0,void 0,function*(){var s,l;if(i.result){var p=i.result.hasMore,f=i.result.data;let a=i.result.disconnectedTopics;if(a)try{for(let c=0;c<a.length;c++){let u=a[c];if(u.topic){(0,Be.logDebug)("send receive disconnect:",u.topic),yield this.sendRecvDisconnect(u.topic);let _=(0,bt.safeJsonStringify)({requestId:u.publishedAt.toString(),method:"disconnect"}),y={messageId:u.publishedAt.toString(),message:(0,bt.safeJsonStringify)({message:_}),topic:u.topic,publishedAt:u.publishedAt};yield this.connector.getMsgPayloadFromHistory(y)}}}catch(c){x.logError("disconnect topic fails",c)}if(f)for(let c=0;c<f.length;c++){let u=f[c];if(u&&u.topic==t){let _=u.messageId;x.reportLog("5. get fetch result"),this.splitManager.tryParseMessageSplitPayload(u.message)?(yield this.connector.getMsgPayloadFromHistory(u),x.logDebug("skip receive")):(yield this.connector.getMsgPayloadFromHistory(u),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),_,t))}}p&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else x.logDebug(`CONNECT: get error rsp ${(s=i.error)===null||s===void 0?void 0:s.code} : ${(l=i.error)===null||l===void 0?void 0:l.message}`)})),x.logDebug("5. send fetch more"),x.reportLog("5. send fetch more");let r=new Date().getTime();(0,Be.logDebug)("ConnectTime---5->",r-this.timeLog);let o={id:e,jsonrpc:rt.CONNECT_JSONRPC_VER,method:on.CONNECT_METHOD_FETCHMSG,params:{data:{topic:t}}};yield this.connector.send(()=>pe(this,void 0,void 0,function*(){return x.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}cleanCache(){x.reportLog("connection cache clean called"),this.connectStorage.clearCache()}saveSessionContent(e,t){t||this.connectStorage.clearCache(Ne.OKXCONNECTOR_SESSION_PREFIX_KEY+e);let r=(0,bt.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(r,Ne.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}getSessionContent(e){try{let t=this.connectStorage.getAndDecrypt(Ne.OKXCONNECTOR_SESSION_PREFIX_KEY+e);if(t)return(0,bt.safeJsonParse)(t)}catch{this.connectStorage.clearCache(Ne.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}}getCurrentConnectionReady(){let e=!1;try{this.getCachedCryptoKeyPair()&&(e=!0)}catch{x.logError("check connection ready failed")}return this.isWalletPKReady()&&e}getCryptoKeyEnable(){let e=!1;try{this.getCachedCryptoKeyPair()&&(e=!0)}catch{x.logError("check connection ready failed")}return e}checkExpire(e){let t=!1;if(e.length==0)return(0,Be.logDebug)("checkExpire: invalid topic"),t;let r=this.getSessionContent(Ne.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE);return r&&r.topic?r.topic==e?Date.now()>r.timestamp&&((0,Be.logDebug)("checkExpire: connection is Expired"),t=!0):((0,Be.logDebug)("checkExpire: not same connection"),t=!1):((0,Be.logDebug)("checkExpire: not topic records"),this.updateExpireLimit(e),t=!1),t}updateExpireLimit(e){(0,Be.logDebug)(`update expire limit for topic: ${e}`);let t={topic:e,timestamp:Date.now()+rt.OKXCONNECTOR_SESSION_LIVE_TTL};this.saveSessionContent(Ne.OKXCONNECTOR_STORAGE_TOPIC_EXPIRE_CACHE,t)}activateDisconnect(){return pe(this,void 0,void 0,function*(){let e=(0,bt.safeJsonStringify)({requestId:"",method:"disconnect"}),t={messageId:"",message:(0,bt.safeJsonStringify)({message:e}),topic:this.currentTopic,publishedAt:0};yield this.connector.getMsgPayloadFromHistory(t)})}};Kt.ConnectionManager=Qa});var _f=H(Gr=>{"use strict";g();m();Object.defineProperty(Gr,"__esModule",{value:!0});Gr.WalletConnectionManagerEvent=Gr.WalletConnectionManagerTopicInfoCacheKey=void 0;Gr.WalletConnectionManagerTopicInfoCacheKey="wcmtic";Gr.WalletConnectionManagerEvent={RECEIVE_REQUEST:"payload"}});var wf=H(Lt=>{"use strict";g();m();var wy=Lt&&Lt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Ty=Lt&&Lt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Sy=Lt&&Lt.__importStar||function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[r.length]=o);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),o=0;o<r.length;o++)r[o]!=="default"&&wy(t,e,r[o]);return Ty(t,e),t}}(),ce=Lt&&Lt.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.WalletConnectionManager=void 0;var Ny=Ui(),Ot=Ha(),Ct=wr(),yf=qa(),ot=Er(),vf=_f(),Ry=Ga(),bf=Jo(),Dy=Io(),or=Rt(),Of=Fa(),Cf=$a(),st=Sn(),q=Sy(je()),ve=je(),Ef=Qe(),ec=class{constructor(){this.events=new bf.EventEmitter,this.communicateEvents=new bf.EventEmitter,this.splitManager=new Ry.ConnectionSplitPackages("wallet"),q.logDebug("connect manager construct"),this.connectStorage=new Dy.Storage(Ct.OKXCONNECTOR_CACHE_KEY),this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new Ny.OKXWalletConnector(ot.OKXCONNECTOR_WS_URL_1),this.packageId=Date.now(),this.sessionCryptoInfoMap=new Map,this.inLogin=!1,this.isLogined=!1}refreshPackageId(e=0){let t=Date.now()+e;t==this.packageId&&(this.packageId=t+1),this.packageId=t}saveCryptoKeyPair(e,t){let r=(0,st.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(r,Ct.OKXCONNECTOR_CRYPTO_KEY+e)}getCachedCryptoKeyPair(e){let r=this.connectStorage.getAndDecrypt(Ct.OKXCONNECTOR_CRYPTO_KEY+e);return typeof r=="string"?(q.logDebug("get cached crypto key:"),q.logDebug(r),(0,st.safeJsonParse)(r)):(this.connectStorage.clearCache(),null)}saveJWTKeyPair(e){var t={publicKey:(0,or.toHexString)(e.publicKey),secretKey:(0,or.toHexString)(e.secretKey)};q.logDebug("save jwt kp");let r=(0,st.safeJsonStringify)(t);q.logDebug(r),this.connectStorage.encryptStoreMsg(r,Ct.OKXCONNECTOR_JWT_KEY),q.logDebug("after save jwt kp")}getCachedJWTKeyPair(){let t=this.connectStorage.getAndDecrypt(Ct.OKXCONNECTOR_JWT_KEY);if(typeof t=="string"){q.logDebug("get cached jwt kp:"),q.logDebug(t);let o=(0,st.safeJsonParse)(t);q.logDebug("save jwt kp"),q.logDebug(o);var r={publicKey:(0,or.hexToByteArray)(o.publicKey),secretKey:(0,or.hexToByteArray)(o.secretKey)};return r}else return(0,Cf.generateKeyPair)()}isTopicPublicKeyExist(e){return q.logDebug(`isTopicPublicKeyExist  ===> ${e}`),this.sessionCryptoInfoMap.get(e)}makeJWT(e){return ce(this,void 0,void 0,function*(){return yield(0,Cf.signJWT)(e,yf.OKXCONNECTOR_JWT_WALLET_SIDE,yf.OKXCONNECTOR_JWT_TTL,this.jwtKeyPair)})}parseInternalMsg(e){try{let r=(0,st.safeJsonParse)(e)["ivur-igbfft-ptjip"];if(r&&r.length>0)return(0,Ef.base64decode)(r,!0).toString()}catch(t){q.logError("parse internal msg",t)}}updateClientId(e,t){let r=this.sessionCryptoInfoMap.get(e);if((0,ve.logDebug)("updateClientId",r,e,t),r&&t&&t.length>0){if(r.cid){let o=(0,or.getLastSixMd5Hash)(t);r.cid==o?r.dappPublicKey=t:q.logError("cid check failed",r,e,t)}else r.dappPublicKey=t;this.syncCacheSessionInfo()}return!1}parsePackage(e,t){return ce(this,arguments,void 0,function*(r,o,i=!1){var s,l,p,f,a,c,u,_,y,I,X,D,T,U,J,V,S;this.events.emit(o.id,o);let B=this.sessionCryptoInfoMap.get(r);q.logDebug("get sessionInfo for decrypt topic:",r),q.logDebug("get sessionInfo for decrypt:",o.id,r,B,this.sessionCryptoInfoMap);let L=!1;if(B&&o.params.data&&!((s=o.params.data)===null||s===void 0)&&s.message)if(!((l=o.params.data)===null||l===void 0)&&l.isInternalData){let $=(p=o.params.data)===null||p===void 0?void 0:p.message,ne=(f=o.params.data)===null||f===void 0?void 0:f.topic,C=this.parseInternalMsg($);(0,ve.logDebug)("parse internal origin: ",C),C&&C.length>0&&this.communicateEvents.emit("origin",C,ne)}else try{let $=(a=o.params.data)===null||a===void 0?void 0:a.message;if(o.method&&o.method===Ot.CONNECT_METHOD_PUSH&&((0,ve.logDebug)("checkExpire: update expire when get push"),this.updateExpireLimit(r)),$.trimStart().startsWith("{")){let ne=this.splitManager.tryParseMessageSplitPayload($);if(ne){(0,ve.logDebug)("parse split msg object: ",ne),L=!0;let C={topicId:(u=(c=o.params)===null||c===void 0?void 0:c.data)===null||u===void 0?void 0:u.topic,messageId:(y=(_=o.params)===null||_===void 0?void 0:_.data)===null||y===void 0?void 0:y.messageId,messageObject:ne,publishedAt:(X=(I=o.params)===null||I===void 0?void 0:I.data)===null||X===void 0?void 0:X.publishedAt},R=yield this.splitManager.onReceivedPackageCheck(C);if(R.completeMessageIdList&&R.completeMessageIdList.forEach(j=>ce(this,void 0,void 0,function*(){this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),j,r)})),R.finalMessage){let j=B.crypto.decryptWallet(R.finalMessage,B.dappPublicKey);(0,ve.logDebug)("<<< receive msg from split:",r,j),this.communicateEvents.emit(r,j)}}else{let C=(0,st.safeJsonParse)($);if(C.method){if(C.method=="session_info"){let R=C.params.sessionInfo,j=(0,Ef.base64decode)(R,!1);(0,ve.logDebug)("wallet connection manager requset base64Content:",j),(0,ve.logDebug)("base64Content:"+j);let Q=j.toObject();this.updateClientId(r,Q.clientId)}(0,ve.logDebug)("<<< parse raw msg:",r,C),this.communicateEvents.emit(r,$)}}}else{let ne=B.crypto.decryptWallet((D=o.params.data)===null||D===void 0?void 0:D.message,B.dappPublicKey);(0,ve.logDebug)("<<< receive msg:",r,ne),this.communicateEvents.emit(r,ne)}}catch{let ne=B.crypto.decryptWallet((T=o.params.data)===null||T===void 0?void 0:T.message,B.dappPublicKey);(0,ve.logDebug)("<<< receive msg:",r,ne),this.communicateEvents.emit(r,ne)}if(!i&&(yield this.sendACK(o.id,!0),r&&!L)){let $=o;!((J=(U=$.params)===null||U===void 0?void 0:U.data)===null||J===void 0)&&J.messageId&&(this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),(S=(V=$.params)===null||V===void 0?void 0:V.data)===null||S===void 0?void 0:S.messageId,r))}})}recovrySessionInfoFromCache(){let e=this.connectStorage.getAndDecrypt(vf.WalletConnectionManagerTopicInfoCacheKey);if(q.logDebug("get cached sessionInfos:",e),e){let t=(0,st.safeJsonParse)(e);for(let r in t){let o=t[r];q.logDebug("make topicItem:",o);let i={topic:r,crypto:new Of.SessionCrypto({publicKey:o.cryptoKeyPair.publicKey,secretKey:o.cryptoKeyPair.secretKey}),dappPublicKey:o.dappPublicKey,cid:o.cid};this.sessionCryptoInfoMap.set(r,i)}}q.logDebug("get cached sessionInfos map:",this.sessionCryptoInfoMap)}syncCacheSessionInfo(){let e={};for(let[r,o]of this.sessionCryptoInfoMap)q.logDebug("for each Keys",r),o&&(e[r]={cryptoKeyPair:o.crypto.stringifyKeypair(),dappPublicKey:o.dappPublicKey,cid:o.cid});let t=(0,st.safeJsonStringify)(e);q.logDebug("sync cache sessionInfos:",t),this.connectStorage.encryptStoreMsg(t,vf.WalletConnectionManagerTopicInfoCacheKey)}cacheSessionInfo(e,t,r=!0){let o=t.dappPublicKey,i=[];for(let[s,l]of this.sessionCryptoInfoMap)q.logDebug("for each Keys",s),l.dappPublicKey==o&&(q.logDebug("duplicated dapp public key:",s,o),i.push(s));for(let[s,l]of this.sessionCryptoInfoMap)i.includes(s)&&this.sessionCryptoInfoMap.delete(s);return q.logDebug("cleaned connect session cache:",this.sessionCryptoInfoMap),this.sessionCryptoInfoMap.set(e,t),q.logDebug("cache sessionInfo:",e,t,this.sessionCryptoInfoMap),r&&this.syncCacheSessionInfo(),i}updateProtocolVersion(e,t){this.splitManager.updateTopicSenderVersion(e,t)}appendTopic(e,t,r){return ce(this,void 0,void 0,function*(){return(0,ve.logDebug)("4.1. get append Topic:",e),new Promise((o,i)=>ce(this,void 0,void 0,function*(){if(!this.isLogined){var s=new Error;s.message="connection is not logined",s.name="append error",i(s);return}let l={topic:e,crypto:new Of.SessionCrypto,dappPublicKey:t||"",cid:r},p=this.cacheSessionInfo(e,l,!1);yield this.subscribeTopics(Array.from([e])),this.refreshPackageId(),q.logDebug(`5. subscribe callback then fetch append message: ${this.packageId}, ${e}`),q.reportLog("5. subscribe callback then fetch append message");let f=new Date().getTime();(0,ve.logDebug)("Append --subscribe callback->",f-this.timeLog),o(p)}))})}confirmAppendingTopics(){this.syncCacheSessionInfo()}connect(){return ce(this,void 0,void 0,function*(){this.timeLog=new Date().getTime(),(0,ve.logDebug)("[Wallet] ConnectTime---enter->",this.timeLog),q.reportLog("wallet connect connect called");let e=Date.now().toString();var t=yield this.makeJWT(e);return q.logDebug(`generate jwt token: ${t}`),this.connectStorage.saveContent(t,"jwt"),this.recovrySessionInfoFromCache(),new Promise((r,o)=>{this.inLogin=!0,this.connector.onOpen(()=>ce(this,void 0,void 0,function*(){q.logDebug("1. connector on open"),q.reportLog("1. wallet connect connect on open");let i=new Date().getTime();(0,ve.logDebug)("ConnectTime---open->",i-this.timeLog),this.events.once(this.packageId.toString(),s=>ce(this,void 0,void 0,function*(){if(s&&s.error){q.logError("failed when login"),yield this.connector.disconnect();var l=new Error;l.message=s.error.message,l.name=s.error.code.toString(),o(l)}else this.isLogined=!0,r(),q.logDebug("3. subscribe cached topics",this.sessionCryptoInfoMap),q.reportLog("3. wallet connect connect subscribe cached topics"),this.sessionCryptoInfoMap.size>0&&(yield this.subscribeTopics(Array.from(this.sessionCryptoInfoMap.keys())))})),q.logDebug("2. login called"),q.reportLog("2. wallet connect login called"),yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),{id:this.packageId.toString(),jsonrpc:ot.CONNECT_JSONRPC_VER,method:Ot.CONNECT_METHOD_LOGIN,params:{token:t}})})),this.connector.connect().catch(i=>{(0,ve.logDebug)("WalletConnectionManager connect error",i),o(i)}),this.connector.addPackageParse(i=>{var s,l;if(q.logDebug("connect: parse package"),q.logDebug(i),!("params"in i)||!("data"in i.params)){this.parsePackage("",i,!0);return}!((s=i.params.data)===null||s===void 0)&&s.topic&&this.parsePackage((l=i.params.data)===null||l===void 0?void 0:l.topic,i,i.method===Ot.CONNECT_METHOD_RECEIVE)})})})}getSessionPublicKey(e){if(this.isTopicPublicKeyExist(e)){let t=this.sessionCryptoInfoMap.get(e);if(t)return(0,or.toHexString)(t.crypto.keyPair.publicKey)}}getCurrentCachedTopicIdList(){return Array.from(this.sessionCryptoInfoMap.keys())}sendDisconnect(e){return ce(this,void 0,void 0,function*(){this.refreshPackageId();let t={id:this.packageId.toString(),jsonrpc:ot.CONNECT_JSONRPC_VER,method:Ot.CONNECT_METHOD_DISCONNECT,params:{message:{topic:e,ttl:ot.OKXCONNECTOR_MESSAGE_DISCONNECT_TTL}}};yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),t)})}sendRecvDisconnect(e){return ce(this,void 0,void 0,function*(){this.refreshPackageId();let t={id:this.packageId.toString(),jsonrpc:ot.CONNECT_JSONRPC_VER,method:Ot.CONNECT_METHOD_RECV_DISCONNECT,params:{topic:e}};yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),t)})}disconnect(){return ce(this,arguments,void 0,function*(e=!1){yield this.connector.disconnect(),this.connectStorage.clearCache(Ct.OKXCONNECTOR_TOKEN_CACHE),e||this.connectStorage.clearCache(Ct.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE)})}sendRaw(e,t){return ce(this,void 0,void 0,function*(){t&&(yield this.sendMsg(t,e,ot.OKXCONNECTOR_MESSAGE_TTL))})}sendMsg(e,t,r){return ce(this,void 0,void 0,function*(){if(t){this.refreshPackageId();let o={id:this.packageId.toString(),method:Ot.CONNECT_METHOD_PUBLISH,jsonrpc:ot.CONNECT_JSONRPC_VER,params:{message:{topic:e,message:t,ttl:r}}};this.events.once(this.packageId.toString(),i=>ce(this,void 0,void 0,function*(){i&&i.error?q.logError(`@${new Date().toUTCString()} >>> failed when send msg`):i&&!i.error&&q.logDebug(`CONNECTION @[${new Date().toUTCString()}] >>> send msg with id ${this.packageId} successed`)})),yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)}})}send(e,t){return ce(this,arguments,void 0,function*(r,o,i=!1,s=ot.OKXCONNECTOR_MESSAGE_TTL,l=!1){var p,f;if(q.logDebug(`message send =====> ${o}`),!this.isTopicPublicKeyExist(r))throw new Error("connection not finish");let a=(p=this.sessionCryptoInfoMap.get(r))===null||p===void 0?void 0:p.dappPublicKey,c=(f=this.sessionCryptoInfoMap.get(r))===null||f===void 0?void 0:f.crypto,u;l&&(u={message:o});let _=!1;if(c&&a&&!l){let y=c.encryptWallet(o,a);_=!0,u={message:y}}if(u){i&&c&&(u.clientId=(0,or.toHexString)(c.keyPair.publicKey));let y=(0,st.safeJsonStringify)(u);!l&&_?yield this.splitManager.sendSplitPackages(r,y,this.sendMsg.bind(this),this.sendRaw.bind(this)):yield this.sendMsg(r,y,s)}})}sendACK(e,t){return ce(this,arguments,void 0,function*(r,o,i=void 0){if(o===!0){let s={id:r,jsonrpc:ot.CONNECT_JSONRPC_VER,result:!0};yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)}else if(i){let s={id:r,jsonrpc:ot.CONNECT_JSONRPC_VER,error:{code:i.code,message:i.message}};yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),s)}})}sendReceive(e,t,r){return ce(this,void 0,void 0,function*(){let o={id:e,jsonrpc:ot.CONNECT_JSONRPC_VER,method:Ot.CONNECT_METHOD_RECEIVE,params:{data:{messageId:t,topic:r}}};yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}sendUnsubscribe(e){return ce(this,void 0,void 0,function*(){yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),{id:this.packageId.toString(),jsonrpc:ot.CONNECT_JSONRPC_VER,method:Ot.CONNECT_METHOD_UNSUB,params:{topic:e}});try{yield this.sendDisconnect(e)}catch(t){q.logError("send disconnect command failed",t)}this.sessionCryptoInfoMap.delete(e),this.syncCacheSessionInfo()})}sendFetchAndConsumeMessages(e,t){return ce(this,void 0,void 0,function*(){this.events.once(e,i=>ce(this,void 0,void 0,function*(){var s,l;if(i.result){var p=i.result.hasMore,f=i.result.data;if(f)for(let a=0;a<f.length;a++){let c=f[a];if(c&&c.topic==t){let u=c.messageId;yield this.connector.getMsgPayloadFromHistory(c),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),u,t)}}p&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else q.logDebug(`CONNECT: get error rsp ${(s=i.error)===null||s===void 0?void 0:s.code} : ${(l=i.error)===null||l===void 0?void 0:l.message}`)})),q.logDebug("5. send fetch more");let r=new Date().getTime();(0,ve.logDebug)("ConnectTime---5->",r-this.timeLog);let o={id:e,jsonrpc:ot.CONNECT_JSONRPC_VER,method:Ot.CONNECT_METHOD_FETCHMSG,params:{data:{topic:t}}};yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}sendBatchFetchAndConsumeMessages(e,t){return ce(this,void 0,void 0,function*(){this.events.once(e,i=>ce(this,void 0,void 0,function*(){var s,l;if(i.result){var p=i.result.hasMore,f=i.result.data;let a=i.result.disconnectedTopics;if(a)try{for(let c=0;c<a.length;c++){let u=a[c];if(u.topic){(0,ve.logDebug)("send receive disconnect:",u.topic),yield this.sendRecvDisconnect(u.topic);let _=(0,st.safeJsonStringify)({requestId:u.publishedAt.toString(),method:Ot.CONNECT_METHOD_DISCONNECT}),y={messageId:u.publishedAt.toString(),message:(0,st.safeJsonStringify)({message:_}),topic:u.topic,publishedAt:u.publishedAt};yield this.connector.getMsgPayloadFromHistory(y)}}}catch(c){q.logError("disconnect topic fails",c)}if(f)for(let c=0;c<f.length;c++){let u=f[c];if(u&&u.topic)if(this.splitManager.tryParseMessageSplitPayload(u.message))yield this.connector.getMsgPayloadFromHistory(u);else{let y=u.messageId;yield this.connector.getMsgPayloadFromHistory(u),this.refreshPackageId(c),yield this.sendReceive(this.packageId.toString(),y,u.topic)}}p&&(this.refreshPackageId(),yield this.sendBatchFetchAndConsumeMessages(this.packageId.toString(),t))}else q.logDebug(`CONNECT: get error rsp ${(s=i.error)===null||s===void 0?void 0:s.code} : ${(l=i.error)===null||l===void 0?void 0:l.message}`)})),q.logDebug("5. send fetch more"),q.reportLog("5. send fetch more");let r=new Date().getTime();(0,ve.logDebug)("ConnectTime---5->",r-this.timeLog);let o={id:e,jsonrpc:ot.CONNECT_JSONRPC_VER,method:Ot.CONNECT_METHOD_BATCH_FETCHMSG,params:{topics:t,withInternalData:!0}};yield this.connector.send(()=>ce(this,void 0,void 0,function*(){q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),o)})}cleanCache(){return ce(this,void 0,void 0,function*(){this.connectStorage.clearCache()})}saveSessionContent(e,t){t||this.connectStorage.clearCache(Ct.OKXCONNECTOR_SESSION_PREFIX_KEY+e);let r=(0,st.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(r,Ct.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}getSessionContent(e){let t=this.connectStorage.getAndDecrypt(Ct.OKXCONNECTOR_SESSION_PREFIX_KEY+e);if(t)return(0,st.safeJsonParse)(t)}subscribeTopics(e){return ce(this,void 0,void 0,function*(){(0,ve.logDebug)("4. topicid list",e),q.reportLog("4. topicid list"),this.refreshPackageId();let t=new Date().getTime();return(0,ve.logDebug)("ConnectTime--subscribe callback->",t-this.timeLog),new Promise((r,o)=>ce(this,void 0,void 0,function*(){let i=0;for(let s=0;s<e.length;++s){let l=e[s];this.refreshPackageId(s),this.events.once(this.packageId.toString(),f=>ce(this,void 0,void 0,function*(){if(f&&f.error){q.logError("failed when subscribe"),yield this.connector.disconnect();var a=new Error;a.message=f.error.message,a.name=f.error.code.toString(),i+=1,i==e.length&&r()}this.refreshPackageId(s);let c=new Date().getTime();(0,ve.logDebug)("ConnectTime--subscribe callback->",c-this.timeLog),i+=1,i==e.length&&(q.logDebug(`5. send fetch msg: ${this.packageId}, ${l}`),yield this.sendBatchFetchAndConsumeMessages(this.packageId.toString(),e),yield this.splitManager.init(this.sendRaw.bind(this)),this.checkExpire(l)?((0,ve.logDebug)("disconnect From topic expire"),yield this.activateDisconnect(l)):((0,ve.logDebug)("extends expire check"),this.updateExpireLimit(l)),r())})),q.logDebug(`3. login callback then send subscribe: ${this.packageId}, ${l}`),q.reportLog("3. login callback then send subscribe");let p=new Date().getTime();(0,ve.logDebug)("ConnectTime---login callback->",p-this.timeLog),yield this.connector.send(()=>ce(this,void 0,void 0,function*(){return q.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}),{id:this.packageId.toString(),jsonrpc:ot.CONNECT_JSONRPC_VER,method:Ot.CONNECT_METHOD_SUB,params:{topic:l}})}}))})}checkExpire(e){let t=!1;if(e.length==0)return(0,ve.logDebug)("checkExpire: invalid topic"),t;let r=this.getSessionContent(Ct.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE);if(r&&r instanceof Object)try{let i=new Map(Object.entries(r)).get(e);i?Date.now()>i&&((0,ve.logDebug)("checkExpire: connection is Expired"),t=!0):((0,ve.logDebug)("checkExpire: not same connection"),t=!1)}catch{(0,ve.logDebug)("checkExpire: cache error"),t=!1}else(0,ve.logDebug)("checkExpire: not topic records"),this.updateExpireLimit(e),t=!1;return t}updateExpireLimit(e){(0,ve.logDebug)(`update expire limit for topic: ${e}`);try{let t=this.getSessionContent(Ct.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE),r=new Map;t&&(r=new Map(Object.entries(t)));let o=Date.now()+ot.OKXCONNECTOR_SESSION_LIVE_TTL;r.set(e,o),this.saveSessionContent(Ct.OKXCONNECTOR_STORAGE_TOPIC_WALLET_EXPIRE_CACHE,Object.fromEntries(r))}catch{(0,ve.logDebug)("update cache failed")}}activateDisconnect(e){return ce(this,void 0,void 0,function*(){let t=(0,st.safeJsonStringify)({requestId:"",method:Ot.CONNECT_METHOD_DISCONNECT}),r={messageId:"",message:(0,st.safeJsonStringify)({message:t}),topic:e,publishedAt:0};yield this.connector.getMsgPayloadFromHistory(r)})}};Lt.WalletConnectionManager=ec});var Yr=H(xt=>{"use strict";g();m();Object.defineProperty(xt,"__esModule",{value:!0});xt.OKX_TG_WALLET=xt.OKX_APP_WALLET=xt.OKX_INJECT_WALLET=void 0;xt.getTagByappName=Ay;var Iy=ze(),Tf=_o();xt.OKX_INJECT_WALLET="okx_inject_wallet";xt.OKX_APP_WALLET="okx_app_wallet";xt.OKX_TG_WALLET="okx_tg_wallet";function Ay(n){var e="";if(n)switch(n){case Iy.OKXWalletName:e=xt.OKX_APP_WALLET;break;case Tf.OKXMiniWalletName:e=xt.OKX_TG_WALLET;break;case Tf.OKXInjectWalletName:e=xt.OKX_INJECT_WALLET}return e}});var tc=H(ko=>{"use strict";g();m();Object.defineProperty(ko,"__esModule",{value:!0});ko.buildNameSpacesByConnectResponse=Py;ko.buildRequestAccountNameSpacesByConnectResponse=Sf;ko.buildAccountNameSpaces=Nf;var Pn=je();function Py(n){return Sf(n)}function Sf(n){let e={};(0,Pn.logDebug)("buildRequestAccountNameSpacesByConnectResponse start connectResponse111>>",JSON.stringify(n));let t=n.payload.responses.find(i=>i.name==="requestAccounts");if(t&&t.accounts){let i=[];for(let s of t.accounts)s.namespace==="ton"?s.data&&s.data.ton_addr&&s.data.ton_addr.address&&s.data.ton_addr.address.length>0&&((0,Pn.logDebug)("buildRequestAccountNameSpacesByConnectResponse start TON>>",JSON.stringify(s)),i.push(s)):((0,Pn.logDebug)("buildRequestAccountNameSpacesByConnectResponse start other>>",JSON.stringify(s)),i.push(s));t.accounts=i}let r=n.payload.responses.find(i=>i.name==="ton_addr"),o=n.payload.responses.find(i=>i.name==="ton_proof");if(r&&!t){(0,Pn.logDebug)("buildRequestAccountNameSpacesByConnectResponse adapt ton data >>");let i=r.address;i="ton:"+r.network+":"+i;let s={ton_addr:r};o&&(s.ton_proof=o),t={name:"requestAccounts",accounts:[{namespace:"ton",addresses:[i],methods:["ton_sendTransaction"],extra:{},data:s}]}}return(0,Pn.logDebug)("buildRequestAccountNameSpacesByConnectResponse end universalResponse>>>",JSON.stringify(t)),Nf(t.accounts,e),e}function Nf(n,e){n.forEach(t=>{var r=[],o=[];t.addresses.forEach(i=>{var s=i.split(":");if((0,Pn.logDebug)("buildRequestAccountNameSpacesByConnectResponse addressArr>>",s.length),s.length>=3){let l=s.slice(0,2).join(":");r.push(l),o.push(i),(0,Pn.logDebug)("buildRequestAccountNameSpacesByConnectResponse chain:>>",l,"addressItem:",i)}}),t.data&&t.data.ton_addr&&(t.data.ton_addr.name="ton_addr"),t.data&&t.data.ton_proof&&(t.data.ton_proof.name="ton_proof"),e[t.namespace]={chains:r,accounts:o,methods:t.methods,extra:t.extra,payload:t.data},(0,Pn.logDebug)("buildRequestAccountNameSpacesByConnectResponse result>>",JSON.stringify(e))})}});var Rf=H(zr=>{"use strict";g();m();var ir=zr&&zr.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(zr,"__esModule",{value:!0});zr.Engine=void 0;var sr=ze(),ky=Er(),te=Qe(),gn=Yr(),Ky=Za(),Ly=tc(),nc=_o(),rc=class{constructor(e){this.connectors=[],this.useConnector=void 0,this.connectionManager=new Ky.ConnectionManager(e),this.addConnectionListener()}getConnector(){if(this.useConnector)return this.useConnector}setAccountChangeListener(e){this.accountChangeListener=e,(0,te.logDebug)("setAccountChangeListener: engine",e);for(let t of this.connectors)t.setAccountChangeListener(e)}registerConnector(e){this.connectors=e;for(let t of e)t.setConnectionManager(this.connectionManager)}hasWsConnector(){for(let e of this.connectors)if(this.isWsConnector(e))return!0;return!1}isWsConnector(e){return e?e.getTag()===gn.OKX_TG_WALLET||e.getTag()===gn.OKX_APP_WALLET:!1}isInjectedConnector(e){return e?e.getTag()===gn.OKX_INJECT_WALLET:!1}universalConnect(e,t,r){return ir(this,void 0,void 0,function*(){return this.addConnectionListener(),new Promise((o,i)=>ir(this,void 0,void 0,function*(){var s,l,p,f,a;try{(0,te.logDebug)("engine universalConnect request :",JSON.stringify(e)),(0,te.logDebug)("engine universalConnect sessionConfig :",JSON.stringify(t));let c=[];e.forEach(S=>{let B=S.name;(B.startsWith("requestAccounts")||B.startsWith("ton"))&&c.push(S)}),(0,te.logDebug)("engine universalConnect universalRequest :",JSON.stringify(c));let u=this.connectionManager.getConnectInfo(),_=Date.now().toString(),y=(s=t.openUniversalUrl)!==null&&s!==void 0?s:!1,I=(l=t.openAppLinkType)!==null&&l!==void 0?l:sr.OpenAppLinkType.UniversalLink,X={protocolVer:Number(sr.tonConnectSdkVersion),topic:u.channelId,clientId:u.clientId,requestId:_,dAppInfo:this.fixDappName(t.dappInfo),requests:c,redirect:(p=t?.redirect)!==null&&p!==void 0?p:"none"},D=(0,te.encodeConnectParams)(X);X.redirect=(f=t?.redirect)!==null&&f!==void 0?f:"none",(0,te.logDebug)("engine universalConnect ==>>universalConnectRequest:",JSON.stringify(X));let T="",U="";if(y){let S=(0,te.getOKXLink)(X,t.useMini,t.tmaReturnUrl);T=S.universalLink,U=S.deepLink||"",(0,te.logDebug)("engine universalConnect ==>>openOKXLink:",T)}let J=()=>this.connectors.length==1&&this.connectors[0].getTag()===gn.OKX_INJECT_WALLET?this.connectors[0].openWallet({connectRequest:X},I):t.useMini?(0,te.openOKXTMAWalletlinkWithFallback)(T):(0,te.openOKXDeeplinkWithFallback)(U,T,I);(0,te.logDebug)("engine universalConnect ==>>openOKXLink:",T);let V=(0,te.isIos)();if(V&&y&&((0,te.logDebug)(`engine universalConnect ==>>isIOS: ${V}   openUniversalLink: ${y}`),J()),this.addOnConnectResultListener(S=>{var B,L,$,ne;try{this.addOnConnectResultListener(void 0);let j=S;if(j.method=="connect"){(0,te.logDebug)("engin  universalConnect success connectResponse:>>>",JSON.stringify(j));let Q=(0,Ly.buildNameSpacesByConnectResponse)(j);if(Q){let le;((L=(B=j.payload)===null||B===void 0?void 0:B.responses)===null||L===void 0?void 0:L[0])&&"walletName"in j.payload.responses[0]&&(le=j.payload.responses[0].walletName);let oe=($=j.payload)===null||$===void 0?void 0:$.wallet.appName;var C="";switch(oe){case nc.OKXWalletName:C=gn.OKX_APP_WALLET;break;case nc.OKXMiniWalletName:C=gn.OKX_TG_WALLET;break;case nc.OKXInjectWalletName:C=gn.OKX_INJECT_WALLET;break}var R=this.connectors.find(Re=>Re.getTag()===C);if(!R)throw new sr.OKXConnectError(sr.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR);let Fe=Object.assign({topic:u.channelId,sessionConfig:t,namespaces:Q},j.payload&&{wallet:Object.assign(Object.assign({},j.payload.wallet),{walletName:le})}),$e=j.payload.responses.find(Re=>Re.name==="requestAccounts");$e&&$e.connectRequestMethods&&(Fe.signResponse=$e.connectRequestMethods),(0,te.logDebug)("engin  universalConnect success session:>>>",JSON.stringify(Fe)),this.isWsConnector(R)&&((0,te.logDebug)("engine update protocol version"),this.connectionManager.updateProtocolVersion(u.channelId,j.payload.wallet.maxProtocolVersion)),this.deviceInfo=Object.assign({},Fe.wallet),o(Fe),this.setUseConnector(R),(0,te.reportEvent)(te.OKXReportType.PAGE_IN,te.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View,C)}else throw new sr.OKXConnectError(sr.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR)}else if(j.method=="connect_error"&&((ne=j.payload)===null||ne===void 0?void 0:ne.code)!=null)throw new sr.OKXConnectError(j.payload.code)}catch(j){i(j)}}),this.hasWsConnector()){yield(a=this.connectionManager)===null||a===void 0?void 0:a.disconnect(!1);try{yield this.connectionManager.connect()}catch(S){throw(0,te.logDebug)("Engine universalConnect error",S),S}(0,te.logDebug)("engin  universalConnect ==>> connectInfoAndUrl:",r),this.sendSession(D)}if(!V&&y&&J(),(0,te.logDebug)("engin  universalConnect ==>> connectInfoAndUrl:",r),r){let S={connectRequest:X,redirect:t.redirect,tmaReturnUrl:t.tmaReturnUrl};(0,te.logDebug)("universalConnect connectInfoAndUrl info :",JSON.stringify(S)),r(S)}}catch(c){(0,te.logDebug)("Engine universalConnect catch error",c),i(c)}}))})}fixDappName(e){try{if(e.name.toLowerCase()==="dapp portal"){let t=document.title;if(t||(t=this.getOGSiteName()),t)return Object.assign(Object.assign({},e),{name:e.name+" - "+t})}return e}catch{return e}}getOGSiteName(){let e=document.getElementsByTagName("meta"),t=["og:site_name","og:title","twitter:title"];for(let r of e){let o=r.getAttribute("property");for(let i of t)if(o==i)return r.getAttribute("content")}}addOnConnectResultListener(e){for(let t of this.connectors)this.isInjectedConnector(t)&&t.setOnConnectResultListener(e);this.connectResultListener=e}openWallet(e,t,r){var o;t?t.openWallet(e,r):(o=this.getConnector())===null||o===void 0||o.openWallet(e,r)}send(e,t,r){return ir(this,void 0,void 0,function*(){var o,i,s,l,p,f,a,c,u;let _;"chainId"in e&&e.chainId!=null&&(_=e.chainId.toString());try{(0,te.reportEvent)(te.OKXReportType.LOG,te.Report_OKXConnectSDK_RequestStart_Log,"",(i=(o=this.getConnector())===null||o===void 0?void 0:o.getTag())!==null&&i!==void 0?i:"",e.method,(l=(s=this.deviceInfo)===null||s===void 0?void 0:s.platform)!==null&&l!==void 0?l:"",_),(p=this.getConnector())===null||p===void 0||p.send(e,{resolve:y=>{var I,X,D,T,U,J,V,S,B;(I=t?.resolve)===null||I===void 0||I.call(t,y),"error"in y&&y.error?(0,te.reportEvent)(te.OKXReportType.LOG,te.Report_OKXConnectSDK_RequestError_Log,"",(D=(X=this.getConnector())===null||X===void 0?void 0:X.getTag())!==null&&D!==void 0?D:"",e.method,(U=(T=this.deviceInfo)===null||T===void 0?void 0:T.platform)!==null&&U!==void 0?U:"",_):(0,te.reportEvent)(te.OKXReportType.LOG,te.Report_OKXConnectSDK_RequestSuccess_Log,"",(V=(J=this.getConnector())===null||J===void 0?void 0:J.getTag())!==null&&V!==void 0?V:"",e.method,(B=(S=this.deviceInfo)===null||S===void 0?void 0:S.platform)!==null&&B!==void 0?B:"",_)},onAck:()=>{var y;(y=t?.onAck)===null||y===void 0||y.call(t)}})}catch(y){throw(0,te.reportEvent)(te.OKXReportType.LOG,te.Report_OKXConnectSDK_RequestError_Log,"",(a=(f=this.getConnector())===null||f===void 0?void 0:f.getTag())!==null&&a!==void 0?a:"",e.method,(u=(c=this.deviceInfo)===null||c===void 0?void 0:c.platform)!==null&&u!==void 0?u:"",_),y}})}clearData(){var e;(e=this.getConnector())===null||e===void 0||e.clearData()}addDisconnectListener(e){var t;(t=this.getConnector())===null||t===void 0||t.addDisconnectListener(e)}saveSessionContent(e,t){this.connectionManager.saveSessionContent(e,t)}getSessionContent(e){var t,r=this.connectionManager.getSessionContent(e);if(r){var o="";if(typeof r=="object"&&(o=(0,gn.getTagByappName)((t=r.wallet)===null||t===void 0?void 0:t.appName)),this.connectors.find(i=>i.getTag()===o))return r}}setConnectConnector(e){var t=(0,gn.getTagByappName)(e?.appName);!t||this.setUseConnector(this.connectors.find(r=>r.getTag()===t))}setUseConnector(e){this.useConnector=e,this.isWsConnector(e)&&e.addConnectionListener()}setSessionConnectingListener(e){this.sessionConnectingListener=e}restoreconnect(e,t){return ir(this,void 0,void 0,function*(){var r;yield(r=this.getConnector())===null||r===void 0?void 0:r.restoreconnect(e,o=>{var i,s;t(o),o&&(this.deviceInfo=Object.assign({},o.wallet),(0,te.reportEvent)(te.OKXReportType.PAGE_IN,te.Report_OKXConnectSDKExtension_ConnectDapp_ConnectSuccess_View,(s=(i=this.getConnector())===null||i===void 0?void 0:i.getTag())!==null&&s!==void 0?s:""))})})}restoreconnectFromTopic(e){return ir(this,void 0,void 0,function*(){this.isWsConnector(this.getConnector())&&(yield this.getConnector().restoreconnectFromTopic(e))})}getCurrentConnectionReady(e){var t;return!!(!((t=this.getConnector())===null||t===void 0)&&t.getCurrentConnectionReady(e))}connectManagerDisconnect(){return ir(this,arguments,void 0,function*(e=!1){var t;yield(t=this.getConnector())===null||t===void 0?void 0:t.connectManagerDisconnect(e)})}sendSession(e){return ir(this,void 0,void 0,function*(){(0,te.logDebug)("[Connect] sendSession called:",e);let t=Date.now().toString(),r={method:"session_info",params:{protocolVersion:ky.CONNECT_PROTOCOL_VER,sessionInfo:e}};yield this.connectionManager.sendRaw(JSON.stringify(Object.assign(Object.assign({},r),{requestId:t})))})}addConnectionListener(){var e;(e=this.connectionManager)===null||e===void 0||e.addListener("sdk_response",(t,r)=>{var o=(0,te.safeJsonParse)(r);(0,te.logDebug)(`Engine ==>> addListener ==> success ==> ${o}`),o.method==="connect"||o.method==="connect_error"?this.connectResultListener&&this.connectResultListener(o):o.method==="session_connecting"&&((0,te.logDebug)("Engine ==>> handleResponse_4  ===> sessionConnectingListener"),this.sessionConnectingListener&&((0,te.logDebug)("Engine ==>> handleResponse_4  ===> sessionConnectingListener not null"),this.sessionConnectingListener(),this.sessionConnectingListener=void 0))},function(){})}};zr.Engine=rc});var Df=H(Mt=>{"use strict";g();m();Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Storage=Mt.Engine=Mt.WalletConnectionManager=Mt.ConnectionManager=Mt.OKXWalletConnector=void 0;var xy=Ui();Object.defineProperty(Mt,"OKXWalletConnector",{enumerable:!0,get:function(){return xy.OKXWalletConnector}});var My=Za();Object.defineProperty(Mt,"ConnectionManager",{enumerable:!0,get:function(){return My.ConnectionManager}});var Wy=wf();Object.defineProperty(Mt,"WalletConnectionManager",{enumerable:!0,get:function(){return Wy.WalletConnectionManager}});var jy=Rf();Object.defineProperty(Mt,"Engine",{enumerable:!0,get:function(){return jy.Engine}});var Uy=Io();Object.defineProperty(Mt,"Storage",{enumerable:!0,get:function(){return Uy.Storage}})});var kn=H(at=>{"use strict";g();m();Object.defineProperty(at,"__esModule",{value:!0});at.BtcMethods=at.SuiMethods=at.TONMethods=at.AptosMethods=at.SOLANAMethods=at.Eip55Methods=void 0;at.hasOKXInjectedProvider=By;function By(){return typeof Xy("okxwallet")<"u"}function Xy(n){let e=(t,r)=>{let[o,...i]=r.split("."),s=t[o];if(s)return i.length===0?s:e(s,i.join("."))};if(typeof window<"u")return e(window,n)}at.Eip55Methods=["personal_sign","eth_signTypedData_v4","eth_sendTransaction","wallet_addEthereumChain","wallet_watchAsset","wallet_switchEthereumChain","eth_requestAccounts","eth_accounts","eth_chainId"];at.SOLANAMethods=["solana_signTransaction","solana_signMessage","solana_signAllTransactions","solana_signAndSendTransaction"];at.AptosMethods=["aptos_signMessage","aptos_signTransaction","aptos_signAndSubmitTransaction"];at.TONMethods=["ton_sendTransaction"];at.SuiMethods=["sui_signMessage","sui_signPersonalMessage","sui_signTransactionBlock","sui_signAndExecuteTransactionBlock"];at.BtcMethods=["btc_signMessage","btc_signPsbts","btc_send","btc_sendInscription","btc_signAndPushPsbt","btc_inscribeTransfer","btc_sendRunes"]});var mn=H(Je=>{"use strict";g();m();Object.defineProperty(Je,"__esModule",{value:!0});Je.mediaNotTouch=Je.mediaTouch=Je.maxWidth=void 0;Je.isDevice=Fy;Je.media=$y;Je.mediaMin=Vy;Je.mediaMax=Gy;Je.mediaMinMax=Yy;var Hy=_i(),qy=vo(),If=Pr(),Jy=je();Je.maxWidth={mobile:440,tablet:1020};function Fy(n){var e;let t=(0,If.getWindow)();if(!t)return n==="desktop";if((0,qy.isTmaPlatform)("weba"))return!0;let r=t.innerWidth;switch(n){case"desktop":return r>Je.maxWidth.tablet;case"tablet":return r>Je.maxWidth.mobile;default:case"mobile":let o=r<=Je.maxWidth.mobile||(0,Hy.isOS)("ios","android","ipad");if(o){let i=!!(!((e=(0,If.getWindow)())===null||e===void 0)&&e.TelegramWebviewProxy),s=navigator.maxTouchPoints||0;i&&s===0&&(o=!1),(0,Jy.logDebug)("isDevice mobile isTelegram and maxTouchPoints:",o,i,s)}return o}}function $y(n){switch(n){case"mobile":return`@media (max-width: ${Je.maxWidth.mobile}px)`;case"tablet":return`@media (max-width: ${Je.maxWidth.tablet}px) (min-width: ${Je.maxWidth.mobile}px)`;default:case"desktop":return`@media (min-width: ${Je.maxWidth.tablet}px)`}}function Vy(n){return`@media (min-width: ${n}px)`}function Gy(n){return`@media (max-width: ${n}px)`}function Yy(n,e){return`@media (min-width: ${n}px) and (max-width: ${e}px)`}Je.mediaTouch="@media (hover: none)";Je.mediaNotTouch="@media not all and (hover: none)"});var Af=H(Qr=>{"use strict";g();m();var oc=Qr&&Qr.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.Eip155Provider=void 0;var Xi=ze(),Et=Qe(),zy=mn(),Qy=kn(),ic=class{constructor(){this.accountChangedEVMHandler=null}send(e){return oc(this,void 0,void 0,function*(){var t;try{(0,Et.logDebug)("Eip155Provider send request:",(0,Et.safeJsonStringify)(e)),yield this.restoreConnect();let r=null;switch(e.method){case"personal_sign":e.params&&"message"in e.params&&(r={method:e.method,params:[e.params.message,e.address]});break;case"eth_sendTransaction":case"wallet_addEthereumChain":case"wallet_switchEthereumChain":e.params&&(r={method:e.method,params:[e.params]});break;case"eth_signTypedData_v4":e.params&&"typedDataJson"in e.params&&((t=e.params)===null||t===void 0?void 0:t.typedDataJson)&&typeof e.params.typedDataJson=="string"&&(r={method:e.method,params:[e.address,e.params.typedDataJson]});break;case"wallet_watchAsset":e.params&&(r={method:e.method,params:e.params});break;default:r={method:e.method,params:e.injectParams}}if(r)if((e.method==="wallet_switchEthereumChain"||e.method==="wallet_addEthereumChain")&&e.params&&"chainId"in e.params){(0,Et.logDebug)("Eip155Provider send request switch requestParams:",(0,Et.safeJsonStringify)(r));let o=parseInt(e.params.chainId,16).toString();yield window.okxwallet.request(r);let i=`eip155:${o}:${e.address}`;return(0,Et.logDebug)("Eip155Provider send request switch result:",i),{result:i,method:e.method}}else{let o=(0,Et.getChainId)(e.chainId),i=`0x${Number(o).toString(16)}`;if((0,Et.logDebug)("Eip155Provider current chainId:",o,i),i){yield window.okxwallet.request({method:"wallet_switchEthereumChain",params:[{chainId:i}]}),(0,Et.logDebug)("Eip155Provider send request requestParams:",i,(0,Et.safeJsonStringify)(r));let s=yield window.okxwallet.request(r);return(0,Et.logDebug)("Eip155Provider send request result:",(0,Et.safeJsonStringify)(s)),{result:s,method:e.method}}}else throw new Xi.OKXConnectError(Xi.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED)}catch(r){throw(0,Et.logDebug)("Eip155Provider encountered an error:",r),r}})}connectReady(){return!0}restoreConnect(){return(0,zy.isDevice)("mobile")?window.okxwallet.request({method:"eth_requestAccounts"}):Promise.resolve()}parseConnectResponse(e,t,r,o,i,s){return oc(this,void 0,void 0,function*(){try{let l=[];o.forEach(a=>{a.namespace===Xi.NameSpaceKeyEip155&&l.push(...a.chains)});let p=[],f={};return l.forEach(a=>{let c=(0,Et.getChainId)(a),u=i.address.find(_=>_.chainId===c&&_.coinType===60||_.namespaceChainId===a);u&&(p.push(a+":"+u.address),f[a]={publicKey:u.publicKey})}),p&&p.length>0?{namespace:Xi.NameSpaceKeyEip155,addresses:p,methods:[...Qy.Eip55Methods],extra:f}:void 0}catch(l){throw l}})}connect(){return oc(this,void 0,void 0,function*(){return window.okxwallet.request({method:"eth_requestAccounts"})})}singleConnect(){return this.connect()}addListener(e){console.log("window.okxwallet configEventWithKey: eip155"),this.accountChangedEVMHandler=t=>{console.log("window.okxwallet configEventWithKey_evm:",Date.now(),"eip155",t),t&&t.length>0&&e()},window.okxwallet.on("accountsChanged",this.accountChangedEVMHandler)}removeListener(){this.accountChangedEVMHandler&&window.okxwallet.removeListener("accountsChanged",this.accountChangedEVMHandler)}};Qr.Eip155Provider=ic});var Pf=H(ar=>{"use strict";g();m();var Zy=ar&&ar.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),ev=ar&&ar.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Zy(e,n,t)};Object.defineProperty(ar,"__esModule",{value:!0});ev(Af(),ar)});var sc=H(Kn=>{"use strict";g();m();var tv=Kn&&Kn.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),kf=Kn&&Kn.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&tv(e,n,t)};Object.defineProperty(Kn,"__esModule",{value:!0});kf(kn(),Kn);kf(Pf(),Kn)});var qi=H(Zr=>{"use strict";g();m();var Hi=Zr&&Zr.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.WsConnector=void 0;var ac=Sn(),_n=je(),cc=class{constructor(){this.disconnectListener=[],this.walletName="",this.walletNameKey="",this.enable=!0,this.pendingRequests=new Map,(0,_n.getDefaultReporter)().beginReport()}setAccountChangeListener(e){this.accountChangeListener=e}setConnectionManager(e){this.connectionManager=e}addConnectionListener(){var e;(e=this.connectionManager)===null||e===void 0||e.addListener("sdk_response",(t,r)=>{var o=(0,ac.safeJsonParse)(r);(0,_n.logDebug)(`Engine ==>> addListener ==> success ==> ${o}`),this.handleResponse(t,o)},function(){})}addDisconnectListener(e){this.disconnectListener.push(e)}connectManagerDisconnect(){return Hi(this,arguments,void 0,function*(e=!1){var t;yield(t=this.connectionManager)===null||t===void 0?void 0:t.disconnect(e)})}openWallet(e,t){}bindRequestForPromise(e,t){this.pendingRequests.set(e,t)}send(e,t,r){return Hi(this,void 0,void 0,function*(){var o,i;try{delete e.injectParams}catch{}(0,_n.logDebug)("Engine ==>> send  request==>",JSON.stringify(e));let s=this.getRequestId();try{let l=yield(o=this.connectionManager)===null||o===void 0?void 0:o.send(JSON.stringify(Object.assign(Object.assign({},e),{requestId:s})),r);l&&((i=this.connectionManager)===null||i===void 0||i.events.once(l.toString(),p=>{var f;(0,_n.logDebug)(`Engine ==> send => onAck => ${(0,ac.safeJsonStringify)(p)}`),p&&p.result&&((f=t.onAck)===null||f===void 0||f.call(t))})),t.resolve&&this.bindRequestForPromise(s,t.resolve)}catch(l){return Promise.reject(l)}})}restoreconnect(e,t){return Hi(this,void 0,void 0,function*(){var r;yield(r=this.connectionManager)===null||r===void 0?void 0:r.restoreConnect(e.topic),t(e)})}restoreconnectFromTopic(e){return Hi(this,void 0,void 0,function*(){var t;yield(t=this.connectionManager)===null||t===void 0?void 0:t.restoreConnect(e)})}getRequestId(){let e=Date.now().toString();return(0,_n.logDebug)("Engine ==>> getRequestId ==>",e),e}handleResponse(e,t){if((0,_n.logDebug)(`Engine ==>> handleResponse_1  ======>response: ${(0,ac.safeJsonStringify)(t)}`,e),"requestId"in t){(0,_n.logDebug)("Engine ==>> handleResponse_2  ===> in response");let r=t.requestId,o=this.pendingRequests.get(r);o?((0,_n.logDebug)("Engine ==>> handleResponse_3  ===> find resolve:",o),o(t),this.pendingRequests.delete(r)):((0,_n.logDebug)("Engine ==>> handleResponse_3  ===> not find resolve:"),t.method==="disconnect"&&(this.disconnectListener.forEach(i=>i()),this.disconnectListener=[],this.clearData()))}}getCurrentConnectionReady(){var e;return!!(!((e=this.connectionManager)===null||e===void 0)&&e.getCurrentConnectionReady())}saveSessionContent(e,t){var r;(r=this.connectionManager)===null||r===void 0||r.saveSessionContent(e,t)}getSessionContent(e){var t;return(t=this.connectionManager)===null||t===void 0?void 0:t.getSessionContent(e)}setOnConnectResultListener(e){this.connectResultListener=e}getTag(){return""}toJSON(){return"ws-connector"}clearData(){this.pendingRequests.clear()}};Zr.WsConnector=cc});var Kf=H(Ji=>{"use strict";g();m();Object.defineProperty(Ji,"__esModule",{value:!0});Ji.AppwalletConnector=void 0;var nv=qi(),rv=Yr(),cr=Qe(),lc=li(),ov=ze(),uc=class extends nv.WsConnector{constructor(){super(),this.walletName="OKX App",this.walletNameKey="walletModal.mobileConnectionModal.connectApp"}getTag(){return rv.OKX_APP_WALLET}openWallet(e,t){var r;let o=t??ov.OpenAppLinkType.UniversalLink;if(e&&e.connectRequest){(0,cr.logDebug)(`appwallet-connector openwallet before useSHortLink engineConnectInfo.connectRequest JSON ${JSON.stringify(e)}`);let i=e.connectRequest;(0,cr.useShortLink)()||(i=Object.assign(Object.assign({},e.connectRequest),{redirect:(r=e.redirect)!==null&&r!==void 0?r:"none"}));let{universalLink:s,deepLink:l}=(0,cr.getOKXLink)(i);(0,cr.openOKXDeeplinkWithFallback)(l,s,o)}else(0,cr.isOS)("android")?(0,cr.openDeeplinkWithFallback)(lc.stackDeepLink,()=>{}):(0,cr.openOKXDeeplinkWithFallback)(lc.standardDeeplink,lc.shortUniversalLink,o)}};Ji.AppwalletConnector=uc});var Lf=H(xn=>{"use strict";g();m();var dc=xn&&xn.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})},iv=xn&&xn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(xn,"__esModule",{value:!0});xn.SolProvider=void 0;var Ln=ze(),Ft=Qe(),sv=iv(mh()),av=mn(),cv=kn(),fc=class{constructor(){this.accountChangedSolanaPublicKeyHandler=null}send(e){return dc(this,void 0,void 0,function*(){var t;try{yield this.restoreConnect(),(0,Ft.logDebug)("SolProvider send request:",JSON.stringify(e));let i=e.method,s;if(e.injectParams)switch(i){case"solana_signMessage":if(e.injectParams&&typeof e.injectParams=="object"&&"message"in e.injectParams){var r=(t=e.injectParams)===null||t===void 0?void 0:t.message;let l=new TextEncoder().encode(r),p=yield window.okxwallet.solana.signMessage(l,"utf8");return s={method:e.method,result:sv.default.encode(p.signature)},(0,Ft.logDebug)("SolProvider send result:",JSON.stringify(p)),s}else throw new Ln.OKXConnectError(Ln.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${i}'`);break;case"solana_signTransaction":{let l=yield window.okxwallet.solana.signTransaction(e.injectParams);return(0,Ft.logDebug)("SolProvider send bufferResult:",JSON.stringify(l)),s={method:e.method,injectResult:l},(0,Ft.logDebug)("SolProvider send result:",(0,Ft.safeJsonStringify)(s)),s}break;case"solana_signAllTransactions":{let l=yield window.okxwallet.solana.signAllTransactions(e.injectParams);return(0,Ft.logDebug)("SolProvider send result:",(0,Ft.safeJsonStringify)(l)),s={method:e.method,injectResult:l},s}break;case"solana_signAndSendTransaction":{var o=yield window.okxwallet.solana.signAndSendTransaction(e.injectParams);return(0,Ft.logDebug)("SolProvider send result:",(0,Ft.safeJsonStringify)(o)),s={method:e.method,injectResult:o},s}break;default:throw new Ln.OKXConnectError(Ln.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,`method: '${i}'`)}else throw new Ln.OKXConnectError(Ln.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${i}'`)}catch(i){throw(0,Ft.logDebug)("SolProvider send error:",i),i}})}connectReady(){return!0}disconnect(){}restoreConnect(){return(0,av.isDevice)("mobile")?this.connect():Promise.resolve()}parseConnectResponse(e,t,r,o,i,s){return dc(this,void 0,void 0,function*(){let l=[];o.forEach(c=>{c.namespace===Ln.NameSpaceKeySOL&&l.push(...c.chains)});let p=[],f={},a={};if(l.forEach(c=>{let u=i.address.find(_=>_.chainId==="501"&&_.coinType===501||_.namespaceChainId===c);u&&(p.push(c+":"+u.address),a&&"publicKey"in a?f[c]=a:f[c]={publicKey:u.publicKey})}),p&&p.length>0){let c={namespace:Ln.NameSpaceKeySOL,addresses:p,methods:[...cv.SOLANAMethods],extra:f};return(0,Ft.logDebug)("parseConnectResponse nameSpaceResponse :",JSON.stringify(c)),c}})}connect(){return dc(this,void 0,void 0,function*(){return window.okxwallet.solana.connect()})}singleConnect(){return this.connect()}addListener(e){console.log("window.okxwallet configEventWithKey:","sol"),this.accountChangedSolanaPublicKeyHandler=t=>{console.log("window.okxwallet configEventWithKey_solana:",Date.now(),"sol",t),t&&e()},window.okxwallet.solana.on("accountChanged",this.accountChangedSolanaPublicKeyHandler)}removeListener(){this.accountChangedSolanaPublicKeyHandler&&window.okxwallet.solana.removeListener("accountChanged",this.accountChangedSolanaPublicKeyHandler)}};xn.SolProvider=fc});var Mf=H(eo=>{"use strict";g();m();var pc=eo&&eo.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(eo,"__esModule",{value:!0});eo.AptosProvider=void 0;var Mn=ze(),ht=Qe(),lv=kn(),xf=mn(),uv=wi(),dv=Object.freeze(["637","70000060","70000066"]),Fi=new Map;Fi.set("aptos:637","Mainnet");Fi.set("aptos:70000060","Movement Testnet");Fi.set("aptos:70000066","Movement Mainnet");var hc=class{send(e){return pc(this,void 0,void 0,function*(){try{(0,ht.logDebug)("AptosProvider send request:",(0,ht.safeJsonStringify)(e)),yield this.restoreConnect();let t=yield window.okxwallet.aptos.network(),r=this.searchChainIdToInjectChainName(e.chainId);if((0,ht.logDebug)("AptosProvider send network and searchNetwork:",t,"-----",r),!(t&&r&&t.toLowerCase()===r.toLowerCase()))throw new Mn.OKXConnectError(Mn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Please switch your wallet link to '${r}'`);let o=e.method,i;switch(o){case"aptos_signMessage":if(e.injectParams){let s=yield window.okxwallet.aptos.signMessage(e.injectParams);return i={method:e.method,result:s.signature,injectResult:s},(0,ht.logDebug)("AptosProvider send result:",(0,ht.safeJsonStringify)(i)),i}else throw new Mn.OKXConnectError(Mn.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`param is error method: '${o}'`);break;case"aptos_signTransaction":{(0,ht.logDebug)("AptosProvider Method>>>> :",o);let s=yield window.okxwallet.aptos.signTransaction(e.params);return i={method:e.method,result:s},(0,ht.logDebug)("AptosProvider send result:",(0,ht.safeJsonStringify)(i)),i}break;case"aptos_signAndSubmitTransaction":{(0,ht.logDebug)("AptosProvider Method>>>> :",o);let s=yield window.okxwallet.aptos.signAndSubmitTransaction(e.params);return i={method:e.method,result:s.hash},(0,ht.logDebug)("AptosProvider send result:",(0,ht.safeJsonStringify)(i)),i}break;default:throw new Mn.OKXConnectError(Mn.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,` method: '${o}'`)}}catch(t){throw(0,ht.logDebug)("AptosProvider send error:",t),t}})}searchChainIdToInjectChainName(e){let t=e;return Fi.forEach((r,o)=>{e.includes(o)&&(t=r)}),t}connectReady(){return!0}disconnect(){}restoreConnect(){return(0,xf.isDevice)("mobile")?this.connect():Promise.resolve()}parseConnectResponse(e,t,r,o,i,s){return pc(this,void 0,void 0,function*(){let l=[];o.forEach(c=>{c.namespace===Mn.NameSpaceKeyAptos&&l.push(...c.chains)});let p=[],f={};(0,ht.logDebug)("AptosProvider parseConnectResponse connectChain",JSON.stringify(l));let a;if(!(0,xf.isDevice)("mobile")&&l&&l.length>0&&(a=(yield window.okxwallet.aptos.connect()).publicKey),l.forEach(c=>{let u=i.address.find(_=>dv.includes(_.chainId)&&_.coinType===637||_.namespaceChainId===c);u&&(p.push(c+":"+u.address),f[c]={publicKey:u.publicKey?u.publicKey:a})}),(0,ht.logDebug)("AptosProvider parseConnectResponse addresses",JSON.stringify(p)),p&&p.length>0)return{namespace:Mn.NameSpaceKeyAptos,addresses:p,methods:[...lv.AptosMethods],extra:f}})}connect(){return pc(this,void 0,void 0,function*(){return window.okxwallet.aptos.connect()})}singleConnect(){return this.connect()}addListener(e){window.okxwallet.aptos.onAccountChange(t=>{console.log("window.okxwallet configEventWithKey_aptos:",Date.now(),uv.key,JSON.stringify(t)),t&&e()})}removeListener(){}};eo.AptosProvider=hc});var Wf=H(to=>{"use strict";g();m();var gc=to&&to.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(to,"__esModule",{value:!0});to.TONProvider=void 0;var ct=ze(),it=Qe(),fv=mn(),pv=kn(),mc=class{constructor(){this.signalChainConnectResult=void 0,this.accountChangedTONHandler=null}send(e){return gc(this,void 0,void 0,function*(){try{(0,it.logDebug)("TONProvider send request:",(0,it.safeJsonStringify)(e));let t=null;switch(e.method){case"ton_sendTransaction":e.params&&(t={method:"sendTransaction",params:[JSON.stringify(e.params)],id:Date.now().toString()},(0,it.logDebug)("TONProvider tonParams first:",JSON.stringify(t)));break;default:throw new ct.OKXConnectError(ct.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED)}if(t){let r=yield window.okxTonWallet.tonconnect.send(t);if((0,it.logDebug)("TONProvider send request result:",(0,it.safeJsonStringify)(r)),r.error)throw new ct.OKXConnectError(r.error.code,r.error.message);return{result:r.result,method:e.method}}else throw new ct.OKXConnectError(ct.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED)}catch(t){throw(0,it.logDebug)("TONProvider encountered an error:",t),t}})}connectReady(){return!0}restoreConnect(){return Promise.resolve()}parseConnectResponse(e,t,r,o,i,s){return gc(this,void 0,void 0,function*(){try{let l=[];o.forEach(a=>{a.namespace===ct.NameSpaceKeyTON&&l.push(...a.chains)});let p=[],f={};if(l.forEach(a=>{let c=(0,it.getChainId)(a),u=i.address.find(_=>_.chainId==="607"&&_.coinType===607||_.namespaceChainId===a);u&&(p.push(a+":"+u.address),f[a]={publicKey:u.publicKey})}),(0,it.logDebug)("tonprovider parseConnectResponse needPop and addresses: ",e,JSON.stringify(p)),p&&p.length>0){let a=o.find(u=>u.namespace===ct.NameSpaceKeyTON);(0,it.logDebug)("tonprovider parseConnectResponse ton: ",JSON.stringify(a));let c;if(a&&a.params&&s&&s.manifestUrl){this.dappInfo=s;let u=[a.params.ton_addr],_={manifestUrl:s.manifestUrl,items:u};(e||t)&&a.params.ton_proof&&u.push(a.params.ton_proof),(0,it.logDebug)("parseConnectResponse ton connect params: ",JSON.stringify(_)),(0,fv.isDevice)("mobile")?c=yield window.okxTonWallet.tonconnect.connect(2,_):e||t?c=yield window.okxTonWallet.tonconnect.connect(2,_):c=yield window.okxTonWallet.tonconnect.restoreConnection()}else throw new ct.OKXConnectError(ct.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"manifestUrl is nil");if(r&&this.signalChainConnectResult&&(c=this.signalChainConnectResult,this.signalChainConnectResult=void 0),(0,it.logDebug)("parseConnectResponse ton connect result: ",JSON.stringify(c)),c&&a){if(c.event==="connect_error")throw new ct.OKXConnectError(c.payload.code,c.payload.message);{let u=c.payload.items.find(I=>I.name==="ton_addr"),_=c.payload.items.find(I=>I.name==="ton_proof");return(0,it.logDebug)("tonprovider connect isSignalChain: ",r),{namespace:ct.NameSpaceKeyTON,addresses:p,methods:[...pv.TONMethods],extra:f,data:{ton_addr:u,ton_proof:_,manifestUrl:s.manifestUrl}}}}}return}catch(l){throw(0,it.logDebug)("tonprovider parseConnectResponse error: ",JSON.stringify(l)),l}})}connect(e,t){return gc(this,void 0,void 0,function*(){if(e&&t&&t.manifestUrl&&e.params){this.dappInfo=t;let r=[e.params.ton_addr],o={manifestUrl:t.manifestUrl,items:r};e.params.ton_proof&&r.push(e.params.ton_proof),(0,it.logDebug)("tonprovider connect params: ",JSON.stringify(o));try{let i=yield window.okxTonWallet.tonconnect.connect(2,o);return(0,it.logDebug)("tonprovider connect tonResult: ",JSON.stringify(i)),this.signalChainConnectResult=i,i}catch(i){throw(0,it.logDebug)("tonprovider connect error: ",JSON.stringify(i)),new ct.OKXConnectError(ct.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"tonconnect error")}}else throw new ct.OKXConnectError(ct.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"manifestUrl or params is nil")})}singleConnect(e,t){return this.connect(e,t)}addListener(e){console.log("window.okxwallet configEventWithKey:","ton"),this.accountChangedTONHandler=()=>{console.log("window.okxwallet configEventWithKey_TON:",Date.now(),"ton"),e()},window.okxTonWallet.tonconnect.on("accountChanged",this.accountChangedTONHandler)}removeListener(){this.accountChangedTONHandler&&window.okxTonWallet.tonconnect.off("accountChanged",this.accountChangedTONHandler)}};to.TONProvider=mc});var Uf=H(no=>{"use strict";g();m();var $i=no&&no.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(no,"__esModule",{value:!0});no.SuiProvider=void 0;var jf=ze(),_c=Qe(),hv=mn(),gv=kn(),yc=class{constructor(){this.accountChangedHandler=null}connectReady(){return!0}getSuiPublicKey(){return $i(this,void 0,void 0,function*(){return(yield this.connect()).accounts[0].publicKey})}parseConnectResponse(e,t,r,o,i,s){return $i(this,void 0,void 0,function*(){try{let l=[];o.forEach(c=>{c.namespace===jf.NameSpaceKeySui&&l.push(...c.chains)});let p=[],f={};if(l.length==0)return;let a=yield this.getSuiPublicKey();return l.forEach(c=>{var u;let _=(0,_c.getChainId)(c),y=i.address.find(I=>I.coinType===784||I.namespaceChainId===c);y&&(p.push(c+":"+y.address),f[c]={publicKey:(u=y.publicKey)!==null&&u!==void 0?u:a})}),p&&p.length>0?{namespace:jf.NameSpaceKeySui,addresses:p,methods:[...gv.SuiMethods],extra:f}:void 0}catch(l){throw l}})}restoreConnect(){return(0,hv.isDevice)("mobile")?this.connect():Promise.resolve()}getSuiWallet(){return window.okxwallet.sui}send(e){return $i(this,void 0,void 0,function*(){try{yield this.restoreConnect(),(0,_c.logDebug)("suiProvider send request:",JSON.stringify(e));let t=e.method,r;if(e.injectParams&&this.getSuiWallet()){let o=e.injectParams;switch(t){case"sui_signTransactionBlock":r={method:"sui_signTransactionBlock",result:(yield this.getSuiWallet().features["sui:signTransactionBlock"].signTransactionBlock(o)).signature};break;case"sui_signAndExecuteTransactionBlock":r={method:"sui_signAndExecuteTransactionBlock",result:(yield this.getSuiWallet().features["sui:signAndExecuteTransactionBlock"].signAndExecuteTransactionBlock(o)).digest};break;case"sui_signMessage":r={method:"sui_signMessage",result:(yield this.getSuiWallet().features["sui:signMessage"].signMessage(o)).signature};break;case"sui_signPersonalMessage":r={method:"sui_signPersonalMessage",result:(yield this.getSuiWallet().features["sui:signPersonalMessage"].signPersonalMessage(o)).signature};break}}return r}catch(t){throw(0,_c.logDebug)("suiProvider send error:",t),t}})}connect(){return $i(this,void 0,void 0,function*(){var e;return(e=this.getSuiWallet())===null||e===void 0?void 0:e.features["standard:connect"].connect()})}singleConnect(){return this.connect()}addListener(e){console.log("window.okxwallet configEventWithKey:","sui"),this.accountChangedHandler=t=>{console.log("window.okxwallet configEventWithKey_sui:",Date.now(),"sui",t),t&&e()},window.okxwallet.sui.on("accountChanged",this.accountChangedHandler)}removeListener(){this.accountChangedHandler&&window.okxwallet.sui.removeListener("accountChanged",this.accountChangedHandler)}};no.SuiProvider=yc});var Bf=H(oo=>{"use strict";g();m();var ro=oo&&oo.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(oo,"__esModule",{value:!0});oo.BtcProvider=void 0;var sn=ze(),Vi=Qe(),mv=kn(),_v=mn(),vc=class{constructor(){this.accountChangedBtcHandler=null}connect(){return window.okxwallet.unisat.connect()}switchChain(e){return ro(this,void 0,void 0,function*(){let t=window.okxwallet.unisat;switch(e){case sn.BTC_CHAINS.MAINNET:yield t.switchChain("BITCOIN_MAINNET");break;case sn.BTC_CHAINS.FRACTAL:yield t.switchChain("FRACTAL_BITCOIN_MAINNET");break}})}connectReady(){return!0}parseConnectResponse(e,t,r,o,i){return ro(this,void 0,void 0,function*(){try{let s=[];o.forEach(u=>{u.namespace===sn.NameSpaceKeyBtc&&s.push(...u.chains)});let l=[],p={};if(s.length==0)return;let f=(u,_)=>u.find(y=>{let I=y.name==="bitcoin"&&_===sn.BTC_CHAINS.MAINNET||y.name==="fractalbitcoin"&&_===sn.BTC_CHAINS.FRACTAL;return y.coinType===0&&I||y.namespaceChainId===_}),a=u=>ro(this,void 0,void 0,function*(){let _=f(i.address,u);if(!_)return;l.push(u+":"+_.address);let y=yield this.connect();p[u]={publicKey:y.publicKey,compressedPublicKey:y.compressedPublicKey}}),c=s.map(a);return yield Promise.all(c),l&&l.length>0?{namespace:sn.NameSpaceKeyBtc,addresses:l,methods:[...mv.BtcMethods],extra:p}:void 0}catch(s){throw s}})}restoreConnect(){return ro(this,void 0,void 0,function*(){return(0,_v.isDevice)("mobile")?this.connect():Promise.resolve()})}send(e){return ro(this,void 0,void 0,function*(){try{(0,Vi.logDebug)("btcProvider send request:",JSON.stringify(e));let t=e.method,r=e.chainId;yield this.restoreConnect(),yield this.switchChain(r);let o;if(e.params)switch(t){case"btc_signMessage":{let{signStr:i,type:s}=e.params||{},l=yield window.okxwallet.unisat.signMessage(i,s);return{method:e.method,result:l}}case"btc_send":{let{from:i,to:s,value:l,satBytes:p}=e.params||{},f=yield window.okxwallet.unisat.send({from:i,to:s,value:l,satBytes:p});return{method:e.method,result:f}}case"btc_signPsbts":{let{psbtHexs:i,options:s}=e.params||{},l;if(Array.isArray(i)&&i.length===1){let p;Array.isArray(s)?p=yield window.okxwallet.unisat.signPsbt(i[0],s.length>0&&typeof s[0]=="object"?s[0]:void 0):p=yield window.okxwallet.unisat.signPsbt(i[0]),l=[p]}else l=yield window.okxwallet.unisat.signPsbts(i,s);return{method:e.method,result:(0,Vi.safeJsonStringify)(l)}}case"btc_signAndPushPsbt":{let{psbtHex:i,options:s}=e.params||{},l=yield window.okxwallet.unisat.signPsbt(i,s),p=yield window.okxwallet.unisat.pushPsbt(l);return{method:e.method,result:(0,Vi.safeJsonStringify)({signedPsbt:l,txHash:p})}}case"btc_sendInscription":{let{address:i,inscriptionId:s,options:l}=e.injectParams||{},p=yield window.okxwallet.unisat.sendInscription(i,s,l);return{method:e.method,result:p}}case"btc_inscribeTransfer":if(this.hasFunction("inscribeTransfer")){let{ticker:i,amount:s}=e.params||{},l=yield window.okxwallet.unisat.inscribeTransfer(i,s);return{method:e.method,result:l}}case"btc_sendRunes":if(this.hasFunction("sendRunes")){let{address:i,runeid:s,amount:l,options:p}=e.injectParams||{},f=yield window.okxwallet.unisat.sendRunes(i,s,l,p);return{method:e.method,result:f}}default:throw new sn.OKXConnectError(sn.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,`method: '${t}' not support`)}else throw new sn.OKXConnectError(sn.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,`param is error method: '${t}'`)}catch(t){throw(0,Vi.logDebug)("BtcProvider send error:",t),t}})}hasFunction(e){return!!(window.okxwallet&&window.okxwallet.unisat&&typeof window.okxwallet.unisat[e]=="function")}singleConnect(e){return ro(this,void 0,void 0,function*(){return e.chains.length==1?this.connect():!1})}addListener(e){this.accountChangedBtcHandler=t=>{console.log("window.okxwallet btc:",Date.now(),"btc",t),t&&t.length>0&&e()},window.okxwallet.unisat.on("accountsChanged",this.accountChangedBtcHandler)}removeListener(){window.okxwallet.unisat.removeListener("accountsChanged",this.accountChangedBtcHandler)}};oo.BtcProvider=vc});var Gi=H(io=>{"use strict";g();m();var lr=io&&io.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(io,"__esModule",{value:!0});io.InjectConnector=void 0;var ie=ze(),Oe=Qe(),yv=Yr(),vv=Lf(),bv=_o(),Ov=Mf(),bc=mn(),Cv=Wf(),Ev=sc(),wv=Uf(),Xf=Rt(),Tv=tc(),Sv=Bf(),Oc=class{constructor(){this.disconnectListener=[],this.providerMap=new Map,this.disconnectHandler=null,this.walletName="",this.walletNameKey="",this.enable=!0,this.providerMap.set(ie.NameSpaceKeyEip155,new Ev.Eip155Provider),this.providerMap.set(ie.NameSpaceKeySOL,new vv.SolProvider),this.providerMap.set(ie.NameSpaceKeyAptos,new Ov.AptosProvider),this.providerMap.set(ie.NameSpaceKeyTON,new Cv.TONProvider),this.providerMap.set(ie.NameSpaceKeySui,new wv.SuiProvider),this.providerMap.set(ie.NameSpaceKeyBtc,new Sv.BtcProvider)}setAccountChangeListener(e){(0,Oe.logDebug)("setAccountChangeListener: inject",e),this.accountChangeListener=e}setConnectionManager(e){this.connectionManager=e}getInjectProvider(e){if(!!e){for(let[t,r]of this.providerMap.entries())if(e.includes(t))return r}}openWallet(e,t){return lr(this,void 0,void 0,function*(){var r,o,i;if((0,Oe.logDebug)("InjectEngine connect begin:",JSON.stringify(e)),!e)throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR);this.dappInfo=e.connectRequest.dAppInfo;var s=e.connectRequest;try{if(window&&window.okxwallet){if(s.requests){let a=s.requests.find(T=>T.name==="requestAccounts"),c=yield window.okxwallet.getVersion(),u={method:"connect",requestId:s.requestId,payload:{wallet:{platform:(r=navigator.platform)!==null&&r!==void 0?r:"/",appName:bv.OKXInjectWalletName,appVersion:c??"1.0.0",maxProtocolVersion:1},responses:[]}},_={name:"requestAccounts",accounts:[]};u.payload.responses.push(_),yield this.disconnect();let y=(o=a.requiredNamespaces)!==null&&o!==void 0?o:[],I=(i=a.optionalNamespaces)!==null&&i!==void 0?i:[],X=!0,D=!1;if(y.length+I.length===1&&!(0,bc.isDevice)("mobile")){let T=y.length===1?y[0]:I[0],U=this.getInjectProvider(T.namespace);(yield U?.singleConnect(T,this.dappInfo))&&(D=!0,X=!1)}var l=yield this.getAccountByRequestWallets(X,!1,D,y,I);if(l){if(_.accounts.push(...l),_.accounts.length===0)throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect connectAccounts is null")}else throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect requestWallets is null");this.connectResultListener&&(this.disconnectHandler&&window.okxwallet.removeListener("disconnect",this.disconnectHandler),this.disconnectHandler=()=>{console.log("window.okxwallet disconnect:"),this.disconnectListener.forEach(T=>T()),this.disconnectListener=[]},window.okxwallet.on("disconnect",this.disconnectHandler),this.connectResultListener(u))}}else throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR)}catch(a){var p=ie.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,f="";a instanceof ie.OKXConnectError&&(p=a.code,f=a.message),this.connectResultListener&&this.connectResultListener({requestId:"-1",method:"connect_error",payload:{code:p}})}})}disconnect(){return lr(this,void 0,void 0,function*(){(0,Oe.logDebug)("InjectEngine ==>> disconnect  okxwallet.disconnect()"),window.okxwallet&&(yield window.okxwallet.disconnect(),(0,Oe.logDebug)("InjectEngine ==>> disconnect end okxwallet.disconnect()"))})}getRequestId(){let e=Date.now().toString();return(0,Oe.logDebug)("InjectEngine ==>> getRequestId ==>",e),e}send(e,t){return lr(this,void 0,void 0,function*(){var r;try{(0,Oe.logDebug)("InjectEngine send  > request:",(0,Oe.safeJsonStringify)(e));let o=e;if(o.method==="disconnect"){yield this.disconnect(),this.disconnectListener.forEach(s=>s()),this.disconnectListener=[],(r=t.onAck)===null||r===void 0||r.call(t);return}yield this.checkWalletMatch();let i=this.getInjectProvider((0,Oe.getNamespaceKeyByChain)(o.chainId));if(i){i.send(o).then(s=>{var l;(0,Oe.logDebug)("InjectEngine ==>> send > result:",s),(l=t.resolve)===null||l===void 0||l.call(t,s)}).catch(s=>{var l;let p=s.code;p===4001&&(p=ie.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR);let f={requestId:this.getRequestId(),method:e.method,error:{code:p,message:s.message}};(0,Oe.logDebug)("InjectEngine ==>> send > errorResponse:",JSON.stringify(f)),(l=t.resolve)===null||l===void 0||l.call(t,f)});return}else throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED)}catch(o){return(0,Oe.logDebug)("InjectEngine ==>> send  ===> error:",o),Promise.reject(o)}})}checkWalletMatch(){return lr(this,void 0,void 0,function*(){return new Promise((e,t)=>{var r;let o=(r=this.connectionManager)===null||r===void 0?void 0:r.getSessionContent("connectSession");o||t(new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED)),this.restoreconnect(o,i=>{i?e():t(new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED))})})})}checkAccountChanged(){return lr(this,void 0,void 0,function*(){var e;try{let t=(e=this.connectionManager)===null||e===void 0?void 0:e.getSessionContent("connectSession");if(!t)throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);(0,Oe.logDebug)("inject-connector checkAccountChanged --sessionInfo:",JSON.stringify(t));let r=this.getRequireNameSpaceFromSession(t);(0,Oe.logDebug)("inject-connector checkAccountChanged --requiredNamespaces:",JSON.stringify(r));let o=yield this.getAccountByRequestWallets(!1,!0,!1,r,[]);if((0,Oe.logDebug)("inject-connector checkAccountChanged --accounts:",JSON.stringify(o)),o){let i={};(0,Tv.buildAccountNameSpaces)(o,i),this.compareAndModifyNamespaces(t.namespaces,i)||((0,Oe.logDebug)("inject-connector checkAccountChanged --result sessionLocal:",JSON.stringify(t)),this.accountChangeListener?((0,Oe.logDebug)("inject-connector checkAccountChanged -accountChangeListener:",this.accountChangeListener),this.accountChangeListener(t)):((0,Oe.logDebug)("inject-connector checkAccountChanged disconnect:"),yield this.disconnect()))}else throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect requestWallets is null")}catch(t){throw(0,Oe.logDebug)("inject-connector restoreconnect catch error",JSON.stringify(t)),t}})}compareAndModifyNamespaces(e,t){let r=!0;for(let o in e)if(t[o]){let i=e[o],s=t[o];(0,Oe.logDebug)("inject-connector checkAccountChanged ns1:",JSON.stringify(i)),(0,Oe.logDebug)("inject-connector checkAccountChanged ns2:",JSON.stringify(s)),JSON.stringify([...i.accounts].sort())===JSON.stringify([...s.accounts].sort())||(r=!1,i.accounts=[...s.accounts],i.extra=Object.assign({},s.extra),i.payload=Object.assign({},s.payload)),(0,Oe.logDebug)("inject-connector checkAccountChanged new ns1:",JSON.stringify(i))}return(0,Oe.logDebug)(`inject-connector checkAccountChanged compareAndModifyNamespaces ===> ${r}`),r}clearData(){this.connectResultListener=void 0}addDisconnectListener(e){this.disconnectListener.push(e)}setOnConnectResultListener(e){this.connectResultListener=e}connectManagerDisconnect(){return lr(this,arguments,void 0,function*(e=!1){})}getCurrentConnectionReady(e){return e?e.every(r=>{var o;return(o=this.getInjectProvider(r))===null||o===void 0?void 0:o.connectReady()}):!1}getTag(){return yv.OKX_INJECT_WALLET}toJSON(){return"inject-connector"}getRequireNameSpaceFromSession(e){var t,r,o=[];for(let i in e.namespaces){let s=e.namespaces[i],l={namespace:i,chains:s.chains};if(i===ie.NameSpaceKeyAptos){let p=[];s.chains.forEach(f=>{let a=(0,Xf.replaceChainNameToChainId)(f);p.push(a)}),l={namespace:i,chains:p}}else if(i===ie.NameSpaceKeyTON){let p,f;!((t=s.payload)===null||t===void 0)&&t.ton_proof&&(p=(r=s.payload)===null||r===void 0?void 0:r.ton_proof,p.proof.payload&&(f={name:"ton_proof",payload:p.proof.payload})),l={namespace:i,chains:s.chains,params:{ton_addr:{name:"ton_addr"},ton_proof:f}}}o.push(l)}return o}restoreconnect(e,t){var r;if(!window.okxwallet){t(null);return}this.dappInfo=(r=e.sessionConfig)===null||r===void 0?void 0:r.dappInfo,(0,Oe.logDebug)("inject-connector restoreconnect --sessionInfo:",JSON.stringify(e));var o=this.getRequireNameSpaceFromSession(e);(0,Oe.logDebug)("inject-connector restoreconnect --requiredNamespaces:",JSON.stringify(o)),this.getAccountByRequestWallets(!1,!1,!1,o,[]).then(i=>{(0,Oe.logDebug)("inject-connector restoreconnect --accounts:",JSON.stringify(i));let s=!0;for(let f in e.namespaces){var l=i.find(u=>u.namespace===f),p=e.namespaces[f].accounts;if(!l)throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"resotreconnect error: accountItem error");let a=p;f===ie.NameSpaceKeyAptos&&a&&a.length>0&&(a=p.map(u=>(0,Xf.replaceChainNameToChainId)(u))),l.addresses.length===a.length&&l.addresses.slice().sort().every((u,_)=>{if(f===ie.NameSpaceKeyAptos){let y=a.slice().sort()[_];return(0,Oe.logDebug)("check aptos address -value and aptosAdd--",u,y),y===u}else return u===a.slice().sort()[_]})||(s=!1)}if(s)t(e);else throw new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.BAD_REQUEST_ERROR,"resotreconnect error: address not as same as session")}).catch(i=>{(0,Oe.logDebug)("inject-connector restoreconnect catch error",JSON.stringify(i)),t(null)})}getAccountByRequestWallets(e,t,r,o,i){return lr(this,void 0,void 0,function*(){try{var s=[],l=[];if((0,bc.isDevice)("mobile")){var p=yield window.okxwallet.connectWallet(e,{requiredNamespaces:o,optionalNamespaces:i});s.push(p)}else s=yield window.okxwallet.requestWallets(e);var f=[...o??[],...i??[]];let a=s[0];(0,Oe.logDebug)(" InjectEngine connect connectAccounts:",JSON.stringify(a));let c;if(f&&a&&a.address)for(let[_,y]of this.providerMap.entries()){let I=yield y.parseConnectResponse(e,t,r,f,a,this.dappInfo);I&&(c=_,l.push(I))}let u=o.every(_=>{let y=l.find(I=>I.namespace===_.namespace);return y?_.chains.every(X=>!!y.addresses.find(T=>T.startsWith(X+":"))):!1});if((0,Oe.logDebug)("InjectEngine connect requiredNamespaces:",JSON.stringify(o)),(0,Oe.logDebug)("InjectEngine connect accountResult:",JSON.stringify(l)),!u)throw yield this.disconnect(),new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.CHAIN_NOT_SUPPORTED);return(0,bc.isDevice)("mobile")||(this.configEventWithKey(c),yield window.okxwallet.requestWallets(e)),l}catch(a){throw a&&typeof a=="object"&&"code"in a&&a.code===4001?new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR):new ie.OKXConnectError(ie.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR)}})}configEventWithKey(e){var t,r;for(let o in this.providerMap)(t=this.providerMap.get(o))===null||t===void 0||t.removeListener();(r=this.getInjectProvider(e))===null||r===void 0||r.addListener(()=>{this.checkAccountChanged().catch(o=>{console.log("window.okxwallet configEventWithKey error: ",o)})})}};io.InjectConnector=Oc});var Hf=H(Yi=>{"use strict";g();m();Object.defineProperty(Yi,"__esModule",{value:!0});Yi.TgwalletConnector=void 0;var Nv=qi(),Rv=Yr(),Cc=Qe(),Ec=class extends Nv.WsConnector{constructor(){super(),this.walletName="OKX Mini Wallet",this.walletNameKey="walletModal.mobileConnectionModal.connectMini"}getTag(){return Rv.OKX_TG_WALLET}openWallet(e,t){var r,o;e&&e.connectRequest&&(o=(0,Cc.encodeTWAConnectURLParams)(Object.assign(Object.assign({},e.connectRequest),{redirect:"none"})));var i=(0,Cc.getTelegramWalletTWAUrl)(o,(r=e?.tmaReturnUrl)!==null&&r!==void 0?r:"back");(0,Cc.openOKXTMAWalletlinkWithFallback)(i)}};Yi.TgwalletConnector=Ec});var qf=H(zi=>{"use strict";g();m();Object.defineProperty(zi,"__esModule",{value:!0});zi.OkxwalletInjectConnector=void 0;var Dv=Gi(),wc=class extends Dv.InjectConnector{constructor(){super(),this.walletName="OKX Wallet extension",this.walletNameKey="walletModal.mobileConnectionModal.connectInjected"}};zi.OkxwalletInjectConnector=wc});var Jf=H(so=>{"use strict";g();m();var Iv=so&&so.__awaiter||function(n,e,t,r){function o(i){return i instanceof t?i:new t(function(s){s(i)})}return new(t||(t=Promise))(function(i,s){function l(a){try{f(r.next(a))}catch(c){s(c)}}function p(a){try{f(r.throw(a))}catch(c){s(c)}}function f(a){a.done?i(a.value):o(a.value).then(l,p)}f((r=r.apply(n,e||[])).next())})};Object.defineProperty(so,"__esModule",{value:!0});so.OkxwalletInjectTonsdkConnector=void 0;var Av=Gi(),Wn=ze(),Pv=Qe(),kv=mn(),Tc=class extends Av.InjectConnector{constructor(){super(),this.walletName="OKX Wallet extension",this.walletNameKey="walletModal.mobileConnectionModal.connectInjected"}checkWalletMatch(){return Iv(this,void 0,void 0,function*(){var e,t,r;(e=this.connectionManager)===null||e===void 0||e.tonsdkConnectStorage.synchronizedCache();let o=(t=this.connectionManager)===null||t===void 0?void 0:t.tonsdkConnectStorage.getItem("ton_connect_info_adapter_universal");if(!o||!o?.content)throw new Wn.OKXConnectError(Wn.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR);let i=o?.content,s=JSON.parse(i),l=s.connectEvent.payload.items.find(f=>"name"in f?f.name==="ton_addr":!1);this.dappInfo=s.dappInfo;let p;if(l&&"address"in l&&(p=l.address),!p)throw new Wn.OKXConnectError(Wn.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED);if((0,Pv.logDebug)(`inject-connector localTonaddress : ${p}`),(0,kv.isDevice)("mobile")){let f,a;f={namespace:Wn.NameSpaceKeyTON,chains:[Wn.TON_CHAINS.MAINNET],params:{ton_addr:{name:"ton_addr"}}};let c=yield this.getAccountByRequestWallets(!1,!1,!1,[f],[]);if(c&&c.length==1){let _=(r=c[0].data)===null||r===void 0?void 0:r.ton_addr,y=_?.address;if(p===y)return}}else{let f=yield window.okxTonWallet.tonconnect.restoreConnection();if(f.event==="connect"&&f.payload.items.find(c=>c.name==="ton_addr").address==p)return}throw new Wn.OKXConnectError(Wn.OKX_CONNECT_ERROR_CODES.WALLET_NOT_SUPPORTED)})}};so.OkxwalletInjectTonsdkConnector=Tc});var Ff=H(xe=>{"use strict";g();m();Object.defineProperty(xe,"__esModule",{value:!0});xe.OkxwalletInjectTonsdkConnector=xe.OkxwalletInjectConnector=xe.WsConnector=xe.TgwalletConnector=xe.InjectConnector=xe.getTagByappName=xe.OKX_INJECT_WALLET=xe.OKX_APP_WALLET=xe.OKX_TG_WALLET=xe.AppwalletConnector=void 0;var Kv=Kf();Object.defineProperty(xe,"AppwalletConnector",{enumerable:!0,get:function(){return Kv.AppwalletConnector}});var Qi=Yr();Object.defineProperty(xe,"OKX_TG_WALLET",{enumerable:!0,get:function(){return Qi.OKX_TG_WALLET}});Object.defineProperty(xe,"OKX_APP_WALLET",{enumerable:!0,get:function(){return Qi.OKX_APP_WALLET}});Object.defineProperty(xe,"OKX_INJECT_WALLET",{enumerable:!0,get:function(){return Qi.OKX_INJECT_WALLET}});Object.defineProperty(xe,"getTagByappName",{enumerable:!0,get:function(){return Qi.getTagByappName}});var Lv=Gi();Object.defineProperty(xe,"InjectConnector",{enumerable:!0,get:function(){return Lv.InjectConnector}});var xv=Hf();Object.defineProperty(xe,"TgwalletConnector",{enumerable:!0,get:function(){return xv.TgwalletConnector}});var Mv=qi();Object.defineProperty(xe,"WsConnector",{enumerable:!0,get:function(){return Mv.WsConnector}});var Wv=qf();Object.defineProperty(xe,"OkxwalletInjectConnector",{enumerable:!0,get:function(){return Wv.OkxwalletInjectConnector}});var jv=Jf();Object.defineProperty(xe,"OkxwalletInjectTonsdkConnector",{enumerable:!0,get:function(){return jv.OkxwalletInjectTonsdkConnector}})});var Sc=H($t=>{"use strict";g();m();var Uv=$t&&$t.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,o)}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Ko=$t&&$t.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Uv(e,n,t)};Object.defineProperty($t,"__esModule",{value:!0});Ko(Df(),$t);Ko(ze(),$t);Ko(Qe(),$t);Ko(sc(),$t);Ko(Ff(),$t)});g();m();var he=re(He()),Ep=re(bn()),cs=re(vr()),ls=re(Yo());dn();yh();g();m();g();m();var vt=re(He()),du=re(vr());dn();g();m();var As=re(He());_h();var lu=({walletIds:n})=>{let e=(0,As.useCallback)(async()=>{try{return await Ss().fetchApprovalRisk({accountIds:n})}catch{return{}}},[n]),t=(0,As.useCallback)(async()=>{await Ss().setApprovalRiskRemindLater()},[]);return{fetchApprovalRisk:e,remindLater:t}};g();m();var uu={btn:"_btn_l5kiz_1"};var fu=({walletId:n,onFetchApprovalRisk:e})=>{let[t,r]=vt.default.useState(!1),o=(0,vt.useMemo)(()=>({walletIds:[n]}),[n]),{fetchApprovalRisk:i,remindLater:s}=lu(o);(0,vt.useEffect)(()=>{(async()=>{let{approvalProjectList:a}=await i();a?.length>0&&(r(!0),e(!0)),e(!1)})()},[i,e]);let l=(0,vt.useCallback)(()=>{r(!1),ul({go_to_website:!1}),s()},[s]),p=(0,du.useHistory)(),f=()=>{p.push(vl)};return vt.default.createElement(yt.Prompt,{visible:t,title:Ie("wallet_extension_risk_modaltitle_risk_warning"),text:Ie("wallet_extension_risk_modalsubtitle_risk_warning"),infoType:yt.Prompt.INFO_TYPE.warn,hideCloseBtn:!0,alignBottom:!1,footer:vt.default.createElement(vt.default.Fragment,null,vt.default.createElement(tt,{category:tt.CATEGORY.fill,type:tt.TYPE.highlight,size:tt.SIZE.lg,block:!0,onClick:f},Ie("wallet_extension_approval_btn_revoke")),vt.default.createElement(tt,{category:tt.CATEGORY.outline,type:tt.TYPE.default,size:tt.SIZE.lg,className:uu.btn,block:!0,onClick:l},Ie("wallet_extension_risk_btn_remind_later")))})};g();m();var pu=re(bn());var Cr=()=>{let n=On(),e=(0,pu.useSelector)(sl)||{};return{isWalletCreated:Boolean(e[n])}};g();m();var Ye=re(He());g();m();var Ps=re(He());g();m();var oi={main:"_main_1li3n_1",line:"_line_1li3n_5",dot:"_dot_1li3n_11"};var hu=({total:n,activeIndex:e,className:t})=>Ps.default.createElement(Se.FlexBox,{align:Se.ALIGN.center,className:`${oi.main} ${t}`},Array(n).fill("").map((r,o)=>Ps.default.createElement("div",{className:e===o?oi.line:oi.dot})));g();m();var ii=re(He());g();m();var mo={main:"_main_si9mr_1",icon:"_icon_si9mr_1",left:"_left_si9mr_11"};var gu=({handlePrev:n,handleNext:e,className:t})=>ii.default.createElement(Se.FlexBox,{align:Se.ALIGN.center,className:`${mo.main} ${t}`},ii.default.createElement(jt,{size:jt.SIZE.xxs,onClick:n,icon:"okx-wallet-plugin-left",className:`${mo.icon} ${mo.left} `}),ii.default.createElement(jt,{size:jt.SIZE.xxs,onClick:e,icon:"okx-wallet-plugin-right",className:mo.icon}));g();m();var Cn=re(He()),si=re(bn());ys();ch();Os();Cs();var mu=()=>{let[n,e]=(0,Cn.useState)([]),t=(0,si.useSelector)(pl),r=(0,si.useDispatch)(),o=Yc();(0,Cn.useEffect)(()=>{(async()=>{let{data:l=[]}=await Zc(_r.getBannerConfig),{uiData:p}=await Ho.get("uiData"),f=p?.closedBannerStore||[];r(Ns({allData:l,closedBanners:f,theme:o})),e(l)})()},[o]);let i=(0,Cn.useMemo)(()=>t.length,[t]),s=(0,Cn.useCallback)(async l=>{let{uiData:p}=await Ho.get("uiData"),{closedBannerStore:f=[]}=p;f.push(l?.id);let a=qc(f,n,(c,u)=>c===u?.id);await Ho.set({uiData:{...p??{},closedBannerStore:a}}),r(Ns({allData:n,closedBanners:a,theme:o}))},[n,o]);return{bannerList:t,total:i,handleClose:s}};g();m();var _u=re(He()),yu=re(vr());var vu=()=>{let n=(0,yu.useHistory)();return{link:(0,_u.useCallback)(t=>{switch(Go({click_close:!1,banner_id:t.id}),t.urlType){case 2:{let r=t.url.replace("wallet://","");n.push(r);break}case 1:globalThis.open(t.url);break;default:break}},[])}};g();m();var Ut={"retina-border-basic":"_retina-border-basic_60npk_1",retinaBorderBasic:"_retina-border-basic_60npk_1",main:"_main_60npk_29",carousel:"_carousel_60npk_63",closeWrapper:"_closeWrapper_60npk_67",banner:"_banner_60npk_75",content:"_content_60npk_80",left:"_left_60npk_83",title:"_title_60npk_87",icon:"_icon_60npk_90",buttonIndex:"_buttonIndex_60npk_95",switch:"_switch_60npk_100"};var bu=()=>{let[n,e]=(0,Ye.useState)(0),[t,r]=(0,Ye.useState)(!1),o=Ye.default.useRef(null),{link:i}=vu(),{bannerList:s,total:l,handleClose:p}=mu();return l===0?null:Ye.default.createElement(Se.FlexBox,{className:Ut.main,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1)},Ye.default.createElement(vs,{touchSwitch:l>1,className:Ut.carousel,autoplay:l>1?5e3:!1,ref:o,loop:l>1,navigation:!1,showIndicators:!1,onChange:f=>{e(f)}},s?.map(f=>Ye.default.createElement(vs.Slide,null,Ye.default.createElement(Se.FlexBox,{className:Ut.banner},Ye.default.createElement(Se.FlexBox,{onClick:()=>i(f),className:Ut.content,align:l===1?Se.ALIGN.center:Se.ALIGN.start},Ye.default.createElement("div",{className:Ut.left},Ye.default.createElement(Wt.Text,{ellipsis:{rows:2},size:Wt.SIZE.sm,strong:500,className:Ut.title},f.title)),Ye.default.createElement(jt,{type:jt.TYPE.image,className:Ut.icon,src:f.img})),Ye.default.createElement(Se.FlexBox,{align:Se.ALIGN.center,className:Ut.closeWrapper,onClick:()=>{Go({click_close:!0,banner_id:f.id}),p(f)}},Ye.default.createElement(Gc,{className:"okx-wallet-plugin-close"})))))),l>1&&Ye.default.createElement("div",null,t?Ye.default.createElement(gu,{className:Ut.switch,handlePrev:()=>o.current?.prev(),handleNext:()=>o.current?.next()}):Ye.default.createElement(hu,{total:l,activeIndex:n,className:Ut.buttonIndex})))};g();m();var En=re(He());dn();g();m();var Jn={iconAniWrapper:"_iconAniWrapper_piy3e_20",iconItem:"_iconItem_piy3e_29",text:"_text_piy3e_35",moveOutAnimation:"_moveOutAnimation_piy3e_38",moveOut:"_moveOut_piy3e_38",moveInAnimation:"_moveInAnimation_piy3e_42",moveIn:"_moveIn_piy3e_42",iconTitle:"_iconTitle_piy3e_54"};var Ou=({width:n})=>En.default.createElement(Se.FlexBox,{align:Se.ALIGN.center,direction:Se.DIRECTION.vertical,style:{width:n}},En.default.createElement(Se.Box,{className:Jn.iconAniWrapper},En.default.createElement(Se.FlexBox,{align:Se.ALIGN.center,justify:Se.ALIGN.center,className:`${Jn.iconItem} ${Jn.moveInAnimation}`},En.default.createElement(jt,{className:"okx-wallet-plugin-toolkit"})),En.default.createElement(Se.FlexBox,{align:Se.ALIGN.center,justify:Se.ALIGN.center,direction:Se.DIRECTION.vertical,className:`${Jn.iconItem} ${Jn.moveOutAnimation}`},En.default.createElement(jt,{className:"okx-wallet-plugin-swap-for-gas"}))),En.default.createElement(Wt.Text,{className:Jn.iconTitle,ellipsis:!0,size:Wt.SIZE.xs},Ie("wallet_extension_home_text_toolkit")));g();m();var cn=re(He()),ns=re(bn()),Ac=re(vr());g();m();var Qf=re(vr());g();m();g();m();var Vt=re(Sc());g();m();g();m();function Nc(n){let e={};try{let t=new URL(n),r=new URLSearchParams(t.search);for(let[o,i]of r.entries())e[o]=i;if(t.pathname.endsWith("/ul/connect")&&e.topic!==void 0&&e.topic.length>=6){let o=e.topic,i=o.slice(-6),l={topic:o.slice(0,-6),cid:i};return(0,Vt.base64encode)(l,!1)}else{if(t.href.startsWith(Vt.standardDeeplink)&&e.param!==void 0)return e.param;if(t.pathname.endsWith("/download")&&e.deeplink!==void 0){let o=new URL(e.deeplink),i=new URLSearchParams(o.search),s={};for(let[l,p]of i.entries())s[l]=p;if(o.href.startsWith(Vt.standardDeeplink)&&s.param!==void 0)return s.param}}}catch(t){console.log("Invalid URL:",t)}}g();m();var Rc=re(Sc());g();m();g();m();var Dc=async()=>{};g();m();var es=re(He());dn();g();m();g();m();var Zi="";var $f=()=>{let[n,e]=(0,es.useState)(!1);return[(0,es.useCallback)(async r=>{if(!!Zi)try{e(!0),await Zi.pair({uri:r})}catch(o){o&&o?.message&&o?.message?.includes("URI has expired")&&zc.error(Ie("wallet_extension_tg_error_qr_code_expired"))}finally{e(!1)}},[]),n]};Es();g();m();var Vf=n=>{let t=`http://t.me/OKX_WALLET_BOT/dapp?startapp=${encodeURIComponent(n).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%/g,"__")}`;jl(t)};g();m();function qv(){let n=(e,t)=>{if(Array.isArray(t))return t.find(r=>r?.coinId===e.coinId||n(e,r?.childrenCoin))};return{checkCoinAdded:n}}var Gf=qv;g();m();gh();var Jv=async(n,e)=>{let t=await Promise.all(n.map(e));return n.filter((r,o)=>t[o])};function Fv(){return{findChainsByAddress:async t=>{let r=ws();return await Jv(r,async i=>await xl(t,i.coinId))||[]},findChainByChainName:t=>ws().find(o=>Ts(t)===Ts(o.chainName))||{}}}var Yf=Fv;g();m();var an=re(He());dn();function $v(){let n=(0,an.useCallback)(()=>{let i=yt.tip({infoType:yt.Tip.INFO_TYPE.default,children:an.default.createElement(an.default.Fragment,null,Ie("wallet_extension_tg_alert_address_not_recognize")),confirmText:Ie("commonall_text_btn_ok_active"),onConfirm:()=>{i.destroy()}})},[]),e=(0,an.useCallback)(()=>{Ds({message:Ie("wallet_extension_tg_alert_address_not_recognize")})},[]),t=(0,an.useCallback)(i=>{let s=yt.tip({infoType:yt.Tip.INFO_TYPE.default,children:an.default.createElement(an.default.Fragment,null,Ie("wallet_extension_tg_alert_token_not_add",{token:i})),confirmText:Ie("commonall_text_btn_ok_active"),onConfirm:()=>{s.destroy()}})},[]),r=(0,an.useCallback)(i=>{Ds({message:Ie("wallet_extension_tg_alert_token_not_add",{token:i})})},[]);return{getMessageFns:i=>i==="link"?{showCoinNotFindMessage:n,showCoinNotAddedMessage:t}:{showCoinNotFindMessage:e,showCoinNotAddedMessage:r}}}var zf=$v;var ts=[rl,nl],Ic=(n,e)=>n.indexOf(e)>0,Vv=n=>{let e=Ic(n,"?")?n.split("?")[0]:n;if(Ic(e,":")){let[t,r]=e.split(":");return{address:r,chainName:t}}return{address:e}},Gv=n=>{if(!Ic(n,"?"))return{};let[,e]=n.split("?");return Al(e)};function Yv(){let n=(0,Qf.useHistory)(),e=Pl(),[t]=$f(),r=Ml(),{findChainsByAddress:o,findChainByChainName:i}=Yf(),{checkCoinAdded:s}=Gf(),{getMessageFns:l}=zf(),p=u=>{if(!u)return{};let _=Gv(u);return{...Vv(u),..._}},f=async({chainName:u="",address:_="",token:y="",amount:I="",source:X="scan",finishedAction:D=()=>{}})=>{let{showCoinNotFindMessage:T,showCoinNotAddedMessage:U}=l(X),J=_;_&&ts.includes(u)&&(J=`${u}:${_}`);let V=y;if(y&&ts.includes(u)&&!y.startsWith(u)&&(V=`${u}:${y}`),J&&!I&&!ts.includes(u)){let B=(await o(J)).map(L=>L.coinId);B.length?(n.push(`${go}?type=${ho.SEND}&address=${J}&coinIds=${B.join(",")}`),D()):T()}else if(J&&u&&(I||ts.includes(u))){let{chainId:S}=i(u);if(typeof S<"u"){let B={chainId:S};V&&(B.address=V);let L=await e(void 0,B);L&&L.coinId&&(s(L,r)?(n.push(`${hl}/${L.coinId}${_l}?address=${J}&amount=${I}`),D()):U(L.symbol))}else T()}else T()};return{openScanner:async()=>{try{await Is({onCaptured:async u=>{let _=Nc(u);if(!!_){(await Dc())?.pairingFromUrl(_),Or();return}if(u.startsWith("http://")||u.startsWith("https://")){Vf(u),Or();return}if(u.startsWith("wc:")){t(u),Or();return}let{chainName:I,address:X,token:D,amount:T}=p(u);f({chainName:I,address:X,token:D,amount:T,finishedAction:()=>{Or()}})}})}catch{Or()}},linkToSend:f,scanToGetText:async()=>{let u;try{u=await Is({capture:()=>!0})}catch{u=""}return u}}}var Zf=Yv;Es();g();m();var Qv=[{text:"wallet_home_btn_send",icon:"okx-wallet-plugin-up",type:"SEND"},{text:"wallet_home_btn_receive",icon:"okx-wallet-plugin-down",type:"RECEIVE"},{text:"wallet_extension_homepage_feature_name_swap",icon:"okx-wallet-plugin-swap-2",type:"DEX",disabledText:""},{text:"wallet_extension_header_text_history",icon:"okx-wallet-plugin-history-1",type:"HISTORY"},{text:"wallet_extension_home_text_toolkit",icon:"okx-wallet-plugin-toolkit",type:"MORE"}],ep=Qv;var Zv=n=>Kl({networkId:n?.id?String(n?.id):void 0})?.coinId,eb=n=>(0,cn.useMemo)(()=>{let{initialType:t,accountMap:r}=n;if(Tl(t)){let o=Object.keys(r);return![$o,tl].some(i=>o.includes(i))}return!1},[n]),tb=n=>{let e=ti(),t=(0,Ac.useHistory)(),r=(0,cn.useCallback)(()=>{t.push(`${go}?type=${ho.RECEIVE}`)},[t]);return(0,cn.useCallback)(()=>{(n?e:r)()},[r,n,e])},tp=()=>{let{isNotBackupWallet:n}=ei(),e=(0,Ac.useHistory)(),t=(0,ns.useDispatch)(),r=tu(),o=Zv(r),{baseCoin:i={}}=kl(o,!0),s=iu(i,"",ou.home),l=(0,ns.useSelector)(al),p=eb(l),f=tb(n),a=(0,cn.useCallback)(()=>{!(typeof i?.chainId>"u")&&t(Ol({chainId:i?.chainId})),e.push(ml)},[i?.chainId,t,e]),c=(0,cn.useCallback)(()=>{e.push(gl)},[e]),u=(0,cn.useCallback)(()=>{e.push(`${go}?type=${ho.SEND}`)},[e]),_=Yl(dl),{impactHaptic:y}=Nl(),{openScanner:I}=Zf(),X=(0,cn.useCallback)(T=>{switch(y(),T.type){case"SEND":{_({homepage:"send"}),u();break}case"RECEIVE":{_({homepage:"receive"}),f();break}case"SCANNER":{I();break}case"DEX":{_({homepage:"trade"}),s();break}case"HISTORY":{_({homepage:"history"}),a();break}case"DAPP_CONNECT":{c();break}default:break}},[f,s,a,c,u,e,y,_]),D=(0,cn.useMemo)(()=>ep.map(T=>T.type==="DEX"?{...T,disabled:p}:T).filter(T=>T.type==="SCANNER"?Wl():!0),[p]);return{clickHandle:X,iconOptions:D}};g();m();var rs=re(He()),rp=re(bn());g();m();var np=re(He());ys();ol();Es();function Pc(){let n=br();return(0,np.useMemo)(()=>{let e=su.find(t=>{let r=n?.account?.[t],o=Fc(Object.values(n?.account??{}));return t===$o?!1:r&&n.keyringIdentityType===Vo.PRIVATE_KEY&&o.length===1&&o[0]===r});return e?{isFactionPKAccount:!0,chain:e}:{isFactionPKAccount:!1}},[n])}var op=()=>{let n=br(),{isFactionPKAccount:e,chain:t}=Pc(),{currentNetworkUniqueId:r}=ni(),{addresses:o=[],hotAddresses:i=[]}=(0,rp.useSelector)(Sl),s=(0,rs.useCallback)(a=>e?a.localType===t:r===""?!0:a.chainId===Number(r),[r,e,t]),{filterAddress:l,filterHotAddress:p}=(0,rs.useMemo)(()=>({filterAddress:o.filter(s),filterHotAddress:i.filter(s)}),[o,s,i]),f=l.length===1;return{filterAddress:l,filterHotAddress:p,address:f?l[0]?.address:"",chainName:f?l[0]?.chainName:"",titleLeft:n?.keyringName,titleRight:f?n?.walletName:"",subTitle:f?il(l[0]?.address):n?.walletName,isFactionPKAccount:e}};g();m();var ip=re(He()),sp=re(vr());dn();ol();var ap=({address:n})=>{let e=(0,sp.useHistory)(),t=br(),r=()=>{e.push(`${zo}?fromHome=1`)};return t?.keyringIdentityType===Vo.PRIVATE_KEY&&n==="UQCiCTSKMQTIF8VSGc3F7DxWxJrV09SAbJzc1YvWZ5pgiQAP"?ip.default.createElement(yt.Prompt,{visible:!0,infoType:yt.Prompt.INFO_TYPE.warn,title:Ie("wallet_extension_errormsg_unavailable_address"),confirmText:Ie("wallet_extension_connect_btn_switch_wallet"),onConfirm:r,hideCloseBtn:!0,alignBottom:!1,maskClosable:!1,confirmBtnProps:{type:tt.TYPE.highlight,size:tt.SIZE.lg}}):null};g();m();g();m();var cp=()=>null;var lp=cp;g();m();var jn=re(He());g();m();g();m();var kc={version:"3.33.51",web:!0,extension:!1,title:"wallet_extension_main_popup_shortcut",description:"wallet_extension_main_toast_shortcut",imgLight:"/cdn/assets/imgs/2412/EEC46FC3302CEC12.svg",imgDark:"/cdn/assets/imgs/2412/026A26E3C0C3D875.svg",mainButtonText:"commonall_text_btn_ok_passive"};g();m();var Lo=re(He());dn();lh();var up=(n,e,t)=>{let{version:r,imgLight:o,imgDark:i,title:s,description:l,mainButtonText:p}=n,f=El({dark:i,light:o}),[a,c]=(0,Lo.useState)(!1),u=$c.init({project:"whatsNew"});return(0,Lo.useEffect)(()=>{if(!e){c(!1);return}if(r!==Vc.version){c(!1);return}if(u.get("whatsNewVersion")===r){c(!1);return}if(typeof t=="boolean"&&!t){c(!1);return}c(!0)},[u,t,r,e]),(0,Lo.useEffect)(()=>{a&&u.set("whatsNewVersion",r)},[a,u,r]),{visible:a,title:qo(s),description:qo(l),img:f,mainButtonText:qo(p),onMainButtonClick:()=>{c(!1)}}};function Kc(){let{extension:n}=kc;return up(kc,n)}g();m();var ur={"whats-new-img":"_whats-new-img_fow6p_1",whatsNewImg:"_whats-new-img_fow6p_1","whats-new-box":"_whats-new-box_fow6p_5",whatsNewBox:"_whats-new-box_fow6p_5","whats-new-title":"_whats-new-title_fow6p_10",whatsNewTitle:"_whats-new-title_fow6p_10","whats-new-desc":"_whats-new-desc_fow6p_15",whatsNewDesc:"_whats-new-desc_fow6p_15","whats-new-footer":"_whats-new-footer_fow6p_20",whatsNewFooter:"_whats-new-footer_fow6p_20","whats-new-dialog":"_whats-new-dialog_fow6p_23",whatsNewDialog:"_whats-new-dialog_fow6p_23"};var nb=({shouldWhatsNewShow:n})=>{let{visible:e,title:t,description:r,img:o,mainButtonText:i,onMainButtonClick:s}=Kc();return jn.default.createElement(yt,{whiteboard:!0,visible:n&&e,hideCloseBtn:!0,noMargin:!1,alignBottom:!1,windowClass:ur.whatsNewDialog},jn.default.createElement("img",{className:ur.whatsNewImg,src:o,alt:""}),jn.default.createElement("div",{className:ur.whatsNewBox},jn.default.createElement("h2",{className:ur.whatsNewTitle},t),jn.default.createElement("p",{className:ur.whatsNewDesc},r),jn.default.createElement("div",{className:ur.whatsNewFooter},jn.default.createElement(tt,{category:tt.CATEGORY.fill,type:tt.TYPE.highlight,size:tt.SIZE.md,onClick:s,block:!0},i))))},dp=nb;g();m();var Mo=re(He()),bp=re(bn()),Op=re(Cl());g();m();var Un=re(He()),os=re(Cl());dn();g();m();var Gt={root:"_root_1yqai_1",asset:"_asset_1yqai_13",change:"_change_1yqai_20",up:"_up_1yqai_23",down:"_down_1yqai_26",hidden:"_hidden_1yqai_29",empty:"_empty_1yqai_32",select:"_select_1yqai_35",amount:"_amount_1yqai_38"};function rb(n){let{hiddenAssets:e,data:t}=n,{hasTypes:r,types:o,typeId:i,onChangeType:s,balanceAdd:l,balanceAddPercent:p}=t,f=l!==void 0,a=p!==void 0,c="--",u="****",_=(0,os.default)(Gt.change,{[Gt.up]:f&&zt.gt(l,0),[Gt.down]:f&&zt.lt(l,0)});return Un.default.createElement("div",{className:Gt.root},Un.default.createElement("div",{className:Gt.asset,"data-testid":Qo.HOME_PAGE.ASSET_CHANGE_DISPLAY},!e&&!f&&Un.default.createElement("div",{className:Gt.empty},c),e&&Un.default.createElement("div",{className:Gt.hidden},u),!e&&f&&Un.default.createElement(Wt.DisplayAmount,{autoColor:!0,useApproximate:!1,mode:Wt.LEGAL,amount:l,ellipsis:{tooltip:!0},size:Rs.sm,className:(0,os.default)(Gt.amount,_),signDisplay:zt.gt(l,0)}),!e&&f&&a&&Un.default.createElement(Wt.DisplayAmount,{autoColor:!0,useApproximate:!1,ellipsis:{tooltip:!0},mode:Wt.PERCENT,signDisplay:!0,size:Rs.sm,zeroSign:"",needZero:!0,className:(0,os.default)(Gt.amount,_),amount:p,format:y=>y&&`(${y})`})),r&&Un.default.createElement(po,{dropMode:!0,type:po.TYPE.text,value:i,align:po.DIRECTION.left,options:o.map(y=>({value:y.chartTypeId,label:y.chartTypeMsg})),size:po.SIZE.md,onChange:y=>{let I=y;s({chartTypeId:I.value,chartTypeMsg:I.label})},searchable:!1,className:Gt.select}))}var fp=rb;g();m();var xo=re(He()),_p=re(bn()),yp=re(Yo());ys();dn();g();m();var Lc=re(bn()),ss=re(Yo());g();m();var ob=()=>{let{showErrorAlert:n}=ri();return t=>{try{el(t,!0)}catch(r){let{type:o,msg:i}=Hl(r);n(o,i)}}},is=ob;g();m();Os();Cs();var ib=n=>Fo(_r.getAssetChangeData,n),pp=ib;var sb=n=>n!=null,ab=n=>{let e=(0,Lc.useSelector)(bl),t=is(),{isWalletCreated:r}=Cr(),o=On(),{currentNetworkUniqueId:i}=ni(),s=(0,Lc.useSelector)(ll),l=i===""?void 0:+i,p=e?1:0,f=sb(n),a=r&&!!o&&f,c=(0,ss.useRequest)(()=>pp({accountIds:[o],chainId:l,userUniqueId:s,chartTypeId:n,hasNft:p}),{ready:a,refreshDeps:[o,l,s,n,p],onError:t}),u=(0,ss.useMemoizedFn)(()=>{a&&c.run()});return{data:c,refresh:u}},hp=ab;g();m();var as=re(Yo());g();m();Os();Cs();var cb=()=>Fo(_r.getAssetChangeType),gp=cb;var lb=()=>{let{isWalletCreated:n}=Cr(),e=On(),t=is(),r=(0,as.useRequest)(gp,{ready:n&&!!e,onError:t,cacheKey:"assetChangeType"}),o=(0,as.useMemoizedFn)(()=>{r.run()});return{data:r,refresh:o}},mp=lb;var ub="current_asset_change_type",db=n=>{let e=!Jc(n)&&n!=="--",t=mp(),{data:r,loading:o,error:i}=t.data,[s,l]=(0,yp.useLocalStorageState)(ub),{usdToThisRate:p}=(0,_p.useSelector)(cl),f=(0,xo.useMemo)(()=>r?.data??[],[r?.data]),a=f.length>0,c=(0,xo.useMemo)(()=>f.find($=>$.chartTypeId===s)??f?.[0],[s,f]),u=c?.chartTypeId,_=hp(c?.chartTypeId),{loading:y,data:I,error:X}=_.data,D=$=>{l($.chartTypeId)},T=I?.data?.[0]?.assetAmount,U=!X&&T!==void 0,J=U&&e?zt.sub(n,T):void 0,V=U&&e&&J!==void 0&&T!==void 0,S=(0,xo.useMemo)(()=>{if(!!V)return zt.eq(T,0)?0:zt.mul(zt.div(J,T),100)},[J,T,V]),B=(0,xo.useMemo)(()=>{if(J!==void 0)return zt.mul(J,p)},[J,p]);return{hasTypes:a,types:f,typeLoading:o,typeError:i,typeId:u,onChangeType:D,loading:y,data:I,error:X,hasData:U,balanceAdd:B,balanceAddPercent:S,refresh:()=>{t.refresh(),_.refresh()}}},vp=db;g();m();var xc={addWeight:"_addWeight_17jnv_1",balance:"_balance_17jnv_1"};function fb(n){let{walletAsset:e,walletAssetUSD:t}=(0,bp.useSelector)(Ul),r=vp(t),[o,i]=Zo();return Mo.default.createElement(Mo.default.Fragment,null,Mo.default.createElement(cu,{balance:e,hiddenAssets:o,onRefresh:()=>{r.refresh(),n.onRefresh?.()},onToggleHiddenAssets:i,className:(0,Op.default)(xc.addWeight,xc.balance)}),Mo.default.createElement(fp,{hiddenAssets:o,data:r}))}var Cp=fb;var pb="54px",hb=({hasBar:n=!1})=>{let e=(0,Ep.useSelector)(wl),{isWalletCreated:t}=Cr(),{showErrorAlert:r}=ri(),o=On(),i=ti(),[{errorType:s,errorMsg:l},{createWalletToServer:p}]=Jl(),f=$l(),[a]=Zo(),c=(0,he.useRef)(null),[u,_]=(0,he.useState)(0),[y,I]=(0,he.useState)(!1),{isNeedShowDisconnectUpgrade:X,setDisconnectUpgrade:D}=Fl(),T=(0,he.useCallback)(()=>{X&&(bs.success({title:Ie("wallet_extension_card_subtitle_disconnect_update")}),D())},[X,D]),{isNotBackupWallet:U}=ei(),J=zl(),V=(0,he.useMemo)(()=>J?.originNoPrefix&&!U,[J,U]),S=(0,he.useRef)(null),B=(0,cs.useHistory)(),{search:L}=(0,cs.useLocation)(),[$,ne]=(0,he.useState)(0),{clickHandle:C,iconOptions:R}=tp();(0,he.useEffect)(()=>{r(s,l)},[l,s,r]),(0,ls.useMount)(()=>{fl()});let j=Il();(0,he.useEffect)(()=>{if(!L)return;let{redirectPathname:gt,redirectSearchParams:dr}=Dl(L);gt&&j(gt,{removeExistingSearchKeys:["redirect_pathname","redirect_search_params"],preserveState:!0,newSearchParams:Rl(dr)})},[L]);let{run:Q}=(0,ls.useDebounceFn)(()=>{ne(S.current?.scrollTop||0)},{wait:50,maxWait:50});au();let{titleLeft:le,titleRight:oe,subTitle:Fe,address:$e,chainName:Re,filterAddress:lt,filterHotAddress:ln,isFactionPKAccount:ut}=op(),un=async()=>{s!==ql.PENDING&&(bs.destroyAll(),await p())};(0,he.useLayoutEffect)(()=>{c.current&&U&&t&&_(c.current?.clientHeight||0)},[U,t]);let Bn=gt=>{S.current&&(S.current.scrollTop=gt)},Xn=(0,he.useCallback)(gt=>{I(!gt)},[]);return he.default.createElement("div",{id:Zl,"data-testid":Qo.HOME_PAGE.HOME_ROOT_ELEMENT_ID,className:"ok-home-page main-container",ref:S,onScroll:()=>{Q()},style:{height:n?`calc(100% - ${pb})`:"100%"}},he.default.createElement(nu,{titleLeft:le,titleRight:oe,subTitle:Fe,address:$e,chainName:Re,filterAddress:lt,filterHotAddress:ln,isNotBackupWallet:U,isFactionPKAccount:ut}),he.default.createElement(Cp,null),he.default.createElement(Ql,{clickHandle:C,iconOptions:R,customMore:gt=>he.default.createElement(Ou,{width:gt})}),he.default.createElement(bu,null),he.default.createElement(eu,{scrollTop:$,hiddenAssets:a,backupHeight:U?u+24:0,isWalletCreated:t,changeScrollTop:Bn,errorType:s,tryAgain:un,showDappConnectAffix:V}),t&&he.default.createElement("div",{ref:c},he.default.createElement(Bl,{offsetBottom:24+Xl})),he.default.createElement(Vl,{info:J,isNotBackupWallet:U,disconnectCallback:T}),t&&he.default.createElement(ru,{showBackup:()=>{i({text:Ie("wallet_dapp_conncetion_alert_backup_wallet")},e)}}),f&&he.default.createElement(Gl,{actionMap:{["RECOVER"]:()=>{B.push(`${yl}?action=${Ll.RECOVER}&walletId=${o}`)},["SWITCH_WALLET"]:()=>{B.push(`${zo}?fromHome=1`)}}}),he.default.createElement(fu,{walletId:o,onFetchApprovalRisk:Xn}),he.default.createElement(ap,{address:$e}),he.default.createElement(lp,null),he.default.createElement(dp,{shouldWhatsNewShow:y}))},dA=hb;export{dA as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-4IWL7T6R.js.map
