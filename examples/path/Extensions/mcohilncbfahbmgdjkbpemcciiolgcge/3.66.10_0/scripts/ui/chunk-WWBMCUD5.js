import{a as Ee,b as Fe}from"./chunk-Q5M243XX.js";import{a as Pe}from"./chunk-JRNVHROF.js";import{b as Le}from"./chunk-OMNHCLSU.js";import{b as ge,g as xe,i as Ae,l as Ie,m as Ce,q as he,r as Ne}from"./chunk-CQWP5UAS.js";import{a as Te}from"./chunk-UWCOP3B7.js";import{a as et,c as we,d as F}from"./chunk-7X4DXTSI.js";import{a as be}from"./chunk-LURPYTXM.js";import{a as It}from"./chunk-CIEH2J25.js";import{b as tt}from"./chunk-64LKONIY.js";import{B as ye,a as pe,l as R}from"./chunk-NKIUEXOA.js";import{a as _e}from"./chunk-4ZGOJDNI.js";import{d as de,g as ue}from"./chunk-7JSJY3SQ.js";import{c as fe}from"./chunk-NWY3GPDX.js";import{b as xt}from"./chunk-B3SXRDEQ.js";import{f as _t}from"./chunk-H5EE6AS6.js";import{h as yt,i as ae}from"./chunk-R7LZSAVU.js";import{e as At}from"./chunk-5A3RJQCM.js";import{h as le,l as ce,m as me}from"./chunk-AZNX5TUC.js";import{a as ie}from"./chunk-Q7FGM7BT.js";import{b as gt}from"./chunk-TKE74ERX.js";import{a as Tt}from"./chunk-QMENNGDH.js";import{r as b}from"./chunk-WGVA2GGS.js";import{o as se}from"./chunk-XP3TNE3R.js";import{jc as ro}from"./chunk-QRHYK2TW.js";import{a as so}from"./chunk-532YJKK4.js";import{j as re,p as oo}from"./chunk-Q4YLD24R.js";import{b as ne}from"./chunk-ZFTHPYIG.js";import{_ as Q,c as X,ia as oe}from"./chunk-4EIUGT5A.js";import{c as w}from"./chunk-62ZAND24.js";import{Eb as J,Jb as Gt,Ma as q,Na as Vt,Rd as $,Xd as Kt,_d as Xt,a as Yt,b as to,ee as K,ic as Zt,id as qt,jd as Jt,je as Qt,le as te,od as $t,oe as ee}from"./chunk-QHXUL3YM.js";import{H as Z,n as B,y as p}from"./chunk-MOTAOJVG.js";import{G as zt,d as jt,o as Ht}from"./chunk-XR4SQWL7.js";import{H as Rt,ra as eo}from"./chunk-CYTB2B6Q.js";import{b as D}from"./chunk-OL67KS7C.js";import{f as N,o as c,q as m}from"./chunk-SHG7TIBL.js";c();m();var t=N(D()),ze=N(ro()),Ve=N(so()),ot=N(se());eo();Z();oo();ee();$t();Kt();c();m();var C=N(D());Z();Kt();c();m();var Be={list:"_list_b7lh5_1"};var no=({coinId:e,value:n,visible:a,onToggleVisible:i,options:o,onChange:u})=>{let f=de(e),h=y=>{let{addressType:T,address:x,canTransferAmount:L}=y;return C.default.createElement(At.Card,{selected:n?.address===x,onClick:()=>{i?.(),u?.(y)}},C.default.createElement(w.Box,{style:{width:"100%"}},C.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},C.default.createElement(b.Text,{strong:!0},p($[T])),C.default.createElement(b.DisplayAmount,{strong:!0,mode:b.CRYPTO,decimals:f?.decimals,precision:f?.displayPrecision,isStableCoin:f?.stableCoin},L)),C.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},C.default.createElement(b.Address,{address:x,desensitize:!0,copyable:!1,size:b.SIZE.sm,type:b.TYPE.secondary}),C.default.createElement(b.Text,{type:b.TYPE.secondary,size:b.SIZE.xs},p("extension_wallet_available_coin_balance",{coin:f?.symbol})))))};return C.default.createElement(Ht,{visible:a,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:p("btcnft_gas_title_pay_gas_with"),onClose:i},C.default.createElement(At,{space:16,dataSource:o,renderItem:h,className:Be.list}))},ke=no;c();m();to();var Se=N(D()),ao=()=>(0,Se.useCallback)(({value:e,message:n,reportParams:a})=>{try{Yt.captureEvent({message:n,contexts:{report:{info:JSON.stringify(a)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(i){console.log(i)}},[]),Oe=ao;c();m();var j=N(D());ee();Vt();Gt();function io(e,n,a,i){let[o,u]=(0,j.useState)(a),[f,h]=(0,j.useState)([]);return(0,j.useEffect)(()=>{if(i?.chainId===void 0||i?.chainId===null)return;(async()=>{try{if(!a)return;let T=await J(q.checkDustForBtcTx,{inscriptionIds:n,targetAddress:e,scene:24,chain:i.chainId,tokenStandard:Qt(i.chainId)});h(T?.data?.dustInscriptionIds||[])}finally{u(!1)}})()},[a,e,n,i]),{isDustLoading:o,dustError:f.length>0}}var We=io;c();m();var Ue=N(D());Z();var lo=({isMpcWallet:e,isHardware:n,feeError:a,isSufficientGas:i,dustError:o,transferReminder:u,addressCheckError:f=""})=>({tipMessageProps:(0,Ue.useMemo)(()=>e?{type:F.TIP_TYPE.COMMON_ERROR,message:p("extension_wallet_contractual_interaction_wallet_unavailable")}:n?{type:F.TIP_TYPE.COMMON_ERROR,message:p("wallet_extension_top_toast_dapp_comingsoon")}:a?{type:F.TIP_TYPE.FEE_ERROR}:i?o?{type:F.TIP_TYPE.COMMON_ERROR,message:p("wallet_info_dialog_dust_limit_individually")}:f?{type:F.TIP_TYPE.COMMON_ERROR,message:f}:{type:jt.TYPE.warn,message:u}:{type:oe.FEE_BALANCE_INSUFFICIENT},[a,e,n,i,o,u,f])}),De=lo;c();m();var Me=N(se());Gt();Vt();var co=e=>{let{loading:n,data:a}=(0,Me.useRequest)(async()=>(await J(q.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[n,a||[]]},ve=co;c();m();var Ct=N(D());Z();$t();var mo=7*1e3,uo=({walletId:e,coinId:n,satBytes:a,needFilteredUtxo:i,localType:o=Zt})=>{let u=le(e),f=(0,Ct.useMemo)(()=>{let x=ne(o);return u?.addressType?.[x]||[]},[u?.walletId]),[h,y]=Ie({coinId:n,walletId:e,satBytes:a,addressList:f?.map(({address:x})=>x),needFilteredUtxo:i},{pollingInterval:mo,ready:!!i?.length&&!!a}),T=(0,Ct.useMemo)(()=>f.map((L,A)=>({...L,canTransferAmount:y[A]}))?.sort((L,A)=>{let rt=B.sub(A.canTransferAmount,L.canTransferAmount);return Number(rt)}),[y,f]);return[h,T]},Ye=uo;c();m();var ht={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var Re={Ordinals:"Ordinals",Atomicals:"Atomicals"},je=2,He="NFT",fo=({unapproved:e})=>{let n=e?.walletId,a=e?.localType,o=fe({localType:a})?.coinId;o===void 0&&(o=Jt(a));let[u,f]=ue(o),h=me(n),y=e.params.transfer.from,T=e.params.transfer.to,{feeRate:x}=e.params.transfer.options||{},L=Oe(),[,A]=Te({coinId:o,address:y,chainId:u?.chainId}),rt=A?.transferReminder,[Nt,H]=(0,ot.useSetState)({payWallet:!1,networkFee:!1}),[E,bt]=(0,t.useState)(x&&typeof x=="number"?{satBytes:x,level:Q.CUSTOM}:{satBytes:A?.normal,level:Q.STANDARD});(0,t.useEffect)(()=>{!E?.satBytes&&A?.normal&&bt({satBytes:A?.normal,level:Q.STANDARD})},[A,E]);let z=e.params.transfer.data,k=Array.isArray(z)&&z.length>1,{isDustLoading:wt,dustError:st}=We(T,z,k,f),[,l]=ve(z),M=(0,t.useMemo)(()=>{if(!Array.isArray(l)||!l?.length)return;let[{protocol:s}]=l||[];if(s===Re.Atomicals)return K.ARC_20},[l]),nt=(0,t.useMemo)(()=>l.map(s=>`${s.btcNftUtxoDetail?.txId}-${s.btcNftUtxoDetail?.outputIndex}`),[l]),[Lt,S]=Ye({localType:a,coinId:o,walletId:n,needFilteredUtxo:nt,satBytes:E?.satBytes}),[r,at]=(0,t.useState)({}),[it,{toggle:Ge}]=(0,ot.useBoolean)(!1);(0,t.useEffect)(()=>{let s=S?.[0];if(Rt(r)&&!!s&&s?.canTransferAmount&&at(s),S&&r.address&&r?.canTransferAmount){let d=S.find(({address:_})=>_===r?.address);d||L({value:d,reportParams:{payWallet:r,payWallets:S},message:`payWallet address get ${d}`}),d&&at(d)}},[L,r,S]);let v=(0,t.useMemo)(()=>l.map(s=>{let{tokenId:d,protocol:_}=s,{txId:U,outputIndex:Y,outputValue:Qe}=s?.btcNftUtxoDetail||{},vt={txHash:U,nftId:s.tokenId,status:1,address:y,vout:Number(Y),coinAmount:Number(Qe),resourceUrl:s?.resourceUrl};return _===Re.Atomicals&&Object.assign(vt,{data:[{atomicalId:d,type:He,amount:1}]}),vt}),[y,l]),Et=(0,t.useMemo)(()=>l.map(s=>{let d=s?.tokenId,{outputValue:_}=s?.btcNftUtxoDetail||{},U=Number(_);k||(U=B.lt(_,546)?546:Number(_));let Y={amount:U,address:T};return M===K.ARC_20&&Object.assign(Y,{data:[{atomicalId:d,type:He,amount:1}]}),Y}),[k,l,M,T]),lt=(0,t.useMemo)(()=>{if(!k){let{outputValue:s=0}=l?.[0]?.btcNftUtxoDetail||{};if(s<546)return B.sub(546,s)}return 0},[k,l]),[ct,g,V]=he({coinId:o,protocolId:M,toAddr:T,coinAmount:lt,fromAddr:r?.address,satBytes:E?.satBytes,utxoParams:{satBytes:E?.satBytes,needFilteredUtxo:nt},canTransferAmount:r?.canTransferAmount,inputs:v,outputs:Et},{ready:!!v?.length}),mt=k?X.BTC_NFT_BULK_SEND:X.SEND_NFT,Ft=Ne({coinId:o,walletId:n,protocolId:M,coinAmount:0,toAddr:T,fromAddr:y,changeAddr:r?.address,localType:u?.localType,dustSize:M===K.ARC_20?void 0:A?.minOutput,networkFee:g,satBytes:E.satBytes,inputs:v,outputs:Et}),dt=l.map(({tokenId:s})=>s),Ze=JSON.stringify({nftIds:dt,from:y,to:T,serviceCharge:g,gasFrom:r?.address}),Pt=ye({coinId:o,txType:mt,walletId:n,coinAmount:0,fromAddr:y,toAddr:T,networkFee:g,localType:u?.localType,extJson:Ze,txSource:Xt.NFT}),Bt=Ae({coinId:o,walletId:n,address:r.address,utxoType:ge.TRANSFER,satBytes:E?.satBytes,needFilteredUtxo:nt}),I=(0,ze.useDispatch)(),O=(0,Ve.useHistory)(),kt=Ce({coinId:o,txType:X.SEND_NFT,protocolId:te(u?.chainId),address:r.address}),ut=l?.length,qe=(0,t.useMemo)(()=>(l?.slice(0,it?ut:je)).map(({resourceUrl:d,name:_})=>({title:_,icon:{src:d}})),[l,it,ut]),W=(0,t.useMemo)(()=>!(r?.canTransferAmount&&B.lt(r?.canTransferAmount,B.add(g,lt))),[g,lt,r?.canTransferAmount]),Je=ce(n),[$e,ft]=(0,t.useState)(!1),G=(0,t.useCallback)(async()=>{e.id?(await I(yt(e.id)),await I(xt()),await re(I)):(I(_t()),W?O.goBack():O.replace(Tt)),ft(!1)},[I,O,W,e.id]),{addressCheckLoading:St,addressCheckError:pt}=Pe({from:y,chainIndex:qt(a),handleCancel:G,method:e.method}),{tipMessageProps:Ke}=De({isHardware:h,feeError:V,isSufficientGas:W,dustError:st,transferReminder:rt,addressCheckError:pt}),Ot=(0,t.useCallback)(async()=>{if(!await _e({walletId:n,callback:async()=>{await I(yt(e.id))}}))return;let d=await Bt(0,g);await kt([...v,...d],G),ft(!0);let _=await Ft({utxoList:[],utxos:[{address:r.address,inputs:xe(d)}]}),U=await pe(u?.localType,_);try{e.id?(await I(ae(e.id,{coinId:o,txHash:U,signedTx:_,serviceCharge:g,gasFrom:r.address,txType:mt,nftIds:dt})),await I(xt())):(await Pt(_),I(_t()),zt.success({title:p("wallet_transfer_notif_transaction_submit")})),O.push(Tt)}catch{}finally{ft(!1)}},[G,kt,u?.localType,I,g,Bt,O,W,dt,r.address,Pt,Ft,v,mt,e.id]),{loading:Wt,onClick:Ut}=It(Ot),{loading:Dt,onClick:Mt}=It(G),Xe=(0,t.useMemo)(()=>{let s={actionType:R.ACTION_TYPE.CANCEL,btnText:p("wallet_dapp_connection_btn_reject"),onClick:Mt,loading:Dt},d={disabled:Lt||ct||V||h||!Number(g)||!l?.length||wt||st||pt,actionType:R.ACTION_TYPE.CONFIRM,onClick:Ut,loading:Wt||St};return W||(d={coinId:o,walletId:n,address:r?.address,actionType:R.ACTION_TYPE.FILL_UP}),[s,d]},[Lt,ct,V,h,g,l?.length,Ot,W,e.id,I,O,o,n,r?.address,wt,st,Dt,Wt,Mt,Ut,St,pt]);return t.default.createElement(w.Box,null,t.default.createElement(et,null,t.default.createElement(we,{space:24,title:p("wallet_extension_send_colored_send"),summaryList:qe}),ut>je&&t.default.createElement(w.FlexBox,{justify:"center",className:ht["nft-transfer__extend"],onClick:Ge},t.default.createElement(gt,{size:gt.SIZE.xs,className:ht["nft-transfer__icon"],icon:it?"okds-arrow-chevron-up-md":"okx-wallet-plugin-add-arrow-chevrons"}))),t.default.createElement(et,null,t.default.createElement(tt,{walletId:n,address:y,title:p("extension_send_mid_text_from")}),t.default.createElement(tt,{address:T,title:p("extension_send_mid_text_to")})),t.default.createElement(et,null,t.default.createElement(be,{coinId:o,loading:ct,estimateFailed:V,networkFee:g,onClick:()=>{H({networkFee:!0})}}),t.default.createElement(tt,{copyable:!1,address:r?.address,addressType:r?.addressType,title:p("btcnft_gas_label_pay_gas_with"),tags:[p($[r?.addressType])],onClick:()=>{H({payWallet:!0})}},t.default.createElement(Ee,{coinBalance:r.canTransferAmount,coinId:o}))),t.default.createElement(ke,{coinId:o,value:r,options:S,visible:Nt.payWallet,onChange:at,onToggleVisible:()=>{H({payWallet:!1})}}),t.default.createElement(ie,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(F,{coinId:o,...Ke}),t.default.createElement(R,{buttonGroup:Xe})),t.default.createElement(Le,{coinId:o,signInfo:A,visible:Nt?.networkFee,value:E,estimatedFee:g,onChange:bt,onToggleVisible:()=>{H({networkFee:!1})}}),t.default.createElement(Fe,{visible:Je&&$e}))},Qr=fo;export{Qr as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-WWBMCUD5.js.map
