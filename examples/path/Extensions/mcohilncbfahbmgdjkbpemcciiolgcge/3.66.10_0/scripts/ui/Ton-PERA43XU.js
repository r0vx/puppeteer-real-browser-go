import{a as pe,b as ge}from"./chunk-ESFVNQVW.js";import{a as ue,b as de}from"./chunk-DP2SXYTT.js";import"./chunk-A4QA4J4S.js";import"./chunk-CXT4EHFX.js";import"./chunk-W3MRBSTV.js";import"./chunk-HPJHY2AY.js";import"./chunk-CK7Z2DAQ.js";import"./chunk-5E2Y3UHC.js";import{a as le}from"./chunk-OQZ6UOCK.js";import{a as me}from"./chunk-V2QGBG3D.js";import"./chunk-5TLDWKXV.js";import"./chunk-7GRDW7ZD.js";import"./chunk-CQWP5UAS.js";import"./chunk-UWCOP3B7.js";import"./chunk-6DUYAS7R.js";import"./chunk-NLKYL456.js";import"./chunk-CEM2RCMY.js";import"./chunk-7X4DXTSI.js";import"./chunk-LURPYTXM.js";import"./chunk-OADPFYBO.js";import"./chunk-CIEH2J25.js";import"./chunk-64LKONIY.js";import"./chunk-VVJ6BK3Q.js";import"./chunk-FUVVPSUI.js";import{n as ie,t as ce,x as J}from"./chunk-NKIUEXOA.js";import"./chunk-EP23RRSK.js";import{c as fe}from"./chunk-4YDY4B6P.js";import"./chunk-CGFS6AE4.js";import"./chunk-DDT324RS.js";import"./chunk-2TQXMDYZ.js";import"./chunk-RNMISV22.js";import"./chunk-A267SEFJ.js";import"./chunk-VR7OPIR6.js";import{a as D}from"./chunk-HBWTVKRO.js";import"./chunk-4ZGOJDNI.js";import"./chunk-ZPQXBUKT.js";import"./chunk-35Y7QMWN.js";import"./chunk-VIT5MDY4.js";import"./chunk-RH6WPBEZ.js";import{A as ae,z as se}from"./chunk-CDNJY7Z3.js";import"./chunk-DBWXHHZT.js";import"./chunk-VVKAQ7K5.js";import{d as V}from"./chunk-7JSJY3SQ.js";import"./chunk-NWY3GPDX.js";import"./chunk-6JEFG7DQ.js";import"./chunk-B6YXJZUF.js";import"./chunk-4I2JSOYJ.js";import"./chunk-GTN3RCGH.js";import"./chunk-3VKPY2QL.js";import"./chunk-AOSRFQ4E.js";import"./chunk-ULL77AIR.js";import"./chunk-PJYSMRRW.js";import"./chunk-GKQQDLVP.js";import"./chunk-7YKP5374.js";import"./chunk-KGG7DXMS.js";import"./chunk-FGIHS4ZF.js";import"./chunk-U65R4NF3.js";import"./chunk-OTUJWRS5.js";import"./chunk-WIW5JVRP.js";import"./chunk-7CXUJS4C.js";import"./chunk-ULXZERAJ.js";import"./chunk-PJ5X5CUU.js";import"./chunk-TSVRDRPO.js";import"./chunk-PPTAKQQT.js";import"./chunk-IFQDHP3Z.js";import"./chunk-DA5RJYYW.js";import"./chunk-HUC3JPS2.js";import"./chunk-MYNDXPHU.js";import"./chunk-ZTIVM5ML.js";import"./chunk-2E2OBQTS.js";import"./chunk-VICEBZ4G.js";import"./chunk-WO6OHGU2.js";import"./chunk-3S4BGA37.js";import"./chunk-POP3LIKS.js";import"./chunk-PMRTKWFS.js";import"./chunk-G44PPNNQ.js";import"./chunk-K2BSCLBF.js";import"./chunk-PZY7HRHV.js";import"./chunk-Z2L2F5M5.js";import"./chunk-IPLOJJIA.js";import"./chunk-RLPRDJ34.js";import"./chunk-2ASICJQL.js";import"./chunk-TQWSBAXG.js";import"./chunk-6JVCYB7O.js";import"./chunk-GR42TVIZ.js";import"./chunk-QMSSDBOR.js";import"./chunk-A5XY2FFW.js";import"./chunk-F6UVHIJV.js";import"./chunk-ZLJJZYPU.js";import"./chunk-5TNLDTW5.js";import"./chunk-34JXWTF5.js";import"./chunk-JSOLAK4X.js";import"./chunk-R7LZSAVU.js";import"./chunk-LTLRDXME.js";import"./chunk-RMI6BAM3.js";import"./chunk-AADHEW4J.js";import"./chunk-OK4242CI.js";import"./chunk-6MVL4I6V.js";import"./chunk-E7MGN3V4.js";import"./chunk-YGIVEMKT.js";import"./chunk-T4RFDN7D.js";import"./chunk-NQAVUB4Q.js";import"./chunk-IEGAVAV7.js";import"./chunk-V4P2E4SN.js";import"./chunk-DYL77QBO.js";import"./chunk-5A3RJQCM.js";import"./chunk-MN3UHDTX.js";import"./chunk-IJW6HFV5.js";import"./chunk-N2MMFEEK.js";import"./chunk-MKDQBVRZ.js";import"./chunk-DA2FCNEZ.js";import"./chunk-TLZRRG7J.js";import"./chunk-ZFFAX2YS.js";import"./chunk-7UDMBSMI.js";import"./chunk-7C7MBE2C.js";import"./chunk-KJWX5V23.js";import"./chunk-KDVER5QK.js";import"./chunk-5CHE7P4E.js";import"./chunk-PD44C7EF.js";import"./chunk-6K6UF6OE.js";import"./chunk-OKXHAJNT.js";import"./chunk-CBHKW7LL.js";import"./chunk-67F2WFQO.js";import"./chunk-QYDRYMWS.js";import"./chunk-AZNX5TUC.js";import"./chunk-JU4HVVJ2.js";import"./chunk-NKWTNXAD.js";import"./chunk-XZE3C5KK.js";import"./chunk-XZE3L7K7.js";import"./chunk-Y5K5NJ6U.js";import"./chunk-UR7XESQE.js";import"./chunk-JABAEAEN.js";import"./chunk-VY2VK2OT.js";import"./chunk-Q7FGM7BT.js";import"./chunk-TKE74ERX.js";import"./chunk-MONRGJFN.js";import"./chunk-RYT7JDQV.js";import"./chunk-CZZFLX67.js";import"./chunk-IK72BO4I.js";import"./chunk-QMENNGDH.js";import"./chunk-KANXVZ35.js";import"./chunk-WGVA2GGS.js";import"./chunk-APGT6UVG.js";import"./chunk-V34MB2FG.js";import{o as Ge}from"./chunk-XP3TNE3R.js";import{Xa as re,Ya as oe,jc as Le}from"./chunk-QRHYK2TW.js";import"./chunk-PODZSVO7.js";import"./chunk-QO4JMOUQ.js";import"./chunk-7N263AYH.js";import"./chunk-532YJKK4.js";import{j as ne,p as ve}from"./chunk-Q4YLD24R.js";import"./chunk-K5ZGZULR.js";import"./chunk-M6J3OOFH.js";import"./chunk-ZDOH3CEJ.js";import{c as te,e as Ne}from"./chunk-AS4Z3FNS.js";import"./chunk-KW2XDOEY.js";import"./chunk-2FDQIA7D.js";import"./chunk-L524QXHA.js";import"./chunk-ZFTHPYIG.js";import"./chunk-N6DAHVYW.js";import"./chunk-YCFHPQAJ.js";import{da as L}from"./chunk-4EIUGT5A.js";import"./chunk-7FRDKLRJ.js";import"./chunk-P7VKC6DQ.js";import"./chunk-D7FW64MN.js";import"./chunk-6ZZOO2CD.js";import"./chunk-JPTLCZ2Y.js";import"./chunk-COS5CL3D.js";import"./chunk-VL2YBSHB.js";import"./chunk-AVC4ODUV.js";import"./chunk-RJ3YTAFM.js";import"./chunk-OCAFSBNZ.js";import"./chunk-62ZAND24.js";import"./chunk-SIITVWZR.js";import{Ec as ee,R as Y,ab as $,bd as h,ia as Re,ib as De,od as Q}from"./chunk-QHXUL3YM.js";import{H as Z,y as w}from"./chunk-MOTAOJVG.js";import"./chunk-FYTT4U7M.js";import{H as z}from"./chunk-XR4SQWL7.js";import"./chunk-NCGYY6X6.js";import"./chunk-LMBQGBLO.js";import"./chunk-QWIXUG3W.js";import"./chunk-Z3JMRMVO.js";import{L as K,ra as Me}from"./chunk-CYTB2B6Q.js";import"./chunk-CAFKDDXA.js";import"./chunk-CTOTVO2J.js";import"./chunk-T2ETCKOI.js";import"./chunk-6P63CWAB.js";import"./chunk-RJPAKY6O.js";import"./chunk-ZCK5UHUS.js";import"./chunk-ANUO2YYF.js";import"./chunk-6M3PZK2X.js";import"./chunk-TPIKSUHH.js";import{b as G}from"./chunk-OL67KS7C.js";import"./chunk-TVBFJITU.js";import"./chunk-D2YP6KBJ.js";import"./chunk-2EEW2VNF.js";import"./chunk-TLR6EQX6.js";import"./chunk-S5ACFHVS.js";import"./chunk-FQLRWF7X.js";import"./chunk-NLMDM2WF.js";import"./chunk-BJAL3374.js";import"./chunk-KDUIZVRC.js";import"./chunk-VYKQ62AB.js";import"./chunk-263G66VF.js";import"./chunk-SUANL2KV.js";import"./chunk-KTFU3F6C.js";import"./chunk-2OVRHWIW.js";import"./chunk-32ZJ4F2J.js";import"./chunk-WIP2REO7.js";import"./chunk-JBHIVXO6.js";import"./chunk-LECESFCD.js";import"./chunk-NW4HKKTQ.js";import"./chunk-EBMX24YQ.js";import"./chunk-3C4MEE67.js";import"./chunk-R4BHRBC7.js";import{f as k,o as m,q as u}from"./chunk-SHG7TIBL.js";m();u();var ye=k(G());m();u();var F=k(G()),Ae=k(Le());Z();Ne();ve();Q();m();u();var E=k(G());Me();Re();var Oe=({code:e,data:o,error_message:n,error:a})=>{if(e!==0||!o||o.queryGasLimitErrorUseDefault||a)return{fee:0,feeError:!0,feeErrorMsg:n};let{gasLimit:s="0"}=o;return{...o,fee:s,feeError:!1,feeErrorMsg:""}},Be=e=>e?.feeError&&e?.feeErrorMsg?e.feeErrorMsg:"",We=(e,o)=>{let n=K(e)||Y(e,o),a=K(e)||Y(e,0);return{isSufficientGas:n,isSufficientBalance:a}},be=({coinId:e,unapproved:o,paramsInfo:n})=>{let{coin:a,toAdr:s,fromAddr:t,walletId:i,messages:r,network:c,validUntil:T}=n,{chainId:I,localType:f}=a||{},l=me(e,o.walletId)||{},{coinAmountInt:x}=l,M=J(),A=(0,E.useRef)(null),[C,g]=(0,E.useState)(!0),[d,P]=(0,E.useState)({}),[_,B]=(0,E.useState)({});(0,E.useEffect)(()=>{f&&e&&t&&i&&r&&(async()=>{try{g(!0);let p=await M({coinId:e,address:t,toAddr:s,fromAddr:t}),S=await se({nonce:p?.nonce,localType:f,fromAddr:t,walletId:i,messages:r,network:c,validUntil:T});B({signInfo:p,sequence:p?.nonce,inputData:JSON.stringify(S?.stringInputParams),transactionParams:S?.transactionParams})}catch(p){g(!1),P({feeError:!0,feeErrorMsg:p?.message})}})()},[f,e,t,i,r]),(0,E.useEffect)(()=>((()=>{let{inputData:p}=_;if(g(!0),p){let S=async()=>{let b=await ae({fromAddr:t,chainId:I,coinId:e,inputData:p}),q=Oe(b);g(!1),P(q)};(()=>{clearInterval(A.current),S(),A.current=setInterval(S,7e3)})()}})(),()=>{clearInterval(A.current)}),[_.inputData,I,t,e]);let{isSufficientGas:W,isSufficientBalance:U}=We(x,d?.fee),N=Be(d);return{networkFeeProps:{coinId:e,loading:C,estimateFailed:d?.feeError,estimateFailedMsg:N,networkFee:d?.fee},isSufficientGas:W,isSufficientBalance:U,estimateFailed:d?.feeError,estimateFailedMsg:N,extParams:{coinId:e,coinAmount:0,inputData:_?.inputData,fromAdr:t,toAdr:s,serviceCharge:d?.fee,extJson:JSON.stringify({nonce:_?.sequence}),txSource:2,accountId:o?.walletId,walletType:2,transactionParams:_?.transactionParams},coinWithBalance:l}},_e=be;m();u();Q();function Ve(e){let o=V(h)||{},{address:n,walletId:a}=D(e),s=e?.params?.transaction||{},t=s?.messages||[],i=s?.network,r=s?.valid_until,{address:c}=t[0]||{};return{toAdr:c,coin:o,fromAddr:n,walletId:a,messages:t,validUntil:r,network:i}}var we=Ve;m();u();var y=k(G());var Je=({origin:e,walletId:o,localType:n})=>{let a=ce(),[s,t]=(0,y.useState)(!0),{host:i}=le({origin:e}),r=D({walletId:o,localType:n}),[c,T]=(0,y.useState)({}),I=(0,y.useCallback)(async(x,M,A)=>{let C="";try{C=JSON.stringify(A)}catch{}let{coinId:g,chainId:d}=x,P=await a({coinId:g,checkTypes:[L.KYS,L.VERIFY_GAS_LIMIT],amount:0,from:r.address,to:"",txType:3,domain:i,tokenAddress:"",inputData:M,chainId:d,additionalData:{tonSignData:C}});T(P),t(!1)},[i,a,r.address]),f=(0,y.useMemo)(()=>({loading:s,...c[L.KYS]||{}}),[s,c]),l=(0,y.useMemo)(()=>c[L.VERIFY_GAS_LIMIT]||{},[c]);return{kysRet:f,loading:s,preExecute:I,preExecuteRet:c,verifyGasLimitRet:l}},Ee=Je;m();u();var Te=k(G()),Ie=k(Ge());Z();De();Q();function Ue({transaction:e,fromAddress:o}){let{valid_until:n,network:a,from:s,messages:t}=e,[i,r]=(0,Te.useState)("");return(0,Ie.useAsyncEffect)(async()=>{if(a!==re.MAINNET)r(w("wallet_extension_error_incorrect_destination_network"));else if(n<Math.floor(Date.now()/1e3))r(w("wallet_extension_error_expired_transaction"));else if(!t||t.length===0)r(w("wallet_extension_error_invalid_transaction_parameter"));else{let{TonWallet:c}=await $(),T=new c;for(let l=0;l<t.length;l++){let x=t[l]?.address;if(!await fe(x,h)){r(w("wallet_extension_error_incorrect_destination_network"));return}}let I=await T.convertAddress({address:o}),f=await T.convertAddress({address:s});I?.raw!==f?.raw&&r(w("wallet_extension_error_incorrect_receiving_address"))}},[n,a,s,o]),{checkParamsTipMessage:i?{message:i}:null,code:i?oe.BAD_REQUEST_ERROR:null}}var xe=Ue;var qe=(0,F.memo)(({unapproved:e})=>{let o=(0,Ae.useDispatch)(),n=V(h)||{},a=n?.coinId||h,{walletId:s,address:t,addressType:i}=D(e),r=we(e),T=(i?.[ee]||[]).find(R=>R.address===t),I=J(),{networkFeeProps:f,isSufficientGas:l,estimateFailed:x,estimateFailedMsg:M,isSufficientBalance:A,extParams:C,coinWithBalance:g}=_e({coinId:a,unapproved:e,paramsInfo:r}),{id:d,origin:P,localType:_}=e,B=Ee({origin:P,walletId:s,localType:_}),{inputData:W,transactionParams:U}=C,N=(0,F.useRef)(),{preExecute:j,kysRet:v,verifyGasLimitRet:p}=B,S=e?.params?.transaction||{};(0,F.useEffect)(()=>{n?.coinId&&!f?.loading&&!N.current&&(N.current=!0,j(n,W,S))},[n?.coinId,f?.loading,W]);let H=ue({kysRet:v,baseCoin:n,estimateFailed:x,estimateFailedMsg:M,isSufficientGas:l,isSufficientBalance:A,verifyGasLimitRet:p,coinWithBalance:g}),{checkParamsTipMessage:b,code:q}=xe({transaction:S,fromAddress:t}),Fe=pe({id:d,walletId:s,origin:P,localType:_,extraParams:{code:q}}),Ce=b||H,Pe=async()=>{try{let R=await I({coinId:a,address:r?.fromAddr,toAddr:r?.toAdr,fromAddr:r?.fromAddr}),X=await te().approveDappRequest(d,{...C,transactionParams:{...U,seqno:R?.nonce,walletVersion:T?.addressType},extJson:JSON.stringify({nonce:R?.nonce})});if(X.code===10009){z.error(X?.msg||w("wallet_extension_failure_subtitle_fail_resend"));return}await ne(o)}catch(R){z.error(R?.msg||w("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:ke,handleCancel:he}=ge({coinId:a,unapproved:e,preExecuteRet:B,feeLoading:f?.loading,estimateFailed:x,isSufficientGas:l,isSufficientBalance:A,disabledConfirmBtn:!!b,onConfirm:Pe,onCancel:Fe,coinWithBalance:g});return ie({kysRet:v,handleCancel:he}),F.default.createElement(de,{kysRet:v,unapproved:e,tipMessage:Ce,buttonGroup:ke,networkFee:f})}),Se=qe;var Jt=({unapproved:e})=>ye.default.createElement(Se,{unapproved:e});export{Jt as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Ton-PERA43XU.js.map
