import{f as Rt}from"./chunk-Z475AMKL.js";import"./chunk-PZSN2XKL.js";import"./chunk-6Q4OK5GJ.js";import"./chunk-OAW4CIA6.js";import{a as Dt}from"./chunk-6DUYAS7R.js";import"./chunk-A267SEFJ.js";import"./chunk-VR7OPIR6.js";import{a as Pt,b as vt,c as Lt}from"./chunk-35Y7QMWN.js";import{a as w,b as kt,d as Mt}from"./chunk-RH6WPBEZ.js";import"./chunk-32XJE5HT.js";import{a as j}from"./chunk-3FBTFEMV.js";import{k as Ot}from"./chunk-MRHV2NKN.js";import"./chunk-ONWPWBS4.js";import"./chunk-UM2UK5YS.js";import"./chunk-U7FUSLT6.js";import{g as Q}from"./chunk-R7LZSAVU.js";import"./chunk-NQAVUB4Q.js";import{a as $}from"./chunk-DA2FCNEZ.js";import"./chunk-TLZRRG7J.js";import"./chunk-KDVER5QK.js";import"./chunk-5CHE7P4E.js";import"./chunk-PD44C7EF.js";import"./chunk-6K6UF6OE.js";import"./chunk-OKXHAJNT.js";import"./chunk-CBHKW7LL.js";import"./chunk-67F2WFQO.js";import"./chunk-QYDRYMWS.js";import{h as wt}from"./chunk-AZNX5TUC.js";import"./chunk-JU4HVVJ2.js";import"./chunk-NKWTNXAD.js";import"./chunk-XZE3L7K7.js";import"./chunk-NS7RQN2C.js";import"./chunk-7IRBVBKW.js";import"./chunk-OS3ZP336.js";import"./chunk-WJ3PVDDF.js";import"./chunk-SRDHWFY4.js";import"./chunk-OVC6PVQJ.js";import"./chunk-7IJVOYMR.js";import"./chunk-BO5YOOQA.js";import{f as At}from"./chunk-QTKQMZ5K.js";import{a as bt}from"./chunk-Y5K5NJ6U.js";import"./chunk-UR7XESQE.js";import"./chunk-JABAEAEN.js";import"./chunk-VY2VK2OT.js";import{a as F}from"./chunk-Q7FGM7BT.js";import"./chunk-TKE74ERX.js";import"./chunk-MONRGJFN.js";import"./chunk-RYT7JDQV.js";import{a as Ct}from"./chunk-CZZFLX67.js";import"./chunk-IK72BO4I.js";import{b as W,ob as yt}from"./chunk-QMENNGDH.js";import"./chunk-KANXVZ35.js";import{r as u}from"./chunk-WGVA2GGS.js";import"./chunk-APGT6UVG.js";import"./chunk-V34MB2FG.js";import"./chunk-XP3TNE3R.js";import{$b as z,_b as xt,jc as lt,zb as Y}from"./chunk-QRHYK2TW.js";import"./chunk-PODZSVO7.js";import"./chunk-QO4JMOUQ.js";import"./chunk-7N263AYH.js";import{a as ht}from"./chunk-532YJKK4.js";import"./chunk-Q4YLD24R.js";import"./chunk-K5ZGZULR.js";import"./chunk-M6J3OOFH.js";import"./chunk-ZDOH3CEJ.js";import{c as g,e as V}from"./chunk-AS4Z3FNS.js";import"./chunk-KW2XDOEY.js";import"./chunk-L524QXHA.js";import"./chunk-ZFTHPYIG.js";import"./chunk-N6DAHVYW.js";import"./chunk-YCFHPQAJ.js";import"./chunk-4EIUGT5A.js";import"./chunk-7FRDKLRJ.js";import"./chunk-P7VKC6DQ.js";import"./chunk-D7FW64MN.js";import"./chunk-6ZZOO2CD.js";import"./chunk-JPTLCZ2Y.js";import"./chunk-COS5CL3D.js";import"./chunk-VL2YBSHB.js";import{d as Nt}from"./chunk-AVC4ODUV.js";import"./chunk-RJ3YTAFM.js";import{a as Z}from"./chunk-OCAFSBNZ.js";import{c as N}from"./chunk-62ZAND24.js";import"./chunk-SIITVWZR.js";import{Xa as ct,Zd as St,ib as jt,oe as Gt}from"./chunk-QHXUL3YM.js";import{H as st,y as n}from"./chunk-MOTAOJVG.js";import"./chunk-FYTT4U7M.js";import{G as at,J as K,e as It,o as it}from"./chunk-XR4SQWL7.js";import"./chunk-NCGYY6X6.js";import"./chunk-LMBQGBLO.js";import"./chunk-QWIXUG3W.js";import"./chunk-Z3JMRMVO.js";import"./chunk-CYTB2B6Q.js";import"./chunk-CAFKDDXA.js";import"./chunk-CTOTVO2J.js";import"./chunk-T2ETCKOI.js";import"./chunk-6P63CWAB.js";import"./chunk-RJPAKY6O.js";import"./chunk-ZCK5UHUS.js";import"./chunk-ANUO2YYF.js";import{fa as U,ka as d}from"./chunk-6M3PZK2X.js";import"./chunk-TPIKSUHH.js";import{b as C}from"./chunk-OL67KS7C.js";import"./chunk-TVBFJITU.js";import"./chunk-2EEW2VNF.js";import"./chunk-TLR6EQX6.js";import"./chunk-NLMDM2WF.js";import"./chunk-BJAL3374.js";import"./chunk-KDUIZVRC.js";import"./chunk-263G66VF.js";import"./chunk-SUANL2KV.js";import"./chunk-2OVRHWIW.js";import"./chunk-32ZJ4F2J.js";import"./chunk-WIP2REO7.js";import"./chunk-JBHIVXO6.js";import"./chunk-LECESFCD.js";import"./chunk-NW4HKKTQ.js";import"./chunk-EBMX24YQ.js";import"./chunk-3C4MEE67.js";import"./chunk-R4BHRBC7.js";import{f as T,o,q as r}from"./chunk-SHG7TIBL.js";o();r();var Kt=T(ht()),c=T(C()),nt=T(lt());V();st();o();r();var G={container:"_container_1on3b_1",main:"_main_1on3b_7",title:"_title_1on3b_10",subTitle:"_subTitle_1on3b_17",qrCode:"_qrCode_1on3b_23",scanImg:"_scanImg_1on3b_27",scanTip:"_scanTip_1on3b_31",notHaveWalletImg:"_notHaveWalletImg_1on3b_35",notHaveWalletTitle:"_notHaveWalletTitle_1on3b_40",notHaveWalletSubTitle:"_notHaveWalletSubTitle_1on3b_47",scanStatusTip:"_scanStatusTip_1on3b_50",loadingContainer:"_loadingContainer_1on3b_54"};o();r();var J=T(C());V();var mt=T(lt());o();r();V();var X=T(C()),M=()=>{let[t,i]=(0,X.useState)(null);return(0,X.useEffect)(()=>{(async()=>{let a=await g().getMpcToken();i(a)})()},[]),t};var p={IMPORTED:"IMPORTED",NOT_CREATE:"NOT_CREATE",NOT_IMPORTED:"NOT_IMPORTED",TOKEN_EXPIRED:"TOKEN_EXPIRED",ACCOUNT_MISMATCH:"ACCOUNT_MISMATCH",VERIFY_PASS:"VERIFY_PASS",RECOVER:"RECOVER"},Ut=()=>{let t=M(),i=(0,mt.useSelector)(xt),a=(0,mt.useSelector)(z),[l,e]=(0,J.useState)(null);return(0,J.useEffect)(()=>{!t||(async()=>{try{let{data:m}=await vt({},{headers:{Authorization:t}}),{mpcId:_}=m;switch(i){case w.VERIFY:{let f=await g().getMpcIdByWalletId(a);e({...m,accountStatus:f!==_?p.ACCOUNT_MISMATCH:p.VERIFY_PASS});break}case w.RECOVER:{if(_)try{await g().checkMpcIdIsImported(_),e({...m,accountStatus:p.RECOVER})}catch{e({...m,accountStatus:p.IMPORTED})}else e({...m,accountStatus:p.NOT_CREATE});break}case w.IMPORT:case w.NO_ACTION:{if(_)try{await g().checkMpcIdIsImported(_),e({...m,accountStatus:p.NOT_IMPORTED})}catch{e({...m,accountStatus:p.IMPORTED})}else e({...m,accountStatus:p.NOT_CREATE});break}default:break}}catch{e({accountStatus:p.TOKEN_EXPIRED})}})()},[t]),{accountInfo:l}};o();r();var P=T(C());o();r();var tt={img:"_img_18f4s_1",title:"_title_18f4s_6",text:"_text_18f4s_13"};var et=({text:t,title:i,footer:a})=>{let l=Nt({dark:"/cdn/assets/imgs/246/3CD5B03CE6E2FC68.png",light:"/cdn/assets/imgs/246/F1105B2119166F9E.png"});return P.default.createElement(P.default.Fragment,null,P.default.createElement("img",{className:tt.img,src:l,alt:""}),P.default.createElement(u.Text,{className:tt.title,align:u.ALIGN.center},i),P.default.createElement(u.Text,{size:u.SIZE.sm,align:u.ALIGN.center,className:tt.text},t),a)};o();r();var v=T(C());st();o();r();var _t={"retina-border-basic":"_retina-border-basic_2bcuq_1",retinaBorderBasic:"_retina-border-basic_2bcuq_1",main:"_main_2bcuq_29",title:"_title_2bcuq_63"};var Wt=()=>{let t=Z(),i=j(),a=$(),l=()=>{globalThis.open(a.download||`https://${i}/download`)};return v.default.createElement(F,{offsetBottom:0},v.default.createElement(N.FlexBox,{className:_t.main,align:N.ALIGN.center},v.default.createElement(It,{width:32,height:32,alt:"",src:`${t}/cdn/assets/imgs/237/A229988567261685.png`}),v.default.createElement(u.Text,{size:u.SIZE.md,className:_t.title},n("extension_wallet_qr_title_app_download")),v.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.xs,onClick:l},n("extension_wallet_qr_btn_download"))))};o();r();var s=T(C()),B=T(lt()),Bt=T(ht());st();V();jt();Gt();o();r();var A=T(C());var Xt=3e3,S={SCAN_NOT:-1,SCAN_SUCCESS:0,SCAN_FAIL:1,SHARE2_UPLOADED:2,SHARE2_UPLOAD_FAIL:3,NET_WORK_ERROR:"NET_WORK_ERROR"},Ft=(t,i)=>{let[a,l]=(0,A.useState)({status:S.SCAN_NOT}),e=M(),m=(0,A.useRef)(null),_=()=>{m.current&&clearInterval(m.current),l({status:S.SCAN_NOT})},f=(0,A.useCallback)(async()=>{try{let{data:I}=await Pt({pubKey:t},{headers:{Authorization:e}}),{status:y,cipherText:O,mpcId:k}=I;l({status:y,cipherText:O,mpcId:k})}catch{l({status:S.NET_WORK_ERROR})}},[t,e]);return(0,A.useEffect)(()=>!t||!i?.mpcId?()=>{_()}:(f(),m.current=setInterval(async()=>{await f()},Xt),()=>{_()}),[t,e,i?.mpcId]),{scanInfo:a,clear:_}};o();r();var x=T(C());o();r();var ot={scanImg:"_scanImg_r7slg_1",scanStatusTip:"_scanStatusTip_r7slg_5",loadingTip:"_loadingTip_r7slg_9"};var L=({onClick:t=()=>{},imgSrc:i,text:a,loading:l=!1})=>{let e=Z();return x.default.createElement(N.FlexBox,{onClick:t,direction:N.DIRECTION.vertical,align:N.ALIGN.center},l?x.default.createElement(x.default.Fragment,null,x.default.createElement(U.Circle,{size:U.SIZE.lg}),x.default.createElement(u.Text,{className:ot.loadingTip,size:u.SIZE.sm},a)):x.default.createElement(x.default.Fragment,null,x.default.createElement("img",{className:ot.scanImg,src:`${e}${i}`,alt:""}),x.default.createElement(u.Text,{className:ot.scanStatusTip,size:u.SIZE.sm},a)))};o();r();var b={container:"_container_7ejxx_1",main:"_main_7ejxx_7",title:"_title_7ejxx_10",subTitle:"_subTitle_7ejxx_17",qrCode:"_qrCode_7ejxx_23",scanImg:"_scanImg_7ejxx_28",scanTip:"_scanTip_7ejxx_32",scanStatusTip:"_scanStatusTip_7ejxx_36"};var Jt="okx_mpc:",te=({accountInfo:t,userInfo:i})=>{let a=(0,Bt.useHistory)(),l=(0,B.useDispatch)(),[e,m]=(0,s.useState)(!1),[_,f]=(0,s.useState)({}),[I,y]=(0,s.useState)(!1),O=(0,B.useSelector)(Y),k=(0,B.useSelector)(z),pt=wt(k),{scanInfo:D,clear:ut}=Ft(_.publicKey,t),Vt=i?.email||"",ft=async()=>{m(!0),y(!1);let R=Dt();try{let h=await R.exec("genRsaPair");f(h)}catch{y(!0)}finally{m(!1)}};(0,s.useEffect)(()=>{ft()},[]);let[Yt,dt]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{let{AesEncodeQRCodeInfo:R}=await ct();if(_.publicKey&&i.uuid){let h={publicKey:_.publicKey,time:Date.now(),uId:i.uuid},q=R(JSON.stringify(h),i.uuid);dt(`${Jt}${q}`);return}dt("")})()},[_,i.uuid]);let H=async()=>{ut(),ft()},zt=(0,s.useCallback)(()=>{if(I)return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_refresh_qr_code")});if(e)return s.default.createElement(L,{loading:!0,onClick:H,text:n("extension_wallet_qr_text_loading")});switch(D.status){case S.SCAN_SUCCESS:return s.default.createElement(L,{imgSrc:"/cdn/assets/imgs/237/0929F8643613BD4F.png",text:n("extension_wallet_qr_text_confirm_mobile")});case S.SCAN_FAIL:case S.SHARE2_UPLOAD_FAIL:return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_sync_failed")});case S.NET_WORK_ERROR:return s.default.createElement(L,{onClick:H,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:n("extension_wallet_qr_text_network_failed")});case S.SHARE2_UPLOADED:default:return null}},[D,I,e]);return(0,s.useEffect)(()=>{(async()=>{let{status:R,cipherText:h,mpcId:q}=D;if(R===S.SHARE2_UPLOADED){let{phone:Qt="",approvedPetname:Tt=""}=i,gt={approvedPetname:Tt,phone:Qt,email:Vt,walletName:Tt};if(l(Q.setKeepOpen({show:!0})),O){let{RSADecodeQRCodeInfo:Zt}=await ct(),$t=await Zt(h,_.privateKey);if(await g().importMpcWallet({share2:$t,mpcId:q,userInfo:gt}),Ct(),t.accountStatus===p.RECOVER&&pt?.status?.mpcStatus===Mt.RECOVER&&pt?.keyringIdentityType===St.MPC){let Et=await g().getWalletIdentityByWalletId(k);Et?.groupId&&await l(At(Et.groupId))}a.push(W)}else await l(Ot({cipherText:h,privateKey:_.privateKey,mpcId:q,userInfo:gt})),a.push(`${yt}?from=${Rt.MPC}`);ut()}})()},[D,_]),s.default.createElement(s.default.Fragment,null,s.default.createElement(K,{className:b.qrCode,level:K.LEVEL.Q,text:Yt,type:K.TYPE.svg,size:232,cornersDotOptions:{type:"dot"},cornersSquareOptions:{type:"dot"},dotsOptions:{type:"dots"},mask:D.status!==S.SCAN_NOT||I||e,renderMaskCon:zt}))},ee=({accountInfo:t,userInfo:i={},accountName:a})=>s.default.createElement("div",{className:b.container},s.default.createElement("div",{className:b.main},s.default.createElement("div",{className:b.title},n("extension_wallet_qr_title_sync_wallet")),s.default.createElement("div",{className:b.subTitle},n("extension_wallet_qr_subtitle_scan_confirm",{acctname:a})),s.default.createElement(te,{accountInfo:t,userInfo:i}),s.default.createElement(u.Text,{className:b.scanTip,size:u.SIZE.sm,align:u.ALIGN.center},n("extension_wallet_qr_text_operational_tips")))),Ht=ee;o();r();var rt=T(C());var qt=()=>{let t=M(),[i,a]=(0,rt.useState)({userInfo:null});return(0,rt.useEffect)(()=>{!t||(async()=>{try{let{data:l,code:e}=await Lt({},{headers:{Authorization:t}});a({userInfo:l,code:e})}catch{a({userInfo:{}})}})()},[t]),i};var oe=()=>{let t=(0,Kt.useHistory)(),i=j(),a=$(),l=(0,nt.useDispatch)(),{userInfo:e,code:m}=qt(),_=(0,nt.useSelector)(Y),{accountInfo:f}=Ut(),I=(0,c.useMemo)(()=>e?.phone||e?.email||"",[e]);(0,c.useEffect)(()=>{f&&e&&(f?.accountStatus===p.VERIFY_PASS?(at.success({title:n("extension_wallet_error_toast_verification_successful")}),l(Q.setKeepOpen({show:!0})),g().setMpcAction("",""),t.push(W)):m===0&&at.success({title:n("extension_wallet_qr_toast_login_successful",{acctname:I})}))},[f,e,I,m]);let y=async()=>{g().setMpcAction("","")};if((0,c.useEffect)(()=>(window.addEventListener("beforeunload",y),()=>{window.removeEventListener("beforeunload",y)}),[]),!f||!e)return c.default.createElement("div",{className:G.loadingContainer},c.default.createElement(U.Circle,null));let O=()=>{g().setMpcAction("",""),t.push(W)},k=()=>{switch(f.accountStatus){case p.IMPORTED:return c.default.createElement(et,{title:n("extension_wallet_verification_title_account_duplicate",{acctname:I}),text:n("extension_wallet_verification_text_account_duplicate1"),footer:c.default.createElement(F.FooterActions,{placeholder:!1},c.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.lg,block:!0,onClick:O},n("extension_wallet_verification_btn_return")))});case p.NOT_CREATE:return c.default.createElement(et,{title:n("extension_wallet_login_title_not_created",{acctname:I}),text:n("extension_wallet_login_text_not_created1"),footer:c.default.createElement(Wt,null)});case p.ACCOUNT_MISMATCH:return c.default.createElement(et,{title:n("extension_wallet_verification_title_account_mismatch"),text:n("extension_wallet_verification_text_account_mismatch1"),footer:c.default.createElement(F.FooterActions,{placeholder:!1},c.default.createElement(d,{type:d.TYPE.highlight,size:d.SIZE.lg,block:!0,onClick:O},n("extension_wallet_verification_btn_return")))});case p.NOT_IMPORTED:case p.RECOVER:return c.default.createElement(Ht,{accountInfo:f,userInfo:e,accountName:I});default:return null}};return c.default.createElement("div",{className:G.container},c.default.createElement(bt,{onBack:O,closeable:!1,bordered:!1}),c.default.createElement("div",{className:G.main},k()),c.default.createElement(it,{visible:f.accountStatus===p.TOKEN_EXPIRED||m!==0,title:n("extension_wallet_error_toast_title_verify_again"),text:n("extension_wallet_error_toast_text_verify_again1"),infoType:it.Prompt.INFO_TYPE.warn,hideCloseBtn:!0,alignBottom:!1,footer:c.default.createElement(d,{category:d.CATEGORY.fill,type:d.TYPE.highlight,size:d.SIZE.md,block:!0,onClick:async()=>{await g().setMpcAction(w.VERIFY,_),globalThis.open(a?.mpcLogin||`https://${i}${kt}`),window.close()}},n("extension_wallet_error_toast_btn_verification"))}))},fr=oe;export{fr as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Import-LU2YFZLD.js.map
