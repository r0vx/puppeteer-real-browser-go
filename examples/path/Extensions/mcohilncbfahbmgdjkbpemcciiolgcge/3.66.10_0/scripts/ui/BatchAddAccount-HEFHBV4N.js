import{a as f,b as kt}from"./chunk-JEHXTOJ7.js";import{a as bt}from"./chunk-MZSDFALS.js";import{a as Bt}from"./chunk-32BL2FRE.js";import{a as Nt,b as et}from"./chunk-Y2R33A3S.js";import{a as ht}from"./chunk-6LM53EG2.js";import"./chunk-DHQ6D2W3.js";import{a as Y}from"./chunk-P3XA54LG.js";import"./chunk-6JEFG7DQ.js";import{c as V}from"./chunk-ZTIVM5ML.js";import{a as pt,b as yt,c as xt,d as At}from"./chunk-MEH5CVYN.js";import"./chunk-UM2UK5YS.js";import{S as dt}from"./chunk-NQAVUB4Q.js";import{a as ot}from"./chunk-CBHKW7LL.js";import"./chunk-JU4HVVJ2.js";import"./chunk-NKWTNXAD.js";import{a as G}from"./chunk-Q7FGM7BT.js";import{Wa as H,Xa as M}from"./chunk-QMENNGDH.js";import"./chunk-V34MB2FG.js";import{o as oo}from"./chunk-XP3TNE3R.js";import{jc as gt}from"./chunk-QRHYK2TW.js";import"./chunk-PODZSVO7.js";import"./chunk-QO4JMOUQ.js";import{a as wt}from"./chunk-532YJKK4.js";import{j as _t,p as to}from"./chunk-Q4YLD24R.js";import{f as ft,i as Rt}from"./chunk-K5ZGZULR.js";import"./chunk-M6J3OOFH.js";import"./chunk-ZDOH3CEJ.js";import{c as K,e as lt}from"./chunk-AS4Z3FNS.js";import"./chunk-4EIUGT5A.js";import"./chunk-7FRDKLRJ.js";import"./chunk-P7VKC6DQ.js";import"./chunk-D7FW64MN.js";import"./chunk-6ZZOO2CD.js";import"./chunk-JPTLCZ2Y.js";import"./chunk-AVC4ODUV.js";import"./chunk-RJ3YTAFM.js";import"./chunk-OCAFSBNZ.js";import{c}from"./chunk-62ZAND24.js";import{a as It}from"./chunk-SIITVWZR.js";import{A as st,B as it,I as Qt,Zd as ct,ja as at,ka as Xt,oe as $t}from"./chunk-QHXUL3YM.js";import{H as T,n as k,y as d}from"./chunk-MOTAOJVG.js";import"./chunk-FYTT4U7M.js";import{D as C,q as mt,w as ut}from"./chunk-XR4SQWL7.js";import"./chunk-NCGYY6X6.js";import"./chunk-LMBQGBLO.js";import"./chunk-QWIXUG3W.js";import"./chunk-Z3JMRMVO.js";import"./chunk-CYTB2B6Q.js";import"./chunk-CAFKDDXA.js";import"./chunk-CTOTVO2J.js";import"./chunk-6P63CWAB.js";import"./chunk-RJPAKY6O.js";import"./chunk-ZCK5UHUS.js";import"./chunk-ANUO2YYF.js";import{ka as x}from"./chunk-6M3PZK2X.js";import"./chunk-TPIKSUHH.js";import{b as g}from"./chunk-OL67KS7C.js";import"./chunk-TVBFJITU.js";import"./chunk-2EEW2VNF.js";import"./chunk-NLMDM2WF.js";import"./chunk-BJAL3374.js";import"./chunk-KDUIZVRC.js";import"./chunk-263G66VF.js";import"./chunk-SUANL2KV.js";import"./chunk-2OVRHWIW.js";import"./chunk-32ZJ4F2J.js";import"./chunk-WIP2REO7.js";import"./chunk-JBHIVXO6.js";import"./chunk-LECESFCD.js";import"./chunk-NW4HKKTQ.js";import"./chunk-EBMX24YQ.js";import"./chunk-3C4MEE67.js";import"./chunk-R4BHRBC7.js";import{f as p,o as t,q as o}from"./chunk-SHG7TIBL.js";t();o();var R=p(g()),U=p(wt());t();o();var W=p(g());t();o();var Z=p(g());t();o();var rt={root:"_root_dowdc_1",header:"_header_dowdc_30"};t();o();t();o();var Lt=p(g());t();o();var v=ot(yt,At),j=ot(pt,xt);t();o();var Et=p(wt());function eo(){let e=(0,Et.useHistory)(),r=s=>(y=!0)=>{y?e.replace(s):e.push(s)},n=s=>e.location.pathname===s,i=r(M),m=r(H),u=n(H),a=n(M);return{isHomePage:u,isAddPage:a,gotoAddPage:i,gotoHomePage:m}}var z=eo;function ro(){let[e]=v(),{gotoHomePage:r,isHomePage:n}=z();(0,Lt.useLayoutEffect)(()=>{!n&&!e&&r()},[r,n,e])}var Ft=ro;function no(){return Ft(),null}var St=no;function so({children:e,hidden:r=!1}){return Z.default.createElement(c.Box,{className:rt.root},Z.default.createElement(Bt,{className:rt.header}),r?null:e,Z.default.createElement(St,null))}var q=so;t();o();var J=p(g());T();t();o();var O={root:"_root_5jwcg_1",titleBox:"_titleBox_5jwcg_17",title:"_title_5jwcg_17",subtitle:"_subtitle_5jwcg_112",add:"_add_5jwcg_131"};function io(){let e=d("wallet_extension_addaccount_title_add_account"),r=d("wallet_extension_addaccount_subtitle_select_account");return J.default.createElement(c.Box,{className:O.titleBox},J.default.createElement(c.Box,{className:O.title},e),J.default.createElement(c.Box,{className:O.subtitle},r))}var Tt=io;t();o();var _=p(g());T();t();o();var E={root:"_root_1umy7_2",confirm:"_confirm_1umy7_41",max:"_max_1umy7_55",label:"_label_1umy7_67",name:"_name_1umy7_73",nums:"_nums_1umy7_80",option:"_option_1umy7_86",icon:"_icon_1umy7_105"};t();o();var Ct=p(g());T();$t();var ao=e=>e.filter(r=>[ct.MNEMONIC].includes(r.keyringIdentityType)).filter(r=>r.walletIdentities.every(n=>n.needBackup!==1)),nt=1;function mo(){let e=C.useForm(),{gotoAddPage:r}=z(),{keyringIdentities:n,remainAccountAmount:i}=Y(),[,m]=j(),[,u]=v(),a=h=>{if(Object.keys(e.getErrors()).length>0)return;let{keyringId:S,amount:B}=h;if(B==="0")return;let tt=Number(B||nt);!S||tt>i||(m(tt),u(S),r())},s=(0,Ct.useMemo)(()=>ao(n).map(h=>({value:h.keyringId,label:h.keyringName,len:h.walletIdentities.length})),[n]),y={keyringId:s[0]?.value,amount:""},N=(h,F=nt)=>{if(Number(F||nt)<=i&&i>0)return Promise.resolve();let B=d("wallet_extension_addaccount_remainder_added_upper_limits",{num:k.thousandFormat(i)});return Promise.reject(B)},A=()=>{e.setFieldsValue({amount:i})},b=i<=0||s.length<=0;return{initialValues:y,onSubmit:a,form:e,options:s,amountValidator:N,onSetMaxAmount:A,disableAdd:b}}var Dt=mo;function uo(){let{initialValues:e,onSubmit:r,form:n,options:i,amountValidator:m,onSetMaxAmount:u,disableAdd:a}=Dt(),{isSm:s}=V(),y=s?G.FooterActions:_.default.Fragment,N=A=>_.default.createElement(_.default.Fragment,null,_.default.createElement("div",{className:E.name},A.label),_.default.createElement("div",{className:E.nums},d("wallet_extension_batch_modify_account_desc",{num:k.thousandFormat(A.len)})));return _.default.createElement(c.Box,{className:E.root},_.default.createElement(C,{requiredMark:!0,initialValues:e,onSubmit:r,form:n},_.default.createElement(C.Item,{label:d("wallet_extension_addaccount_title_select_wallet"),name:"keyringId"},_.default.createElement(ut,{title:d("wallet_extension_addaccount_title_select_wallet"),options:i,searchable:!1,showSelectedIcon:!0,label:A=>_.default.createElement("div",{className:E.label},N(A)),renderOption:({option:A,activeIcon:b})=>_.default.createElement("div",{className:E.option},_.default.createElement("div",null,N(A)),_.default.createElement("div",{className:E.icon},b))})),_.default.createElement(C.Item,{label:d("wallet_extension_addaccount_text_added_amount"),name:"amount",rules:[{validator:m}]},_.default.createElement(mt.Number,{placeholder:"1",precision:0,min:1,suffix:_.default.createElement(c.Box,{className:E.max,onClick:u},d("wallet_extension_addaccount_textbtn_max"))})),_.default.createElement(y,null,_.default.createElement(C.Item,{noStyle:!0,className:!s&&E.confirm},_.default.createElement(x,{category:x.CATEGORY.fill,type:x.TYPE.highlight,size:x.SIZE.xl,disabled:a,htmlType:"submit",block:!0},d("wallet_extension_addaccount_btn_add"))))))}var vt=uo;function co(){return W.default.createElement(q,null,W.default.createElement(c.Box,{className:O.root},W.default.createElement(Tt,null),W.default.createElement(vt,null)))}var Ot=co;t();o();var D=p(g());t();o();var Pt={root:"_root_1uqqr_1"};t();o();var w=p(g()),Wt=p(gt()),Ut=p(oo());t();o();lt();var Ht=p(gt());to();Rt();var lo=()=>{let e=(0,Ht.useDispatch)();return async(n,i=1)=>{try{return await K().addNewWallets(n,i)}catch(m){throw e(ft(m?.message)),m}finally{await _t(e)}}},Mt=lo;lt();var fo=e=>{let{newAccountsSuccessCount:r,newAccountsFailedCount:n}=e.metamask;return{newAccountsSuccessCount:r,newAccountsFailedCount:n}},_o=e=>{let[r,n]=(0,w.useState)(f.NONE),{newAccountsSuccessCount:i,newAccountsFailedCount:m}=(0,Wt.useSelector)(fo),u=et(),a=(0,w.useRef)(),[s]=j(),[y,N]=(0,w.useState)(0),[A,b]=(0,w.useState)(0),h=Mt(),F=s-y,S=P=>P>0;(0,w.useEffect)(()=>{s<=0||(y===s&&n(f.FINISHED),A===s&&n(f.FAILED))},[A,y,s]);let B=async()=>{if(!(y>0)&&!!S(s)){n(f.ADDING);try{let P=await h(e,s);N(P),b(s-P)}catch{b(s)}finally{n(f.FINISHED)}}};return{start:B,cancel:()=>{n(f.FINISHED),a.current?.cancel()},retry:()=>{F>0&&(b(0),B())},failed:u?A+m:A,success:u?y+i:y,total:s,remain:F,status:r}},po=e=>{let{keyringIdentities:r,remainAccountAmount:n}=Y(),i=r.find(u=>u.keyringId===e),m=i?.walletIdentities?.[0]?.walletId;return{keyring:i,walletId:m,remainAccountAmount:n}};function yo(){let[e]=v(),r=et(),n=(0,Ut.useLatest)(r),{walletId:i,keyring:m,remainAccountAmount:u}=po(e),a=(0,w.useRef)(!1),{start:s,cancel:y,retry:N,success:A,failed:b,total:h,status:F}=_o(i),S=bt();return(0,w.useEffect)(()=>{!a.current&&i&&u>0&&(s(),a.current=!0)},[i,u,s]),(0,w.useEffect)(()=>{let B=async()=>{n.current===!0&&K().stopBatchAddNewWallets()};return window.addEventListener("beforeunload",B),()=>{window.removeEventListener("beforeunload",B)}},[]),{start:s,cancel:y,retry:N,success:A,failed:b,total:h,keyring:m,status:F,onFinish:S}}var Kt=yo;t();o();var Vt=p(g()),Yt=p(It());T();t();o();var Gt={root:"_root_x2b1d_1"};var xo=({status:e,className:r,walletName:n})=>{let m={[f.NONE]:null,[f.ADDING]:{key:"wallet_extension_addaccount_remainder_account_creating",params:{acctName:n}},[f.FINISHED]:{key:"wallet_extension_addaccount_remainder_account_created"},[f.FAILED]:{key:"wallet_extension_addaccount_adding_maintitle_create_failed"}}[e],u=m?d(m.key,m.params):"";return Vt.default.createElement(c.Box,{className:(0,Yt.default)(Gt.root,r)},u)},jt=xo;t();o();var X=p(g());T();t();o();var Q={root:"_root_1n2pz_1",item:"_item_1n2pz_75",retry:"_retry_1n2pz_98"};t();o();T();var Ao=({status:e,success:r=0,total:n=0,failed:i=0})=>{let u=f.FINISHED===e?n-r:i,a={success:{key:"wallet_extension_addaccount_adding_text_create_success",params:{num:k.thousandFormat(r)}},failed:{key:"wallet_extension_addaccount_adding_text_create_failed",params:{num:k.thousandFormat(u)},withRetry:u>0},adding:{key:"wallet_extension_addaccount_remainder_created_account",params:{successnum:k.thousandFormat(r),totalnum:k.thousandFormat(n)}}};return{items:{[f.NONE]:[],[f.ADDING]:[a.adding],[f.FINISHED]:[a.success,u>0?a.failed:void 0].filter(Boolean),[f.FAILED]:[a.failed]}[e]}},zt=Ao;function go(e){let{items:r=[]}=zt(e),{retry:n}=e;return X.default.createElement(c.Box,{className:Q.root},r.map((i,m)=>{let{key:u,params:a,withRetry:s}=i;return X.default.createElement(c.Box,{key:m,className:Q.item},d(u,a),s&&X.default.createElement(c.Box,{onClick:n,className:Q.retry},d("wallet_extension_addaccount_adding_textbtn_retry")))}))}var Zt=go;t();o();var I=p(g()),$=p(It());T();Xt();Qt();t();o();var L={root:"_root_1gfwy_1",actions:"_actions_1gfwy_21",adding:"_adding_1gfwy_38",finish:"_finish_1gfwy_52",tip:"_tip_1gfwy_88",hiddenTip:"_hiddenTip_1gfwy_154",mobileFinishActions:"_mobileFinishActions_1gfwy_162"};function wo(e){let{isSm:r}=V(),{status:n,cancel:i,download:m,finish:u}=e,a=n===f.ADDING,s=at(),y=r?G:c.Box,N=r&&!a?{offsetBottom:0,className:(0,$.default)(L.actions,L.mobileFinishActions)}:{};return I.default.createElement(c.Box,{className:L.root},I.default.createElement(y,{className:(0,$.default)(L.actions,a?L.adding:L.finish),...N},a?I.default.createElement(I.default.Fragment,null,I.default.createElement(x,{category:x.CATEGORY.outline,type:x.TYPE.primary,onClick:i,size:x.SIZE.xl,block:!0},d("wallet_extension_addaccount_adding_btn_cancel"))):I.default.createElement(I.default.Fragment,null,s!==st&&s!==it&&I.default.createElement(x,{category:x.CATEGORY.outline,type:x.TYPE.primary,size:x.SIZE.xl,onClick:Nt(dt)(m),block:r},d("wallet_extension_addaccount_adding_btn_download_address")),I.default.createElement(x,{category:x.CATEGORY.fill,type:x.TYPE.highlight,size:x.SIZE.xl,onClick:u,block:r},d("wallet_extension_addaccount_adding_btn_confirm")))),I.default.createElement(c.Box,{className:(0,$.default)(L.tip,!a&&L.hiddenTip)},a?d("wallet_extension_addaccount_adding_text_not_close"):""))}var qt=wo;function Io(){let{cancel:e,retry:r,success:n,failed:i,total:m,keyring:u,status:a,onFinish:s}=Kt(),{downloadAddress:y}=ht();return D.default.createElement(q,{hidden:a===f.NONE},D.default.createElement(c.Box,{className:Pt.root},D.default.createElement(kt,{status:a}),D.default.createElement(jt,{status:a,walletName:u?.keyringName}),D.default.createElement(Zt,{status:a,retry:r,total:m,failed:i,success:n}),D.default.createElement(qt,{status:a,cancel:e,download:y,finish:s})))}var Jt=Io;var En=()=>R.default.createElement(U.Switch,null,R.default.createElement(U.Route,{path:H,component:Ot,exact:!0}),R.default.createElement(U.Route,{path:M,component:Jt,exact:!0}));export{En as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=BatchAddAccount-HEFHBV4N.js.map
