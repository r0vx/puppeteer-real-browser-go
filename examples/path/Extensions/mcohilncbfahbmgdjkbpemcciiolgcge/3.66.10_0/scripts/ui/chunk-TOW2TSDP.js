import{o as w}from"./chunk-XP3TNE3R.js";import{c as l,e as M}from"./chunk-AS4Z3FNS.js";import{Ra as T,Sa as Y,c}from"./chunk-QHXUL3YM.js";import{H as O,b as d}from"./chunk-MOTAOJVG.js";import{L as P,ra as H}from"./chunk-CYTB2B6Q.js";import{b as S}from"./chunk-OL67KS7C.js";import{f as o,o as n,q as t}from"./chunk-SHG7TIBL.js";n();t();var p=o(S()),D=o(w());M();n();t();var _=o(S());n();t();var y=o(c());M();var U={EXTENSION_INSTALLED:"EXTENSION_INSTALLED",EXTENSION_UNINSTALLED:"EXTENSION_UNINSTALLED"},j=e=>!!e?.type&&!!e?.data&&e.type===U.EXTENSION_INSTALLED,G=e=>!!e?.type&&!!e?.data&&e.type===U.EXTENSION_UNINSTALLED,v=e=>{let s=r=>{if(j(r)){let a=r?.data||[];e(a)}};return y.default.runtime.onMessage.addListener(s),l().addOnInstallExtensionListener(),()=>{y.default.runtime.onMessage.removeListener(s),l().removeOnInstallExtensionListener()}},q=e=>{let s=r=>{if(G(r)){let a=r?.data||[];e(a)}};return y.default.runtime.onMessage.addListener(s),l().addOnUnInstallExtensionListener(),()=>{y.default.runtime.onMessage.removeListener(s),l().removeOnUnInstallExtensionListener()}};var J=(e,s,r)=>{(0,_.useEffect)(()=>{if(!e)return()=>{};let a=s.listenInstall?v(r):void 0,m=s.listenUninstall?q(r):void 0;return()=>{e&&(a?.(),m?.())}},[e,s,r])},A=J;function Re(e,s={}){let[r,a]=(0,p.useState)([]),[m,u]=(0,p.useState)(!0),[g,f]=(0,p.useState)(null),x=(0,D.useMemoizedFn)(async()=>{u(!0),f(null);try{let L=await l().getInstalledExtensions();a(L)}catch(L){f(L)}finally{u(!1)}});(0,p.useEffect)(()=>{!e||x()},[x,e]),A(e,s,x);let I=(0,p.useMemo)(()=>new Set((r??[]).map(L=>L.id)),[r]);return{extensions:r,loading:m,error:g,refresh:x,extensionIds:I}}n();t();var B=o(c());O();var W=()=>d.isEdge?"edge://extensions/":d.isFirefox?"about:addons":d.isOpera?"opera://extensions/":d.isBrave?"brave://extensions/":"chrome://extensions/";function Z(){let e=W();B.default.tabs.create({url:e})}var ee=Z;n();t();n();t();var re=o(c());n();t();var ne=o(c());n();t();var te=o(c());n();t();var ae=o(c());n();t();var oe=o(c());n();t();n();t();var h=o(c());O();var me=()=>!(!h.default.permissions||!h.default.management||d.isOKXDesktop||d.isSafari||d.isFirefox),F=me;var N=F;n();t();var ue=o(c());n();t();var fe=o(c());n();t();var R=o(S()),E=o(w());M();function Un(){let[e,s]=(0,E.useLocalStorageState)("managementPermission",{defaultValue:!1}),[r,a]=(0,R.useState)(!0),m=(0,R.useMemo)(()=>N(),[]),u=(0,E.useMemoizedFn)(async()=>{a(!0);let f=await l().checkManagementPermission();s(f),a(!1)}),g=(0,E.useMemoizedFn)(async()=>{if(!m)return!1;let f=await l().requestManagementPermission();return s(f),f});return(0,E.useMount)(()=>{m&&u()}),{hasPermission:!!e,loading:r,requestPermission:g,refresh:u,supportManagement:m}}n();t();var V=o(S()),k=o(w());H();n();t();Y();n();t();async function ce(e,s){await e.reduce(async(r,a,m,u)=>(await r,s(a,m,u)),Promise.resolve())}var K=ce;async function le(e,s){let r=`${e.id}-${e.version}`,a=await T.risk_extension,m=await a.get(r),u=Date.now();await a.set({riskExtensionKey:r,id:e.id,version:e.version,riskInfo:e.riskInfo,createTime:m?.createTime??s??u,updateTime:s??u})}async function C(e,s){await K(e,async r=>{await le(r,s)})}async function b(e){return await(await T.risk_extension).query(e)??[]}async function $(e){return await b({updateTime:e})}n();t();var z=o(w()),de="lastRiskExtensionRequestTime";function Q(){let[e,s]=(0,z.useLocalStorageState)(de,{defaultValue:0});return[e??0,s]}function Jn(e){let[s,r]=Q(),[a,m]=(0,V.useState)([]),u=(0,k.useMemoizedFn)(async()=>{try{return await b()}catch{return[]}});(0,k.useAsyncEffect)(async()=>{if(!P(s))try{let f=await $(s);m(f)}catch{}},[e]);let g=(0,k.useMemoizedFn)(async f=>{try{let x=Date.now();await C(f.map(I=>({id:I.id,version:I.version,riskInfo:I.riskInfo,name:I.name})),x),r(x)}catch{}});return{lastScannedRiskList:a,setLastScannedRiskList:m,getAllRiskExtensions:u,setRiskExtensionList:g,lastRequestTime:s}}export{Re as a,ee as b,N as c,Un as d,Jn as e};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-TOW2TSDP.js.map
