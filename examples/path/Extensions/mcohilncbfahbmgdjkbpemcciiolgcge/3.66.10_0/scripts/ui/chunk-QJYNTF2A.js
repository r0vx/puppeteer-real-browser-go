import{a as N,b as f,k as te}from"./chunk-SR7OSGG2.js";import{a as Xt}from"./chunk-TW4KQJBW.js";import{a as Qt}from"./chunk-7DDBBEVP.js";import{a as jt,c as Z,d as Jt}from"./chunk-NZOYKJV7.js";import{a as zt}from"./chunk-NKIUEXOA.js";import{a as $t}from"./chunk-4ZGOJDNI.js";import{a as Zt}from"./chunk-LOILO52X.js";import{f as Lt}from"./chunk-Q6REWZWR.js";import{b as Ut}from"./chunk-FKISPHB5.js";import{a as qt,b as at}from"./chunk-B3SXRDEQ.js";import{a as Gt,e as Ht,f as Kt}from"./chunk-F6UVHIJV.js";import{e as Ft}from"./chunk-636UWIUZ.js";import{c as Mt}from"./chunk-JSOLAK4X.js";import{a as st,j as Bt}from"./chunk-IEGAVAV7.js";import{l as Yt,n as Vt,p as Wt}from"./chunk-KDVER5QK.js";import{a as V}from"./chunk-PD44C7EF.js";import{b as B}from"./chunk-67F2WFQO.js";import{b as rt}from"./chunk-QYDRYMWS.js";import{Y as bt}from"./chunk-QMENNGDH.js";import{o as Dt}from"./chunk-XP3TNE3R.js";import{Fb as Ct,Jb as St,Nb as wt,Ob as ht,Ua as g,ib as K,jc as q,tb as vt,vb as Ot}from"./chunk-QRHYK2TW.js";import{a as ve}from"./chunk-532YJKK4.js";import{j as U,p as It}from"./chunk-Q4YLD24R.js";import{c as y,e as Y}from"./chunk-AS4Z3FNS.js";import{a as kt,b as w}from"./chunk-2FDQIA7D.js";import{E as b,n as L}from"./chunk-4EIUGT5A.js";import{a as W}from"./chunk-VL2YBSHB.js";import{Wa as Re,Y as At,a as ft,b as Ee,gc as yt,hc as Rt,ia as Ne,kb as Pt,mb as Nt,na as Et,ob as xe,od as xt,ra as ye}from"./chunk-QHXUL3YM.js";import{H as gt,y as S}from"./chunk-MOTAOJVG.js";import{G as h}from"./chunk-XR4SQWL7.js";import{L as Tt,V as _t,f as ot,ra as Pe}from"./chunk-CYTB2B6Q.js";import{b as nt}from"./chunk-OL67KS7C.js";import{f as v,o as T,q as _}from"./chunk-SHG7TIBL.js";T();_();var I=v(q());function qe(){let t=(0,I.useSelector)(Kt),e=t&&t.metadata?t.metadata.id:null,n=e?1:0,o=(0,I.useSelector)(Ot),r=o.length,a=(0,I.useSelector)(vt),i=(0,I.useSelector)(ht),m=i.length,s=(0,I.useSelector)(wt),c=s.length,p=(0,I.useSelector)(Ht);return{unapprovedTxList:o,unapprovedTxCount:r,unapprovedSmCount:a,unapprovedStList:i,unapprovedStCount:m,unapprovedPermissionCount:n,unapprovedPermissionsRequestId:e,unapprovedSnList:s,unapprovedSnCount:c,realGeneralDappRequestsCount:p,unapprovedRequestCount:r+a+m+c+n+p}}T();_();T();_();var A=v(nt()),ut=v(q()),de=v(ve());gt();T();_();var z=v(q()),G=v(Dt()),D=v(Re());Pe();Ee();Y();ye();xt();T();_();Y();var ee=async t=>await y().rpcEvmAddTransaction(t),it=async t=>await y().rpcEvmUpdateTransaction(t),oe=async t=>await y().rpcEvmConfirmTransaction(t),ne=async t=>await y().rpcEvmFindTransaction(t),re=async(t,e)=>await y().rpcEvmPublishTransaction(t,e);T();_();var ae=v(nt());gt();var Oe=()=>{let t=te();return e=>{if(e){let{type:n,status:o,txHash:r,extraParams:a}=e,i={[f.TRANS_OUT]:{key:"wallet_transfer_notif_send_success",params:{first:a?.value,second:a?.coinSymbol}},[f.CONTRACT_CALL]:{key:"wallet_transfer_notif_contract_interaction_success"},[f.AUTHORIZATION]:{key:"wallet_transfer_notif_approval_success",params:{first:a?.coinSymbol}},[f.CANCEL_AUTHORIZATION]:{key:"wallet_transfer_notif_cancel_approval_success",params:{first:a?.coinSymbol}},[f.CONTRACT_DEPLOY]:{key:"developer_mode_dapp_toast_deployed_successfully"}},m={[f.TRANS_OUT]:{key:"wallet_transfer_notif_send_fail",params:{first:a?.value,second:a?.coinSymbol}},[f.CONTRACT_CALL]:{key:"wallet_transfer_notif_contract_interaction_fail"},[f.AUTHORIZATION]:{key:"wallet_transfer_notif_approval_fail",params:{first:a?.coinSymbol}},[f.CANCEL_AUTHORIZATION]:{key:"wallet_transfer_notif_cancel_approval_fail",params:{first:a?.coinSymbol}},[f.CONTRACT_DEPLOY]:{key:"developer_mode_dapp_toast_deployfailed"}},s,c,p,l,d;o===N.PENDING?(s=h.TYPE.success,n===f.CANCEL_AUTHORIZATION?(c="wallet_transfer_notif_cancel_approval_submit",p={first:a?.coinSymbol}):c="wallet_transfer_notif_transaction_submit"):(o===N.SUCCEED?(s=h.TYPE.success,c=i[n]?.key,p=i[n]?.params):(s=h.TYPE.error,c=m[n]?.key,p=m[n]?.params),o!==N.DROPPED&&(l=t(r),d="wallet_transfer_notif_view_on_explorer")),h[s]({title:S(c,p)||c,desc:l?ae.default.createElement(Zt,{url:l,urlText:S(d)}):null,duration:3})}}},se=Oe;function Se(t){let e={to:t.to,value:(0,D.addHexPrefix)(w(t.value)),gasLimit:(0,D.addHexPrefix)(w(t.gasLimit)),nonce:(0,D.addHexPrefix)(w(t.nonce)),kaiaTxType:t.kaiaTxType,signFn:t.signFn};return t.type===L.FEE_MARKET?(e.maxFeePerGas=(0,D.addHexPrefix)(w(t.maxFeePerGas)),e.maxPriorityFeePerGas=(0,D.addHexPrefix)(w(t.maxPriorityFeePerGas)),e.type=t.type):(e.gasPrice=(0,D.addHexPrefix)(w(t.gasPrice)),t.type=L.LEGACY),t.data&&(e.data=t.data),e}function ct(t){let{extensionConfig:e}=V("rpc_info"),n=t||e,o=B();return(0,G.useMemoizedFn)(r=>{let{type:a,txParams:i,extraParams:m}=r,s=a;return s||(i.to?s=f.CONTRACT_CALL:s=f.CONTRACT_DEPLOY),{id:Et(),type:s,txParams:{...Se(i),from:i.from||o,chainId:n.chainId},status:N.UNAPPROVED,createTime:+new Date,txPool:[],isCanceling:!1,isSpeeding:!1,extraParams:m||{}}})}function mt(t){let e=se(),n=(0,z.useSelector)(St),o=st();return(0,G.useMemoizedFn)(async(r,{walletId:a=o,signedCallback:i=ot}={})=>{if(!r)throw new Error("tx meta error");let m;if(r.txParams?.result)m=r.txParams.result;else{let{from:c}=r.txParams||{};m=await y().signRpcEvmTransaction(r.txParams,c,n,a)}if(r?.txParams?.signFn===b.KAIA_SIGN_TRANSACTION)return{rawTx:m};let s=await zt(yt,m);return await i({rawTx:m,txHash:s,status:N.PENDING}),new Promise((c,p)=>{re({txId:r.id,rawTx:m},t).then(({error:l,data:d,tx:u})=>{if(l){(u?.status===N.PENDING||u?.status===N.DROPPED)&&e(u),p(l);let{type:E,txParams:R,extraParams:C}=r,{from:k,to:x,value:M,gasLimit:F,gasPrice:P,maxFeePerGas:$,maxPriorityFeePerGas:j,data:J,nonce:Q,chainId:X}=R||{},{approvedAmount:tt,coinSymbol:lt,tokenAddress:dt,approvedAddress:et,value:ge,toAddress:Ae}=C||{};ft.captureEvent({tags:{address:k},message:"API_ERROR_evm_rpc_send_tx",contexts:{report:{info:JSON.stringify({type:E,txParams:{from:k,to:x,value:M,gasLimit:F,gasPrice:P,maxFeePerGas:$,maxPriorityFeePerGas:j,data:J,nonce:Q,chainId:X},extraParams:_t({approvedAmount:tt,coinSymbol:lt,tokenAddress:dt,approvedAddress:et,value:ge,toAddress:Ae},Tt)})}},exception:{values:[{type:"API_ERROR_evm_rpc_send_tx",value:l?.message}]},level:"info"})}else e(u),c({id:r.id,txHash:d.result})}).catch(async l=>{await oe({txId:r.id,tx:{status:N.DROPPED,finishTime:+new Date,errorMessage:l?.message},checkPoolEmpty:!0}),p(l)})})})}var pt=()=>{let t=(0,z.useDispatch)(),e=st();return async(n,o=e)=>{await t(Mt({walletId:o,txParams:n.txParams,isRpcMode:!0}));let{id:r}=n,a=await ne(r);if(a&&(a.status===N.SUCCEED||a.status===N.DROPPED||a.status===N.DROPPED))throw Error(W)}};function ie(t){let e=ct(t),n=mt(t),o=pt();return(0,G.useMemoizedFn)(async(r,a,i)=>{if(!await $t({walletId:a}))return ot;let s=e(r);return await o(s,a),n(s,{walletId:a,signedCallback:c=>{let p={...s,...c};try{i&&i(p)}catch{}return ee(p)}})})}function xo(){let t=ct(),e=mt(),n=pt();return(0,G.useMemoizedFn)(async(o,r)=>{let{type:a,txParams:i,extraParams:m}=o,s=t({type:a,txParams:{...i,...r},extraParams:m}),{id:c,txPool:p}=o;return o.id=s.id,s.id=c,o.txPool=[],await n(s),e(s,{signedCallback:l=>it({txId:c,tx:{...s,status:N.PENDING,isSpeeding:!0,txPool:[o,...p],...l}})})})}function vo(){let t=Vt(!0),e=ct(),n=mt(),o=pt();return(0,G.useMemoizedFn)(async(r,a)=>{let{txParams:i,extraParams:m}=r,{from:s,nonce:c,type:p,chainId:l}=i,d=t.find(({address:C})=>!C),u=e({type:f.TRANS_OUT,txParams:{to:s,value:"0x0",nonce:c,chainId:l,type:p,...a},extraParams:m}),{id:E,txPool:R}=r;return r.id=u.id,u.id=E,r.txPool=[],await o(u),n(u,{signedCallback:C=>it({txId:E,tx:{...u,status:N.PENDING,isCanceling:!0,txPool:[r,...R],extraParams:{toAddress:s,tokenAddress:"",coinSymbol:d?.symbol,value:"0"},...C}})})})}T();_();var H=v(nt()),ce=v(q()),me=v(Dt());Y();function pe(t,e){let n=B(),o=t||n,r=(0,ce.useSelector)(Ut),[a,i]=(0,H.useState)(!1),[m,s]=(0,H.useState)(null),[c,p]=(0,H.useState)(null),l=y(),d=(0,me.useMemoizedFn)(async()=>{i(!0);try{let{nonce:u,suggestedNonce:E}=await l.rpcEvmGetNonce(o,e);return s(u),p(E),{nonce:u,suggestedNonce:E}}finally{i(!1)}});return(0,H.useEffect)(()=>{d()},[o,r]),{loadingNonce:a,nonce:m,suggestedNonce:c,request:d}}Ne();T();_();var ue=async(t,e)=>{let n;try{n=await e.getCode(t)}catch{n=null}return{isContractAddress:Boolean(n&&n!=="0x"&&n!=="0x0")}};T();_();function le(t,{customPermissionAmount:e}){let n=K(t);if(n){if(n.name!==g.TOKEN_METHOD_APPROVE)throw new Error(`Invalid data; should be 'approve' method, but instead is '${n.name}'`)}else throw new Error("Invalid data");let o=Z(n);o.startsWith("0x")&&(o=o.substring(2));let[r,a]=t.split(o);if(!r||!a)throw new Error("Invalid data");if(a.length!==64)throw new Error("Invalid token value; should be exactly 64 hex digits long (u256)");let i=w(e);if(i.length>64)throw new Error("Custom value is larger than u256");return i=i.padStart(a.length,"0"),`${r}${o}${i}`}function we({data:t,to:e}){let n=Yt(),[o,r]=(0,A.useState)(""),[a,i]=(0,A.useState)(!1);return(0,A.useEffect)(()=>{(async()=>{if(t&&!e){r(g.DEPLOY_CONTRACT);return}try{let l=K(t)?.name,d=[g.TOKEN_METHOD_APPROVE,g.TOKEN_METHOD_TRANSFER,g.TOKEN_METHOD_TRANSFER_FROM].find(u=>u.toLowerCase()===l.toLowerCase());if(d){r(d);return}}catch{}i(!0);let s=await n(),{isContractAddress:c}=await ue(e,s);r(c?g.CONTRACT_INTERACTION:g.SENT_ETHER),i(!1)})()},[t,e,n]),[o,a]}function he({data:t,type:e}){let n,o,r,a;try{let i=K(t),m=Jt(i);n=Z(i),a=m,o=e===g.TOKEN_METHOD_APPROVE,r=o&&Number(a)===0}catch{}return{address:n,isApprove:o,isRevoke:r,amount:a}}function Ie(t,e){let n=Wt(void 0,e),[o,r]=(0,A.useState)({}),[a,i]=(0,A.useState)(!1),m=async()=>{try{i(!0);let{symbol:s,decimals:c}=await n(t);r({symbol:s,decimals:c}),i(!1)}catch{i(!1)}};return(0,A.useEffect)(()=>{t&&m()},[t]),[o,a]}function De(t){let[e,n]=(0,A.useState)(-1),{isApprove:o,amount:r}=t;return(0,A.useEffect)(()=>{o&&n(r)},[o,r]),[{...t,customApproveAmount:e},n]}function ke({origin:t,isApprove:e,isRevoke:n,symbol:o,walletId:r}){let a=Bt(r),i=(0,ut.useSelector)(Ct),m=r?a:i,c=(0,ut.useSelector)(Gt)[t]||{},[p,l]=(0,A.useState)({});return(0,A.useEffect)(()=>{let d=null,u=null,E=null;e?(d=null,u=o,E=n?S("wallet_approval_subtitle_revoke_approval_desc",{tokenSymbol:o}):S("wallet_dapp_conncetion_alert_approve_tip",{name:c.name,tokenSymbol:o})):(d=c.icon,E=c.host,u=c.name),l({icon:d,host:E,name:u})},[n,o]),{...p,originInfo:c,wallet:`${m.keyringName} - ${m.walletName}`}}function Fe(t,e){let{nonce:n,suggestedNonce:o}=pe(t,e),[r,a]=(0,A.useState)(0),[i,m]=(0,A.useState)(!0);return(0,A.useEffect)(()=>{a(o),m(!1)},[o]),[{suggested:n,custom:r,pending:i},a]}var Le=({tx:t,nonce:e,txData:n,tokenInfo:o,chain:r,customGasInfo:a,approvedAmount:i,formattedAmount:m,txType:s})=>{let{from:c,to:p,value:l,data:d}=t,{isSupportEip1559:u,maxFeePerGas:E,maxPriorityFeePerGas:R,gasPrice:C,gasLimit:k}=a,x={from:c,to:p,value:l,gasLimit:k,nonce:e,data:d};u?(x.maxFeePerGas=E,x.maxPriorityFeePerGas=R,x.type=L.FEE_MARKET):(x.gasPrice=C,x.type=L.LEGACY),t?.method===b.KAIA_SIGN_TRANSACTION&&(x.signFn=b.KAIA_SIGN_TRANSACTION,x.kaiaTxType=t?.typeInt);let F={[g.DEPLOY_CONTRACT]:f.CONTRACT_DEPLOY,[g.CONTRACT_INTERACTION]:f.CONTRACT_CALL,[g.TOKEN_METHOD_APPROVE]:f.AUTHORIZATION,[g.SENT_ETHER]:f.TRANS_OUT,[g.TOKEN_METHOD_TRANSFER]:f.TRANS_OUT,[g.TOKEN_METHOD_TRANSFER_FROM]:f.TRANS_OUT}[s]||f.CONTRACT_CALL;n.isRevoke&&(F=f.CANCEL_AUTHORIZATION);let P={};return s===g.TOKEN_METHOD_APPROVE&&(P.approvedAmount=i,P.coinSymbol=o.symbol,P.tokenAddress=p,P.approvedAddress=n.address),s===g.SENT_ETHER&&(P.value=At(kt(l)),P.toAddress=p,P.coinSymbol=r.symbol),(s===g.TOKEN_METHOD_TRANSFER||s===g.TOKEN_METHOD_TRANSFER_FROM)&&(P.value=m,P.tokenAddress=p,P.toAddress=n.address,P.coinSymbol=o.symbol),{type:F,txParams:x,extraParams:P}};function be(t,e,n){let o=(0,de.useHistory)(),r=Qt(),a=Xt(),i=ie(n),[m,s]=(0,A.useState)(!1);return[{sign:async(l,d)=>{s(!0),i(t,l,d).then(async({txHash:u,rawTx:E})=>{let R=t.signFn===b.KAIA_SIGN_TRANSACTION?{raw:E}:u;r({id:e,result:R}),o.push(bt)}).catch(u=>{u.message!==W&&h.error({title:u?.message}),r({id:e,error:u?.message||"Transaction failed"}),s(!1)}).finally(()=>{o.go(0)})},cancel:async()=>{await a({id:e}),o.go(0)}},m]}function Tn(t,e){let[n]=we(t),o=he({data:t.data,type:n}),[r,a]=Ie(t?.to,e),i=ke({walletId:t?.walletId,origin:t.origin,...o,...r}),m=(0,A.useMemo)(()=>jt(o?.amount||0,r?.decimals),[o?.amount,r?.decimals]),[s,c]=De({...o,...r,formattedAmount:m}),[p,l]=(0,A.useState)(t.data);(0,A.useEffect)(()=>{if(n===g.TOKEN_METHOD_APPROVE)try{let et=le(t.data,{customPermissionAmount:s.customApproveAmount});l(et)}catch{}},[s.customApproveAmount,t.data,r?.decimals,o,n]);let d={...e,name:e?.name||e?.chainName},[u,E]=Fe(t.from,e),{setGasType:R,currentGasInfo:C,chainGasLevels:k,chainGasLoading:x,setCustomGasOption:M,chainGasError:F,chainGasLoadFailed:P,chainGasLimitLoadFailed:$}=Lt({to:t.to,from:t.from,value:t.value||"0x0",data:p,method:t.method},{gasLimit:t.gas||t.gasLimit,gasPrice:t.gasPrice,maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas},e),j=Le({tx:{...t,data:p},nonce:u.custom||u.suggested,txData:o,tokenInfo:r,chain:d,customGasInfo:C,approvedAmount:s.customApproveAmount,formattedAmount:m,txType:n}),[{sign:J,cancel:Q},X]=be(j,t.id,e),tt=(0,A.useMemo)(()=>{switch(n){case g.DEPLOY_CONTRACT:return S("developer_mode_history_title_contract_eployment");case g.TOKEN_METHOD_APPROVE:return o?.isRevoke?S("wallet_extension_popup_btn_revoke_approval"):S("wallet_extension_popup_btn_approve");default:return S("wallet_extension_popup_title_contract_interaction")}},[n,o?.isRevoke]);return[{type:n,title:tt,auth:{...s,...r,formattedAmount:m},meta:i,chain:d,nonce:u,gas:{setGasType:R,chainGasLevels:k,currentGasInfo:C,setCustomGasOption:M,chainGasLoading:x,chainGasError:F,chainGasLoadFailed:P,chainGasLimitLoadFailed:$},loading:{sign:X,token:a},data:p},{sign:J,cancel:Q,setNonce:E,setAuthAmount:c}]}T();_();var _e=v(q());T();_();It();Y();function fe(t,e,n){return async o=>{await y().resolvePendingApproval(t,e);let{pendingApprovals:r}=await U(o);Object.values(r).length===0&&!n&&o(at())}}function Te(t){return async e=>{await y().rejectPendingApproval(t);let{pendingApprovals:n}=await U(e);Object.values(n).length===0&&e(at())}}It();xt();function kn(t){let e=(0,_e.useDispatch)(),o=(s=>{let{id:c,origin:p,requestData:l,type:d,requestData:{chainId:u}}=s;return{id:c,origin:p,...l,requestData:l,chainIdToDisplay:parseInt(u,16),switchType:d,explorers:l.blockExplorerUrl}})(t),{addRpcNetwork:r}=Ft(),{setExtensionConfig:a}=V("rpc_info");return[o,{cancel:async()=>{await e(Te(o.id)),await U(e)},approve:async()=>{let{rpcUrl:s,ticker:c,blockExplorerUrl:p,chainId:l,faucetUrl:d,chainName:u}=o,E=await r({chainId:l,explorerUrl:p,faucetUrl:d,name:u,rpcUrl:s,symbol:c}),{uniqueId:R}=E;await a(E),await e(rt("isRpcMode",!0)),await e(rt("currentNetworkUniqueId",R)),await e(qt(Rt,s,c,u,l,{},!0,R)),await e(fe(o.id,o.requestData)),await U(e)}}]}T();_();xe();function Gn(t){return Pt(t?.image)?t.image=t.image[0]:Nt(t?.image)&&(t.image=null),t}export{oe as a,ne as b,se as c,ie as d,xo as e,vo as f,pe as g,we as h,he as i,Le as j,Tn as k,kn as l,qe as m,Gn as n};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-QJYNTF2A.js.map
